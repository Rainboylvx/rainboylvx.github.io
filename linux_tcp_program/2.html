<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=cache-control content="max-age=0"><meta http-equiv=cache-control content="no-cache"><meta http-equiv=expires content="0"><meta http-equiv=expires content="Tue, 01 Jan 1980 1:00:00 GMT"><meta http-equiv=pragma content="no-cache"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png }><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#1b1b1b"><meta name=description content><script>(function(){const e=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");document.documentElement.setAttribute("data-theme",e)})()</script><title>| Rainboy's Blog</title><style>:root{--background:#ffffff}@media(prefers-color-scheme:dark){:root{--background:#1b1b1b}}html{background-color:var(--background)}body{background-color:var(--background)}</style><link rel=stylesheet type=text/css href=/style.min.9e52618e081d7542403ff6356f894d993b93e26eb37d3f072c70cd92f0c439ab.css media=all><link rel=stylesheet href=/grid.css><link href="https://fonts.font.im/css?family=Roboto+Mono" rel=stylesheet><style>body,.heti,.heti--sans{font-family:roboto mono,monospace,times new roman,times,heti song,serif,apple color emoji,segoe ui emoji,segoe ui symbol}</style></head><body><nav><ul class=menu><li><a tabindex=-1 class=menu-link href=/><u>H</u>ome</a></li><li><a tabindex=-1 class=menu-link href=/tags><u>T</u>ags</a></li><li><span style=cursor:pointer id=theme-switcher class=menu-link type=button><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon h-4 w-4"><path d="M12 3a6 6 0 009 9 9 9 0 11-9-9z"/></svg></span></li></ul></nav><div id=single-header><h1></h1><div id=single-meta></div></div><main class="heti heti--classic"><h2 id=学习目标>学习目标</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>mindmap
</span></span><span class=line><span class=ln>2</span><span class=cl>    root((学习目标))
</span></span><span class=line><span class=ln>3</span><span class=cl>        1.什么是socket
</span></span><span class=line><span class=ln>4</span><span class=cl>        2.IPv4套接口地址结构
</span></span><span class=line><span class=ln>5</span><span class=cl>        3.网终字节序
</span></span><span class=line><span class=ln>6</span><span class=cl>        4.字节序转换函数
</span></span><span class=line><span class=ln>7</span><span class=cl>        5.地址转换函数
</span></span><span class=line><span class=ln>8</span><span class=cl>        6.套接字类型
</span></span></code></pre></div><h2 id=1-什么是socket>1. 什么是socket</h2><ul><li>socket可以看成是用户进程与内核网络协议栈的
编程接口</li><li>socket不仅可以用于本机的进程间通信，还可以
用于网络上不同主机的进程间通信</li></ul><p>我的理解: socket就是对前面学习的tcp/ip的代码封装,但是位于系统的内核,也就是说提供给用户的一组API,用于网络通信.</p><link rel=stylesheet href=/css/vendors/admonitions.4fd9a0b8ec8899f2ca952048d255a569f433f77dfb3f52f5bc87e7d65cdce449.css integrity="sha256-T9mguOyImfLKlSBI0lWlafQz9337P1L1vIfn1lzc5Ek=" crossorigin=anonymous><div class="admonition warning"><div class=admonition-header><svg viewBox="0 0 512 512"><path d="M256 32c14.2.0 27.3 7.5 34.5 19.8l216 368c7.3 12.4 7.3 27.7.2 40.1S486.3 480 472 480H40c-14.3.0-27.6-7.7-34.7-20.1s-7-27.8.2-40.1l216-368C228.7 39.5 241.8 32 256 32zm0 128c-13.3.0-24 10.7-24 24v112c0 13.3 10.7 24 24 24s24-10.7 24-24V184c0-13.3-10.7-24-24-24zm32 224a32 32 0 10-64 0 32 32 0 1064 0z"/></svg>
<span>Warning</span></div><div class=admonition-content><p>socket 这里理解成"插座"</p></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>mindmap
</span></span><span class=line><span class=ln>2</span><span class=cl>    root((socket需要的属性))
</span></span><span class=line><span class=ln>3</span><span class=cl>        地址: sockaddr_in
</span></span><span class=line><span class=ln>4</span><span class=cl>            sin_addr
</span></span><span class=line><span class=ln>5</span><span class=cl>            sin_port
</span></span><span class=line><span class=ln>6</span><span class=cl>            sin_family
</span></span></code></pre></div><h2 id=ipv4-socket-地址结构体>ipv4 socket 地址结构体</h2><p>ipv4 socket地址结构体,在头文件<code>netinet/in.h</code>中定义。 <code>sockaddr_in</code>结构体定义如下：</p><p>使用<code>man 7 ip</code>命令查看<code>sockaddr_in</code>结构体的定义：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>1</span><span class=cl><span class=k>struct</span> <span class=n>sockaddr_in</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>    <span class=kt>sa_family_t</span> <span class=n>sin_family</span><span class=p>;</span> <span class=c1>// 地址族，ipv4 就是AF_INET
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=c1></span>    <span class=kt>in_port_t</span> <span class=n>sin_port</span><span class=p>;</span> <span class=c1>// 端口号    
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=c1></span>    <span class=k>struct</span> <span class=n>in_addr</span> <span class=n>sin_addr</span><span class=p>;</span> <span class=c1>// IP地址
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=c1></span>    <span class=kt>char</span> <span class=n>sin_zero</span><span class=p>[</span><span class=mi>8</span><span class=p>];</span> <span class=c1>// 未使用,注意这个在man 7 ip中没有说明
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=c1></span>                     <span class=c1>//暗示程序员不需要知道这个??
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=c1></span>                     <span class=c1>//当成上面的普通的来用?
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><ol><li><code>sin_family</code>字段表示地址族,socket在设计的时候还可以用于其它的协议,不仅是tcp/ip,比如还有<code>unix</code>域，对于IPv4地址，该值为<code>AF_INET</code>。</li><li><code>sin_port</code>字段表示端口号，使用网络字节序（big-endian）存储。</li><li><code>sin_addr</code>字段表示IP地址，使用<code>struct in_addr</code>结构体表示。</li></ol><p><code>struct in_addr</code>结构体定义如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>1</span><span class=cl><span class=k>struct</span> <span class=n>in_addr</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>    <span class=kt>uint32_t</span> <span class=n>s_addr</span><span class=p>;</span> <span class=c1>// IP地址，使用网络字节序存储
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><ol><li><code>s_addr</code>字段表示IP地址，使用网络字节序存储。</li></ol><h3 id=疑问1>疑问1</h3><div class="admonition note"><div class=admonition-header><svg viewBox="0 0 576 512"><path d="M0 64C0 28.7 28.7.0 64 0H224v128c0 17.7 14.3 32 32 32h128v125.7l-86.8 86.8c-10.3 10.3-17.5 23.1-21 37.2l-18.7 74.9c-2.3 9.2-1.8 18.8 1.3 27.5L64 512c-35.3.0-64-28.7-64-64V64zm384 64H256V0L384 128zM549.8 235.7l14.4 14.4c15.6 15.6 15.6 40.9.0 56.6l-29.4 29.4-71-71 29.4-29.4c15.6-15.6 40.9-15.6 56.6.0zM311.9 417 441.1 287.8l71 71L382.9 487.9c-4.1 4.1-9.2 7-14.9 8.4l-60.1 15c-5.5 1.4-11.2-.2-15.2-4.2s-5.6-9.7-4.2-15.2l15-60.1c1.4-5.6 4.3-10.8 8.4-14.9z"/></svg>
<span>Note</span></div><div class=admonition-content><p>到这里就有一个疑问,<code>socketaddr_in</code>结构体具体的定义是什么呢?后面有没有<code>char sin_zero[8];</code>字段呢?通过下面的代码来验证</p></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>1</span><span class=cl><span class=p>{{</span><span class=err>#</span><span class=n>include</span> <span class=p>.</span><span class=o>/</span><span class=n>code</span><span class=o>/</span><span class=n>size_ofsockaddr_in</span><span class=p>.</span><span class=n>c</span><span class=p>}}</span>
</span></span></code></pre></div><p>输出的结果是：<code>16</code>,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>size bytes of sockaddr_in 16
</span></span><span class=line><span class=ln>2</span><span class=cl>size bytes of sin_family 2
</span></span><span class=line><span class=ln>3</span><span class=cl>size bytes of sin_port 2
</span></span><span class=line><span class=ln>4</span><span class=cl>size bytes of sin_addr 4
</span></span></code></pre></div><p>结果确实是少<code>8</code></p><h2 id=通用套接字地址结构体sockaddr>通用套接字地址结构体<code>sockaddr</code></h2><p>定义如下：</p><p>它适用于任何地址协议,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>struct sockaddr {
</span></span><span class=line><span class=ln>2</span><span class=cl>    sa_family_t sa_family; // 地址族
</span></span><span class=line><span class=ln>3</span><span class=cl>    char sa_data[14]; // 地址数据，长度取决于地址族
</span></span><span class=line><span class=ln>4</span><span class=cl>};
</span></span></code></pre></div><ol><li><code>sa_family</code>字段表示地址族。</li><li><code>sa_data</code>字段表示地址数据，长度取决于地址族。</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=ln> 1</span><span class=cl><span class=c1>#include &lt;stdio.h&gt;</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1>#include &lt;netinet/in.h&gt;</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=ne>int</span> <span class=n>main</span><span class=p>(</span><span class=ne>int</span> <span class=n>argc</span><span class=p>,</span> <span class=n>char</span> <span class=k>const</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=n>struct</span>  <span class=n>sockaddr_in</span> <span class=n>addr1</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=n>struct</span>  <span class=n>sockaddr</span> <span class=n>addr2</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;sizof(sockaddr_in) = </span><span class=si>%ld</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>sizeof</span><span class=p>(</span><span class=n>addr1</span><span class=p>));</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;sizof(sockaddr) = </span><span class=si>%ld</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>sizeof</span><span class=p>(</span><span class=n>addr2</span><span class=p>));</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=o>//</span> <span class=err>最后输出的结果是：</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=o>//</span> <span class=n>sizof</span><span class=p>(</span><span class=n>sockaddr_in</span><span class=p>)</span> <span class=o>=</span> <span class=mi>16</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=o>//</span> <span class=n>sizof</span><span class=p>(</span><span class=n>sockaddr</span><span class=p>)</span> <span class=o>=</span> <span class=mi>16</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=o>//</span> <span class=err>说明</span><span class=n>sockaddr_in和sockaddr的大小是相同的</span><span class=err>，都是</span><span class=mi>16</span><span class=err>字节。</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>在通常的网络编程中,我们先填写<code>sockaddr_in</code>结构体,然后再把它转换成通用的<code>sockaddr</code>结构体.</p><h2 id=网络字节序><a href=https://notes.roj.ac.cn/myNetworkProgramming/socket%E7%BC%96%E7%A8%8B.html#%e7%bd%91%e7%bb%9c%e5%ad%97%e8%8a%82%e5%ba%8f target=_blank rel=noopener>网络字节序</a></h2><h2 id=网络字节序-1>网络字节序</h2><p>字节序分为：</p><ul><li>大端字节序（Big-endian）</li><li>小端字节序（Little-endian）</li></ul><p><p class=imgp><img loading=lazy src=2/assets/image.png alt="alt text"></p></p><p>网络字节序（Network Byte Order）是指数据的高位字节保存在内存的低地址中，而数据的低位字节保存在内存的高地址中。就是大端字节序.</p><p>在TCP/IP协议中，所有长度字段和数字都采用网络字节序。例如，在TCP报文头部的源端口字段中，端口号的高位字节保存在内存的低地址中，而端口号的低位字节保存在内存的高地址中。</p></main><br><footer><div class=footer-info><p>Copyright &copy; 2025 Rainboy. All rights reserved.
<span>| Last build: 2025-09-16 22:51:49</span></p></div><script defer>document.addEventListener("keydown",function(e){if(document.activeElement.isContentEditable)return!1;if(document.activeElement.tagName=="INPUT")return!1;if(e.altKey||e.ctrlKey||e.shiftKey)return!1;var t=e.key;if(t==="h")e.preventDefault(),e.stopPropagation(),window.location.href="/";else if(t==="t")e.preventDefault(),e.stopPropagation(),window.location.href=`https://${location.hostname}/tags`;else if(t==="i"){e.preventDefault(),e.stopPropagation();const t=document.querySelectorAll("input");for(let e=0;e<t.length;e++)if(t[e].offsetParent!==null){t[e].selectionStart=t[e].selectionEnd=t[e].value.length,t[e].focus();break}}return!1})</script><script defer>function throttle(e,t){var n=Date.now();return function(){var s=Date.now();n+t-s<0&&(e(),n=s)}}function scrollHandler(){const e=Array.from(document.querySelectorAll("body h2, body h3"));function t(){for(var n,s,o,i=window.pageYOffset||document.documentElement.scrollTop,t=0;t<e.length;t++)s=e[t].getAttribute("id"),n=document.querySelector('nav ul li a[href="#'+s+'"]'),n&&n.classList.remove("active-toc");for(t=e.length-1;t>=0;t--)if(o=e[t].offsetTop,i>o-75&&(s=e[t].getAttribute("id"),n=document.querySelector('nav ul li a[href="#'+s+'"]'),n)){n.classList.add("active-toc");break}}window.addEventListener("scroll",throttle(t,200))}setTimeout(scrollHandler,100)</script><script defer>function addCopyButtonToCodeBlocks(){const e=document.querySelectorAll('code[class^="language-"]:not(.output):not([class*="language-console"])');e.forEach(e=>{const t=document.createElement("button");t.classList.add("copy-code-button"),t.innerHTML="copy",t.addEventListener("click",()=>{const s=e.querySelectorAll(".cl");let n="";s.forEach(e=>{n+=e.innerText}),navigator.clipboard.writeText(n),t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},1500)}),e.parentNode.before(t)})}setTimeout(function(){addCopyButtonToCodeBlocks()},100)</script><script defer src=/js/theme-switcher.js></script></footer></body></html>