<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=cache-control content="max-age=0"><meta http-equiv=cache-control content="no-cache"><meta http-equiv=expires content="0"><meta http-equiv=expires content="Tue, 01 Jan 1980 1:00:00 GMT"><meta http-equiv=pragma content="no-cache"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png }><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#1b1b1b"><meta name=description content><script>(function(){const e=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");document.documentElement.setAttribute("data-theme",e)})()</script><title>| Rainboy's Blog</title><style>:root{--background:#ffffff}@media(prefers-color-scheme:dark){:root{--background:#1b1b1b}}html{background-color:var(--background)}body{background-color:var(--background)}</style><link rel=stylesheet type=text/css href=/style.min.ec0f719b913e581207983cf92193a08ecc267bcfa103b18138938c37c3af261a.css media=all><link rel=stylesheet href=/grid.css></head><body><nav><ul class=menu><li><a tabindex=-1 class=menu-link href=/><u>H</u>ome</a></li><li><a tabindex=-1 class=menu-link href=/tags><u>T</u>ags</a></li><li><span style=cursor:pointer id=theme-switcher class=menu-link type=button>ğŸŒ™</span></li></ul></nav><div id=single-header><h1></h1><div id=single-meta></div></div><main><h2 id=å­¦ä¹ ç›®æ ‡>å­¦ä¹ ç›®æ ‡</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>mindmap
</span></span><span class=line><span class=ln>2</span><span class=cl>    root((å­¦ä¹ ç›®æ ‡))
</span></span><span class=line><span class=ln>3</span><span class=cl>        1.ä»€ä¹ˆæ˜¯socket
</span></span><span class=line><span class=ln>4</span><span class=cl>        2.IPv4å¥—æ¥å£åœ°å€ç»“æ„
</span></span><span class=line><span class=ln>5</span><span class=cl>        3.ç½‘ç»ˆå­—èŠ‚åº
</span></span><span class=line><span class=ln>6</span><span class=cl>        4.å­—èŠ‚åºè½¬æ¢å‡½æ•°
</span></span><span class=line><span class=ln>7</span><span class=cl>        5.åœ°å€è½¬æ¢å‡½æ•°
</span></span><span class=line><span class=ln>8</span><span class=cl>        6.å¥—æ¥å­—ç±»å‹
</span></span></code></pre></div><h2 id=1-ä»€ä¹ˆæ˜¯socket>1. ä»€ä¹ˆæ˜¯socket</h2><ul><li>socketå¯ä»¥çœ‹æˆæ˜¯ç”¨æˆ·è¿›ç¨‹ä¸å†…æ ¸ç½‘ç»œåè®®æ ˆçš„
ç¼–ç¨‹æ¥å£</li><li>socketä¸ä»…å¯ä»¥ç”¨äºæœ¬æœºçš„è¿›ç¨‹é—´é€šä¿¡ï¼Œè¿˜å¯ä»¥
ç”¨äºç½‘ç»œä¸Šä¸åŒä¸»æœºçš„è¿›ç¨‹é—´é€šä¿¡</li></ul><p>æˆ‘çš„ç†è§£: socketå°±æ˜¯å¯¹å‰é¢å­¦ä¹ çš„tcp/ipçš„ä»£ç å°è£…,ä½†æ˜¯ä½äºç³»ç»Ÿçš„å†…æ ¸,ä¹Ÿå°±æ˜¯è¯´æä¾›ç»™ç”¨æˆ·çš„ä¸€ç»„API,ç”¨äºç½‘ç»œé€šä¿¡.</p><blockquote><p>[!WARNING]
socket è¿™é‡Œç†è§£æˆ"æ’åº§"</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>mindmap
</span></span><span class=line><span class=ln>2</span><span class=cl>    root((socketéœ€è¦çš„å±æ€§))
</span></span><span class=line><span class=ln>3</span><span class=cl>        åœ°å€: sockaddr_in
</span></span><span class=line><span class=ln>4</span><span class=cl>            sin_addr
</span></span><span class=line><span class=ln>5</span><span class=cl>            sin_port
</span></span><span class=line><span class=ln>6</span><span class=cl>            sin_family
</span></span></code></pre></div><h2 id=ipv4-socket-åœ°å€ç»“æ„ä½“>ipv4 socket åœ°å€ç»“æ„ä½“</h2><p>ipv4 socketåœ°å€ç»“æ„ä½“,åœ¨å¤´æ–‡ä»¶<code>netinet/in.h</code>ä¸­å®šä¹‰ã€‚ <code>sockaddr_in</code>ç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼š</p><p>ä½¿ç”¨<code>man 7 ip</code>å‘½ä»¤æŸ¥çœ‹<code>sockaddr_in</code>ç»“æ„ä½“çš„å®šä¹‰ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>1</span><span class=cl><span class=k>struct</span> <span class=n>sockaddr_in</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>    <span class=kt>sa_family_t</span> <span class=n>sin_family</span><span class=p>;</span> <span class=c1>// åœ°å€æ—ï¼Œipv4 å°±æ˜¯AF_INET
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=c1></span>    <span class=kt>in_port_t</span> <span class=n>sin_port</span><span class=p>;</span> <span class=c1>// ç«¯å£å·    
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=c1></span>    <span class=k>struct</span> <span class=n>in_addr</span> <span class=n>sin_addr</span><span class=p>;</span> <span class=c1>// IPåœ°å€
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=c1></span>    <span class=kt>char</span> <span class=n>sin_zero</span><span class=p>[</span><span class=mi>8</span><span class=p>];</span> <span class=c1>// æœªä½¿ç”¨,æ³¨æ„è¿™ä¸ªåœ¨man 7 ipä¸­æ²¡æœ‰è¯´æ˜
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=c1></span>                     <span class=c1>//æš—ç¤ºç¨‹åºå‘˜ä¸éœ€è¦çŸ¥é“è¿™ä¸ª??
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=c1></span>                     <span class=c1>//å½“æˆä¸Šé¢çš„æ™®é€šçš„æ¥ç”¨?
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><ol><li><code>sin_family</code>å­—æ®µè¡¨ç¤ºåœ°å€æ—,socketåœ¨è®¾è®¡çš„æ—¶å€™è¿˜å¯ä»¥ç”¨äºå…¶å®ƒçš„åè®®,ä¸ä»…æ˜¯tcp/ip,æ¯”å¦‚è¿˜æœ‰<code>unix</code>åŸŸï¼Œå¯¹äºIPv4åœ°å€ï¼Œè¯¥å€¼ä¸º<code>AF_INET</code>ã€‚</li><li><code>sin_port</code>å­—æ®µè¡¨ç¤ºç«¯å£å·ï¼Œä½¿ç”¨ç½‘ç»œå­—èŠ‚åºï¼ˆbig-endianï¼‰å­˜å‚¨ã€‚</li><li><code>sin_addr</code>å­—æ®µè¡¨ç¤ºIPåœ°å€ï¼Œä½¿ç”¨<code>struct in_addr</code>ç»“æ„ä½“è¡¨ç¤ºã€‚</li></ol><p><code>struct in_addr</code>ç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>1</span><span class=cl><span class=k>struct</span> <span class=n>in_addr</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>    <span class=kt>uint32_t</span> <span class=n>s_addr</span><span class=p>;</span> <span class=c1>// IPåœ°å€ï¼Œä½¿ç”¨ç½‘ç»œå­—èŠ‚åºå­˜å‚¨
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><ol><li><code>s_addr</code>å­—æ®µè¡¨ç¤ºIPåœ°å€ï¼Œä½¿ç”¨ç½‘ç»œå­—èŠ‚åºå­˜å‚¨ã€‚</li></ol><h3 id=ç–‘é—®1>ç–‘é—®1</h3><blockquote><p>[!NOTE]
åˆ°è¿™é‡Œå°±æœ‰ä¸€ä¸ªç–‘é—®,<code>socketaddr_in</code>ç»“æ„ä½“å…·ä½“çš„å®šä¹‰æ˜¯ä»€ä¹ˆå‘¢?åé¢æœ‰æ²¡æœ‰<code>char sin_zero[8];</code>å­—æ®µå‘¢?é€šè¿‡ä¸‹é¢çš„ä»£ç æ¥éªŒè¯</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>1</span><span class=cl><span class=p>{{</span><span class=err>#</span><span class=n>include</span> <span class=p>.</span><span class=o>/</span><span class=n>code</span><span class=o>/</span><span class=n>size_ofsockaddr_in</span><span class=p>.</span><span class=n>c</span><span class=p>}}</span>
</span></span></code></pre></div><p>è¾“å‡ºçš„ç»“æœæ˜¯ï¼š<code>16</code>,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>size bytes of sockaddr_in 16
</span></span><span class=line><span class=ln>2</span><span class=cl>size bytes of sin_family 2
</span></span><span class=line><span class=ln>3</span><span class=cl>size bytes of sin_port 2
</span></span><span class=line><span class=ln>4</span><span class=cl>size bytes of sin_addr 4
</span></span></code></pre></div><p>ç»“æœç¡®å®æ˜¯å°‘<code>8</code></p><h2 id=é€šç”¨å¥—æ¥å­—åœ°å€ç»“æ„ä½“sockaddr>é€šç”¨å¥—æ¥å­—åœ°å€ç»“æ„ä½“<code>sockaddr</code></h2><p>å®šä¹‰å¦‚ä¸‹ï¼š</p><p>å®ƒé€‚ç”¨äºä»»ä½•åœ°å€åè®®,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>struct sockaddr {
</span></span><span class=line><span class=ln>2</span><span class=cl>    sa_family_t sa_family; // åœ°å€æ—
</span></span><span class=line><span class=ln>3</span><span class=cl>    char sa_data[14]; // åœ°å€æ•°æ®ï¼Œé•¿åº¦å–å†³äºåœ°å€æ—
</span></span><span class=line><span class=ln>4</span><span class=cl>};
</span></span></code></pre></div><ol><li><code>sa_family</code>å­—æ®µè¡¨ç¤ºåœ°å€æ—ã€‚</li><li><code>sa_data</code>å­—æ®µè¡¨ç¤ºåœ°å€æ•°æ®ï¼Œé•¿åº¦å–å†³äºåœ°å€æ—ã€‚</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=ln> 1</span><span class=cl><span class=c1>#include &lt;stdio.h&gt;</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1>#include &lt;netinet/in.h&gt;</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=ne>int</span> <span class=n>main</span><span class=p>(</span><span class=ne>int</span> <span class=n>argc</span><span class=p>,</span> <span class=n>char</span> <span class=k>const</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=n>struct</span>  <span class=n>sockaddr_in</span> <span class=n>addr1</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=n>struct</span>  <span class=n>sockaddr</span> <span class=n>addr2</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;sizof(sockaddr_in) = </span><span class=si>%ld</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>sizeof</span><span class=p>(</span><span class=n>addr1</span><span class=p>));</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=n>printf</span><span class=p>(</span><span class=s2>&#34;sizof(sockaddr) = </span><span class=si>%ld</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>sizeof</span><span class=p>(</span><span class=n>addr2</span><span class=p>));</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=o>//</span> <span class=err>æœ€åè¾“å‡ºçš„ç»“æœæ˜¯ï¼š</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=o>//</span> <span class=n>sizof</span><span class=p>(</span><span class=n>sockaddr_in</span><span class=p>)</span> <span class=o>=</span> <span class=mi>16</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=o>//</span> <span class=n>sizof</span><span class=p>(</span><span class=n>sockaddr</span><span class=p>)</span> <span class=o>=</span> <span class=mi>16</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=o>//</span> <span class=err>è¯´æ˜</span><span class=n>sockaddr_inå’Œsockaddrçš„å¤§å°æ˜¯ç›¸åŒçš„</span><span class=err>ï¼Œéƒ½æ˜¯</span><span class=mi>16</span><span class=err>å­—èŠ‚ã€‚</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>åœ¨é€šå¸¸çš„ç½‘ç»œç¼–ç¨‹ä¸­,æˆ‘ä»¬å…ˆå¡«å†™<code>sockaddr_in</code>ç»“æ„ä½“,ç„¶åå†æŠŠå®ƒè½¬æ¢æˆé€šç”¨çš„<code>sockaddr</code>ç»“æ„ä½“.</p><h2 id=ç½‘ç»œå­—èŠ‚åº><a href=https://notes.roj.ac.cn/myNetworkProgramming/socket%E7%BC%96%E7%A8%8B.html#%e7%bd%91%e7%bb%9c%e5%ad%97%e8%8a%82%e5%ba%8f target=_blank rel="noreferrer nofollow">ç½‘ç»œå­—èŠ‚åº</a></h2><h2 id=ç½‘ç»œå­—èŠ‚åº-1>ç½‘ç»œå­—èŠ‚åº</h2><p>å­—èŠ‚åºåˆ†ä¸ºï¼š</p><ul><li>å¤§ç«¯å­—èŠ‚åºï¼ˆBig-endianï¼‰</li><li>å°ç«¯å­—èŠ‚åºï¼ˆLittle-endianï¼‰</li></ul><p><p class=imgp><img loading=lazy src=2/assets/image.png alt="alt text"></p></p><p>ç½‘ç»œå­—èŠ‚åºï¼ˆNetwork Byte Orderï¼‰æ˜¯æŒ‡æ•°æ®çš„é«˜ä½å­—èŠ‚ä¿å­˜åœ¨å†…å­˜çš„ä½åœ°å€ä¸­ï¼Œè€Œæ•°æ®çš„ä½ä½å­—èŠ‚ä¿å­˜åœ¨å†…å­˜çš„é«˜åœ°å€ä¸­ã€‚å°±æ˜¯å¤§ç«¯å­—èŠ‚åº.</p><p>åœ¨TCP/IPåè®®ä¸­ï¼Œæ‰€æœ‰é•¿åº¦å­—æ®µå’Œæ•°å­—éƒ½é‡‡ç”¨ç½‘ç»œå­—èŠ‚åºã€‚ä¾‹å¦‚ï¼Œåœ¨TCPæŠ¥æ–‡å¤´éƒ¨çš„æºç«¯å£å­—æ®µä¸­ï¼Œç«¯å£å·çš„é«˜ä½å­—èŠ‚ä¿å­˜åœ¨å†…å­˜çš„ä½åœ°å€ä¸­ï¼Œè€Œç«¯å£å·çš„ä½ä½å­—èŠ‚ä¿å­˜åœ¨å†…å­˜çš„é«˜åœ°å€ä¸­ã€‚</p></main><br><footer><div class=footer-info><p>Copyright &copy; 2025 Rainboy. All rights reserved.
<span>| Last build: 2025-09-05 09:08:39</span></p></div><script defer>document.addEventListener("keydown",function(e){if(document.activeElement.isContentEditable)return!1;if(document.activeElement.tagName=="INPUT")return!1;if(e.altKey||e.ctrlKey||e.shiftKey)return!1;var t=e.key;if(t==="h")e.preventDefault(),e.stopPropagation(),window.location.href="/";else if(t==="t")e.preventDefault(),e.stopPropagation(),window.location.href=`https://${location.hostname}/tags`;else if(t==="i"){e.preventDefault(),e.stopPropagation();const t=document.querySelectorAll("input");for(let e=0;e<t.length;e++)if(t[e].offsetParent!==null){t[e].selectionStart=t[e].selectionEnd=t[e].value.length,t[e].focus();break}}return!1})</script><script defer>function throttle(e,t){var n=Date.now();return function(){var s=Date.now();n+t-s<0&&(e(),n=s)}}function scrollHandler(){const e=Array.from(document.querySelectorAll("body h2, body h3"));function t(){for(var n,s,o,i=window.pageYOffset||document.documentElement.scrollTop,t=0;t<e.length;t++)s=e[t].getAttribute("id"),n=document.querySelector('nav ul li a[href="#'+s+'"]'),n&&n.classList.remove("active-toc");for(t=e.length-1;t>=0;t--)if(o=e[t].offsetTop,i>o-75&&(s=e[t].getAttribute("id"),n=document.querySelector('nav ul li a[href="#'+s+'"]'),n)){n.classList.add("active-toc");break}}window.addEventListener("scroll",throttle(t,200))}setTimeout(scrollHandler,100)</script><script defer>function addCopyButtonToCodeBlocks(){const e=document.querySelectorAll('code[class^="language-"]:not(.output):not([class*="language-console"])');e.forEach(e=>{const t=document.createElement("button");t.classList.add("copy-code-button"),t.innerHTML="copy",t.addEventListener("click",()=>{const s=e.querySelectorAll(".cl");let n="";s.forEach(e=>{n+=e.innerText}),navigator.clipboard.writeText(n),t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},1500)}),e.parentNode.before(t)})}setTimeout(function(){addCopyButtonToCodeBlocks()},100)</script><script defer src=/js/theme-switcher.js></script></footer></body></html>