<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=cache-control content="max-age=0"><meta http-equiv=cache-control content="no-cache"><meta http-equiv=expires content="0"><meta http-equiv=expires content="Tue, 01 Jan 1980 1:00:00 GMT"><meta http-equiv=pragma content="no-cache"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png }><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#1b1b1b"><meta name=description content="MongoDB - Lookup æ“ä½œè¯¦è§£"><script>(function(){const e=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");document.documentElement.setAttribute("data-theme",e)})()</script><title>MongoDB - Lookup æ“ä½œè¯¦è§£ | Rainboy's Blog</title><style>:root{--background:#ffffff}@media(prefers-color-scheme:dark){:root{--background:#1b1b1b}}html{background-color:var(--background)}body{background-color:var(--background)}</style><link rel=stylesheet type=text/css href=/style.min.ec0f719b913e581207983cf92193a08ecc267bcfa103b18138938c37c3af261a.css media=all><link rel=stylesheet href=/grid.css></head><body><nav><ul class=menu><li><a tabindex=-1 class=menu-link href=/><u>H</u>ome</a></li><li><a tabindex=-1 class=menu-link href=/tags><u>T</u>ags</a></li><li><span style=cursor:pointer id=theme-switcher class=menu-link type=button>ğŸŒ™</span></li></ul></nav><div id=single-header><h1>MongoDB - Lookup æ“ä½œè¯¦è§£</h1><div id=single-meta><span class=datesub>2025-09-09</span>
<span id=tags>&nbsp;&nbsp;
<span><a href=https://hugo-dead-simple.netlify.com/tags/mongodb/>#mongodb</a>
</span>&nbsp; <span><a href=https://hugo-dead-simple.netlify.com/tags/aggregation/>#aggregation</a>
</span>&nbsp;</span></div></div><aside class="hidden lg:block toc" id=tableOfContentContainer><nav id=TableOfContents><ul><li><a href=#faq>FAQ</a></li><li><a href=#ask>ask</a></li><li><a href=#answser>Answser</a><ul><li><a href=#ç¤ºä¾‹æ•°æ®ç»“æ„>ç¤ºä¾‹æ•°æ®ç»“æ„</a></li><li><a href=#ä½¿ç”¨-lookup-è¿›è¡Œè”è¡¨æŸ¥è¯¢>ä½¿ç”¨ <code>$lookup</code> è¿›è¡Œè”è¡¨æŸ¥è¯¢</a></li><li><a href=#è§£æè¯´æ˜>è§£æè¯´æ˜</a></li><li><a href=#å…¶ä»–æ”¹è¿›>å…¶ä»–æ”¹è¿›</a></li><li><a href=#æ€»ç»“>æ€»ç»“</a></li></ul></li></ul></nav></aside><main><h2 id=faq>FAQ</h2><p>å¦‚æœå®ç°ç±»ä¼¼çš„sqlçš„ join åŠŸèƒ½å‘¢?</p><p>æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£</p><ul><li><a href=https://www.mongodb.com/zh-cn/docs/manual/reference/operator/aggregation/lookup/ target=_blank rel="noreferrer nofollow">$lookupï¼ˆèšåˆï¼‰â€” MongoDB æ‰‹å†Œ v8.0</a></li></ul><h2 id=ask>ask</h2><ul><li>ask : æˆ‘åœ¨å†™åœ¨mongodbçš„ç›¸å…³å†…å®¹, æœ‰ä¸€ä¸ªuser collection ,è¿˜æœ‰ä¸€ä¸ªcomment collection,commmenté€šè¿‡ userid ä¸user è¿›è¡Œäº†å…³è”,,æˆ‘åœ¨æŸ¥è¯¢comment ,å¦‚ä½•å¾—åˆ°æ¯ä¸ªcomment é‡Œçš„user çš„ç›¸å…³å±æ€§?</li></ul><h2 id=answser>Answser</h2><p>åœ¨ MongoDB ä¸­ï¼Œå¦‚æœ <code>comment</code> é›†åˆä¸­çš„æ¯ä¸ªæ–‡æ¡£é€šè¿‡ <code>userId</code> å­—æ®µä¸ <code>user</code> é›†åˆä¸­çš„ç”¨æˆ·è¿›è¡Œå…³è”ï¼Œå¹¶ä¸”ä½ å¸Œæœ›åœ¨æŸ¥è¯¢ <code>comment</code> æ—¶è·å–æ¯ä¸ªè¯„è®ºå¯¹åº”çš„ <code>user</code> çš„ç›¸å…³å±æ€§ï¼Œä½ å¯ä»¥ä½¿ç”¨ <strong><code>$lookup</code></strong> èšåˆæ“ä½œæ¥å®ç°è”è¡¨æŸ¥è¯¢ã€‚</p><h3 id=ç¤ºä¾‹æ•°æ®ç»“æ„>ç¤ºä¾‹æ•°æ®ç»“æ„</h3><ul><li><p><strong>user</strong> é›†åˆ:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=ln>1</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>  <span class=nt>&#34;_id&#34;</span><span class=p>:</span> <span class=err>ObjectId(</span><span class=s2>&#34;user1&#34;</span><span class=err>)</span><span class=p>,</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Alice&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>  <span class=nt>&#34;email&#34;</span><span class=p>:</span> <span class=s2>&#34;alice@example.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>  <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>30</span>
</span></span><span class=line><span class=ln>6</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div></li><li><p><strong>comment</strong> é›†åˆ:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=ln>1</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>  <span class=nt>&#34;_id&#34;</span><span class=p>:</span> <span class=err>ObjectId(</span><span class=s2>&#34;comment1&#34;</span><span class=err>)</span><span class=p>,</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>  <span class=nt>&#34;content&#34;</span><span class=p>:</span> <span class=s2>&#34;This is a comment&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>  <span class=nt>&#34;userId&#34;</span><span class=p>:</span> <span class=err>ObjectId(</span><span class=s2>&#34;user1&#34;</span><span class=err>)</span><span class=p>,</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>  <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=err>ISODate(</span><span class=s2>&#34;2024-12-09T10:00:00Z&#34;</span><span class=err>)</span>
</span></span><span class=line><span class=ln>6</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div></li></ul><h3 id=ä½¿ç”¨-lookup-è¿›è¡Œè”è¡¨æŸ¥è¯¢>ä½¿ç”¨ <code>$lookup</code> è¿›è¡Œè”è¡¨æŸ¥è¯¢</h3><p>ä½ å¯ä»¥ä½¿ç”¨èšåˆæ¡†æ¶ï¼ˆ<code>aggregate()</code>ï¼‰ç»“åˆ <code>$lookup</code> æ¥è¿æ¥ <code>comment</code> å’Œ <code>user</code> é›†åˆï¼Œå¹¶å°†æ¯ä¸ªè¯„è®ºå¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯åˆå¹¶åˆ°è¯„è®ºæ•°æ®ä¸­ã€‚</p><h4 id=èšåˆæŸ¥è¯¢ç¤ºä¾‹>èšåˆæŸ¥è¯¢ç¤ºä¾‹</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=ln> 1</span><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>comment</span><span class=p>.</span><span class=nx>aggregate</span><span class=p>([</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=nx>$lookup</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>      <span class=nx>from</span><span class=o>:</span> <span class=s2>&#34;user&#34;</span><span class=p>,</span>              <span class=c1>// å…³è”çš„é›†åˆæ˜¯ &#34;user&#34;
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1></span>      <span class=nx>localField</span><span class=o>:</span> <span class=s2>&#34;userId&#34;</span><span class=p>,</span>       <span class=c1>// å½“å‰é›†åˆä¸­å…³è”å­—æ®µæ˜¯ &#34;userId&#34;
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1></span>      <span class=nx>foreignField</span><span class=o>:</span> <span class=s2>&#34;_id&#34;</span><span class=p>,</span>       <span class=c1>// å…³è”åˆ° &#34;user&#34; é›†åˆä¸­çš„ &#34;_id&#34; å­—æ®µ
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1></span>      <span class=nx>as</span><span class=o>:</span> <span class=s2>&#34;userDetails&#34;</span>          <span class=c1>// ç»“æœä¼šæ”¾å…¥ &#34;userDetails&#34; æ•°ç»„å­—æ®µ
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=nx>$unwind</span><span class=o>:</span> <span class=s2>&#34;$userDetails&#34;</span>       <span class=c1>// å°† &#34;userDetails&#34; æ•°ç»„å±•å¼€æˆå•ä¸ªå¯¹è±¡ï¼ˆå¦‚æœæ¯ä¸ªè¯„è®ºåªèƒ½æœ‰ä¸€ä¸ªç”¨æˆ·çš„è¯ï¼‰
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=p>])</span>
</span></span></code></pre></div><h4 id=æŸ¥è¯¢ç»“æœ>æŸ¥è¯¢ç»“æœ</h4><p>å‡è®¾ <code>comment</code> é›†åˆæœ‰ä¸€ä¸ªæ–‡æ¡£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=ln> 1</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>  <span class=nt>&#34;_id&#34;</span><span class=p>:</span> <span class=err>ObjectId(</span><span class=s2>&#34;comment1&#34;</span><span class=err>)</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=nt>&#34;content&#34;</span><span class=p>:</span> <span class=s2>&#34;This is a comment&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=nt>&#34;userId&#34;</span><span class=p>:</span> <span class=err>ObjectId(</span><span class=s2>&#34;user1&#34;</span><span class=err>)</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>  <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=err>ISODate(</span><span class=s2>&#34;2024-12-09T10:00:00Z&#34;</span><span class=err>)</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>  <span class=nt>&#34;userDetails&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=nt>&#34;_id&#34;</span><span class=p>:</span> <span class=err>ObjectId(</span><span class=s2>&#34;user1&#34;</span><span class=err>)</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Alice&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=nt>&#34;email&#34;</span><span class=p>:</span> <span class=s2>&#34;alice@example.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>30</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=è§£æè¯´æ˜>è§£æè¯´æ˜</h3><ol><li><p><strong><code>$lookup</code></strong>: åœ¨ <code>comment</code> é›†åˆä¸­çš„ <code>userId</code> å­—æ®µå’Œ <code>user</code> é›†åˆä¸­çš„ <code>_id</code> å­—æ®µä¹‹é—´å»ºç«‹è¿æ¥ï¼Œå°†åŒ¹é…åˆ°çš„ç”¨æˆ·ä¿¡æ¯åŠ å…¥åˆ°æ¯ä¸ªè¯„è®ºä¸­ï¼Œå¹¶å­˜å‚¨åœ¨ <code>userDetails</code> å­—æ®µä¸­ã€‚</p></li><li><p><strong><code>$unwind</code></strong>: å¦‚æœä½ ç¡®å®šæ¯ä¸ªè¯„è®ºåªæœ‰ä¸€ä¸ªå¯¹åº”çš„ç”¨æˆ·ï¼ˆå³ <code>userId</code> å­—æ®µæŒ‡å‘çš„æ˜¯å”¯ä¸€ç”¨æˆ·ï¼‰ï¼Œä½¿ç”¨ <code>$unwind</code> å°† <code>userDetails</code> æ•°ç»„æ‹†è§£æˆå•ä¸ªå¯¹è±¡ã€‚è¿™æ ·ï¼Œä½ å°±å¯ä»¥ç›´æ¥åœ¨æ¯ä¸ªè¯„è®ºæ–‡æ¡£ä¸­è·å–åˆ°ç”¨æˆ·çš„å±æ€§ã€‚</p></li></ol><p>å¦‚æœä¸€ä¸ªè¯„è®ºå¯èƒ½æœ‰å¤šä¸ªç”¨æˆ·ï¼ˆä¾‹å¦‚è¯„è®ºå¯èƒ½æœ‰å¤šä¸ªä½œè€…ï¼‰ï¼Œä½ å¯ä»¥è·³è¿‡ <code>$unwind</code>ï¼Œè¿™æ ·æ¯ä¸ªè¯„è®ºçš„ <code>userDetails</code> ä¼šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«åŒ¹é…çš„æ‰€æœ‰ç”¨æˆ·ã€‚</p><h3 id=å…¶ä»–æ”¹è¿›>å…¶ä»–æ”¹è¿›</h3><p>å¦‚æœä½ åªå…³å¿ƒæŸäº›ç‰¹å®šçš„ç”¨æˆ·å­—æ®µï¼Œå¯ä»¥é€šè¿‡ <code>$project</code> å¯¹è¿”å›çš„å­—æ®µè¿›è¡Œè¿‡æ»¤ï¼Œå‡å°‘æ•°æ®ä¼ è¾“é‡ã€‚ä¾‹å¦‚ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=ln> 1</span><span class=cl><span class=nx>db</span><span class=p>.</span><span class=nx>comment</span><span class=p>.</span><span class=nx>aggregate</span><span class=p>([</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=nx>$lookup</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>      <span class=nx>from</span><span class=o>:</span> <span class=s2>&#34;user&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>      <span class=nx>localField</span><span class=o>:</span> <span class=s2>&#34;userId&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>      <span class=nx>foreignField</span><span class=o>:</span> <span class=s2>&#34;_id&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>      <span class=nx>as</span><span class=o>:</span> <span class=s2>&#34;userDetails&#34;</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=nx>$unwind</span><span class=o>:</span> <span class=s2>&#34;$userDetails&#34;</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=nx>$project</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>      <span class=nx>content</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span>                      <span class=c1>// åªä¿ç•™è¯„è®ºçš„å†…å®¹
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=c1></span>      <span class=s2>&#34;userDetails.name&#34;</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span>            <span class=c1>// åªè¿”å›ç”¨æˆ·çš„åå­—
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1></span>      <span class=s2>&#34;userDetails.email&#34;</span><span class=o>:</span> <span class=mi>1</span>            <span class=c1>// åªè¿”å›ç”¨æˆ·çš„é‚®ç®±
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>20</span><span class=cl><span class=p>])</span>
</span></span></code></pre></div><p>è¿™æ ·ï¼Œç»“æœå°†åªåŒ…å«è¯„è®ºå†…å®¹ä»¥åŠç”¨æˆ·çš„åå­—å’Œé‚®ç®±ã€‚</p><h3 id=æ€»ç»“>æ€»ç»“</h3><p>ä½¿ç”¨ <code>aggregate()</code> æ–¹æ³•ç»“åˆ <code>$lookup</code> å¯ä»¥è½»æ¾åœ°åœ¨æŸ¥è¯¢è¯„è®ºæ—¶è·å–æ¯ä¸ªè¯„è®ºå¯¹åº”ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚å¦‚æœä½ åªå…³å¿ƒéƒ¨åˆ†ç”¨æˆ·å­—æ®µï¼Œå¯ä»¥ä½¿ç”¨ <code>$project</code> æ¥é™åˆ¶è¿”å›çš„å­—æ®µï¼Œä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡ã€‚</p></main><br><footer><div class=footer-info><p>Copyright &copy; 2025 Rainboy. All rights reserved.
<span>| Last build: 2025-09-05 09:15:16</span></p></div><script defer>document.addEventListener("keydown",function(e){if(document.activeElement.isContentEditable)return!1;if(document.activeElement.tagName=="INPUT")return!1;if(e.altKey||e.ctrlKey||e.shiftKey)return!1;var t=e.key;if(t==="h")e.preventDefault(),e.stopPropagation(),window.location.href="/";else if(t==="t")e.preventDefault(),e.stopPropagation(),window.location.href=`https://${location.hostname}/tags`;else if(t==="i"){e.preventDefault(),e.stopPropagation();const t=document.querySelectorAll("input");for(let e=0;e<t.length;e++)if(t[e].offsetParent!==null){t[e].selectionStart=t[e].selectionEnd=t[e].value.length,t[e].focus();break}}return!1})</script><script defer>function throttle(e,t){var n=Date.now();return function(){var s=Date.now();n+t-s<0&&(e(),n=s)}}function scrollHandler(){const e=Array.from(document.querySelectorAll("body h2, body h3"));function t(){for(var n,s,o,i=window.pageYOffset||document.documentElement.scrollTop,t=0;t<e.length;t++)s=e[t].getAttribute("id"),n=document.querySelector('nav ul li a[href="#'+s+'"]'),n&&n.classList.remove("active-toc");for(t=e.length-1;t>=0;t--)if(o=e[t].offsetTop,i>o-75&&(s=e[t].getAttribute("id"),n=document.querySelector('nav ul li a[href="#'+s+'"]'),n)){n.classList.add("active-toc");break}}window.addEventListener("scroll",throttle(t,200))}setTimeout(scrollHandler,100)</script><script defer>function addCopyButtonToCodeBlocks(){const e=document.querySelectorAll('code[class^="language-"]:not(.output):not([class*="language-console"])');e.forEach(e=>{const t=document.createElement("button");t.classList.add("copy-code-button"),t.innerHTML="copy",t.addEventListener("click",()=>{const s=e.querySelectorAll(".cl");let n="";s.forEach(e=>{n+=e.innerText}),navigator.clipboard.writeText(n),t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},1500)}),e.parentNode.before(t)})}setTimeout(function(){addCopyButtonToCodeBlocks()},100)</script><script defer src=/js/theme-switcher.js></script></footer></body></html>