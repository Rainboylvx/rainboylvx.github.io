<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=cache-control content="max-age=0"><meta http-equiv=cache-control content="no-cache"><meta http-equiv=expires content="0"><meta http-equiv=expires content="Tue, 01 Jan 1980 1:00:00 GMT"><meta http-equiv=pragma content="no-cache"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png }><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#1b1b1b"><meta name=description content="Lua中的面向对象编程"><script>(function(){const e=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");document.documentElement.setAttribute("data-theme",e)})()</script><title>Lua中的面向对象编程 | Rainboy's Blog</title><style>:root{--background:#ffffff}@media(prefers-color-scheme:dark){:root{--background:#1b1b1b}}html{background-color:var(--background)}body{background-color:var(--background)}</style><link rel=stylesheet type=text/css href=/style.min.4de9e3236bcb55312d0b2ff0fc62c694f607b9c0d95d0621f6c6dbacb7d6dbb5.css media=all><link rel=stylesheet href=/grid.css><link href="https://fonts.font.im/css?family=Roboto+Mono" rel=stylesheet><style>body,.heti,.heti--sans{font-family:roboto mono,monospace,times new roman,times,heti song,serif,apple color emoji,segoe ui emoji,segoe ui symbol}</style></head><body><nav><ul class=menu><li><a tabindex=-1 class=menu-link href=/><u>H</u>ome</a></li><li><a tabindex=-1 class=menu-link href=/tags><u>T</u>ags</a></li><li><span style=cursor:pointer id=theme-switcher class=menu-link type=button><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon h-4 w-4"><path d="M12 3a6 6 0 009 9 9 9 0 11-9-9z"/></svg></span></li></ul></nav><div id=single-header><h1>Lua中的面向对象编程</h1><div id=single-meta><span class=datesub>2025-09-09 00:00</span>
<span id=tags>&nbsp;&nbsp;
<span><a href=https://hugo-dead-simple.netlify.com/tags/lua.html>#lua</a>
</span>&nbsp;</span></div></div><aside class="hidden lg:block toc" id=tableOfContentContainer><nav id=TableOfContents><ul><li><a href=#核心概念表元表和__index>核心概念：表、元表和<code>__index</code></a></li><li><a href=#方案一基础的基于表的oop>方案一：基础的基于表的OOP</a></li><li><a href=#方案二进阶的多层继承>方案二：进阶的多层继承</a></li><li><a href=#方案三更优雅的实现使用闭包和私有变量>方案三：更优雅的实现：使用闭包和私有变量</a></li><li><a href=#总结与建议>总结与建议</a></li></ul></nav></aside><main class="heti heti--classic"><p>嗨！很高兴能和你一起探索Lua这门优雅且强大的语言。你可能知道，Lua天生并没有像Java或C++那样的内置类和对象系统。但别担心，这正是它的魅力所在！这门语言提供了极其灵活的元编程机制，让我们能够<strong>从零开始，亲手构建一个属于自己的面向对象（Object-Oriented Programming，简称OOP）世界</strong>。</p><p>这篇博客将带你深入理解Lua中实现OOP的几种核心思想，从最基础的<strong>表（table）和元表（metatable）</strong>，到实用的继承和多态。准备好了吗？让我们开始吧！</p><h2 id=核心概念表元表和__index>核心概念：表、元表和<code>__index</code></h2><p>在Lua中，一切皆表。表是Lua中唯一的数据结构，它既可以是数组，也可以是哈希表。而实现OOP的关键，就在于如何利用<strong>元表</strong>来赋予表新的行为。</p><p>你可以把<strong>元表</strong>想象成一个表的“配置文件”或者“行为蓝图”。当你在一个表上执行某个操作（比如访问一个不存在的键）时，如果这个表设置了元表，Lua就会去元表中查找对应的特殊字段，我们称之为<strong>元方法（metamethod）</strong>。</p><p>实现OOP，我们主要关注一个元方法：<code>__index</code>。</p><p><code>__index</code>的神奇之处在于：当你想在一个表中访问一个不存在的键时，Lua不会直接返回<code>nil</code>，而是会去<strong>这个表的元表</strong>中，查找<code>__index</code>字段。</p><ul><li>如果<code>__index</code>是一个<strong>表</strong>，Lua就会在这个表中继续查找这个键。</li><li>如果<code>__index</code>是一个<strong>函数</strong>，Lua就会调用这个函数，并把原始的表和键作为参数传入。</li></ul><p>我们主要利用第一种情况来实现“继承”的行为。</p><ul><li>参考 <a href=https://wiki-zh.luatos.org/luaGuide/luaReference.html#id6 target=_blank rel=noopener>lua 5.3 中文手册 2.4 – 元表及元方法</a></li></ul><h2 id=方案一基础的基于表的oop>方案一：基础的基于表的OOP</h2><p>这是最简单，也是最常见的实现方式。我们利用<code>__index</code>指向一个<strong>原型表（prototype table）</strong>，这个原型表就像是我们的“类”，里面存放着所有对象共享的方法。</p><p>让我们来创建一个简单的<code>Vector2</code>类，代表二维向量。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=ln> 1</span><span class=cl><span class=c1>-- Vector2.lua</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=kd>local</span> <span class=n>Vector2</span> <span class=o>=</span> <span class=p>{}</span> <span class=c1>-- 我们的“类”原型表</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=n>Vector2.__index</span> <span class=o>=</span> <span class=n>Vector2</span> <span class=c1>-- 关键步骤：设置元表，指向自身</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=kr>function</span> <span class=nc>Vector2</span><span class=p>.</span><span class=nf>new</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=kd>local</span> <span class=n>self</span> <span class=o>=</span> <span class=p>{</span><span class=n>x</span> <span class=o>=</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=n>y</span><span class=p>}</span> <span class=c1>-- 创建实例</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=n>setmetatable</span><span class=p>(</span><span class=n>self</span><span class=p>,</span> <span class=n>Vector2</span><span class=p>)</span> <span class=c1>-- 设置实例的元表为Vector2</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=kr>return</span> <span class=n>self</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=kr>function</span> <span class=nc>Vector2</span><span class=p>:</span><span class=nf>add</span><span class=p>(</span><span class=n>other</span><span class=p>)</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=c1>-- 注意：这里的冒号语法糖会把self作为第一个参数传入</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=kr>return</span> <span class=n>Vector2.new</span><span class=p>(</span><span class=n>self.x</span> <span class=o>+</span> <span class=n>other.x</span><span class=p>,</span> <span class=n>self.y</span> <span class=o>+</span> <span class=n>other.y</span><span class=p>)</span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=kr>function</span> <span class=nc>Vector2</span><span class=p>:</span><span class=nf>tostring</span><span class=p>()</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=kr>return</span> <span class=n>string.format</span><span class=p>(</span><span class=s2>&#34;Vector2(%f, %f)&#34;</span><span class=p>,</span> <span class=n>self.x</span><span class=p>,</span> <span class=n>self.y</span><span class=p>)</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>
</span></span><span class=line><span class=ln>20</span><span class=cl><span class=kd>local</span> <span class=n>v1</span> <span class=o>=</span> <span class=n>Vector2.new</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=kd>local</span> <span class=n>v2</span> <span class=o>=</span> <span class=n>Vector2.new</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>
</span></span><span class=line><span class=ln>23</span><span class=cl><span class=kd>local</span> <span class=n>v3</span> <span class=o>=</span> <span class=n>v1</span><span class=p>:</span><span class=n>add</span><span class=p>(</span><span class=n>v2</span><span class=p>)</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>
</span></span><span class=line><span class=ln>25</span><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>v3</span><span class=p>:</span><span class=n>tostring</span><span class=p>())</span> <span class=c1>-- 输出：Vector2(4.000000, 6.000000)</span>
</span></span></code></pre></div><p><strong>发生了什么？</strong></p><ol><li>我们首先创建了一个<code>Vector2</code>表，它将作为我们的类和原型。</li><li><code>Vector2.__index = Vector2</code>是核心。当我们通过<code>v1:add(v2)</code>调用<code>add</code>方法时，Lua发现<code>v1</code>中没有<code>add</code>键。</li><li>于是，它会去<code>v1</code>的元表（也就是<code>Vector2</code>）中查找<code>__index</code>。</li><li><code>__index</code>指向了<code>Vector2</code>自身，所以Lua在<code>Vector2</code>中找到了<code>add</code>方法并调用了它。</li><li><code>Vector2:add</code>语法糖会把<code>v1</code>作为<code>self</code>参数传入，实现了方法调用。</li></ol><p>这种方式的优点是简单明了，容易理解。缺点是当你的类和继承关系变得复杂时，管理起来可能会有些混乱。</p><h2 id=方案二进阶的多层继承>方案二：进阶的多层继承</h2><p>现在，我们来让事情变得更有趣一些。假设我们想创建一个<code>Creature</code>类，然后让<code>Hero</code>和<code>Monster</code>继承它。</p><p>多层继承的关键在于，子类的<code>__index</code>元方法要指向<strong>父类</strong>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=ln> 1</span><span class=cl><span class=c1>-- Creature.lua</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=kd>local</span> <span class=n>Creature</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=n>Creature.__index</span> <span class=o>=</span> <span class=n>Creature</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=kr>function</span> <span class=nc>Creature</span><span class=p>.</span><span class=nf>new</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>health</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=kd>local</span> <span class=n>self</span> <span class=o>=</span> <span class=p>{</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span><span class=p>,</span> <span class=n>health</span> <span class=o>=</span> <span class=n>health</span><span class=p>}</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=n>setmetatable</span><span class=p>(</span><span class=n>self</span><span class=p>,</span> <span class=n>Creature</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=kr>return</span> <span class=n>self</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=kr>function</span> <span class=nc>Creature</span><span class=p>:</span><span class=nf>speak</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>self.name</span> <span class=o>..</span> <span class=s2>&#34; says: &#34;</span> <span class=o>..</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=c1>-- Hero.lua，继承自Creature</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=kd>local</span> <span class=n>Hero</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=n>setmetatable</span><span class=p>(</span><span class=n>Hero</span><span class=p>,</span> <span class=p>{</span><span class=n>__index</span> <span class=o>=</span> <span class=n>Creature</span><span class=p>})</span> <span class=c1>-- Hero的元表指向Creature</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=kr>function</span> <span class=nc>Hero</span><span class=p>.</span><span class=nf>new</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>health</span><span class=p>,</span> <span class=n>level</span><span class=p>)</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>    <span class=c1>-- 先创建父类实例</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>    <span class=kd>local</span> <span class=n>self</span> <span class=o>=</span> <span class=n>Creature.new</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>health</span><span class=p>)</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>    <span class=c1>-- 再添加子类特有的属性</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>    <span class=n>self.level</span> <span class=o>=</span> <span class=n>level</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>    <span class=c1>-- 关键：用Hero的元表替换父类的元表</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>    <span class=n>setmetatable</span><span class=p>(</span><span class=n>self</span><span class=p>,</span> <span class=n>Hero</span><span class=p>)</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>    <span class=kr>return</span> <span class=n>self</span>
</span></span><span class=line><span class=ln>27</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>
</span></span><span class=line><span class=ln>29</span><span class=cl><span class=kr>function</span> <span class=nc>Hero</span><span class=p>:</span><span class=nf>attack</span><span class=p>(</span><span class=n>target</span><span class=p>)</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>    <span class=n>self</span><span class=p>:</span><span class=n>speak</span><span class=p>(</span><span class=s2>&#34;Take that!&#34;</span><span class=p>)</span> <span class=c1>-- 调用父类方法</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>self.name</span> <span class=o>..</span> <span class=s2>&#34; attacks &#34;</span> <span class=o>..</span> <span class=n>target.name</span> <span class=o>..</span> <span class=s2>&#34; with level &#34;</span> <span class=o>..</span> <span class=n>self.level</span><span class=p>)</span>
</span></span><span class=line><span class=ln>32</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>
</span></span><span class=line><span class=ln>34</span><span class=cl><span class=kd>local</span> <span class=n>hero</span> <span class=o>=</span> <span class=n>Hero.new</span><span class=p>(</span><span class=s2>&#34;Arthur&#34;</span><span class=p>,</span> <span class=mi>100</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=ln>35</span><span class=cl><span class=kd>local</span> <span class=n>monster</span> <span class=o>=</span> <span class=n>Creature.new</span><span class=p>(</span><span class=s2>&#34;Goblin&#34;</span><span class=p>,</span> <span class=mi>50</span><span class=p>)</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>
</span></span><span class=line><span class=ln>37</span><span class=cl><span class=n>hero</span><span class=p>:</span><span class=n>speak</span><span class=p>(</span><span class=s2>&#34;I&#39;m here!&#34;</span><span class=p>)</span> <span class=c1>-- 父类方法</span>
</span></span><span class=line><span class=ln>38</span><span class=cl><span class=n>hero</span><span class=p>:</span><span class=n>attack</span><span class=p>(</span><span class=n>monster</span><span class=p>)</span> <span class=c1>-- 子类方法</span>
</span></span></code></pre></div><p><strong>发生了什么？</strong></p><ol><li>我们给<code>Hero</code>表设置了一个元表，它的<code>__index</code>指向<code>Creature</code>。这就像是说：“如果<code>Hero</code>里找不到某个方法，就去<code>Creature</code>里找。”</li><li>在<code>Hero.new</code>中，我们先用<code>Creature.new</code>创建了一个实例，它继承了<code>Creature</code>的元表。</li><li>然后，我们把这个实例的元表<strong>替换</strong>成了<code>Hero</code>。</li><li>当调用<code>hero:attack</code>时，Lua在<code>hero</code>中找到了<code>attack</code>方法。</li><li>当调用<code>self:speak</code>时，Lua在<code>hero</code>中找不到<code>speak</code>，于是去<code>hero</code>的元表（<code>Hero</code>）中查找<code>__index</code>。</li><li><code>Hero</code>的元表指向了<code>Creature</code>，所以Lua在<code>Creature</code>中找到了<code>speak</code>方法。完美！</li></ol><p>这就是<strong>多层继承</strong>在Lua中的实现方式，通过元表层层嵌套，形成一个查找链，实现了类似原型链继承的行为。</p><h2 id=方案三更优雅的实现使用闭包和私有变量>方案三：更优雅的实现：使用闭包和私有变量</h2><p>虽然上面的方案能很好地工作，但所有的属性都是公开的，这在一些情况下可能不是我们想要的。我们可以利用Lua的**闭包（closure）**特性来创建私有变量。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=ln> 1</span><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>create_vector2</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=c1>-- 这里的x和y是私有变量</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=kd>local</span> <span class=n>self</span> <span class=o>=</span> <span class=p>{}</span> <span class=c1>-- 实例表</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=kr>function</span> <span class=nc>self</span><span class=p>.</span><span class=nf>add</span><span class=p>(</span><span class=n>other</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>        <span class=kr>return</span> <span class=n>create_vector2</span><span class=p>(</span><span class=n>x</span> <span class=o>+</span> <span class=n>other.x</span><span class=p>,</span> <span class=n>y</span> <span class=o>+</span> <span class=n>other.y</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=kr>end</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=kr>function</span> <span class=nc>self</span><span class=p>.</span><span class=nf>tostring</span><span class=p>()</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>        <span class=kr>return</span> <span class=n>string.format</span><span class=p>(</span><span class=s2>&#34;Vector2(%f, %f)&#34;</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=kr>end</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=c1>-- 提供一个公开的访问器，以便外部获取x和y的值</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=n>self.get_x</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span> <span class=kr>return</span> <span class=n>x</span> <span class=kr>end</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=n>self.get_y</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span> <span class=kr>return</span> <span class=n>y</span> <span class=kr>end</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=kr>return</span> <span class=n>self</span>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=kd>local</span> <span class=n>v1</span> <span class=o>=</span> <span class=n>create_vector2</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=ln>22</span><span class=cl><span class=kd>local</span> <span class=n>v2</span> <span class=o>=</span> <span class=n>create_vector2</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>
</span></span><span class=line><span class=ln>24</span><span class=cl><span class=kd>local</span> <span class=n>v3</span> <span class=o>=</span> <span class=n>v1.add</span><span class=p>(</span><span class=n>v2</span><span class=p>)</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>
</span></span><span class=line><span class=ln>26</span><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>v3.tostring</span><span class=p>())</span> <span class=c1>-- 输出：Vector2(4.000000, 6.000000)</span>
</span></span><span class=line><span class=ln>27</span><span class=cl><span class=c1>-- print(v3.x) -- 错误：试图访问私有变量</span>
</span></span></code></pre></div><p>这种方案的优点在于：</p><ul><li><strong>私有性</strong>：<code>x</code>和<code>y</code>变量被闭包捕获，外部无法直接访问。</li><li><strong>直观</strong>：创建实例的函数<code>create_vector2</code>更像是传统的构造函数。</li></ul><p>缺点是：</p><ul><li><strong>内存开销</strong>：每个实例都会创建自己的一套函数副本，而不是共享一个原型。这在创建大量轻量级对象时可能会有性能问题。</li><li><strong>不支持继承</strong>：这种方法很难优雅地实现继承。</li></ul><h2 id=总结与建议>总结与建议</h2><table><thead><tr><th>方案</th><th>优点</th><th>缺点</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>基于元表</strong></td><td>内存高效（方法共享），灵活，支持继承</td><td>需要理解元表机制，代码稍复杂</td><td>大多数需要OOP的场景，特别是游戏开发和框架设计</td></tr><tr><td><strong>基于闭包</strong></td><td>易于实现私有变量，代码直观</td><td>内存开销大，不支持继承</td><td>小规模、对内存不敏感、不需要继承的场景</td></tr></tbody></table><p>对于大多数情况，我强烈建议使用<strong>第一种基于元表的方案</strong>。它既高效又灵活，是Lua社区最广泛使用的OOP实现方式。一旦你理解了<code>__index</code>的魔法，你就能在Lua中轻松构建出强大而优雅的对象系统。</p><p>现在，拿起你的编辑器，尝试自己构建一个<strong>玩家</strong>、<strong>敌人</strong>和<strong>物品</strong>的简单世界吧！相信你会在这个过程中发现Lua的独特魅力。</p><p>如果你对Lua中的其他元方法（比如<code>__add</code>、<code>__len</code>等）感兴趣，或者想了解更高级的OOP设计模式，欢迎随时与我交流。编程的乐趣，就在于不断探索和创造！</p><ul><li><a href=https://www.bilibili.com/video/BV1f44y1a7Gk target=_blank rel=noopener>B站视频【Lua】元表、元方法、面向对象</a></li></ul></main><br><footer><div class=footer-info><p>Copyright &copy; 2025 Rainboy. All rights reserved.
<span>| Last build: 2025-10-26 19:50:50</span></p></div><script defer>document.addEventListener("keydown",function(e){if(document.activeElement.isContentEditable)return!1;if(document.activeElement.tagName=="INPUT")return!1;if(e.altKey||e.ctrlKey||e.shiftKey)return!1;var t=e.key;if(t==="h")e.preventDefault(),e.stopPropagation(),window.location.href="/";else if(t==="t")e.preventDefault(),e.stopPropagation(),window.location.href=`https://${location.hostname}/tags`;else if(t==="i"){e.preventDefault(),e.stopPropagation();const t=document.querySelectorAll("input");for(let e=0;e<t.length;e++)if(t[e].offsetParent!==null){t[e].selectionStart=t[e].selectionEnd=t[e].value.length,t[e].focus();break}}return!1})</script><script defer>function throttle(e,t){var n=Date.now();return function(){var s=Date.now();n+t-s<0&&(e(),n=s)}}function scrollHandler(){const e=Array.from(document.querySelectorAll("body h2, body h3"));function t(){for(var n,s,o,i=window.pageYOffset||document.documentElement.scrollTop,t=0;t<e.length;t++)s=e[t].getAttribute("id"),n=document.querySelector('nav ul li a[href="#'+s+'"]'),n&&n.classList.remove("active-toc");for(t=e.length-1;t>=0;t--)if(o=e[t].offsetTop,i>o-75&&(s=e[t].getAttribute("id"),n=document.querySelector('nav ul li a[href="#'+s+'"]'),n)){n.classList.add("active-toc");break}}window.addEventListener("scroll",throttle(t,200))}setTimeout(scrollHandler,100)</script><script defer>function addCopyButtonToCodeBlocks(){const e=document.querySelectorAll('code[class^="language-"]:not(.output):not([class*="language-console"])');e.forEach(e=>{const t=document.createElement("button");t.classList.add("copy-code-button"),t.innerHTML="copy",t.addEventListener("click",()=>{const s=e.querySelectorAll(".cl");let n="";s.forEach(e=>{n+=e.innerText}),navigator.clipboard.writeText(n),t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},1500)}),e.parentNode.before(t)})}setTimeout(function(){addCopyButtonToCodeBlocks()},100)</script><script defer src=/js/theme-switcher.js></script></footer></body></html>