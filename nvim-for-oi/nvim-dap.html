<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=cache-control content="max-age=0"><meta http-equiv=cache-control content="no-cache"><meta http-equiv=expires content="0"><meta http-equiv=expires content="Tue, 01 Jan 1980 1:00:00 GMT"><meta http-equiv=pragma content="no-cache"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png }><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#1b1b1b"><meta name=description content><script>(function(){const e=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");document.documentElement.setAttribute("data-theme",e)})()</script><title>| Rainboy's Blog</title><style>:root{--background:#ffffff}@media(prefers-color-scheme:dark){:root{--background:#1b1b1b}}html{background-color:var(--background)}body{background-color:var(--background)}</style><link rel=stylesheet type=text/css href=/style.min.4de9e3236bcb55312d0b2ff0fc62c694f607b9c0d95d0621f6c6dbacb7d6dbb5.css media=all><link rel=stylesheet href=/grid.css><link href="https://fonts.font.im/css?family=Roboto+Mono" rel=stylesheet><style>body,.heti,.heti--sans{font-family:roboto mono,monospace,times new roman,times,heti song,serif,apple color emoji,segoe ui emoji,segoe ui symbol}</style></head><body><nav><ul class=menu><li><a tabindex=-1 class=menu-link href=/><u>H</u>ome</a></li><li><a tabindex=-1 class=menu-link href=/tags><u>T</u>ags</a></li><li><span style=cursor:pointer id=theme-switcher class=menu-link type=button><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon h-4 w-4"><path d="M12 3a6 6 0 009 9 9 9 0 11-9-9z"/></svg></span></li></ul></nav><div id=single-header><h1></h1><div id=single-meta></div></div><main class="heti heti--classic"><think>Here's a thinking process that could lead to the detailed `nvim-dap` guide:<ol><li><p><strong>Deconstruct the User&rsquo;s Request:</strong></p><ul><li><strong>Core Question:</strong> &ldquo;How do I use the nvim-dap plugin?&rdquo;</li><li><strong>Implicit Needs:</strong> This is a broad question. A good answer needs to cover several aspects, not just one command. It implies the user wants to set up a debugging environment in Neovim. I need to break this down into a logical, step-by-step process.</li><li><strong>Audience:</strong> The user has been asking about LSP and completion. They are comfortable with <code>lazy.nvim</code> and editing Lua configs. They are likely a C++ developer, given the <code>clangd</code> context. So, I should use C++ as the primary example.</li></ul></li><li><p><strong>Structure the Answer - The &ldquo;Hero&rsquo;s Journey&rdquo; of Debugging Setup:</strong></p><p>I&rsquo;ll structure the answer like a guide, taking the user from zero to a working debugger.</p><ul><li><p><strong>Part 1: The Big Picture - What is DAP?</strong></p><ul><li>Start with a high-level analogy. The LSP analogy worked well before (&ldquo;LSP lets your editor <em>understand</em> code&rdquo;). So, &ldquo;DAP lets your editor <em>control a debugger</em>.&rdquo;</li><li>Explain the key components:<ul><li><code>nvim-dap</code> (The Neovim frontend/client).</li><li><strong>Debug Adapter</strong> (The middleman, like <code>vscode-cpptools</code>). This is a crucial concept to explain. It&rsquo;s the &ldquo;server&rdquo; in the DAP &ldquo;client-server&rdquo; model.</li><li>The actual <strong>Debugger</strong> (The backend, like GDB or LLDB).</li></ul></li><li>A simple diagram would be helpful here: <code>Neovim &lt;-> nvim-dap &lt;-> Debug Adapter &lt;-> GDB/LLDB</code>. This clarifies the roles.</li></ul></li><li><p><strong>Part 2: Installation and Core Configuration (<code>lazy.nvim</code>).</strong></p><ul><li>This is the practical, hands-on part. I need to provide a <code>lazy.nvim</code> configuration.</li><li><strong>Core Plugin:</strong> <code>mfussenegger/nvim-dap</code>.</li><li><strong>UI Plugin:</strong> <code>nvim-dap</code> itself is just the backend. A UI is essential for a good experience. <code>rcarriga/nvim-dap-ui</code> is the standard choice. I must include this.</li><li><strong>Virtual Text (Optional but recommended):</strong> <code>theHamsta/nvim-dap-virtual-text</code> is another great addition for showing variable values inline.</li><li><strong>The Configuration:</strong><ul><li>Create a <code>lazy.nvim</code> spec for <code>nvim-dap</code>.</li><li>Inside the <code>config</code> function, define the keymaps. This is <em>critical</em> for usability. I need to provide a standard, ergonomic set of keybindings with clear comments explaining what each one does (e.g., <code>F5</code> to continue, <code>F9</code> for breakpoint, <code>F10</code> for step over).</li><li>Create a spec for <code>nvim-dap-ui</code>.</li><li>Inside its <code>config</code>, call <code>dapui.setup()</code>. I&rsquo;ll also show how to configure it to open/close automatically with DAP sessions.</li><li>Create a spec for <code>nvim-dap-virtual-text</code>.</li></ul></li></ul></li><li><p><strong>Part 3: Setting up a Specific Language (The C++ Example).</strong></p><ul><li>This bridges the gap from &ldquo;plugins installed&rdquo; to &ldquo;I can actually debug my code.&rdquo;</li><li><strong>Step 3.1: Install the Debug Adapter.</strong> This is often a point of confusion. I need to be very clear here. For C++, the common choice is <code>vscode-cpptools</code>, which contains the <code>OpenDebugAD7</code> adapter. I&rsquo;ll provide the <code>mason.nvim</code> way to install it (<code>:MasonInstall cpptools</code>). This is the easiest for most users. If they don&rsquo;t use Mason, I should briefly mention manual installation (cloning the repo, etc.), but focus on the Mason path.</li><li><strong>Step 3.2: Configure the Adapter in Neovim.</strong><ul><li>Explain that <code>nvim-dap</code> needs to know how to <em>launch</em> the adapter.</li><li>Provide the Lua code for configuring the <code>cppdbg</code> adapter. I&rsquo;ll explain the <code>type = 'cppdbg'</code> and how the <code>command</code> and <code>args</code> point to the installed adapter. The path will need to be dynamic, so I&rsquo;ll use <code>mason_registry</code> to find it automatically. This makes the config robust.</li></ul></li><li><strong>Step 3.3: Configure the Launch Configuration (<code>launch.json</code>).</strong><ul><li>Explain what <code>launch.json</code> is (tells the adapter how to start <em>your</em> program). This is another common stumbling block.</li><li>Provide a clear, commented example of a <code>launch.json</code> for a simple C++ program. I&rsquo;ll explain each key: <code>name</code>, <code>type</code>, <code>request</code>, <code>program</code>, <code>args</code>, <code>cwd</code>.</li><li>Crucially, I must emphasize the need to compile the C++ code with debug symbols (<code>-g</code> flag). This is a classic &ldquo;gotcha&rdquo;.</li></ul></li></ul></li><li><p><strong>Part 4: The Debugging Workflow - Putting It All Together.</strong></p><ul><li>This is the payoff. A step-by-step walkthrough of a debugging session.</li><li><ol><li>Compile your code with <code>-g</code>.</li></ol></li><li><ol start=2><li>Open the source file in Neovim.</li></ol></li><li><ol start=3><li>Set a breakpoint (using the <code>F9</code> key we defined).</li></ol></li><li><ol start=4><li>Start debugging (using the <code>F5</code> key we defined). <code>nvim-dap</code> will read the <code>.vscode/launch.json</code>.</li></ol></li><li><ol start=5><li>The <code>dap-ui</code> will open, the program will pause at the breakpoint.</li></ol></li><li><ol start=6><li>Explain what the user will see in the UI (variables, call stack, etc.).</li></ol></li><li><ol start=7><li>Demonstrate using the other keys: <code>F10</code> (step over), <code>F11</code> (step into), <code>Shift+F5</code> (stop).</li></ol></li><li><ol start=8><li>Explain how to use the REPL to inspect variables.</li></ol></li></ul></li></ul></li><li><p><strong>Review and Refine:</strong></p><ul><li>Read through the entire guide. Is the flow logical?</li><li>Are the code blocks correct and well-commented?</li><li>Is the language clear and not overly jargony? (The initial analogy helps a lot here).</li><li>Have I anticipated common problems? (Forgetting <code>-g</code>, incorrect <code>launch.json</code> path, not installing the adapter). I&rsquo;ve addressed these.</li><li>Is the C++ example self-contained and easy to follow? (Yes, simple <code>main.cpp</code> and <code>g++ -g ...</code> command).</li><li>The structure seems solid: Concept -> Installation -> Configuration (Language Specific) -> Workflow. This is a complete and actionable guide.当然！<code>nvim-dap</code> 是 Neovim 的一个调试适配器协议（Debug Adapter Protocol, DAP）客户端。它本身是一个强大的后端，让 Neovim 能够与各种调试器（如 GDB, LLDB, PDB 等）进行通信。</li></ul></li></ol><p>为了获得类似 VS Code 的图形化调试体验，我们通常会将 <code>nvim-dap</code> 与一个 UI 插件（如 <code>nvim-dap-ui</code>）结合使用。</p><p>下面我将为你提供一个完整的使用指南，包括：</p><ol><li><strong>基本概念</strong>：<code>nvim-dap</code> 是如何工作的。</li><li><strong>安装配置</strong>：使用 <code>lazy.nvim</code> 安装 <code>nvim-dap</code> 和 <code>nvim-dap-ui</code>。</li><li><strong>语言配置</strong>：以 C++ 为例，配置调试器适配器（Adapter）。</li><li><strong>调试流程</strong>：一个完整的从设置断点到开始调试的步骤。</li></ol><hr><h3 id=1-基本概念dap-的三个核心组件>1. 基本概念：DAP 的三个核心组件</h3><p>理解这三个组件的关系至关重要：</p><ol><li><p><strong>Neovim + nvim-dap (客户端)</strong></p><ul><li>这是你交互的前端。你在这里设置断点、查看变量、控制执行流程。</li></ul></li><li><p><strong>调试适配器 (Adapter)</strong></p><ul><li>这是一个中间件，一个独立的程序。它将 Neovim 发送的 DAP 指令（如“在第 10 行设置断点”）翻译成特定调试器能听懂的命令（如 GDB 的 <code>break 10</code>）。</li><li>对于 C++，最常用的适配器是 <code>cpptools</code>（由微软提供）。</li><li>对于 Python，是 <code>debugpy</code>。</li></ul></li><li><p><strong>调试器 (Debugger)</strong></p><ul><li>这是真正执行调试工作的后端，如 <code>gdb</code> 或 <code>lldb</code>。</li></ul></li></ol><p><strong>流程图：</strong>
<code>Neovim (你)</code> &lt;&ndash;> <code>nvim-dap</code> &lt;&ndash;> <code>调试适配器 (cpptools)</code> &lt;&ndash;> <code>调试器 (gdb/lldb)</code></p><hr><h3 id=2-安装与核心配置-lazynvim>2. 安装与核心配置 (lazy.nvim)</h3><p>我们将安装三个插件：</p><ul><li><code>nvim-dap</code>: 核心协议实现。</li><li><code>nvim-dap-ui</code>: 提供美观的调试 UI 界面。</li><li><code>nvim-dap-virtual-text</code>: (可选) 在代码旁以内联方式显示变量值。</li></ul><p>在你的 <code>plugins</code> 目录下创建一个新文件 <code>lua/plugins/dap.lua</code>，并粘贴以下内容：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=ln> 1</span><span class=cl><span class=c1>-- lua/plugins/dap.lua</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=kr>return</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=c1>-- nvim-dap 核心插件</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=s2>&#34;mfussenegger/nvim-dap&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=n>dependencies</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>      <span class=c1>-- DAP 的 UI 界面</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>        <span class=s2>&#34;rcarriga/nvim-dap-ui&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>        <span class=n>config</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>          <span class=kd>local</span> <span class=n>dapui</span> <span class=o>=</span> <span class=n>require</span><span class=p>(</span><span class=s2>&#34;dapui&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>          <span class=n>dapui.setup</span><span class=p>({</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>            <span class=c1>-- UI 布局配置</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>            <span class=n>layouts</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>                <span class=n>elements</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>                  <span class=p>{</span> <span class=n>id</span> <span class=o>=</span> <span class=s2>&#34;scopes&#34;</span><span class=p>,</span> <span class=n>size</span> <span class=o>=</span> <span class=mf>0.25</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>                  <span class=p>{</span> <span class=n>id</span> <span class=o>=</span> <span class=s2>&#34;breakpoints&#34;</span><span class=p>,</span> <span class=n>size</span> <span class=o>=</span> <span class=mf>0.25</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>                  <span class=p>{</span> <span class=n>id</span> <span class=o>=</span> <span class=s2>&#34;stacks&#34;</span><span class=p>,</span> <span class=n>size</span> <span class=o>=</span> <span class=mf>0.25</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>                  <span class=p>{</span> <span class=n>id</span> <span class=o>=</span> <span class=s2>&#34;watches&#34;</span><span class=p>,</span> <span class=n>size</span> <span class=o>=</span> <span class=mf>0.25</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>                <span class=n>size</span> <span class=o>=</span> <span class=mi>40</span><span class=p>,</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>                <span class=n>position</span> <span class=o>=</span> <span class=s2>&#34;left&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>                <span class=n>elements</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>                  <span class=p>{</span> <span class=n>id</span> <span class=o>=</span> <span class=s2>&#34;repl&#34;</span><span class=p>,</span> <span class=n>size</span> <span class=o>=</span> <span class=mf>0.5</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>                  <span class=p>{</span> <span class=n>id</span> <span class=o>=</span> <span class=s2>&#34;console&#34;</span><span class=p>,</span> <span class=n>size</span> <span class=o>=</span> <span class=mf>0.5</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>                <span class=n>size</span> <span class=o>=</span> <span class=mf>0.25</span><span class=p>,</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>                <span class=n>position</span> <span class=o>=</span> <span class=s2>&#34;bottom&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>            <span class=c1>-- 其他设置...</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>          <span class=p>})</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>
</span></span><span class=line><span class=ln>38</span><span class=cl>          <span class=kd>local</span> <span class=n>dap</span><span class=p>,</span> <span class=n>dapui</span> <span class=o>=</span> <span class=n>require</span><span class=p>(</span><span class=s2>&#34;dap&#34;</span><span class=p>),</span> <span class=n>require</span><span class=p>(</span><span class=s2>&#34;dapui&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>
</span></span><span class=line><span class=ln>40</span><span class=cl>          <span class=c1>-- 在调试会话开始时自动打开 UI，在结束时自动关闭</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>          <span class=n>dap.listeners</span><span class=p>.</span><span class=n>after.event_initialized</span><span class=p>[</span><span class=s2>&#34;dapui_config&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>            <span class=n>dapui.open</span><span class=p>()</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>          <span class=kr>end</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>          <span class=n>dap.listeners</span><span class=p>.</span><span class=n>before.event_terminated</span><span class=p>[</span><span class=s2>&#34;dapui_config&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>            <span class=n>dapui.close</span><span class=p>()</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>          <span class=kr>end</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>          <span class=n>dap.listeners</span><span class=p>.</span><span class=n>before.event_exited</span><span class=p>[</span><span class=s2>&#34;dapui_config&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>            <span class=n>dapui.close</span><span class=p>()</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>          <span class=kr>end</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>        <span class=kr>end</span><span class=p>,</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>      <span class=c1>-- (可选) 在代码旁显示变量值</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>      <span class=p>{</span> <span class=s2>&#34;theHamsta/nvim-dap-virtual-text&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>54</span><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=ln>55</span><span class=cl>    <span class=n>config</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=ln>56</span><span class=cl>      <span class=kd>local</span> <span class=n>dap</span> <span class=o>=</span> <span class=n>require</span><span class=p>(</span><span class=s2>&#34;dap&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>57</span><span class=cl>
</span></span><span class=line><span class=ln>58</span><span class=cl>      <span class=c1>-- 定义调试快捷键</span>
</span></span><span class=line><span class=ln>59</span><span class=cl>      <span class=c1>-- 使用 F 键区作为调试的标准键位</span>
</span></span><span class=line><span class=ln>60</span><span class=cl>      <span class=n>vim.keymap</span><span class=p>.</span><span class=n>set</span><span class=p>(</span><span class=s2>&#34;n&#34;</span><span class=p>,</span> <span class=s2>&#34;&lt;F5&gt;&#34;</span><span class=p>,</span> <span class=n>dap.continue</span><span class=p>,</span> <span class=p>{</span> <span class=n>desc</span> <span class=o>=</span> <span class=s2>&#34;DAP: Continue&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=ln>61</span><span class=cl>      <span class=n>vim.keymap</span><span class=p>.</span><span class=n>set</span><span class=p>(</span><span class=s2>&#34;n&#34;</span><span class=p>,</span> <span class=s2>&#34;&lt;F1&gt;&#34;</span><span class=p>,</span> <span class=n>dap.step_into</span><span class=p>,</span> <span class=p>{</span> <span class=n>desc</span> <span class=o>=</span> <span class=s2>&#34;DAP: Step Into&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=ln>62</span><span class=cl>      <span class=n>vim.keymap</span><span class=p>.</span><span class=n>set</span><span class=p>(</span><span class=s2>&#34;n&#34;</span><span class=p>,</span> <span class=s2>&#34;&lt;F2&gt;&#34;</span><span class=p>,</span> <span class=n>dap.step_over</span><span class=p>,</span> <span class=p>{</span> <span class=n>desc</span> <span class=o>=</span> <span class=s2>&#34;DAP: Step Over&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=ln>63</span><span class=cl>      <span class=n>vim.keymap</span><span class=p>.</span><span class=n>set</span><span class=p>(</span><span class=s2>&#34;n&#34;</span><span class=p>,</span> <span class=s2>&#34;&lt;F3&gt;&#34;</span><span class=p>,</span> <span class=n>dap.step_out</span><span class=p>,</span> <span class=p>{</span> <span class=n>desc</span> <span class=o>=</span> <span class=s2>&#34;DAP: Step Out&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=ln>64</span><span class=cl>      <span class=n>vim.keymap</span><span class=p>.</span><span class=n>set</span><span class=p>(</span><span class=s2>&#34;n&#34;</span><span class=p>,</span> <span class=s2>&#34;&lt;F9&gt;&#34;</span><span class=p>,</span> <span class=n>dap.toggle_breakpoint</span><span class=p>,</span> <span class=p>{</span> <span class=n>desc</span> <span class=o>=</span> <span class=s2>&#34;DAP: Toggle Breakpoint&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=ln>65</span><span class=cl>      <span class=n>vim.keymap</span><span class=p>.</span><span class=n>set</span><span class=p>(</span><span class=s2>&#34;n&#34;</span><span class=p>,</span> <span class=s2>&#34;&lt;Leader&gt;b&#34;</span><span class=p>,</span> <span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=ln>66</span><span class=cl>        <span class=n>dap.set_breakpoint</span><span class=p>(</span><span class=n>vim.fn</span><span class=p>.</span><span class=n>input</span><span class=p>(</span><span class=s1>&#39;Breakpoint condition: &#39;</span><span class=p>))</span>
</span></span><span class=line><span class=ln>67</span><span class=cl>      <span class=kr>end</span><span class=p>,</span> <span class=p>{</span> <span class=n>desc</span> <span class=o>=</span> <span class=s2>&#34;DAP: Set Conditional Breakpoint&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=ln>68</span><span class=cl>
</span></span><span class=line><span class=ln>69</span><span class=cl>      <span class=c1>-- 查看悬浮变量</span>
</span></span><span class=line><span class=ln>70</span><span class=cl>      <span class=n>vim.keymap</span><span class=p>.</span><span class=n>set</span><span class=p>(</span><span class=s2>&#34;n&#34;</span><span class=p>,</span> <span class=s2>&#34;&lt;Leader&gt;dh&#34;</span><span class=p>,</span> <span class=kr>function</span><span class=p>()</span> <span class=n>require</span><span class=p>(</span><span class=s1>&#39;dap.ui.widgets&#39;</span><span class=p>).</span><span class=n>hover</span><span class=p>()</span> <span class=kr>end</span><span class=p>,</span> <span class=p>{</span> <span class=n>desc</span> <span class=o>=</span> <span class=s2>&#34;DAP: Hover Variable&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=ln>71</span><span class=cl>    <span class=kr>end</span><span class=p>,</span>
</span></span><span class=line><span class=ln>72</span><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=ln>73</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>保存文件并重启 Neovim，让 <code>lazy.nvim</code> 完成安装。</p><hr><h3 id=3-配置-c-调试器适配器>3. 配置 C++ 调试器适配器</h3><p>现在，我们需要安装并配置 C++ 的调试适配器。</p><h4 id=步骤-31-安装调试适配器-cpptools>步骤 3.1: 安装调试适配器 (<code>cpptools</code>)</h4><p>如果你在使用 <code>mason.nvim</code>，这是最简单的方法。</p><ol><li>运行 <code>:Mason</code> 命令。</li><li>找到 <code>cpptools</code> 并按 <code>i</code> 安装它。</li></ol><h4 id=步骤-32-在-neovim-中注册适配器>步骤 3.2: 在 Neovim 中注册适配器</h4><p><code>nvim-dap</code> 需要知道如何启动 <code>cpptools</code>。在你的 Neovim 配置中的某个地方（例如 <code>init.lua</code> 或专门的 dap 配置文件中），添加以下代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=ln> 1</span><span class=cl><span class=c1>-- 将此代码添加到你的配置中</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=kd>local</span> <span class=n>dap</span> <span class=o>=</span> <span class=n>require</span><span class=p>(</span><span class=s1>&#39;dap&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1>-- 适配器配置：告诉 nvim-dap 如何启动 cpptools</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=n>dap.adapters</span><span class=p>.</span><span class=n>cppdbg</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>  <span class=n>id</span> <span class=o>=</span> <span class=s1>&#39;cppdbg&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>  <span class=n>type</span> <span class=o>=</span> <span class=s1>&#39;executable&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>  <span class=c1>-- 注意：这里的路径需要指向你通过 Mason 安装的 cpptools 的位置</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>  <span class=c1>-- 你可以通过在 Mason 窗口中对 cpptools 按 `g?` 查看路径</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>  <span class=c1>-- 或者使用 `mason-lspconfig` 这样的插件来自动获取路径</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>  <span class=n>command</span> <span class=o>=</span> <span class=n>vim.fn</span><span class=p>.</span><span class=n>stdpath</span><span class=p>(</span><span class=s1>&#39;data&#39;</span><span class=p>)</span> <span class=o>..</span> <span class=s1>&#39;/mason/bin/OpenDebugAD7&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=c1>-- 语言配置：将 cppdbg 适配器与 c 和 cpp 文件类型关联起来</span>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=n>dap.configurations</span><span class=p>.</span><span class=n>cpp</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=s2>&#34;Launch file&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=n>type</span> <span class=o>=</span> <span class=s2>&#34;cppdbg&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=n>request</span> <span class=o>=</span> <span class=s2>&#34;launch&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>    <span class=n>program</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>      <span class=c1>-- 要求用户输入要调试的可执行文件路径</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>      <span class=kr>return</span> <span class=n>vim.fn</span><span class=p>.</span><span class=n>input</span><span class=p>(</span><span class=s1>&#39;Path to executable: &#39;</span><span class=p>,</span> <span class=n>vim.fn</span><span class=p>.</span><span class=n>getcwd</span><span class=p>()</span> <span class=o>..</span> <span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=s1>&#39;file&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>    <span class=kr>end</span><span class=p>,</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>    <span class=n>cwd</span> <span class=o>=</span> <span class=s1>&#39;${workspaceFolder}&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>    <span class=n>stopAtEntry</span> <span class=o>=</span> <span class=kc>true</span><span class=p>,</span> <span class=c1>-- 在 main 函数入口处暂停</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=ln>27</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>
</span></span><span class=line><span class=ln>29</span><span class=cl><span class=c1>-- 为 c 文件也设置同样的配置</span>
</span></span><span class=line><span class=ln>30</span><span class=cl><span class=n>dap.configurations</span><span class=p>.</span><span class=n>c</span> <span class=o>=</span> <span class=n>dap.configurations</span><span class=p>.</span><span class=n>cpp</span>
</span></span></code></pre></div><p><strong>注意</strong>：<code>command</code> 路径是硬编码的示例，如果你的 <code>mason</code> 安装在不同位置，请相应修改。</p><hr><h3 id=4-完整调试流程一个-c-示例>4. 完整调试流程：一个 C++ 示例</h3><p>现在，一切准备就绪！让我们来调试一个简单的 C++ 程序。</p><h4 id=步骤-41-准备示例代码>步骤 4.1: 准备示例代码</h4><p>创建一个名为 <code>main.cpp</code> 的文件：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=ln> 1</span><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;vector&gt;</span><span class=cp>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=cp></span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=kt>void</span> <span class=nf>print_hello</span><span class=p>(</span><span class=kt>int</span> <span class=n>count</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>count</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Hello, number &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>numbers</span> <span class=o>=</span> <span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>};</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=kt>int</span> <span class=n>total_count</span> <span class=o>=</span> <span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=n>print_hello</span><span class=p>(</span><span class=n>total_count</span><span class=p>);</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=n>numbers</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Final size: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>numbers</span><span class=p>.</span><span class=n>size</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>20</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=步骤-42-编译并生成调试信息>步骤 4.2: 编译并生成调试信息</h4><p><strong>这是最关键的一步！</strong> 必须使用 <code>-g</code> 标志来编译你的程序，这样可执行文件中才会包含调试符号。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>g++ -g -std<span class=o>=</span>c++17 main.cpp -o main_debug
</span></span></code></pre></div><p>现在你目录下有了一个名为 <code>main_debug</code> 的可执行文件。</p><h4 id=步骤-43-在-neovim-中开始调试>步骤 4.3: 在 Neovim 中开始调试</h4><ol><li>用 Neovim 打开 <code>main.cpp</code> 文件。</li><li><strong>设置断点</strong>：将光标移动到 <code>print_hello(total_count);</code> 这一行，然后按 <code>&lt;F9></code>。你会看到行号旁边出现一个红点 🔴，表示断点已设置。</li><li><strong>启动调试会话</strong>：按 <code>&lt;F5></code>。<ul><li>此时 Neovim 会在底部提示你 <code>Path to executable:</code>。</li><li>输入你刚刚编译好的文件名 <code>main_debug</code>，然后按回车。</li></ul></li><li><strong>调试开始！</strong><ul><li><code>nvim-dap-ui</code> 界面会自动在左侧和下方打开。</li><li>程序会停在你设置的断点处，该行会高亮显示。</li></ul></li></ol><h4 id=步骤-44-控制调试流程>步骤 4.4: 控制调试流程</h4><p>现在，你可以使用我们之前定义的快捷键来控制调试：</p><ul><li><strong><f5>(Continue)</strong>: 继续执行，直到遇到下一个断点或程序结束。</li><li><strong><f2>(Step Over)</strong>: 单步执行，但不进入函数内部。将光标放在 <code>print_hello</code> 这一行，按 <code>&lt;F2></code>，程序会执行完整个函数，停在下一行。</li><li><strong><f1>(Step Into)</strong>: 单步执行，并进入函数内部。将光标放在 <code>print_hello</code> 这一行，按 <code>&lt;F1></code>，你会跳转到 <code>print_hello</code> 函数的第一行。</li><li><strong><f3>(Step Out)</strong>: 从当前函数跳出，返回到调用它的地方。</li></ul><h4 id=步骤-45-观察变量和交互>步骤 4.5: 观察变量和交互</h4><ul><li><strong>左侧 UI 界面</strong>：<ul><li><strong>Scopes</strong>: 你可以看到当前作用域内的所有变量（例如 <code>numbers</code> 和 <code>total_count</code>）以及它们的值。</li><li><strong>Breakpoints</strong>: 列出所有设置的断点。</li><li><strong>Stacks</strong>: 显示当前的函数调用栈。</li></ul></li><li><strong>底部 UI 界面 (REPL)</strong>：<ul><li>这是一个交互式控制台。你可以输入变量名来查看它的值，甚至可以执行一些简单的表达式，例如输入 <code>numbers.size()</code> 并回车。</li></ul></li></ul><p>通过这套流程，你就拥有了一个功能齐全、可媲美 IDE 的调试环境，完全集成在 Neovim 中！</p></main><br><footer><div class=footer-info><p>Copyright &copy; 2025 Rainboy. All rights reserved.
<span>| Last build: 2025-10-23 16:51:53</span></p></div><script defer>document.addEventListener("keydown",function(e){if(document.activeElement.isContentEditable)return!1;if(document.activeElement.tagName=="INPUT")return!1;if(e.altKey||e.ctrlKey||e.shiftKey)return!1;var t=e.key;if(t==="h")e.preventDefault(),e.stopPropagation(),window.location.href="/";else if(t==="t")e.preventDefault(),e.stopPropagation(),window.location.href=`https://${location.hostname}/tags`;else if(t==="i"){e.preventDefault(),e.stopPropagation();const t=document.querySelectorAll("input");for(let e=0;e<t.length;e++)if(t[e].offsetParent!==null){t[e].selectionStart=t[e].selectionEnd=t[e].value.length,t[e].focus();break}}return!1})</script><script defer>function throttle(e,t){var n=Date.now();return function(){var s=Date.now();n+t-s<0&&(e(),n=s)}}function scrollHandler(){const e=Array.from(document.querySelectorAll("body h2, body h3"));function t(){for(var n,s,o,i=window.pageYOffset||document.documentElement.scrollTop,t=0;t<e.length;t++)s=e[t].getAttribute("id"),n=document.querySelector('nav ul li a[href="#'+s+'"]'),n&&n.classList.remove("active-toc");for(t=e.length-1;t>=0;t--)if(o=e[t].offsetTop,i>o-75&&(s=e[t].getAttribute("id"),n=document.querySelector('nav ul li a[href="#'+s+'"]'),n)){n.classList.add("active-toc");break}}window.addEventListener("scroll",throttle(t,200))}setTimeout(scrollHandler,100)</script><script defer>function addCopyButtonToCodeBlocks(){const e=document.querySelectorAll('code[class^="language-"]:not(.output):not([class*="language-console"])');e.forEach(e=>{const t=document.createElement("button");t.classList.add("copy-code-button"),t.innerHTML="copy",t.addEventListener("click",()=>{const s=e.querySelectorAll(".cl");let n="";s.forEach(e=>{n+=e.innerText}),navigator.clipboard.writeText(n),t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},1500)}),e.parentNode.before(t)})}setTimeout(function(){addCopyButtonToCodeBlocks()},100)</script><script defer src=/js/theme-switcher.js></script></footer></body></html>