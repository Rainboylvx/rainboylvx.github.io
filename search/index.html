<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=cache-control content="max-age=0"><meta http-equiv=cache-control content="no-cache"><meta http-equiv=expires content="0"><meta http-equiv=expires content="Tue, 01 Jan 1980 1:00:00 GMT"><meta http-equiv=pragma content="no-cache"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png }><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#1b1b1b"><meta name=description content="Search Results"><script>(function(){const e=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");document.documentElement.setAttribute("data-theme",e)})()</script><title>Search Results | Rainboy's Blog</title><style>:root{--background:#ffffff}@media(prefers-color-scheme:dark){:root{--background:#1b1b1b}}html{background-color:var(--background)}body{background-color:var(--background)}</style><link rel=stylesheet type=text/css href=/style.min.9e52618e081d7542403ff6356f894d993b93e26eb37d3f072c70cd92f0c439ab.css media=all><link rel=stylesheet href=/grid.css><link href="https://fonts.font.im/css?family=Roboto+Mono" rel=stylesheet><style>body,.heti,.heti--sans{font-family:roboto mono,monospace,times new roman,times,heti song,serif,apple color emoji,segoe ui emoji,segoe ui symbol}</style></head><body><nav><ul class=menu><li><a tabindex=-1 class=menu-link href=/><u>H</u>ome</a></li><li><a tabindex=-1 class=menu-link href=/tags><u>T</u>ags</a></li><li><span style=cursor:pointer id=theme-switcher class=menu-link type=button><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon h-4 w-4"><path d="M12 3a6 6 0 009 9 9 9 0 11-9-9z"/></svg></span></li></ul></nav><main id=main class=post><header><h1 id=search-title>Search Results</h1></header><form id=search-form action=/search method=get><label hidden for=search-input>Search site</label>
<input tabindex=-1 type=text id=search-input name=query placeholder="search [i] ..."></form><ul id=search-results></ul></main><script>window.store={"https://hugo-dead-simple.netlify.com/tags/aggregation/":{title:"Aggregation",tags:[],content:"",url:"https://hugo-dead-simple.netlify.com/tags/aggregation/"},"https://hugo-dead-simple.netlify.com/tags/css/":{title:"CSS",tags:[],content:"",url:"https://hugo-dead-simple.netlify.com/tags/css/"},"https://hugo-dead-simple.netlify.com/typescript/debug/":{title:"debug",tags:[],content:`æ¥è‡ª: https://www.bilibili.com/video/BV1zT411z7y7/
å®‰è£…typescript ä¸ts-node å†™ä¸€ä¸ªtsçš„è„šæœ¬ 1let a = 1 2a = a+1 3console.log(a) ç‚¹å‡»è¡Œä¸‹æ®µç‚¹ ç‚¹å‡»vscodeä¸Šçš„è°ƒè¯•æŒ‰é’® `,url:"https://hugo-dead-simple.netlify.com/typescript/debug/"},"https://hugo-dead-simple.netlify.com/tags/exercises/":{title:"Exercises",tags:[],content:"",url:"https://hugo-dead-simple.netlify.com/tags/exercises/"},"https://hugo-dead-simple.netlify.com/frontend/":{title:"FrontEnds",tags:[],content:"",url:"https://hugo-dead-simple.netlify.com/frontend/"},"https://hugo-dead-simple.netlify.com/tags/hugo/":{title:"Hugo",tags:[],content:"",url:"https://hugo-dead-simple.netlify.com/tags/hugo/"},"https://hugo-dead-simple.netlify.com/tags/javascript/":{title:"JavaScript",tags:[],content:"",url:"https://hugo-dead-simple.netlify.com/tags/javascript/"},"https://hugo-dead-simple.netlify.com/tags/mongodb/":{title:"MongoDB",tags:[],content:"",url:"https://hugo-dead-simple.netlify.com/tags/mongodb/"},"https://hugo-dead-simple.netlify.com/mongodb/lookup/":{title:"MongoDB - Lookup æ“ä½œè¯¦è§£",tags:["MongoDB","Aggregation"],content:`FAQ å¦‚æœå®ç°ç±»ä¼¼çš„sqlçš„ join åŠŸèƒ½å‘¢?
æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£
$lookupï¼ˆèšåˆï¼‰â€” MongoDB æ‰‹å†Œ v8.0 ask ask : æˆ‘åœ¨å†™åœ¨mongodbçš„ç›¸å…³å†…å®¹, æœ‰ä¸€ä¸ªuser collection ,è¿˜æœ‰ä¸€ä¸ªcomment collection,commmenté€šè¿‡ userid ä¸user è¿›è¡Œäº†å…³è”,,æˆ‘åœ¨æŸ¥è¯¢comment ,å¦‚ä½•å¾—åˆ°æ¯ä¸ªcomment é‡Œçš„user çš„ç›¸å…³å±æ€§? Answser åœ¨ MongoDB ä¸­ï¼Œå¦‚æœ comment é›†åˆä¸­çš„æ¯ä¸ªæ–‡æ¡£é€šè¿‡ userId å­—æ®µä¸ user é›†åˆä¸­çš„ç”¨æˆ·è¿›è¡Œå…³è”ï¼Œå¹¶ä¸”ä½ å¸Œæœ›åœ¨æŸ¥è¯¢ comment æ—¶è·å–æ¯ä¸ªè¯„è®ºå¯¹åº”çš„ user çš„ç›¸å…³å±æ€§ï¼Œä½ å¯ä»¥ä½¿ç”¨ $lookup èšåˆæ“ä½œæ¥å®ç°è”è¡¨æŸ¥è¯¢ã€‚
ç¤ºä¾‹æ•°æ®ç»“æ„ user é›†åˆ:
1{ 2 &#34;_id&#34;: ObjectId(&#34;user1&#34;), 3 &#34;name&#34;: &#34;Alice&#34;, 4 &#34;email&#34;: &#34;alice@example.com&#34;, 5 &#34;age&#34;: 30 6} comment é›†åˆ:
1{ 2 &#34;_id&#34;: ObjectId(&#34;comment1&#34;), 3 &#34;content&#34;: &#34;This is a comment&#34;, 4 &#34;userId&#34;: ObjectId(&#34;user1&#34;), 5 &#34;timestamp&#34;: ISODate(&#34;2024-12-09T10:00:00Z&#34;) 6} ä½¿ç”¨ $lookup è¿›è¡Œè”è¡¨æŸ¥è¯¢ ä½ å¯ä»¥ä½¿ç”¨èšåˆæ¡†æ¶ï¼ˆaggregate()ï¼‰ç»“åˆ $lookup æ¥è¿æ¥ comment å’Œ user é›†åˆï¼Œå¹¶å°†æ¯ä¸ªè¯„è®ºå¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯åˆå¹¶åˆ°è¯„è®ºæ•°æ®ä¸­ã€‚
èšåˆæŸ¥è¯¢ç¤ºä¾‹ 1db.comment.aggregate([ 2 { 3 $lookup: { 4 from: &#34;user&#34;, // å…³è”çš„é›†åˆæ˜¯ &#34;user&#34; 5 localField: &#34;userId&#34;, // å½“å‰é›†åˆä¸­å…³è”å­—æ®µæ˜¯ &#34;userId&#34; 6 foreignField: &#34;_id&#34;, // å…³è”åˆ° &#34;user&#34; é›†åˆä¸­çš„ &#34;_id&#34; å­—æ®µ 7 as: &#34;userDetails&#34; // ç»“æœä¼šæ”¾å…¥ &#34;userDetails&#34; æ•°ç»„å­—æ®µ 8 } 9 }, 10 { 11 $unwind: &#34;$userDetails&#34; // å°† &#34;userDetails&#34; æ•°ç»„å±•å¼€æˆå•ä¸ªå¯¹è±¡ï¼ˆå¦‚æœæ¯ä¸ªè¯„è®ºåªèƒ½æœ‰ä¸€ä¸ªç”¨æˆ·çš„è¯ï¼‰ 12 } 13]) æŸ¥è¯¢ç»“æœ å‡è®¾ comment é›†åˆæœ‰ä¸€ä¸ªæ–‡æ¡£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
1{ 2 &#34;_id&#34;: ObjectId(&#34;comment1&#34;), 3 &#34;content&#34;: &#34;This is a comment&#34;, 4 &#34;userId&#34;: ObjectId(&#34;user1&#34;), 5 &#34;timestamp&#34;: ISODate(&#34;2024-12-09T10:00:00Z&#34;), 6 &#34;userDetails&#34;: { 7 &#34;_id&#34;: ObjectId(&#34;user1&#34;), 8 &#34;name&#34;: &#34;Alice&#34;, 9 &#34;email&#34;: &#34;alice@example.com&#34;, 10 &#34;age&#34;: 30 11 } 12} è§£æè¯´æ˜ $lookup: åœ¨ comment é›†åˆä¸­çš„ userId å­—æ®µå’Œ user é›†åˆä¸­çš„ _id å­—æ®µä¹‹é—´å»ºç«‹è¿æ¥ï¼Œå°†åŒ¹é…åˆ°çš„ç”¨æˆ·ä¿¡æ¯åŠ å…¥åˆ°æ¯ä¸ªè¯„è®ºä¸­ï¼Œå¹¶å­˜å‚¨åœ¨ userDetails å­—æ®µä¸­ã€‚
$unwind: å¦‚æœä½ ç¡®å®šæ¯ä¸ªè¯„è®ºåªæœ‰ä¸€ä¸ªå¯¹åº”çš„ç”¨æˆ·ï¼ˆå³ userId å­—æ®µæŒ‡å‘çš„æ˜¯å”¯ä¸€ç”¨æˆ·ï¼‰ï¼Œä½¿ç”¨ $unwind å°† userDetails æ•°ç»„æ‹†è§£æˆå•ä¸ªå¯¹è±¡ã€‚è¿™æ ·ï¼Œä½ å°±å¯ä»¥ç›´æ¥åœ¨æ¯ä¸ªè¯„è®ºæ–‡æ¡£ä¸­è·å–åˆ°ç”¨æˆ·çš„å±æ€§ã€‚
å¦‚æœä¸€ä¸ªè¯„è®ºå¯èƒ½æœ‰å¤šä¸ªç”¨æˆ·ï¼ˆä¾‹å¦‚è¯„è®ºå¯èƒ½æœ‰å¤šä¸ªä½œè€…ï¼‰ï¼Œä½ å¯ä»¥è·³è¿‡ $unwindï¼Œè¿™æ ·æ¯ä¸ªè¯„è®ºçš„ userDetails ä¼šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«åŒ¹é…çš„æ‰€æœ‰ç”¨æˆ·ã€‚
å…¶ä»–æ”¹è¿› å¦‚æœä½ åªå…³å¿ƒæŸäº›ç‰¹å®šçš„ç”¨æˆ·å­—æ®µï¼Œå¯ä»¥é€šè¿‡ $project å¯¹è¿”å›çš„å­—æ®µè¿›è¡Œè¿‡æ»¤ï¼Œå‡å°‘æ•°æ®ä¼ è¾“é‡ã€‚ä¾‹å¦‚ï¼š
1db.comment.aggregate([ 2 { 3 $lookup: { 4 from: &#34;user&#34;, 5 localField: &#34;userId&#34;, 6 foreignField: &#34;_id&#34;, 7 as: &#34;userDetails&#34; 8 } 9 }, 10 { 11 $unwind: &#34;$userDetails&#34; 12 }, 13 { 14 $project: { 15 content: 1, // åªä¿ç•™è¯„è®ºçš„å†…å®¹ 16 &#34;userDetails.name&#34;: 1, // åªè¿”å›ç”¨æˆ·çš„åå­— 17 &#34;userDetails.email&#34;: 1 // åªè¿”å›ç”¨æˆ·çš„é‚®ç®± 18 } 19 } 20]) è¿™æ ·ï¼Œç»“æœå°†åªåŒ…å«è¯„è®ºå†…å®¹ä»¥åŠç”¨æˆ·çš„åå­—å’Œé‚®ç®±ã€‚
æ€»ç»“ ä½¿ç”¨ aggregate() æ–¹æ³•ç»“åˆ $lookup å¯ä»¥è½»æ¾åœ°åœ¨æŸ¥è¯¢è¯„è®ºæ—¶è·å–æ¯ä¸ªè¯„è®ºå¯¹åº”ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚å¦‚æœä½ åªå…³å¿ƒéƒ¨åˆ†ç”¨æˆ·å­—æ®µï¼Œå¯ä»¥ä½¿ç”¨ $project æ¥é™åˆ¶è¿”å›çš„å­—æ®µï¼Œä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡ã€‚
`,url:"https://hugo-dead-simple.netlify.com/mongodb/lookup/"},"https://hugo-dead-simple.netlify.com/mongodb/find_on_array/":{title:"MongoDB - åœ¨æ•°ç»„ä¸ŠæŸ¥è¯¢",tags:["MongoDB","Querying"],content:`æŸ¥è¯¢æ•°ç»„ - MongoDB æ‰‹å†Œ v8.0
$neæ“ä½œåœ¨æ•°ç»„çš„æŸ¥è¯¢ä¸æˆ‘æƒ³çš„ä¸ä¸€æ ·
å¦‚æœä½ å¸Œæœ›èƒ½å¤ŸåŒ¹é…æ•°ç»„ä¸­æœ‰éƒ¨åˆ†å…ƒç´ ä¸ &ldquo;red&rdquo; ä¸åŒ¹é…çš„æ–‡æ¡£ï¼Œå¯ä»¥ä½¿ç”¨ $elemMatch æ¥ç²¾ç¡®åŒ¹é…æ•°ç»„ä¸­çš„å•ä¸ªå…ƒç´ ï¼š
1db.newdb.find({ 2 tags: { $elemMatch: { $ne: &#34;red&#34; } } 3}) æŸ¥è¯¢æ•°ç»„å…ƒç´ 
å¤šä¸ªæ¡ä»¶
1const cursor = db.collection(&#39;inventory&#39;).find({ 2 dim_cm: { $gt: 15, $lt: 20 } 3}); æ•°å­¦æè¿°
âˆƒxâˆˆA(x&gt;=15)âˆ§âˆƒxâˆˆA(x&lt;=20) \\exists x \\in A( x&gt;=15) \\land \\exists x \\in A (x &lt;=20) âˆƒxâˆˆA(x&gt;=15)âˆ§âˆƒxâˆˆA(x&lt;=20)1const cursor = db.collection(&#39;inventory&#39;).find({ 2 dim_cm: { $elemMatch: { $gt: 22, $lt: 30 } } 3}); âˆƒxâˆˆA(x&gt;=15âˆ§x&lt;=20) \\exists x \\in A( x&gt;=15 \\land x &lt;=20) âˆƒxâˆˆA(x&gt;=15âˆ§x&lt;=20)1const cursor = db.collection(&#39;inventory&#39;).find({ 2 dim_cm: {$eq:20} 3}); âˆƒxâˆˆA(x=20) \\exists x \\in A( x=20) âˆƒxâˆˆA(x=20)1const cursor = db.collection(&#39;inventory&#39;).find({ 2 dim_cm: {$ne:20} 3}); !!!æ³¨æ„è¿™ä¸ªæŸ¥è¯¢æ˜¯ä¸Šé¢çš„æŸ¥è¯¢çš„åé¢
Â¬âˆƒxâˆˆA(x=20)âˆ€Â¬(x=20)âˆ€(x!=20) \\begin{matrix} \\neg \\exists x \\in A(x = 20) \\\\ \\forall \\neg (x = 20) \\\\ \\forall (x != 20) \\end{matrix} Â¬âˆƒxâˆˆA(x=20)âˆ€Â¬(x=20)âˆ€(x!=20)â€‹`,url:"https://hugo-dead-simple.netlify.com/mongodb/find_on_array/"},"https://hugo-dead-simple.netlify.com/mongodb/mongodb/":{title:"MongoDB å­¦ä¹ ç¬”è®°",tags:[],content:`å®‰è£… docker å®‰è£…,æ ¹æ®æ–‡æ¡£æ¥: https://www.mongodb.com/zh-cn/docs/manual/tutorial/install-mongodb-community-with-docker/
å®‰è£…å®Œå,æˆ‘æ ¹æ® https://www.w3resource.com/mongodb-exercises/ åšç»ƒä¹ 
è¿™é‡Œçš„å®¢æˆ·ç«¯é€‰æ‹©äº†mongodb compass: https://www.mongodb.com/try/download/compass
æœ€é‡è¦çš„å°±æ˜¯mongodbçš„å®˜æ–¹æ–‡æ¡£: https://www.mongodb.com/zh-cn/docs/manual/
ä¸€äº›æ¦‚å¿µ 1æ•°æ® --&gt; é›†åˆ-&gt; æ–‡æ¡£ å­¦ä¹ è·¯çº¿ æˆ‘è®¤ä¸ºå­¦ä¹ çš„è·¯çº¿ä¸º
å¢åˆ æ”¹æŸ¥ æ³¨æ„æ•°ç»„ä¸ŠæŸ¥è¯¢çš„åç›´è§‰è¡Œä¸º æ³¨æ„$neåœ¨æ•°ç»„çš„æŸ¥è¯¢é—®é¢˜ èšåˆ ç´¢å¼• `,url:"https://hugo-dead-simple.netlify.com/mongodb/mongodb/"},"https://hugo-dead-simple.netlify.com/mongodb/exercise/":{title:"MongoDB ç»ƒä¹  1",tags:["MongoDB","Exercises"],content:`5 Write a MongoDB query to display all the restaurant which is in the borough Bronx. è¿™ä¸ªç®€å•,æœ¬è´¨æ˜¯æŸ¥è¯¢å›ºå®šçš„å€¼
1db[&#34;restaurants&#34;].find({&#39;borough&#39;:&#39;Bronx&#39;}) 8 Write a MongoDB query to find the restaurants who achieved a score more than 90. è®©æˆ‘ä»¬æŸ¥è¯¢ä¸€ä¸ªæ•°ç»„,æ•°ç»„é‡Œé¢æœ‰ä¸€ä¸ªObjectçš„å€¼&gt;=0
1db[&#34;restaurants&#34;].find({&#39;grades.score&#39;: {$gt : 90}}).count() 1db[&#34;restaurants&#34;].find({ &#39;grades&#39; : {$elemMatch : { &#34;score&#34; :{$gt : 90} } } }) è¿™ä¸¤ä¸ªçš„ç»“æœæ˜¯ç­‰ä»·çš„,åªä¸è¿‡ç¬¬äºŒä¸ªç”¨åˆ°äº†æ•°ç»„åŒ¹é…æ“ä½œç¬¦$elemMatch
9 Write a MongoDB query to find the restaurants that achieved a score, more than 80 but less than 100. è¿™ä¸ªé¢˜ç›®çš„æ„æ€æ˜¯: gradesé‡Œå­˜åœ¨ä¸€ä¸ªåˆ†æ•°,è¿™ä¸ªåˆ†æ•°åœ¨80ä¸90ä¹‹é—´
1db[&#34;restaurants&#34;].find({ &#39;grades&#39; : {$elemMatch : { &#34;score&#34; :{$gt : 80,$lt:100} } } }) 10 Write a MongoDB query to find the restaurants which locate in latitude value less than -95.754168. è¿™é‡Œè€ƒå¯Ÿæˆ‘ä»¬å¦‚ä½•æŸ¥è¯¢æ•°ç»„é‡ŒæŸä¸ªä¸‹æ ‡çš„å€¼
1db.restaurants.find({&#34;address.coord.0&#34;:{$lte : -95.754168} }) 11 Write a MongoDB query to find the restaurants that do not prepare any cuisine of &lsquo;American&rsquo; and their grade score more than 70 and latitude less than -65.754168. 1db[&#34;restaurants&#34;].count({cuisine:{$not: {$regex: /.*American.*/ } },grades:{$elemMatch : { &#34;score&#34;:{$gte:70} }} }) è¿™é‡Œè€ƒæŸ¥æˆ‘ä»¬æœ‰å¤šä¸ªæ¡ä»¶,åŒæ—¶æˆç«‹çš„æŸ¥è¯¢
å‘ç°ä¸€ä¸ªé—®é¢˜:
æˆ‘æŸ¥è¯¢äº†æ–‡æ¡£
mongodbåœ¨æ•°ç»„ä¸Šçš„æŸ¥è¯¢ https://www.mongodb.com/zh-cn/docs/manual/tutorial/query-arrays/#specify-multiple-conditions-for-array-elements mongodb - mongo $ne query with an array not working as expected - Stack Overflow $neæ“ä½œåœ¨æ•°ç»„çš„æŸ¥è¯¢ä¸æˆ‘æƒ³çš„ä¸ä¸€æ ·
å¦‚æœä½ å¸Œæœ›èƒ½å¤ŸåŒ¹é…æ•°ç»„ä¸­æœ‰éƒ¨åˆ†å…ƒç´ ä¸ &ldquo;red&rdquo; ä¸åŒ¹é…çš„æ–‡æ¡£ï¼Œå¯ä»¥ä½¿ç”¨ $elemMatch æ¥ç²¾ç¡®åŒ¹é…æ•°ç»„ä¸­çš„å•ä¸ªå…ƒç´ ï¼š
1db.newdb.find({ 2 tags: { $elemMatch: { $ne: &#34;red&#34; } } 3}) è¿™é‡Œå®˜æ–¹ç»™å‡ºçš„ç­”æ¡ˆ
1db.restaurants.find( 2 {$and: 3 [ 4 {&#34;cuisine&#34; : {$ne :&#34;American &#34;}}, 5 {&#34;grades.score&#34; : {$gt : 70}}, 6 {&#34;address.coord&#34; : {$lt : -65.754168}} 7 ] 8 }); 12 Write a MongoDB query to find the restaurants which do not prepare any cuisine of &lsquo;American&rsquo; and achieved a score more than 70 and located in the longitude less than -65.754168. Note : Do this query without using $and operator. å’Œä¸Šä¸€ä¸ªé—®é¢˜çš„é—®é¢˜ä¸€æ ·,åªæ˜¯ä¸è®©æˆ‘ä»¬ä½¿ç”¨$and$ç¬¦å·
1db.restaurants.find( 2 { 3 &#34;cuisine&#34; : {$ne : &#34;American &#34;}, 4 &#34;grades.score&#34; :{$gt: 70}, 5 &#34;address.coord&#34; : {$lt : -65.754168} 6 } 7 ); 13 Write a MongoDB query to find the restaurants which do not prepare any cuisine of &lsquo;American&rsquo; and achieved a grade point &lsquo;A&rsquo; not belongs to the borough Brooklyn. The document must be displayed according to the cuisine in descending order. å‰é¢çš„æ¡ä»¶è¿˜å¥½,è¿™é‡Œåªæ˜¯å¤šäº†ä¸€ä¸ªæ’åºçš„è¦æ±‚
1db.restaurants.find( { 2 &#34;cuisine&#34; : {$ne : &#34;American&#34;}, 3 &#34;grades.grade&#34; :&#34;A&#34;, 4 &#34;borough&#34;: {$ne : &#34;Brooklyn&#34;} 5 } 6 ).sort({&#34;cuisine&#34;:-1}); 14 Write a MongoDB query to find the restaurant Id, name, borough and cuisine for those restaurants which contain &lsquo;Wil&rsquo; as first three letters for its name. æŸ¥è¯¢çš„æ¡ä»¶æ˜¯nameçš„é¦–ä¸ªä¸‰ä¸ªå­—æ¯æ˜¯3ä¸ªWilå­—ç¬¦.
æˆ‘è¿™é‡Œçš„å†™æ³•ä¸å®˜æ–¹ä¸ä¸€æ ·,å› ä¸ºæˆ‘ä¸ç†è§£å®˜æ–¹çš„ç¬¬äºŒä¸ªå‚æ•°,ä¸ºä»€ä¹ˆè¿™æ ·å†™,å› ä¸ºæˆ‘æŸ¥è¯¢çš„nodejs api ä¸æ˜¯è¿™æ ·çš„.
https://mongodb.github.io/node-mongodb-native/6.11/interfaces/FindOptions.html#projection
1db[&#34;restaurants&#34;].find ({name:/AWil/}).projection({name:1,restaurant_id:1,borough:1,cuisine:1}}) ä¸ºä»€ä¹ˆä¼šè¿™æ ·? ,AI å‘Šè¯‰æˆ‘è¿™æ˜¯ä¸€ä¸ªå·®å¼‚!!!
ä½ æå‡ºçš„é—®é¢˜æ¶‰åŠåˆ° MongoDB Node.js Driver çš„ find æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ª é€‰é¡¹å¯¹è±¡ï¼ˆoptionsï¼‰ï¼Œè€Œ æŠ•å½±ï¼ˆprojectionï¼‰ æ˜¯è¯¥é€‰é¡¹å¯¹è±¡ä¸­çš„ä¸€ä¸ªå­—æ®µã€‚è¿™æ˜¯ MongoDB Node.js Driver å’Œ MongoDB Shellï¼ˆmongoshï¼‰ä¹‹é—´çš„ä¸€ä¸ªå·®å¼‚ã€‚
MongoDB Node.js Driver çš„ find æ–¹æ³• æ ¹æ®ä½ æä¾›çš„é“¾æ¥ï¼Œåœ¨ MongoDB çš„ Node.js Driver ç‰ˆæœ¬ 3.6 ä¸­ï¼Œfind æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•° å¿…é¡»æ˜¯ä¸€ä¸ªé€‰é¡¹å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸­å¯ä»¥åŒ…å«å¤šä¸ªé€‰é¡¹ï¼Œä¾‹å¦‚ projection, sort, limit ç­‰ã€‚
find æ–¹æ³•çš„ç­¾åï¼ˆNode.js Driverï¼‰ 1find(filter, options) filter: æŸ¥è¯¢æ¡ä»¶ã€‚ options: é€‰é¡¹å¯¹è±¡ï¼Œå…¶ä¸­åŒ…æ‹¬å¤šä¸ªå¯é€‰çš„å­—æ®µï¼Œä¾‹å¦‚ projection, sort, limit ç­‰ã€‚ æŠ•å½±ï¼ˆProjectionï¼‰åœ¨é€‰é¡¹å¯¹è±¡ä¸­ åœ¨ MongoDB Node.js Driver ä¸­ï¼ŒæŠ•å½±ï¼ˆprojectionï¼‰ æ˜¯é€šè¿‡é€‰é¡¹å¯¹è±¡ä¸­çš„ projection å­—æ®µæ¥æŒ‡å®šçš„ã€‚å› æ­¤ï¼Œç¬¬äºŒä¸ªå‚æ•°çš„å½¢å¼é€šå¸¸æ˜¯ä¸€ä¸ªåŒ…å« projection å­—æ®µçš„å¯¹è±¡ï¼Œè€Œ æŠ•å½±ï¼ˆprojectionï¼‰ æœ¬èº«æ˜¯ä¸€ä¸ªæ–‡æ¡£ï¼Œå®šä¹‰äº†éœ€è¦åŒ…å«æˆ–æ’é™¤çš„å­—æ®µã€‚
ç¤ºä¾‹ä»£ç ï¼š 1const { MongoClient } = require(&#39;mongodb&#39;); 2 3async function queryRestaurants() { 4 const client = new MongoClient(&#39;mongodb://localhost:27017&#39;); 5 await client.connect(); 6 const db = client.db(&#39;test&#39;); // å‡è®¾ä½ çš„æ•°æ®åº“åæ˜¯ &#39;test&#39; 7 const collection = db.collection(&#39;restaurants&#39;); 8 9 // ä½¿ç”¨ find æŸ¥è¯¢å¹¶æŠ•å½± 10 const cursor = collection.find( 11 { name: /^Wil/ }, 12 { 13 projection: { 14 &#34;restaurant_id&#34;: 1, 15 &#34;name&#34;: 1, 16 &#34;borough&#34;: 1, 17 &#34;cuisine&#34;: 1 18 } 19 } 20 ); 21 22 // è·å–æŸ¥è¯¢ç»“æœå¹¶æ‰“å° 23 const results = await cursor.toArray(); 24 console.log(results); 25 26 await client.close(); 27} 28 29queryRestaurants().catch(console.error); ä¸ºä»€ä¹ˆå¿…é¡»ä½¿ç”¨ projection å­—æ®µï¼Ÿ åœ¨ Node.js MongoDB Driver çš„ find æ–¹æ³•ä¸­ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ª é€‰é¡¹å¯¹è±¡ï¼ˆoptionsï¼‰ï¼Œå› æ­¤ä½ éœ€è¦æ˜ç¡®æŒ‡å®š projection å­—æ®µæ¥è®¾ç½®æŸ¥è¯¢è¿”å›çš„å­—æ®µã€‚è¿™æ˜¯ä¸ MongoDB Shellï¼ˆmongoshï¼‰ çš„å·®å¼‚ï¼Œåè€…å¯ä»¥ç›´æ¥å°†æŠ•å½±æ–‡æ¡£ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚
Node.js Driver çš„é€‰é¡¹å¯¹è±¡ç»“æ„ åœ¨ Node.js ä¸­ï¼Œä½ å¯ä»¥ä¼ é€’ä¸€ä¸ªåŒ…å«å¤šä¸ªé€‰é¡¹å­—æ®µçš„å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š
1{ 2 projection: { &#34;restaurant_id&#34;: 1, &#34;name&#34;: 1, &#34;borough&#34;: 1, &#34;cuisine&#34;: 1 }, 3 sort: { name: 1 }, 4 limit: 10 5} projection: æŒ‡å®šè¿”å›çš„å­—æ®µã€‚ sort: æŒ‡å®šæ’åºè§„åˆ™ã€‚ limit: é™åˆ¶è¿”å›çš„æ–‡æ¡£æ•°é‡ã€‚ æ€»ç»“ åœ¨ MongoDB Node.js Driver ä¸­ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ª é€‰é¡¹å¯¹è±¡ï¼ˆoptionsï¼‰ï¼Œå…¶ä¸­åŒ…å« projection å­—æ®µæ¥æŒ‡å®šæŠ•å½±ã€‚è€Œåœ¨ MongoDB Shellï¼ˆmongoshï¼‰ ä¸­ï¼Œç¬¬äºŒä¸ªå‚æ•°ç›´æ¥æ˜¯ä¸€ä¸ªæŠ•å½±æ–‡æ¡£ï¼Œå¯ä»¥çœç•¥ projection å­—æ®µåã€‚
Node.js Driver ä½¿ç”¨ projectionï¼š 1db.restaurants.find( 2 { name: /^Wil/ }, 3 { projection: { &#34;restaurant_id&#34;: 1, &#34;name&#34;: 1, &#34;borough&#34;: 1, &#34;cuisine&#34;: 1 } } 4); MongoDB Shell ä¸­ç›´æ¥ä¼ é€’æŠ•å½±æ–‡æ¡£ï¼š 1db.restaurants.find( 2 { name: /^Wil/ }, 3 { &#34;restaurant_id&#34;: 1, &#34;name&#34;: 1, &#34;borough&#34;: 1, &#34;cuisine&#34;: 1 } 4); å¥½å§,ç»è¿‡æˆ‘çš„æŸ¥è¯¢,è¿™çœŸçš„æ˜¯ä¸€ä¸ªå·®å¼‚:
https://stackoverflow.com/questions/67090307/mongodb-projection-syntax https://www.mongodb.com/zh-cn/docs/manual/reference/method/db.collection.findOne/ ä¸¤è€…ç¡®å®ä¸ä¸€æ ·.
15 Write a MongoDB query to find the restaurant Id, name, borough and cuisine for those restaurants which contain &lsquo;ces&rsquo; as last three letters for its name. å’Œä¸Šä¸€ä¸ªé—®é¢˜ä¸€æ ·,ä½†æ˜¯è¦æŸ¥è¯¢çš„å€¼æ˜¯æœ€åä¸‰ä¸ªå­—ç¬¦,è¿˜æ˜¯ä½¿ç”¨regex
1db.restaurants.find( 2{name: /ces$/}, 3{ 4&#34;restaurant_id&#34; : 1, 5&#34;name&#34;:1,&#34;borough&#34;:1, 6&#34;cuisine&#34; :1 7} 8); 1db[&#34;restaurants&#34;].find ({name:/ces$/}).projection({name:1, 2restaurant_id:1,borough:1,cuisine:1}) 16 åŒ…å«Reg+æŠ•å½± Write a MongoDB query to find the restaurant Id, name, borough and cuisine for those restaurants which contain &lsquo;Reg&rsquo; as three letters somewhere in its name. æ”¹å˜ä¸€ä¸‹regå°±å¯ä»¥äº†.
1db[&#34;restaurants&#34;].find({name:/Reg/},{name:1}).count() 2db[&#34;restaurants&#34;].find({name:/Reg/},{name:1}).count() 3 4db.restaurants.find( 5{&#34;name&#34;: /.*Reg.*/}, 6{ 7&#34;restaurant_id&#34; : 1, 8&#34;name&#34;:1,&#34;borough&#34;:1, 9&#34;cuisine&#34; :1 10} 11); 17 Write a MongoDB query to find the restaurants which belong to the borough Bronx and prepared either American or Chinese dish. 1db[&#34;restaurants&#34;].find({&#34;cuisine&#34;: {$in :[&#39;Chinese&#39;, &#39;American &#39;]} , 2 &#34;borough&#34;: &#34;Bronx&#34; 3},{&#34;cuisine&#34;:1}).count() 1db.restaurants.find( 2{ 3&#34;borough&#34;: &#34;Bronx&#34; , 4$or : [ 5{ &#34;cuisine&#34; : &#34;American &#34; }, 6{ &#34;cuisine&#34; : &#34;Chinese&#34; } 7] 8} 9); 18 Write a MongoDB query to find the restaurant Id, name, borough and cuisine for those restaurants which belong to the borough Staten Island or Queens or Bronxor Brooklyn.
å’Œæˆ‘çš„ä¸Šä¸€ä¸ªæ‰§è¡Œ$inçš„è¯­æ³•ä¸€æ ·
1db.restaurants.find( 2 {&#34;borough&#34; :{$in :[&#34;Staten Island&#34;,&#34;Queens&#34;,&#34;Bronx&#34;,&#34;Brooklyn&#34;]}}, 3 { 4 &#34;restaurant_id&#34; : 1, 5 &#34;name&#34;:1,&#34;borough&#34;:1, 6 &#34;cuisine&#34; :1 7 } 8 ); 19 Write a MongoDB query to find the restaurant Id, name, borough and cuisine for those restaurants which are not belonging to the borough Staten Island or Queens or Bronxor Brooklyn.
ä»æ•°ç†é€»è¾‘çš„è§’åº¦æ¥çœ‹,aâˆ‰{boroughÂ StatenÂ IslandÂ ,Â QueensÂ ,Â BronxorÂ Brooklyn}a \\notin \\{\\text{borough Staten Island , Queens , Bronxor Brooklyn} \\}aâˆˆ/{boroughÂ StatenÂ IslandÂ ,Â QueensÂ ,Â BronxorÂ Brooklyn} å½“è¿™ä¸ªæ¡ä»¶ä¸ºtrueçš„æ—¶å€™,è¿™é‡Œä½¿ç”¨$ninæ“ä½œ
1db.restaurants.find( 2{&#34;borough&#34; :{$nin :[&#34;Staten Island&#34;,&#34;Queens&#34;,&#34;Bronx&#34;,&#34;Brooklyn&#34;]}}, 3{ 4&#34;restaurant_id&#34; : 1, 5&#34;name&#34;:1,&#34;borough&#34;:1, 6&#34;cuisine&#34; :1 7} 8); 20 Write a MongoDB query to find the restaurant Id, name, borough and cuisine for those restaurants which achieved a score which is not more than 10.
è¿™é‡Œçš„æ ¸å¿ƒå°±åœ¨äº not more than 10 ,æ•°å­¦å†™æ³•
Â¬(grades.score&gt;10)â‡”grades.score&lt;=10 \\neg (grades.score &gt; 10) \\Leftrightarrow grades.score &lt;= 10 Â¬(grades.score&gt;10)â‡”grades.score&lt;=101db[&#34;restaurants&#34;].find({&#34;grades.score&#34;: {$lte: 10}}).count() 2 3db.restaurants.find( {&#34;grades.score&#34; : { $not: {$gt : 10} } }).count() æ©&hellip;&hellip;&hellip;.., ä¸¤è€…ç«Ÿç„¶æ˜¯ä¸ä¸€æ ·çš„.
é¢˜ç›®åº”è¯¥é—®çš„æ˜¯: æ‰€æœ‰çš„åˆ†éƒ½ä¸è¶…è¿‡10.
$lte:10 åº”è¯¥æ˜¯åªè¦æœ‰ä¸€ä¸ª(å­˜åœ¨)&lt;=10 å°±æˆç«‹
é‡åˆ°è¿™ç§äº‹ä»¶,åº”è¯¥é¦–å…ˆæŸ¥æ–‡æ¡£: https://www.mongodb.com/zh-cn/docs/manual/reference/operator/query/not/,ä½†æ–‡æ¡£ä¸Šæ²¡æœ‰è¯´.
find({ &quot;grades.score&quot;: {$gt : 10} }) è¡¨ç¤ºçš„æ„æ€å…¶å®æ˜¯: âˆƒ(x&gt;10)\\exists (x &gt; 10)âˆƒ(x&gt;10)
find({ &quot;grades.score&quot;: {$not :{ $gt : 10} }}) è¡¨ç¤ºçš„æ„æ€å…¶å®æ˜¯: Â¬âˆƒ(x&gt;10)â†’âˆ€(x&lt;=10)\\neg \\exists (x &gt; 10) \\to \\forall (x&lt;=10)Â¬âˆƒ(x&gt;10)â†’âˆ€(x&lt;=10),è¿™æ ·å°±èƒ½ç†è§£äº†
`,url:"https://hugo-dead-simple.netlify.com/mongodb/exercise/"},"https://hugo-dead-simple.netlify.com/mongodb/exercise2/":{title:"MongoDB ç»ƒä¹  2",tags:["MongoDB","Exercises"],content:`21 Write a MongoDB query to find the restaurant Id, name, borough and cuisine for those restaurants which prepared dish except &lsquo;American&rsquo; and &lsquo;Chinees&rsquo; or restaurant&rsquo;s name begins with letter &lsquo;Wil&rsquo;.
1db.restaurants.find({ 2 $or : [ 3 {&#34;name&#34;: /^Wil/}, 4 {&#34;cuisine&#34; : { $nin :[&#34;American &#34;,&#34;Chinees&#34;] }} 5 ] 6 }) è¿™ä¸¤ä¸ªå†™æ³•æ˜¯ä¸€æ ·çš„
1db.restaurants.find( 2{$or: [ 3 {name: /^Wil/}, 4 {&#34;$and&#34;: [ 5 {&#34;cuisine&#34; : {$ne :&#34;American &#34;}}, 6 {&#34;cuisine&#34; : {$ne :&#34;Chinees&#34;}} 7 ]} 8]} 9,{&#34;restaurant_id&#34; : 1,&#34;name&#34;:1,&#34;borough&#34;:1,&#34;cuisine&#34; :1} 10); 22 Write a MongoDB query to find the restaurant Id, name, and grades for those restaurants which achieved a grade of &ldquo;A&rdquo; and scored 11 on an ISODate &ldquo;2014-08-11T00:00:00Z&rdquo; among many of survey dates. è¾¾åˆ°äº† grade A ä¸” scored 11. é¦–å…ˆ,æˆ‘ä»¬è¦ç†è§£è¿™é‡Œçš„æ„æ€åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€?
æœ‰ä¸‰ä¸ªæ¡ä»¶:
æ—¶é—´: ISODate &ldquo;2014-08-11T00:00:00Z åˆ†å€¼: 11 grade: A è¿™é‡Œçš„å…³é”®åœ¨äº,æ•°ç»„gradeså…¶ä¸­çš„ä¸€æ¡æ»¡è¶³è¿™3ä¸ªæ¡ä»¶.é‚£ä¹ˆé‡Œè¿™é‡Œè¦ç”¨åˆ°çš„$elemMatch
1db.restaurants.find({ 2 grades:{ $elemMatch : { grade:&#39;A&#39;,date:ISODate(&#34;2014-08-11T00:00:00Z&#34;), scored: 11}} 3 }) ä½†æ˜¯ç»™å‡ºçš„ç­”æ¡ˆæ˜¯,ç†è§£æˆ‘å†™åœ¨æ³¨é‡Šé‡Œ
1db.restaurants.find( 2 { // è¿™é‡Œæ˜¯and 3 &#34;grades.date&#34;: ISODate(&#34;2014-08-11T00:00:00Z&#34;), // è¿™é‡Œåªè¦æœ‰ä¸€ä¸ªæ•°ç»„çš„å…ƒç´ æˆç«‹ 4 &#34;grades.grade&#34;:&#34;A&#34; , // è¿™é‡Œåªè¦æœ‰ä¸€ä¸ªæ•°ç»„çš„å…ƒç´ æˆç«‹ 5 &#34;grades.score&#34; : 11// è¿™é‡Œåªè¦æœ‰ä¸€ä¸ªæ•°ç»„çš„å…ƒç´ æˆç«‹ 6 }, 7 {&#34;restaurant_id&#34; : 1,&#34;name&#34;:1,&#34;grades&#34;:1} 8 ); è¿™é‡Œæ€ä¹ˆç”¨æ•°å­¦æè¿°: è®¾é›†åˆAä¸ºA = [{},{},{},{}], æ»¡è¶³æ¡ä»¶aâˆˆAâˆ§bâˆˆAâˆ§câˆˆAa \\in A \\land b \\in A \\land c \\in AaâˆˆAâˆ§bâˆˆAâˆ§câˆˆA
23 Write a MongoDB query to find the restaurant Id, name and grades for those restaurants where the 2nd element of grades array contains a grade of &ldquo;A&rdquo; and score 9 on an ISODate &ldquo;2014-08-11T00:00:00Z&rdquo;.
arrayElemAtï¼ˆå¦‚æœä½ éœ€è¦æ˜ç¡®é€‰æ‹©æ•°ç»„ä¸­çš„ç‰¹å®šå…ƒç´ ï¼‰
å¦‚æœä½ æ˜ç¡®åªæƒ³è¦æŸ¥è¯¢æ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼ŒelemMatch ä¸èƒ½ç›´æ¥åšè¿™ä»¶äº‹ã€‚ä¸è¿‡ï¼Œä½ å¯ä»¥ç»“åˆ $arrayElemAt æ¥é€‰æ‹©æ•°ç»„ä¸­çš„ç¬¬äºŒä¸ªå…ƒç´ è¿›è¡Œæ¡ä»¶åŒ¹é…ï¼š
1db.collection.find({ 2 &#34;$expr&#34;: { 3 &#34;$eq&#34;: [ 4 { &#34;$arrayElemAt&#34;: [&#34;$grades&#34;, 1] }, // è·å–ç¬¬äºŒä¸ªå…ƒç´  5 { &#34;grade&#34;: &#34;A&#34;, &#34;score&#34;: 9, &#34;date&#34;: ISODate(&#34;2014-08-11T00:00:00Z&#34;) } // æ¡ä»¶ 6 ] 7 } 8}) é‚£ä¹ˆè¿˜æ˜¯å®˜æ–¹ç»™çš„ç­”æ¡ˆæ¯”è¾ƒç®€å•:
1db.restaurants.find( 2 { &#34;grades.1.date&#34;: ISODate(&#34;2014-08-11T00:00:00Z&#34;), 3 &#34;grades.1.grade&#34;:&#34;A&#34; , 4 &#34;grades.1.score&#34; : 9 5 }, 6 {&#34;restaurant_id&#34; : 1,&#34;name&#34;:1,&#34;grades&#34;:1} 7 ); 24 Write a MongoDB query to find the restaurant Id, name, address and geographical location for those restaurants where 2nd element of coord array contains a value which is more than 42 and upto 52.
æ²¡æœ‰äº‰è®®
1db.restaurants.find( 2 { 3 &#34;address.coord.1&#34;: {$gt : 42, $lte : 52} 4 }, 5 {&#34;restaurant_id&#34; : 1,&#34;name&#34;:1,&#34;address&#34;:1,&#34;coord&#34;:1} 6 ); 25,26 Write a MongoDB query to arrange the name of the restaurants in ascending order along with all the columns. Write a MongoDB query to arrange the name of the restaurants in descending along with all the columns. å°±æ˜¯æ’åºè€Œå·²
1db.restaurants.find().sort({&#34;name&#34;:1}); 2db.restaurants.find().sort( {&#34;name&#34;:-1}); 27 Write a MongoDB query to arranged the name of the cuisine in ascending order and for that same cuisine borough should be in descending order.
è¿˜æ˜¯æ’åº,ä¸è¿‡åŒæ—¶è¦æ’åºä¸¤ä¸ªå…ƒç´ 
1db.restaurants.find().sort( 2 {&#34;cuisine&#34;:1,&#34;borough&#34; : -1,} 3 ); 28 Write a MongoDB query to know whether all the addresses contains the street or not.
æŸ¥è¯¢å…ƒç´ çš„å­˜åœ¨æ€§
1db.restaurants.find( {&#34;address.street&#34; : { $exists : true } } ); 29 Write a MongoDB query which will select all documents in the restaurants collection where the coord field value is Double.
æŸ¥è¯¢å…ƒç´ çš„ç±»å‹
å¯¹äº field ä¸ºæ•°ç»„çš„æ–‡æ¡£ï¼Œ$type è¿”å›çš„æ–‡æ¡£ä¸­è‡³å°‘æœ‰ä¸€ä¸ªæ•°ç»„å…ƒç´ ä¸ä¼ é€’ç»™ $type çš„ç±»å‹åŒ¹é…ã€‚
å¯¹ $type: &ldquo;array&rdquo; çš„æŸ¥è¯¢ä¼šè¿”å›å­—æ®µæœ¬èº«ä¸ºæ•°ç»„çš„æ–‡æ¡£ã€‚
$type â€” MongoDB æ‰‹å†Œ v8.0
1db.restaurants.find( {&#34;address.coord&#34; : {$type : 1} }); 30 Write a MongoDB query which will select the restaurant Id, name and grades for those restaurants which returns 0 as a remainder after dividing the score by 7.
è¿™é‡Œç”¨åˆ°äº† $mod - MongoDB æ‰‹å†Œ v8.0
1db.restaurants.find( 2 {&#34;grades.score&#34; : 3 {$mod : [7,0]} 4 }, 5 {&#34;restaurant_id&#34; : 1,&#34;name&#34;:1,&#34;grades&#34;:1} 6 ); 31 Write a MongoDB query to find the restaurant name, borough, longitude and attitude and cuisine for those restaurants which contains &lsquo;mon&rsquo; as three letters somewhere in its name.
æ­£åˆ™æŸ¥è¯¢
1db.restaurants.find( 2 { name : 3 { $regex : &#34;mon.*&#34;, $options: &#34;i&#34; } 4 }, 5 { 6 &#34;name&#34;:1, 7 &#34;borough&#34;:1, 8 &#34;address.coord&#34;:1, 9 &#34;cuisine&#34; :1 10 } 11 ); 32 Write a MongoDB query to find the restaurant name, borough, longitude and latitude and cuisine for those restaurants which contain &lsquo;Mad&rsquo; as first three letters of its name.
æ­£åˆ™æŸ¥è¯¢
1db.restaurants.find( 2 { name : 3 { $regex : /^Mad/i, } 4 }, 5 { 6 &#34;name&#34;:1, 7 &#34;borough&#34;:1, 8 &#34;address.coord&#34;:1, 9 &#34;cuisine&#34; :1 10 } 11 ); 33 Write a MongoDB query to find the restaurants that have at least one grade with a score of less than 5.
æ•°ç»„æŸ¥è¯¢
1db.restaurants.find({ &#34;grades.score&#34;: { $lt: 5 } }) 34 Write a MongoDB query to find the restaurants that have at least one grade with a score of less than 5 and that are located in the borough of Manhattan.
æ€ä¹ˆå˜ç®€å•äº†?
1db.restaurants.find({ &#34;grades.score&#34;: { $lt: 5 }, &#34;borough&#34;: &#34;Manhattan&#34; }) 35 Write a MongoDB query to find the restaurants that have at least one grade with a score of less than 5 and that are located in the borough of Manhattan or Brooklyn.
è¿˜æ˜¯ç®€å•
1db.restaurants.find({ 2 $and: [ 3 { 4 $or: [ // å¯ä»¥ç”¨$in 5 {borough: &#34;Manhattan&#34;}, 6 {borough: &#34;Brooklyn&#34;} 7 ] 8 }, 9 { 10 &#34;grades.score&#34;: { $lt: 5 } 11 } 12 ] 13}) 36 Write a MongoDB query to find the restaurants that have at least one grade with a score of less than 5 and that are located in the borough of Manhattan or Brooklyn, and their cuisine is not American.
å®˜æ–¹ç»™çš„è¿™ä¸ªç­”æ¡ˆ,å¯ä»¥ä¸ç”¨æœ€å¤–å±‚çš„$and
1db.restaurants.find({ 2 $and: [ 3{ $or: [{ borough: &#34;Manhattan&#34; }, { borough: &#34;Brooklyn&#34; }] }, 4{ &#34;grades.score&#34;: { $lt: 5 } }, 5{ cuisine: { $ne: &#34;American&#34; } } 6 ] 7}) 37 Write a MongoDB query to find the restaurants that have at least one grade with a score of less than 5 and that are located in the borough of Manhattan or Brooklyn, and their cuisine is not American or Chinese.
è¿™é‡Œç”¨åˆ°äº†ä¸æ˜¯...,ä¹Ÿä¸æ˜¯....è¿™ä¸ªä¹Ÿè¯­æ³•
$nor - MongoDB æ‰‹å†Œ v8.0
é€‰æ‹©æ•°ç»„ä¸­æ‰€æœ‰æŸ¥è¯¢è°“è¯å‡æœªé€šè¿‡çš„æ–‡æ¡£
1$nor :[ expr1 ,expr2...] é‚£ä¹ˆæŸ¥è¯¢çš„æ–‡æ¡£æ»¡è¶³çš„æ¡ä»¶æ˜¯ï¼š
1expr1(doc1) == false and expr2(doc2) == false 38 Write a MongoDB query to find the restaurants that have a grade with a score of 2 and a grade with a score of 6.
grades å«æœ‰2ï¼Œå’Œ6
æˆ‘å†™çš„
1db.restaurants.find({ 2 &#34;grades.score&#34;: 2, 3 &#34;grades.score&#34;: 6, 4 }) æ•ˆæœä¸€æ ·çš„å®˜æ–¹ç­”æ¡ˆã€‚
1db.restaurants.find({ 2 $and: [ 3 {&#34;grades.score&#34;: 2}, 4 {&#34;grades.score&#34;: 6} 5 ] 6}) 39 Write a MongoDB query to find the restaurants that have a grade with a score of 2 and a grade with a score of 6 and are located in the borough of Manhattan.
æ²¡æœ‰ä»€ä¹ˆéš¾åº¦
1db.restaurants.find({ 2 $and: [ 3 {&#34;grades.score&#34;: 2}, 4 {&#34;grades.score&#34;: 6}, 5 {&#34;borough&#34;: &#34;Manhattan&#34;} 6 ] 7}) 40 Write a MongoDB query to find the restaurants that have a grade with a score of 2 and a grade with a score of 6 and are located in the borough of Manhattan or Brooklyn.
1db.restaurants.find({ 2 $and: [ 3 {&#34;grades.score&#34;: 2}, 4 {&#34;grades.score&#34;: 6}, 5 {&#34;borough&#34;: {&#34;$in&#34;: [&#34;Manhattan&#34;, &#34;Brooklyn&#34;]}} 6 ] 7}) `,url:"https://hugo-dead-simple.netlify.com/mongodb/exercise2/"},"https://hugo-dead-simple.netlify.com/mongodb/exercise3/":{title:"MongoDB ç»ƒä¹  3",tags:["MongoDB","Exercises"],content:`41 Write a MongoDB query to find the restaurants that have a grade with a score of 2 and a grade with a score of 6 and are located in the borough of Manhattan or Brooklyn, and their cuisine is not American.
æ²¡æœ‰ä»€ä¹ˆéš¾åº¦
1db.restaurants.find({ 2 $and: [ 3 {borough: {$in: [&#34;Manhattan&#34;, &#34;Brooklyn&#34;]}}, 4 {&#34;grades.score&#34;: {$all: [2, 6]}}, 5 {cuisine: {$ne: &#34;American&#34;}} 6 ] 7}) è¿™é‡Œç”¨åˆ°äº†$allè¿ç®—ç¬¦, è¡¨ç¤ºåé¢çš„å€¼[2,6]éƒ½è¦å•ç‹¬åŒæ—¶åŒ¹é…
42 Write a MongoDB query to find the restaurants that have a grade with a score of 2 and a grade with a score of 6 and are located in the borough of Manhattan or Brooklyn, and their cuisine is not American or Chinese.
1db.restaurants.find({ 2 $and: [ 3{ borough: { $in: [&#34;Manhattan&#34;, &#34;Brooklyn&#34;] } }, 4{ cuisine: { $nin: [&#34;American&#34;, &#34;Chinese&#34;] } }, 5{ grades: { $elemMatch: { score: 2 } } }, 6{ grades: { $elemMatch: { score: 6 } } } 7 ] 8}) 43 Write a MongoDB query to find the restaurants that have a grade with a score of 2 or a grade with a score of 6.
1db.restaurants.find({ 2 $or: [ 3{ &#34;grades.score&#34;: 2 }, 4{ &#34;grades.score&#34;: 6 } 5 ] 6}) 44 Write a MongoDB query to find the restaurants that have a grade with a score of 2 or a grade with a score of 6 and are located in the borough of Manhattan.
æ²¡æœ‰ä»€ä¹ˆéš¾åº¦
1db.restaurants.find({ 2 $and: [ 3 { 4 $or: [ 5{ &#34;grades.score&#34;: 2 }, 6{ &#34;grades.score&#34;: 6 } 7 ] 8 }, 9{ &#34;borough&#34;: &#34;Manhattan&#34; } 10 ] 11}) 45 Write a MongoDB query to find the restaurants that have a grade with a score of 2 or a grade with a score of 6 and are located in the borough of Manhattan or Brooklyn.
1db.restaurants.find({ 2 $and: [ 3 { 4 $or: [ 5{ borough: &#34;Manhattan&#34; }, 6{ borough: &#34;Brooklyn&#34; } 7 ] 8 }, 9 { 10 $or: [ 11{ &#34;grades.score&#34;: 2 }, 12{ &#34;grades.score&#34;: 6 } 13 ] 14 } 15 ] 16}) 48 Write a MongoDB query to find the restaurants that have all grades with a score greater than 5.
è¿™ä¸ªæ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„æŸ¥è¯¢: æ‰€æœ‰grade.scoreéƒ½è¦å¤§äº5
æ­£ç¡®çš„æŸ¥è¯¢æ•°ç»„é‡Œçš„å€¼,éƒ½æ˜¯å­˜åœ¨,ç°åœ¨è¦è½¬æˆ\\forall
1db.restaurants.find({ 2 &#34;grades&#34;: { 3 &#34;$not&#34;: { 4 &#34;$elemMatch&#34;: { 5 &#34;score&#34;: { 6 &#34;$lte&#34;: 5 7 } 8 } 9 } 10 } 11}) 49 Write a MongoDB query to find the restaurants that have all grades with a score greater than 5 and are located in the borough of Manhattan.
å¤šä¸ªæ¡ä»¶,å…³é”®å°±åœ¨äºè¿™ä¸ªæ¡ä»¶:æ‰€æœ‰çš„
50 Write a MongoDB query to find the restaurants that have all grades with a score greater than 5 and are located in the borough of Manhattan or Brooklyn.
ä¸éš¾,è¿™é‡Œæœ‰ä¸€ä¸ªæ¡ä»¶,æˆ–è€…
1db.restaurants.find({ 2 &#34;borough&#34;: { 3 &#34;$in&#34;: [&#34;Manhattan&#34;, &#34;Brooklyn&#34;] 4 }, 5 &#34;grades&#34;: { 6 &#34;$not&#34;: { 7 &#34;$elemMatch&#34;: { 8 &#34;score&#34;: { 9 &#34;$lte&#34;: 5 10 } 11 } 12 } 13 } 14}) `,url:"https://hugo-dead-simple.netlify.com/mongodb/exercise3/"},"https://hugo-dead-simple.netlify.com/mongodb/exercise4/":{title:"MongoDB ç»ƒä¹  4",tags:["MongoDB","Exercises"],content:`51 Write a MongoDB query to find the average score for each restaurant.
ä¸€ä¸ªæ•°ç»„çš„å¹³å‡å€¼
è¿™é‡Œæˆ‘é‡åˆ°çš„ç¬¬ä¸€ä¸ª aggregate
1db.restaurants.aggregate([{ 2 $unwind: &#34;$grades&#34; 3 }, 4 { 5 $group: { 6 _id: &#34;$name&#34;, 7 avgScore: { 8 $avg: &#34;$grades.score&#34; 9 } 10 } 11 } 12]) è¿™é‡Œgptç»™å‡ºçš„å¤šç§æ±‚å¹³å‡å€¼çš„æ–¹æ³•
åœ¨ MongoDB ä¸­ï¼Œè¦æ±‚æ•°ç»„çš„å¹³å‡å€¼å¯ä»¥ä½¿ç”¨ èšåˆæ¡†æ¶ æ¥å¤„ç†ã€‚MongoDB çš„èšåˆæ¡†æ¶æä¾›äº†å¼ºå¤§çš„æ•°æ®æ“ä½œåŠŸèƒ½ï¼ŒåŒ…æ‹¬è®¡ç®—æ•°ç»„ä¸­å…ƒç´ çš„å¹³å‡å€¼ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥å®ç°ï¼š
å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹æ–‡æ¡£é›†åˆï¼š 1{ 2 &#34;_id&#34;: 1, 3 &#34;scores&#34;: [90, 80, 70, 85] 4}, 5{ 6 &#34;_id&#34;: 2, 7 &#34;scores&#34;: [60, 75, 85, 90] 8} æ–¹æ³• 1ï¼šä½¿ç”¨ $avg æ“ä½œç¬¦ MongoDB çš„èšåˆæ¡†æ¶å…è®¸åœ¨ç®¡é“ä¸­ä½¿ç”¨ $avg æ“ä½œç¬¦æ¥è®¡ç®—æŸä¸ªæ•°ç»„çš„å¹³å‡å€¼ã€‚ä¸ºäº†è®¡ç®—æ•°ç»„ scores çš„å¹³å‡å€¼ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå°†æ•°ç»„å…ƒç´ å±•å¼€ï¼ˆä½¿ç”¨ $unwindï¼‰ï¼Œç„¶åè®¡ç®—å¹³å‡å€¼ã€‚
èšåˆç®¡é“ç¤ºä¾‹ï¼š 1db.collection.aggregate([ 2 { 3 $project: { 4 averageScore: { $avg: &#34;$scores&#34; } 5 } 6 } 7]) è§£é‡Šï¼š $projectï¼šç”¨äºæŒ‡å®šè¾“å‡ºçš„å­—æ®µï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æŒ‡å®šäº†ä¸€ä¸ªæ–°å­—æ®µ averageScoreã€‚ $avgï¼šç”¨äºè®¡ç®—æŒ‡å®šå­—æ®µçš„å¹³å‡å€¼ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åº”ç”¨ $avg æ“ä½œç¬¦æ¥è®¡ç®— scores æ•°ç»„çš„å¹³å‡å€¼ã€‚ æ–¹æ³• 2ï¼šä½¿ç”¨ $unwind ä¸ $group æ¥æ±‚å¹³å‡å€¼ å¦‚æœä½ æƒ³æ›´ç»†ç²’åº¦åœ°å¤„ç†æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨ $unwind æ¥å±•å¹³æ•°ç»„ï¼Œç„¶åä½¿ç”¨ $group æ¥æ±‚æ•°ç»„çš„å¹³å‡å€¼ã€‚
èšåˆç®¡é“ç¤ºä¾‹ï¼š 1db.collection.aggregate([ 2 { $unwind: &#34;$scores&#34; }, 3 { $group: { _id: null, averageScore: { $avg: &#34;$scores&#34; } } } 4]) è§£é‡Šï¼š $unwindï¼šå°† scores æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ å±•å¹³ä¸ºå•ç‹¬çš„æ–‡æ¡£ã€‚æ¯ä¸ªæ–‡æ¡£å°†åŒ…å«ä¸€ä¸ªæ•°ç»„å…ƒç´ ã€‚ $groupï¼šå°†æ‰€æœ‰å±•å¹³åçš„æ–‡æ¡£ç»„åˆåœ¨ä¸€èµ·ï¼Œå¹¶ä½¿ç”¨ $avg æ¥è®¡ç®—è¿™äº›æ–‡æ¡£ä¸­ scores å­—æ®µçš„å¹³å‡å€¼ã€‚ è¿™ä¸ªæ–¹æ³•é€‚ç”¨äºå½“ä½ å¸Œæœ›å¯¹æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œå¤„ç†å¹¶è®¡ç®—å¹³å‡å€¼çš„æƒ…å†µã€‚
æ–¹æ³• 3ï¼šç›´æ¥è®¡ç®—å­—æ®µçš„å¹³å‡å€¼ å¦‚æœæ•°ç»„å­—æ®µæœ¬èº«å·²ç»åŒ…å«äº†æ‰€æœ‰çš„æ•°å€¼ï¼Œä¸”ä½ åªæƒ³è®¡ç®—è¿™ä¸ªæ•°ç»„å­—æ®µçš„å¹³å‡å€¼ï¼Œè€Œä¸æ˜¯æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå¯ä»¥ç›´æ¥åœ¨ aggregate é˜¶æ®µä¸­è®¡ç®—å¹³å‡å€¼ï¼š
ç¤ºä¾‹ï¼š 1db.collection.aggregate([ 2 { 3 $project: { 4 averageScore: { $avg: &#34;$scores&#34; } 5 } 6 } 7]) æ€»ç»“ï¼š $avg ç”¨äºè®¡ç®—ä¸€ä¸ªæ•°å€¼å­—æ®µçš„å¹³å‡å€¼ï¼Œå¯ä»¥ç›´æ¥åœ¨èšåˆç®¡é“ä¸­å¯¹æ•°ç»„å­—æ®µè¿›è¡Œæ“ä½œã€‚ $unwind + $group é€‚ç”¨äºéœ€è¦å°†æ•°ç»„å…ƒç´ åˆ†å¼€å¤„ç†ï¼Œå¹¶æ±‚æ‰€æœ‰å…ƒç´ çš„å¹³å‡å€¼ã€‚ æ ¹æ®éœ€æ±‚é€‰æ‹©é€‚åˆçš„æ–¹æ³•ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œç›´æ¥ä½¿ç”¨ $avg å¯¹æ•°ç»„å­—æ®µæ±‚å¹³å‡å€¼æœ€ä¸ºç®€å•å’Œé«˜æ•ˆã€‚
52 Write a MongoDB query to find the highest score for each restaurant.
è¿™é‡Œç”¨åˆ°äº† $groupé˜¶æ®µçš„$maxæ“ä½œ
1db.restaurants.aggregate([{ 2 $unwind: &#34;$grades&#34; 3 }, 4 { 5 $group: { 6 _id: &#34;$name&#34;, 7 highest_score: { 8 $max: &#34;$grades.score&#34; 9 } 10 } 11 } 12]) 53 Write a MongoDB query to find the lowest score for each restaurant.
å’Œä¸Šä¸€ä¸ªé¢˜ç›®ä¸€æ ·ï¼Œç”¨$min
1db.restaurants.aggregate([{ 2 $unwind: &#34;$grades&#34; 3 }, 4 { 5 $group: { 6 _id: &#34;$name&#34;, 7 lowest_score: { 8 $min: &#34;$grades.score&#34; 9 } 10 } 11 } 12]) 54 Write a MongoDB query to find the count of restaurants in each borough.
ç”¨åˆ°äº†count
1db.restaurants.aggregate([{ 2 $group: { 3 _id: &#34;$borough&#34;, 4 count: { 5 $sum: 1 6 } 7 } 8}]) 55 Write a MongoDB query to find the count of restaurants for each cuisine.
åªæ˜¯ç”¨åˆ°äº†$sum
1db.restaurants.aggregate([{ 2 $group: { 3 _id: &#34;$cuisine&#34;, 4 count: { 5 $sum: 1 6 } 7 } 8}]) 56 å¦‚ä½•æŒ‰ä¸¤ä¸ªå€¼è¿›è¡Œåˆ†ç»„ 1db.restaurants.aggregate([{ 2 $group: { 3 _id: { 4 cuisine: &#34;$cuisine&#34;, 5 borough: &#34;$borough&#34; 6 }, 7 count: { 8 $sum: 1 9 } 10 } 11}]) 57 å¤šé˜¶æ®µé…åˆ Write a MongoDB query to find the count of restaurants that received a grade of &lsquo;A&rsquo; for each cuisine.
å¤šé˜¶æ®µ
unwind match group 1db.restaurants.aggregate([ 2 { 3 $unwind: &#34;$grades&#34; 4 }, 5 { 6 $match: { &#34;grades.grade&#34;: &#34;A&#34; } 7 }, 8 { 9 $group: { 10 _id: &#34;$cuisine&#34;, 11count: { $sum: 1 } 12 } 13 } 14]) 58 åŒä¸Š Write a MongoDB query to find the count of restaurants that received a grade of &lsquo;A&rsquo; for each borough.
1db.restaurants.aggregate([ 2 { 3 $unwind: &#34;$grades&#34; 4 }, 5 { 6 $match: { &#34;grades.grade&#34;: &#34;A&#34; } 7 }, 8 { 9 $group: { 10 _id: &#34;$borough&#34;, 11count: { $sum: 1 } 12 } 13 } 14]) 59 Write a MongoDB query to find the count of restaurants that received a grade of &lsquo;A&rsquo; for each cuisine and borough.
èšåˆç¡®å®èƒ½è¾¾åˆ°
è¿™é‡Œæ²¡æœ‰unwind
1db.restaurants.aggregate([ 2 { 3 $match: { &#34;grades.grade&#34;: &#34;A&#34; } 4 }, 5 { 6 $group: { 7 _id: { cuisine: &#34;$cuisine&#34;, borough: &#34;$borough&#34; }, 8count: { $sum: 1 } 9 } 10 }, 11 { 12 $sort: { count: -1 } 13 } 14]); 60 Write a MongoDB query to find the number of restaurants that have been graded in each month of the year.
é—®ä¸€å¹´ä¸­ï¼Œæ¯ä¸ªæœˆåˆ†è¯„çº§çš„restaurantsåˆ†åˆ«æœ‰å¤šå°‘ä¸ª,é‚£æ˜¾ç„¶è¦$group
1db.restaurants.aggregate([ 2 { 3 $unwind: &#34;$grades&#34; 4 }, 5 { 6 $project: { 7month: { $month: { $toDate: &#34;$grades.date&#34; } }, 8year: { $year: { $toDate: &#34;$grades.date&#34; } } 9 } 10 }, 11 { 12 $group: { 13 _id: { month: &#34;$month&#34;, year: &#34;$year&#34; }, 14count: { $sum: 1 } 15 } 16 }, 17 { 18 $sort: { 19 &#34;_id.year&#34;: 1, 20 &#34;_id.month&#34;: 1 21 } 22 } 23]); 61-66 å¹³å‡åˆ†,æœ€é«˜ä½åˆ† ä¸Šé¢æ±‚è¿‡äº†
67 Write a MongoDB query to find the name and address of the restaurants that received a grade of &lsquo;A&rsquo; on a specific date
æŸ¥è¯¢ä¸€ä¸ªarrayé‡Œæ»¡è¶³ç‰¹å®šæ¡ä»¶çš„ã€‚
1db.restaurants.find( 2 { 3 &#34;grades&#34;: { 4 &#34;$elemMatch&#34;: { 5 &#34;date&#34;: { 6 &#34;$eq&#34;: ISODate(&#34;2013-07-22T00:00:00Z&#34;) 7 }, 8 &#34;grade&#34;: { 9 &#34;$eq&#34;: &#34;A&#34; 10 } 11 } 12 } 13 }, 14 { 15 &#34;name&#34;: 1, 16 &#34;address&#34;: 1, 17 &#34;_id&#34;: 0 18 } 19) 68 Write a MongoDB query to find the name and address of the restaurants that received a grade of &lsquo;B&rsquo; or &lsquo;C&rsquo; on a specific date.
1db.restaurants.find( 2 { 3 &#34;grades&#34;: { 4 $elemMatch: { 5 &#34;date&#34;: ISODate(&#34;2013-04-05&#34;), 6 &#34;grade&#34;: { $in: [ &#34;B&#34;, &#34;C&#34; ] } 7 } 8 } 9 }, 10 { 11 &#34;name&#34;: 1, 12 &#34;address&#34;: 1 13 } 14) 69 Write a MongoDB query to find the name and address of the restaurants that have at least one &lsquo;A&rsquo; grade and one &lsquo;B&rsquo; grade.
å•Šï¼ æŸ¥è¯¢æ•°ç»„é‡Œï¼š è‡³å°‘å«æœ‰ä¸€ä¸ªAï¼Œä¸”è‡³å°‘å«æœ‰ä¸€ä¸ªB ,\\exits A in arr \\and \\exits B in arr
70 Write a MongoDB query to find the name and address of the restaurants that have at least one &lsquo;A&rsquo; grade and no &lsquo;B&rsquo; grades.
one A no B.ä¸¤ä¸ªæ¡ä»¶åŒæ—¶æˆç«‹
no b -&gt; not exits b in Arr -&gt; {$not : { &quot;grades.score&quot; : 'A'}
å’Œæˆ‘æƒ³çš„å·®ä¸å¤š
1db.restaurants.find({ 2 $and: [ 3{ &#34;grades.grade&#34;: &#34;A&#34; }, 4{ &#34;grades.grade&#34;: { $not: { $eq: &#34;B&#34; } } } 5 ] 6}, 7{ name: 1, address: 1, _id: 0 }) 71 Write a MongoDB query to find the name ,address and grades of the restaurants that have at least one &lsquo;A&rsquo; grade and no &lsquo;C&rsquo; grades.
åŒä¸Š
1db.restaurants.find({ 2 $and: [ 3{ &#34;grades.grade&#34;: &#34;A&#34; }, 4{ &#34;grades.grade&#34;: { $not: { $eq: &#34;C&#34; } } } 5 ] 6}, 7{ name: 1, address: 1, &#34;grades.grade&#34;:1, _id: 0 }) 72 Write a MongoDB query to find the name, address, and grades of the restaurants that have at least one &lsquo;A&rsquo; grade, no &lsquo;B&rsquo; grades, and no &lsquo;C&rsquo; grades.
åŒä¸Š
1db.restaurants.find({ 2 $and: [ 3{ &#34;grades.grade&#34;: &#34;A&#34; }, 4{ &#34;grades.grade&#34;: { $not: { $eq: &#34;B&#34; } } }, 5{ &#34;grades.grade&#34;: { $not: { $eq: &#34;C&#34; } } } 6 ] 7}, 8{ name: 1, address: 1, &#34;grades.grade&#34;:1, _id: 0 }) 73 Write a MongoDB query to find the name and address of the restaurants that have the word &lsquo;coffee&rsquo; in their name
æ­£åˆ™
1db.restaurants.find({ name: { $regex: /coffee/i } }, { name: 1, address: 1 }) 74 Write a MongoDB query to find the name and address of the restaurants that have a zipcode that starts with &lsquo;10&rsquo;.
è¿™é‡Œæˆ‘è§‰å¾—å®˜æ–¹ç»™çš„ç­”æ¡ˆä¸å¯¹ã€‚
75 Write a MongoDB query to find the name and address of the restaurants that have a cuisine that starts with the letter &lsquo;B&rsquo;.
1db.restaurants.find( 2	{ &#34;cuisine&#34;: { $regex: /^B/ } }, 3	{ &#34;name&#34;: 1, 4	&#34;address&#34;: 1, 5	&#34;cuisine&#34; : 1, 6	&#34;_id&#34;: 0 } 7) 76 77 æ­£åˆ™ æ²¡æœ‰ä»€ä¹ˆå¥½å†™çš„
78 æ‰¾æœ€å¤§å€¼ï¼Œé‚£å°±éœ€è¦æ’åº
1db.restaurants.aggregate([ 2 {$unwind: &#34;$grades&#34;}, 3 {$group: { 4 _id: &#34;$restaurant_id&#34;, 5avgScore: {$avg: &#34;$grades.score&#34;} 6 }}, 7 {$sort: {avgScore: -1}}, 8 {$limit: 1}, 9 {$project: {_id: 1, avgScore: 1}} 10]) 79 æ‰¾æœ€å¤§çš„å€¼Açš„é‚£äº›restaurantsçš„idï¼Œç”¨åˆ°èšåˆ
1db.restaurants.aggregate([ 2 {$unwind: &#34;$grades&#34;}, 3 {$match: {&#34;grades.grade&#34;: &#34;A&#34;}}, 4 {$group: { 5 _id: &#34;$restaurant_id&#34;, 6count: {$sum: 1} 7 }}, 8 {$sort: {count: -1}}, 9 {$group: { 10 _id: &#34;$count&#34;, 11restaurants: {$push: &#34;$_id&#34;} 12 }}, 13 {$sort: {_id: -1}}, 14 {$limit: 1}, 15 {$project: {restaurants: 1}} 16]) 80 Write a MongoDB query to find the cuisine type that is most likely to receive a &lsquo;C&rsquo; grade.
å“ªä¸ªåŒºåŸŸçš„Cæœ€å¤š,ç”¨åˆ°äº†èšåˆ
1db.restaurants.aggregate([ 2 {$unwind: &#34;$grades&#34;}, 3 {$match: {&#34;grades.grade&#34;: &#34;C&#34;}}, 4 {$group: {_id: &#34;$cuisine&#34;, count: {$sum: 1}}}, 5 {$sort: {count: -1}} 6]) 81 Write a MongoDB query to find the restaurant that has the highest average score for thecuisine &ldquo;Turkish&rdquo;.
èšåˆã€‚
82 Write a MongoDB query to find the restaurants that achieved the highest total score.
è¿ç»­çš„èšåˆ,èšåˆå°±æ˜¯ä¸€ç§ç®¡é“ã€‚
1db.restaurants.aggregate([ 2{ $unwind: &#34;$grades&#34; }, 3{ $group: { 4 _id: &#34;$name&#34;, 5totalScore: { $sum: &#34;$grades.score&#34; } 6 }}, 7{ $sort: { totalScore: -1 } }, 8{ $group: { 9 _id: &#34;$totalScore&#34;, 10restaurants: { $push: &#34;$_id&#34; } 11 }}, 12{ $sort: { _id: -1 } }, 13{ $limit: 1 }, 14{ $unwind: &#34;$restaurants&#34; }, 15{ $group: { 16 _id: &#34;$_id&#34;, 17restaurants: { $push: &#34;$restaurants&#34; } 18 }} 19]) 83 `,url:"https://hugo-dead-simple.netlify.com/mongodb/exercise4/"},"https://hugo-dead-simple.netlify.com/tags/querying/":{title:"Querying",tags:[],content:"",url:"https://hugo-dead-simple.netlify.com/tags/querying/"},"https://hugo-dead-simple.netlify.com/tags/":{title:"Tags",tags:[],content:"",url:"https://hugo-dead-simple.netlify.com/tags/"},"https://hugo-dead-simple.netlify.com/typescript/typeof%E7%9A%84%E4%BD%BF%E7%94%A8/":{title:"typeofçš„ä½¿ç”¨",tags:[],content:`åœ¨ TypeScript ä¸­ï¼Œtypeof æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„è¿ç®—ç¬¦ï¼Œå®ƒæœ‰ä¸¤ä¸ªä¸»è¦ç”¨é€”ï¼šä¸€ç§ç”¨äº è·å–å€¼çš„ç±»å‹ï¼Œå¦ä¸€ç§ç”¨äº è·å–ç±»å‹çš„æ„é€ å‡½æ•°ã€‚ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«è§£é‡Šè¿™ä¸¤ç§ç”¨é€”ï¼Œå¹¶ç»™å‡ºä¸€äº›ç¤ºä¾‹ã€‚
1. typeof ç”¨äºè·å–å€¼çš„ç±»å‹ åœ¨ TypeScript ä¸­ï¼Œtypeof å¯ä»¥ç”¨æ¥è·å–ä¸€ä¸ªå€¼çš„ç±»å‹ã€‚ä½ å¯ä»¥é€šè¿‡ typeof æ¥æ¨æ–­æˆ–æ˜¾å¼åœ°è·å–å˜é‡çš„ç±»å‹ã€‚
ç¤ºä¾‹ï¼šè·å–å€¼çš„ç±»å‹ 1let x = &#34;hello&#34;; 2let y: typeof x; // y çš„ç±»å‹ä¼šè‡ªåŠ¨æ¨æ–­ä¸º string 3 4y = &#34;world&#34;; // æ­£ç¡® 5// y = 42; // é”™è¯¯: ç±»å‹ &#39;number&#39; ä¸èƒ½èµ‹å€¼ç»™ç±»å‹ &#39;string&#39; typeof x ä¼šæ¨æ–­å‡ºå˜é‡ x çš„ç±»å‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œx æ˜¯ä¸€ä¸ª stringï¼Œæ‰€ä»¥ y çš„ç±»å‹ä¹Ÿä¼šè¢«æ¨æ–­ä¸º stringã€‚ ä½ å¯ä»¥å°† typeof ç”¨äºå˜é‡å£°æ˜ï¼Œæˆ–è€…åœ¨ç±»å‹æ³¨è§£ä¸­æŒ‡å®šç±»å‹ã€‚ ç¤ºä¾‹ï¼šè·å–å¯¹è±¡å±æ€§çš„ç±»å‹ 1const person = { name: &#34;Alice&#34;, age: 30 }; 2let nameType: typeof person.name; // nameType çš„ç±»å‹æ˜¯ string 3let ageType: typeof person.age; // ageType çš„ç±»å‹æ˜¯ number è¿™é‡Œï¼Œtypeof person.name ä¼šå¾—åˆ° person.name çš„ç±»å‹ï¼ˆå³ stringï¼‰ï¼Œtypeof person.age ä¼šå¾—åˆ° numberã€‚ 2. typeof ç”¨äºè·å–ç±»å‹ typeof è¿˜å¯ä»¥ç”¨æ¥è·å– ç±»å‹çš„æ„é€ å‡½æ•°ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½ éœ€è¦å¼•ç”¨æŸä¸ªç±»å‹æˆ–ç±»å‹çš„æ„é€ å‡½æ•°æ—¶ã€‚è¿™ä¸ªç”¨é€”é€šå¸¸ä¸ keyof ä¸€èµ·ä½¿ç”¨æ¥é™åˆ¶æŸä¸ªå€¼çš„ç±»å‹ã€‚
ç¤ºä¾‹ï¼šè·å–ç±»çš„æ„é€ å‡½æ•°ç±»å‹ 1class Person { 2 name: string; 3 constructor(name: string) { 4 this.name = name; 5 } 6} 7 8let PersonConstructor: typeof Person; // PersonConstructor çš„ç±»å‹æ˜¯ \`typeof Person\`ï¼Œå³æ„é€ å‡½æ•°ç±»å‹ 9PersonConstructor = Person; // æ­£ç¡® 10// PersonConstructor = String; // é”™è¯¯: ç±»å‹ &#39;typeof String&#39; ä¸å…¼å®¹ç±»å‹ &#39;typeof Person&#39; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œtypeof Person ä¼šè·å– Person ç±»çš„æ„é€ å‡½æ•°ç±»å‹ï¼Œå³ typeof Person å®é™…ä¸Šæ˜¯ new (name: string) =&gt; Personï¼Œè¡¨ç¤ºå¯ä»¥ç”¨æ¥åˆ›å»º Person å®ä¾‹çš„æ„é€ å‡½æ•°ç±»å‹ã€‚ ç¤ºä¾‹ï¼šé€šè¿‡ typeof å¼•ç”¨ç±»å‹æ„é€ å‡½æ•° 1let x: number = 42; 2let y: typeof x; // y çš„ç±»å‹æ˜¯ number 3y = 123; // æ­£ç¡® 4// y = &#34;hello&#34;; // é”™è¯¯: ç±»å‹ &#39;string&#39; ä¸èƒ½èµ‹å€¼ç»™ç±»å‹ &#39;number&#39; è¿™é‡Œï¼Œtypeof x å–å¾—äº† x çš„ç±»å‹ï¼Œx æ˜¯ number ç±»å‹ï¼Œå› æ­¤ y çš„ç±»å‹ä¹Ÿæ˜¯ numberã€‚ 3. typeof ç”¨äºç±»å‹æ¨æ–­ä¸ç±»å‹ä¿æŠ¤ typeof è¿˜å¯ä»¥ç”¨äºç±»å‹ä¿æŠ¤ï¼Œå³åœ¨ç±»å‹åˆ¤æ–­ä¸­å¸®åŠ©æˆ‘ä»¬æ˜ç¡®å˜é‡çš„ç±»å‹ã€‚è¿™å¯¹äºæŸäº›å¤æ‚çš„ç±»å‹æ£€æŸ¥å¾ˆæœ‰ç”¨ã€‚
ç¤ºä¾‹ï¼štypeof åœ¨ç±»å‹ä¿æŠ¤ä¸­çš„åº”ç”¨ 1function printLength(value: string | string[]) { 2 if (typeof value === &#34;string&#34;) { 3 console.log(value.length); // value æ˜¯ string ç±»å‹ 4 } else { 5 console.log(value.length); // value æ˜¯ string[] ç±»å‹ 6 } 7} 8 9printLength(&#34;Hello&#34;); // è¾“å‡º: 5 10printLength([&#34;a&#34;, &#34;b&#34;, &#34;c&#34;]); // è¾“å‡º: 3 typeof value === &quot;string&quot; ç”¨æ¥åˆ¤æ–­ value æ˜¯å¦æ˜¯ string ç±»å‹ï¼Œå¸®åŠ© TypeScript ç¡®å®šåœ¨ if è¯­å¥å—ä¸­çš„ç±»å‹ã€‚ åŒç†ï¼Œå¯ä»¥ä½¿ç”¨ typeof æ¥åˆ¤æ–­å…¶ä»–åŸºæœ¬ç±»å‹ï¼Œå¦‚ numberã€boolean ç­‰ã€‚ 4. typeof ç”¨äºè”åˆç±»å‹å’Œå­—é¢é‡ç±»å‹çš„æ¨æ–­ typeof ä¹Ÿèƒ½ç”¨æ¥æ¨æ–­å­—é¢é‡ç±»å‹ï¼ˆliteral typesï¼‰ã€‚
ç¤ºä¾‹ï¼šæ¨æ–­å­—é¢é‡ç±»å‹ 1const color = &#34;red&#34;; 2type Color = typeof color; // Color çš„ç±»å‹æ˜¯ &#34;red&#34; 3 4let myColor: Color = &#34;red&#34;; // æ­£ç¡® 5// let anotherColor: Color = &#34;blue&#34;; // é”™è¯¯: ç±»å‹ &#39;&#34;blue&#34;&#39; ä¸èƒ½èµ‹å€¼ç»™ç±»å‹ &#39;&#34;red&#34;&#39; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œtypeof color ä¼šæ¨æ–­å‡º color å˜é‡çš„å­—é¢é‡ç±»å‹ &quot;red&quot;ï¼Œå› æ­¤ Color ç±»å‹å®é™…ä¸Šæ˜¯ &quot;red&quot;ï¼Œè€Œä¸æ˜¯ stringã€‚ æ€»ç»“ typeof è·å–å€¼çš„ç±»å‹ï¼šä½ å¯ä»¥ç”¨ typeof è·å–ä¸€ä¸ªå˜é‡æˆ–å¯¹è±¡çš„ç±»å‹ï¼Œé€šå¸¸ç”¨äºç±»å‹æ¨æ–­æˆ–åŠ¨æ€ç±»å‹èµ‹å€¼ã€‚ typeof è·å–æ„é€ å‡½æ•°ç±»å‹ï¼šå½“ä½ ä½¿ç”¨ typeof å¯¹ç±»è¿›è¡Œæ“ä½œæ—¶ï¼Œå®ƒä¼šè·å–ç±»çš„æ„é€ å‡½æ•°ç±»å‹ï¼Œå¯ä»¥ç”¨äºå¼•ç”¨ç±»å‹çš„æ„é€ å‡½æ•°ã€‚ ç±»å‹ä¿æŠ¤ï¼štypeof åœ¨ç±»å‹ä¿æŠ¤ä¸­å¯ä»¥å¸®åŠ©ä½ æ ¹æ®å€¼çš„ç±»å‹åšå‡ºåˆ¤æ–­ã€‚ å­—é¢é‡ç±»å‹æ¨æ–­ï¼štypeof å¯ä»¥ç”¨äºæ¨æ–­å˜é‡çš„å­—é¢é‡ç±»å‹ï¼Œä»è€Œå®ç°æ›´ç²¾ç¡®çš„ç±»å‹å®šä¹‰ã€‚ é€šè¿‡ typeofï¼Œä½ å¯ä»¥æ›´çµæ´»åœ°åœ¨ TypeScript ä¸­è¿›è¡Œç±»å‹æ¨æ–­ã€ç±»å‹ä¿æŠ¤å’Œç±»å‹çº¦æŸï¼Œå¢å¼ºä»£ç çš„ç±»å‹å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚
`,url:"https://hugo-dead-simple.netlify.com/typescript/typeof%E7%9A%84%E4%BD%BF%E7%94%A8/"},"https://hugo-dead-simple.netlify.com/typescript/typescript_program/":{title:"typescript_program",tags:[],content:` æœ¬æ–‡ç”± ç®€æ‚¦ SimpRead è½¬ç ï¼Œ åŸæ–‡åœ°å€ chengjingchao.com
ç¬¬ 1 ç«  å¯¼è¨€ä½¿ç”¨ TypeScript å¼€å‘çš„ç¨‹åºæ›´å®‰å…¨ï¼Œå¸¸è§çš„é”™è¯¯éƒ½èƒ½æ£€æŸ¥å‡ºæ¥ï¼Œå†™å‡ºçš„ä»£ç è¿˜å¯ä»¥ä½œä¸ºæ–‡æ¡£ã€‚
å‘è¡¨äº 2022-01-01 | æ›´æ–°äº: 2022-01-06
ä½¿ç”¨ TypeScript å¼€å‘çš„ç¨‹åºæ›´å®‰å…¨ï¼Œå¸¸è§çš„é”™è¯¯éƒ½èƒ½æ£€æŸ¥å‡ºæ¥ï¼Œå†™å‡ºçš„ä»£ç è¿˜å¯ä»¥ä½œä¸ºæ–‡æ¡£ã€‚
æ›´å®‰å…¨æ˜¯æŒ‡ç±»å‹å®‰å…¨
ç±»å‹å®‰å…¨ï¼šå€ŸåŠ©ç±»å‹é¿å…ç¨‹åºåšæ— æ•ˆçš„äº‹æƒ…ï¼ˆæ— æ•ˆæŒ‡çš„æ˜¯è¿è¡Œæ—¶ç¨‹åºå´©æºƒæˆ–æœªå´©æºƒï¼Œä½†åšçš„äº‹æƒ…æ¯«æ— æ„ä¹‰
ä¸¾ä¸ª ğŸŒ°
æ•°å­—ä¹˜ä»¥ä¸€ä¸ªåˆ—è¡¨
æ¥æ”¶æ•°å­—çš„å‡½æ•°å´ä¼ å…¥äº†å­—ç¬¦ä¸²
è°ƒç”¨å¯¹è±¡ä¸Šä¸å­˜åœ¨çš„æ–¹æ³•
å¯¼å…¥å·²ç»è¢«ç§»é™¤çš„æ¨¡å—
13 + [] // &#34;3&#34; 2 3 4let obj = {} 5obj.foo // undefined 6 7 8function a(b) { 9 return b/2 10} 11a(&#39;z&#39;) // NaN åœ¨åšæ— æ•ˆäº‹æƒ…çš„æ—¶å€™ï¼ŒJavaScript æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯å°½è‡ªå·±æ‰€èƒ½ï¼Œé¿å…æŠ›å‡ºå¼‚å¸¸ã€‚
è€Œ JavaScript è¿™ç§ç‰¹æ€§è®©ä»£ç ä¸­é”™è¯¯çš„äº§ç”Ÿä¸å‘ç°è„±èŠ‚äº†ã€‚å¯¼è‡´ bug å¾€å¾€æ˜¯ç”±ä»–äººè½¬å‘Šç»™ä½ çš„ã€‚ åˆ°çœŸæ­£è¿è¡Œæ—¶å¯èƒ½æ‰ä¼šå‘ç°é”™è¯¯ã€‚
è€Œ TypeScript ç»™å‡ºé”™è¯¯çš„æ—¶é—´ç‚¹ï¼šåœ¨è¾“å…¥ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œä»£ç ç¼–è¾‘å™¨ä¼šç»™å‡ºé”™è¯¯æ¶ˆæ¯ï¼Œæ¥æé†’ä½ ã€‚
13 + [] // Error TS2365: Operator &#39;+&#39; cannot be applied to types &#39;3&#39; and &#39;never[]&#39;. 2 3 4let obj = {} 5obj.foo // Error TS2339: Property &#39;foo&#39; does not exist on type &#39;{}&#39; 6 7function (a: number) { 8 return b / 2 9} 10a(&#39;z&#39;) // Error TS2345: Argument of type &#39;&#34;z&#34;&#39; is not assignable to parameter of type &#39;number&#39;. ç¼–è¯‘å™¨ TypeScript ç¼–è¯‘å™¨ï¼ˆTSCï¼‰
é€šå¸¸è¿è¡Œç¨‹åºçš„å¤§è‡´æµç¨‹
æŠŠç¨‹åºè§£æä¸º AST AST ç¼–è¯‘æˆå­—èŠ‚ç  è¿è¡Œæ—¶è®¡ç®—å­—èŠ‚ç  è¿è¡Œç¨‹åºå°±æ˜¯è®©è¿è¡Œæ—¶è®¡ç®—ç”±ç¼–è¯‘å™¨ä»æºç è§£æå¾—æ¥çš„ AST ç”Ÿæˆçš„å­—èŠ‚ç ã€‚
TypeScript çš„ç‰¹æ®Šä¹‹å¤„åœ¨äºï¼Œä¸ç›´æ¥ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œè€Œæ˜¯ç¼–è¯‘æˆ JavaScriptã€‚ç„¶åå†åƒå¾€å¸¸ä¸€æ ·ï¼Œåœ¨æµè§ˆå™¨ / NodeJS ä¸­è¿è¡Œã€‚
TypeScript ç¼–è¯‘å™¨ç”Ÿæˆ AST ä¹‹åï¼ŒçœŸæ­£è¿è¡Œä»£ç ä¹‹å‰ä¼šå¯¹ä»£ç åšç±»å‹æ£€æŸ¥ã€‚
ç±»å‹æ£€æŸ¥å™¨ï¼šæ£€æŸ¥ä»£ç æ˜¯å¦ç¬¦åˆå®‰å…¨è¦æ±‚çš„ç‰¹æ®Šç¨‹åº
ç¼–è¯‘å’Œè¿è¡Œ TypeScript (1-3 ç”± TSC æ“ä½œï¼Œ4-6 ç”±æµè§ˆå™¨ / NodeJS æ“ä½œ)
TypeScript æºç  -&gt; TypeScript AST
ç±»å‹æ£€æŸ¥å™¨æ£€æŸ¥ AST
TypeScript AST -&gt; JavaScript æºç 
JavaScript æºç  -&gt; JavaScript AST
AST -&gt; å­—èŠ‚ç 
è¿è¡Œæ—¶è®¡ç®—å­—èŠ‚ç 
ç±»å‹åªåœ¨ç±»å‹æ£€æŸ¥è¿™ä¸€æ­¥ä½¿ç”¨ï¼ŒTSC æŠŠ TS ç¼–è¯‘æˆ JS æ—¶ï¼Œä¸ä¼šè€ƒè™‘ç±»å‹ã€‚å¯ä»¥ç¡®ä¿å¯ä»¥éšæ„æ”¹åŠ¨ã€æ›´æ–°å’Œæ”¹è¿›ç¨‹åºä¸­çš„ç±»å‹ï¼Œè€Œæ— éœ€æ‹…å¿ƒä¼šç ´ååº”ç”¨çš„åŠŸèƒ½ã€‚
ç±»å‹ç³»ç»Ÿ ç±»å‹ç³»ç»Ÿï¼šç±»å‹æ£€æŸ¥å™¨ä¸ºç¨‹åºåˆ†é…ç±»å‹æ—¶ä½¿ç”¨çš„ä¸€ç³»åˆ—è§„åˆ™
ä¸€èˆ¬æ¥è¯´ï¼Œç±»å‹ç³»ç»Ÿæœ‰ä¸¤ç§ï¼Œå„æœ‰åˆ©å¼Š
é€šè¿‡æ˜¾å¼å¥æ³•å‘Šè¯‰ç¼–è¯‘å™¨æ‰€æœ‰å€¼çš„ç±»å‹ è‡ªåŠ¨æ¨å¯¼å€¼çš„ç±»å‹ JavaScript åœ¨è¿è¡Œæ—¶æ¨å¯¼ç±»å‹ TypeScript èº«å…¼ä¸¤ç§ç±»å‹ç³»ç»Ÿï¼Œå¯ä»¥æ˜¾å¼æ³¨è§£ç±»å‹ï¼Œä¹Ÿå¯ä»¥è‡ªåŠ¨æ¨å¯¼å¤šæ•°ç±»å‹ã€‚
æ˜¾ç¤ºå£°æ˜ç±»å‹éœ€è¦ä½¿ç”¨æ³¨è§£ã€‚æ³¨è§£çš„å½¢å¼ value: typeï¼Œå°±åƒæ˜¯å‘Šè¯‰ç±»å‹æ£€æŸ¥å™¨ï¼Œâ€œå˜¿ï¼Œçœ‹åˆ°è¿™ä¸ª value äº†å—ï¼Ÿå®ƒçš„ç±»å‹æ˜¯ typeã€‚â€
1// æ˜¾ç¤ºæ³¨è§£ 2let a: number = 1 3let b: string = &#39;hello&#39; 4let c: boolean[] = [true, false] 5 6// è‡ªåŠ¨æ¨å¯¼ 7let a = 1; 8let b = &#39;hello&#39; 9let c = [true, false] TypeScript VS JavaScript ç±»å‹ç³»ç»Ÿç‰¹æ€§JavaScriptTypeScriptç±»å‹æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼ŸåŠ¨æ€é™æ€æ˜¯å¦è‡ªåŠ¨è½¬æ¢ç±»å‹ï¼Ÿæ˜¯å¦ï¼ˆå¤šæ•°æ—¶å€™ï¼‰ä½•æ—¶æ£€æŸ¥ç±»å‹ï¼Ÿè¿è¡Œæ—¶ç¼–è¯‘æ—¶ä½•æ—¶æŠ¥å‘Šé”™è¯¯ï¼Ÿè¿è¡Œæ—¶ï¼ˆå¤šæ•°æ—¶å€™ï¼‰ç¼–è¯‘æ—¶ï¼ˆå¤šæ•°æ—¶å€™ï¼‰ TypeScript èƒ½åšçš„æ˜¯æŠŠçº¯ JavaScript ä»£ç ä¸­é‚£äº›è¿è¡Œæ—¶æ„ˆå‘å’Œç±»å‹ç›¸å…³çš„é”™è¯¯æå‰åˆ°ç¼–è¯‘æ—¶æŠ¥å‘Šã€‚åœ¨ä»£ç ç¼–è¾‘å™¨ä¸­æ˜¾ç¤ºï¼Œè¾“å…¥ä»£ç åç«‹å³å°±æœ‰åé¦ˆã€‚
ç±»å‹æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ JavaScript åŠ¨æ€ç»‘å®šç±»å‹ï¼Œå¿…é¡»è¿è¡Œç¨‹åºæ‰èƒ½çŸ¥é“ç±»å‹ã€‚ TypeScript æ¸è¿›å¼ç±»å‹è¯­è¨€ï¼Œåœ¨ç¼–è¯‘æ—¶çŸ¥é“æ‰€æœ‰ç±»å‹
ç±»å‹ï¼šä¸€ç³»åˆ—å€¼åŠå¯¹å…¶æ‰§è¡Œçš„æ“ä½œ
example
ç±»å‹åŒ…å«çš„å€¼å¯ä»¥æ‰§è¡Œçš„æ“ä½œbooleantrueã€false||ã€&&ã€!numberæ‰€æœ‰æ•°å­—+ã€-ã€*ã€/ã€%ã€&&ã€? .toFixed()ã€.toString()stringæ‰€æœ‰å­—ç¬¦ä¸²+ã€||ã€&& .concat()ã€.toUpperCase() å¯¹ T ç±»å‹çš„å€¼æ¥è¯´ï¼Œæˆ‘ä»¬ä¸ä»…çŸ¥é“å€¼çš„ç±»å‹æ˜¯ Tï¼Œè¿˜çŸ¥é“å¯ä»¥ / ä¸å¯ä»¥å¯¹è¯¥å€¼åšä»€ä¹ˆæ“ä½œã€‚ ç±»å‹æ£€æŸ¥å™¨é€šè¿‡ä½¿ç”¨çš„ç±»å‹å’Œå…·ä½“ç”¨æ³•åˆ¤æ–­æ˜¯å¦æœ‰æ•ˆã€‚
TypeScript çš„ç±»å‹å±‚æ¬¡ç»“æ„ ç±»å‹æœ¯è¯­ ç±»å‹æ³¨è§£ï¼ˆå¯ä»¥ç†è§£ä¸ºæŸç§ç•Œé™
1function squareOf(n: number) { 2 return n * n; 3} 4squareOf(2); // 4 ç±»å‹æµ…è°ˆ any åœ¨ TypeScript ä¸­ï¼Œç¼–è¯‘æ—¶ä¸€åˆ‡éƒ½è¦æœ‰ç±»å‹ï¼Œå¦‚æœä½ å’Œ TypeScriptï¼ˆç±»å‹æ£€æŸ¥å™¨ï¼‰æ— æ³•ç¡®è®¤ç±»å‹æ˜¯ä»€ä¹ˆï¼Œé»˜è®¤ä¸º anyã€‚è¿™æ˜¯å…œåº•ç±»å‹ï¼Œåº”è¯¥å°½é‡é¿å…ä½¿ç”¨ã€‚
ç±»å‹çš„å®šä¹‰ï¼ˆä¸€ç³»åˆ—å€¼åŠå¯ä»¥å¯¹å…¶æ‰§è¡Œçš„æ“ä½œï¼‰any åŒ…å«æ‰€æœ‰å€¼ï¼Œè€Œä¸”å¯ä»¥å¯¹å…¶åšä»€ä¹ˆæ“ä½œã€‚any ç±»å‹çš„å€¼å°±åƒå¸¸è§„çš„ JavaScript ä¸€æ ·ï¼Œç±»å‹æ£€æŸ¥å™¨å®Œå…¨å‘æŒ¥ä¸äº†ä½œç”¨ã€‚
ä½¿ç”¨ any éœ€è¦æ˜¾ç¤ºæ³¨è§£ã€‚
tsconfig.json noImplicitAny: true;
noImplicitAny éš¶å±äº TSC çš„ strict æ ‡å¿—å®¶æ—ï¼Œ
unknown unknown ä¸ any ç±»ä¼¼ï¼Œä¹Ÿè¡¨ç¤ºä»»ä½•å€¼ã€‚ä½†æ˜¯ TypeScript ä¼šè¦æ±‚ä½ åœ¨åšæ£€æŸ¥ï¼Œç»†åŒ–ç±»å‹ã€‚
ç±»å‹åŒ…å«çš„å€¼å¯ä»¥æ‰§è¡Œçš„æ“ä½œunknown==ã€===ã€||ã€&amp;&amp;ã€?ã€!ã€typeofã€instance of 1// example 2let a: unknown = 30; // unknown 3let b = a === 123; // boolean 4let c = a + 10; // Error TS 2571: Object is of type &#39;unknown&#39; 5if (typeof a === &#39;number&#39;) { 6 let d = a + 10; // number 7} unknown çš„ç”¨æ³•
TypeScript ä¸ä¼šæŠŠä»»ä½•å€¼æ¨å¯¼ä¸º unknown ç±»å‹ï¼Œå¿…é¡»æ˜¾ç¤ºæ³¨è§£ï¼ˆaï¼‰ unknown ç±»å‹çš„å€¼å¯ä»¥æ¯”è¾ƒï¼ˆbï¼‰ æ‰§è¡Œæ“ä½œæ—¶ä¸èƒ½å‡å®š unknown ç±»å‹çš„å€¼ä¸ºæŸç§ç‰¹å®šç±»å‹ï¼ˆcï¼‰ï¼Œå¿…é¡»å…ˆå‘ TypeScript è¯æ˜ä¸€ä¸ªå€¼ç¡®å®æ˜¯æŸä¸ªç±»å‹ï¼ˆdï¼‰ boolean ç±»å‹åŒ…å«çš„å€¼å¯ä»¥æ‰§è¡Œçš„æ“ä½œbooleantrueã€false==ã€===ã€||ã€&amp;&amp;ã€? 1// example 2let a = true // boolean 3let b = false // boolean 4const c = true // true 5let d: boolean = true // boolean 6let e: true = true // true 7let f: true = false // Error TS2322: Type &#39;false&#39; is not assignable to type &#39;true&#39;. TypeScript æ¨å¯¼å‡ºå€¼çš„ç±»å‹ä¸º booleanï¼ˆa å’Œ bï¼‰ ä½¿ç”¨ constï¼Œè®© TypeScript æ¨å¯¼å‡ºå€¼ä¸ºæŸä¸ªå…·ä½“çš„å¸ƒå°”å€¼ï¼ˆcï¼‰ æ˜¾å¼æ³¨è§£ï¼Œå£°æ˜å€¼çš„ç±»å‹ä¸º booleanï¼ˆdï¼‰ æ˜¾å¼æ³¨è§£ï¼Œå£°æ˜å€¼ä¸ºæŸä¸ªå…·ä½“çš„å¸ƒå°”å€¼ï¼ˆe å’Œ fï¼‰ã€‚æŠŠç±»å‹è®¾å®šä¸ºæŸä¸ªå€¼ï¼Œå°±é™åˆ¶äº† e å’Œ f åœ¨æ‰€æœ‰å¸ƒå°”å€¼ä¸­åªèƒ½å–æŒ‡å®šçš„é‚£ä¸ªå€¼ã€‚è¿™ç§ç‰¹æ€§è¢«ç§°ä¸ºç±»å‹å­—é¢é‡ã€‚ ç±»å‹å­—é¢é‡â€”â€”ä»…è¡¨ç¤ºä¸€ä¸ªå€¼çš„ç±»å‹
å˜é‡ e f æ˜¯ä½¿ç”¨ç±»å‹å­—é¢é‡æ˜¾ç¤ºæ³¨è§£äº†å˜é‡ï¼Œå˜é‡ c åˆ™æ˜¯ç”± TypeScript æ¨å¯¼å‡ºä¸€ä¸ªå­—é¢é‡ç±»å‹ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯ constã€‚ const å£°æ˜çš„åŸºæœ¬ç±»å‹çš„å€¼ï¼Œèµ‹å€¼ä¹‹åæ— æ³•ä¿®æ”¹ï¼Œå› æ­¤ TypeScript æ¨å¯¼å‡ºçš„æ˜¯èŒƒå›´æœ€çª„çš„ç±»å‹ï¼Œæ‰€ä»¥ TypeScript æ¨å¯¼å‡ºçš„ c çš„ç±»å‹ä¸º trueï¼Œè€Œä¸æ˜¯ booleanã€‚
number ç±»å‹åŒ…å«çš„å€¼å¯ä»¥æ‰§è¡Œçš„æ“ä½œnumberæ•´æ•°ã€æµ®ç‚¹æ•°ã€æ­£æ•°ã€è´Ÿæ•°ã€Infinityã€NaN ç­‰ç®—æœ¯è¿ç®— æ¯”è¾ƒ 1// example 2let a = 1234 // number 3let b = Infinity * 0.1 // number 4const c = 5678 // 5678 5let d = a &lt; b // boolean 6let e: number = 100 // number 7let f: 26.218 = 26.218 // 26.218 8let g: 26.218 = 10 // Error TS2322: Type &#39;10&#39; is not assignable to type &#39;26.218&#39; TypeScript æ¨å¯¼å‡ºå€¼çš„ç±»å‹ä¸º numberï¼ˆa å’Œ bï¼‰ ä½¿ç”¨ constï¼Œè®© TypeScript æ¨å¯¼å‡ºå€¼ä¸ºæŸä¸ªå…·ä½“çš„æ•°å­—ï¼ˆcï¼‰ æ˜¾å¼æ³¨è§£ï¼Œå£°æ˜å€¼çš„ç±»å‹ä¸º numberï¼ˆeï¼‰ æ˜¾å¼æ³¨è§£ï¼Œå£°æ˜å€¼ä¸ºæŸä¸ªå…·ä½“çš„æ•°å­—ï¼ˆf å’Œ gï¼‰ tipsï¼šå¤„ç†è¾ƒé•¿çš„æ•°å­—æ—¶å¯ä»¥ä½¿ç”¨æ•°å­—åˆ†éš”ç¬¦ã€‚
1let oneMillion = 1_000_ 000 // ç­‰åŒäº 1000000 2let twoMillion: 2_000_000 = 2_000_000 bigint æ˜¯ JavaScript å’Œ TypeScript æ–°å¼•å…¥çš„ç±»å‹ï¼Œåœ¨å¤„ç†è¾ƒå¤§çš„æ•´æ•°æ—¶ï¼Œä¸ç”¨å†æ‹…å¿ƒèˆå…¥è¯¯å·®ã€‚
number ç±»å‹è¡¨ç¤ºçš„æ•´æ•°æœ€å¤§ä¸º 253ï¼Œbigint å¯ä»¥è¡¨ç¤ºä»»æ„å¤§çš„æ•´æ•°ã€‚
ç±»å‹åŒ…å«çš„å€¼å¯ä»¥æ‰§è¡Œçš„æ“ä½œbigintæ‰€æœ‰ BigInt æ•°ç®—æœ¯è¿ç®— æ¯”è¾ƒ 1// example 2let a = 1234n // bigint 3const b = 5678n // 5678n 4let c = a + b // bigint 5let d = a &lt; 1235 // boolean 6let e = 88.5n // Error TS1353: A bigint literal must be an integer. 7let f: bigint = 100n // bigint 8let g: 100n = 100n // 100n 9let h: bigint = 100 // Error TS2322: Type &#39;100&#39; is not assignable ty type &#39;bigint&#39;. ä¸ boolean å’Œ number ä¸€æ ·ï¼Œå£°æ˜ bigint ç±»å‹ä¹Ÿæœ‰å››ç§æ–¹å¼ã€‚å°½é‡è®© TypeScript è‡ªåŠ¨æ¨å¯¼ã€‚
string ç±»å‹åŒ…å«çš„å€¼å¯ä»¥æ‰§è¡Œçš„æ“ä½œstringæ‰€æœ‰å­—ç¬¦ä¸²å­—ç¬¦ä¸²å¯ä»¥è¿›è¡Œçš„æ“ä½œ ä¾‹å¦‚ +ã€.slice() 1// example 2let a = &#39;hello&#39; // string 3let b = &#39;billy&#39; // string 4const c = &#39;!&#39; // ! 5let d = a + &#39; &#39; + b + c // string 6let e: string = &#39;zoom&#39; // string 7let f: &#39;john&#39; = &#39;john&#39; // john 8let g: &#39;john&#39; = &#39;zoe&#39; // Error TS2322: Type &#39;zoe&#39; is not assignable to type &#39;john&#39; åŒæ ·ä¹Ÿæ˜¯å°½é‡è®© TypeScript è‡ªåŠ¨æ¨å¯¼ string ç±»å‹ã€‚
symbol symbol ç»å¸¸ç”¨äºä»£æ›¿å¯¹è±¡å’Œæ˜ å°„çš„å­—ç¬¦ä¸²å¥ï¼Œé˜²æ­¢è¢«æ„å¤–è®¾ç½®ã€‚ symbol çš„ç±»å‹å°±æ˜¯ symbolï¼Œæ¯ä¸€ä¸ª symbol éƒ½æ˜¯å”¯ä¸€çš„ï¼Œä¸ä¸å…¶ä»–ä»»ä½•ç¬¦å·ç›¸ç­‰ï¼Œå³ä¾¿å†ä½¿ç”¨ç›¸åŒçš„åç§°åˆ›å»ºä¸€ä¸ª symbol ä¹Ÿæ˜¯å¦‚æ­¤ã€‚
1// example 2let a = Symbol(&#39;a&#39;) // symbol 3let b: symbol = Symbol(&#39;b&#39;) // symbol 4let c = a === b // boolean 5let d = a + &#39;x&#39; // Error TS2469: The &#39;+&#39; operator cannot be applied to type &#39;symbol&#39;. 1// example 2const e = Symbol(&#39;e&#39;) // unique symbol 3const f: unique symbol = Symbol(&#39;f&#39;) // unique symbol 4let g: unique symbol = Symbol(&#39;f&#39;) // Error TS1332: A variable whose type is a &#39;unique symbol&#39; type must be &#39;const&#39;. 5let h = e === e // boolean 6let i = e === f // Error TS2367: This condition will always return &#39;false&#39; since the type &#39;unique symbol&#39; and &#39;unique symbol&#39; have no overlap. åˆ›å»º symbol çš„æ–¹å¼
ä½¿ç”¨ constï¼ŒTypeScript ä¼šæ¨å¯¼ä¸º unique symbol ç±»å‹ã€‚ æ˜¾å¼æ³¨è§£ const å˜é‡çš„ç±»å‹ä¸º unique symbol unique symbol ç±»å‹çš„å€¼å§‹ç»ˆä¸è‡ªèº«ç›¸ç­‰ TypeScript åœ¨ç¼–è¯‘æ—¶çŸ¥é“ä¸€ä¸ª unique symbol ç»å¯¹ä¸ä¼šä¸å¦ä¸€ä¸ª unique symbol ç›¸ç­‰ unique symbol ä¸å…¶ä»–å­—é¢é‡ç±»å‹å…¶å®æ˜¯ä¸€æ ·çš„ã€‚
å¯¹è±¡ TypeScript çš„å¯¹è±¡ç±»å‹è¡¨ç¤ºå¯¹è±¡çš„ç»“æ„ã€‚
ç»“æ„åŒ–ç±»å‹â€“ä¸€ç§ç¼–ç¨‹è®¾è®¡é£æ ¼ï¼Œåªå…³å¿ƒå¯¹è±¡æœ‰å“ªäº›å±æ€§ï¼Œè€Œä¸ç®¡å±æ€§ä½¿ç”¨ä»€ä¹ˆåç§°ï¼ˆåä¹‰åŒ–ç±»å‹ï¼‰ã€‚åœ¨æŸäº›è¯­è¨€ä¸­ä¹Ÿå«é¸­å­ç±»å‹ï¼ˆå³ä¸ä»¥è²Œå–äººï¼‰
1// example 2let b: object = { 3 b: &#39;x&#39; 4} 5a.b // Error TS2339: Property &#39;b&#39; does not exist on type &#39;object&#39;. object åªèƒ½è¡¨ç¤ºè¯¥å€¼æ˜¯ä¸€ä¸ª JavaScript å¯¹è±¡ï¼ˆè€Œä¸”ä¸æ˜¯ nullï¼‰
1// å¯¹è±¡å­—é¢é‡ 2 3// è‡ªåŠ¨æ¨å¯¼ 4let a = { 5 b: &#39;x&#39; 6} 7 8// or 9let a: { b: string } = { 10 b: &#39;x&#39; 11} å¯¹è±¡å­—é¢é‡å¥æ³•çš„æ„æ€æ˜¯ï¼Œâ€œè¿™ä¸ªä¸œè¥¿çš„ç»“æ„æ˜¯è¿™æ ·è¿‡çš„ã€‚â€
ä½¿ç”¨ const å£°æ˜å¯¹è±¡ä¸ä¼šå¯¼è‡´ TypeScript æŠŠæ¨å¯¼çš„ç±»å‹ç¼©çª„ã€‚ä¸ä¸Šé¢çš„åŸºæœ¬ç±»å‹ä¸åŒã€‚è¿™æ˜¯å› ä¸º JavaScript å¯¹è±¡æ˜¯å¯å˜çš„ï¼Œæ‰€ä»¥åœ¨ TypeScript çœ‹æ¥ï¼Œåˆ›å»ºå¯¹è±¡ä¹‹åä½ å¯èƒ½ä¼šæ›´æ–°å¯¹è±¡çš„å­—æ®µã€‚
1let a: { b: number } 2b = {} // Error TS2741: Property &#39;b&#39; is missing in type &#39;{}&#39; but required in type &#39;{b: number}&#39;. 3 4b = { 5 a: 1, 6 b: 2 7} // Error TS2322: Type &#39;{b: number; c: number}&#39; is not assignable to type &#39;{b: number}&#39;. Object literal may only specify known properties, and &#39;c&#39; does not exist in type &#39;{b: number}&#39;. é»˜è®¤æƒ…å†µä¸‹ï¼ŒTypeScript å¯¹å¯¹è±¡çš„å±æ€§è¦æ±‚ååˆ†ä¸¥æ ¼ã€‚å¦‚æœå£°æ˜å¯¹è±¡æœ‰ä¸ªç±»å‹ä¸º number çš„å±æ€§ bï¼ŒTypeScript å°†é¢„æœŸå¯¹è±¡æœ‰ä¸”åªæœ‰è¿™ä¸ªå±æ€§ã€‚ç¼ºå°‘æˆ–è€…å¤šäº†ï¼ŒTypeScript éƒ½ä¼šæŠ¥é”™ã€‚
1let a: { 2 b: number 3 c?: string // å¯èƒ½æœ‰ä¸ªç±»å‹ä¸º string çš„å±æ€§ cã€‚å…¶å€¼å¯ä»¥ä¸º undefined 4 readonly firstName: string // ä¸ºå­—æ®µèµ‹åˆå§‹å€¼åæ— æ³•ä¿®æ”¹ã€‚ç±»ä¼¼äºä½¿ç”¨ const å£°æ˜å¯¹è±¡çš„å±æ€§ 5 [key: number]: boolean // å¯èƒ½æœ‰ä»»æ„å¤šä¸ªæ•°å­—å±æ€§ï¼Œå…¶å€¼ä¸ºå¸ƒå°”å€¼ 6} [key: T]: U å¥æ³•ç§°ä¸ºç´¢å¼•ç­¾åï¼Œé€šè¿‡è¿™ç§æ–¹å¼å‘Šè¯‰ TypeScriptï¼ŒæŒ‡å®šçš„å¯¹è±¡å¯èƒ½æœ‰æ›´å¤šçš„ keyã€‚è¿™ç§å¥æ³•çš„æ„æ€æ˜¯ï¼Œâ€œåœ¨è¿™ä¸ªå¯¹è±¡ä¸­ï¼Œç±»å‹ä¸º T çš„å¥å¯¹åº”çš„å€¼ä¸º U ç±»å‹ã€‚â€
ç´¢å¼•ç­¾å key çš„ç±»å‹ T å¿…é¡»å¯èµ‹å€¼ç»™ number æˆ– stringã€‚ï¼ˆJavaScript å¯¹è±¡çš„å¥ä¸ºå­—ç¬¦ä¸²ï¼›æ•°ç»„æ˜¯ç‰¹æ®Šçš„å¯¹è±¡ï¼Œå¥ä¸ºæ•°å­—ã€‚ï¼‰ key çš„åç§°å¯ä»¥æ˜¯ä»»æ„è¯ï¼Œä¸ä¸€å®šéçš„ç”¨ key å¯¹è±¡å­—é¢é‡è¡¨ç¤ºæ³•æœ‰ä¸€ä¸ªç‰¹ä¾‹ï¼šç©ºå¯¹è±¡ç±»å‹ {}ã€‚é™¤ null å’Œ undefined ä¹‹å¤–çš„ä»»ä½•ç±»å‹éƒ½å¯ä»¥èµ‹å€¼ç»™ç©ºå¯¹è±¡ç±»å‹ï¼Œåº”è¯¥å°½é‡é¿å…ä½¿ç”¨ã€‚
åœ¨ TypeScript ä¸­å£°æ˜å¯¹è±¡ç±»å‹æœ‰å››ç§æ–¹å¼
å¯¹è±¡å­—é¢é‡è¡¨ç¤ºæ³• {a: string}ï¼Œä¹Ÿç§°å¯¹è±¡ç»“æ„ ç©ºå¯¹è±¡å­—é¢é‡è¡¨ç¤ºæ³• {}ã€‚é¿å…ä½¿ç”¨ object ç±»å‹ã€‚å¦‚æœéœ€è¦ä¸ªå¯¹è±¡ï¼Œå½“å¯¹è¿™ä¸ªå¯¹è±¡çš„å­—æ®µæ²¡æœ‰è¦æ±‚ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼ã€‚ Objectã€‚é¿å…ä½¿ç”¨ å¯¹ä¸€ä¸ªå€¼ï¼Œåœ¨ç±»å‹å…è®¸çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å¯¹å…¶æ‰§è¡Œç‰¹å®šçš„æ“ä½œã€‚å…¶å®åœ¨ç±»å‹è‡ªèº«ä¸Šä¹Ÿå¯ä»¥æ‰§è¡Œä¸€äº›æ“ä½œã€‚
ç±»å‹åˆ«å
1type Age = number 2 3type Person = { 4 name: string 5 age: Age 6} 7 8let driver: Person = { 9 name: &#39;Jack&#39; 10 age: 18 11} ç±»å‹åˆ«åé‡‡ç”¨å—çº§ä½œç”¨åŸŸã€‚åœ¨åŒä¸€ä½œç”¨äºä¸­ä¸èƒ½é‡å¤å£°æ˜ç›¸åŒç±»å‹ã€‚
å¹¶é›†å’Œäº¤é›†
1type Cat = { name: string, purrs: boolean } 2type Dog ={ name: string, barks: boolean, wags: boolean } 3 4type CatOrDogOrBoth = Cat | Dog // å¹¶é›† 5type CatAndDog = Cat &amp; Dog // äº¤é›† 6 7// CatOrDogOrBoth å¯ä»¥æ˜¯ Cat ç±»å‹çš„å€¼ï¼Œå¯ä»¥æ˜¯ Dog ç±»å‹çš„å€¼ï¼Œè¿˜å¯ä»¥äºŒè€…å…¼å…·ã€‚ 8// Cat 9let a: CatOrDogOrBoth = { 10 name: &#39;Bonkers&#39;, 11 purrs: true 12} 13 14// Dog 15a = { 16 name: &#39;Domino&#39;, 17 barks: true, 18 wags: true 19} 20 21// äºŒè€…å…¼å…· 22a = { 23 name: &#39;Donkers&#39;, 24 barsk: true, 25 purrs: true, 26 wags: true 27} 28 29// CatAndDot 30let b: CatAndDog = { 31 name: &#39;Domino&#39;, 32 barks: true, 33 purrs: true, 34 wags: true 35} å¹¶é›†é€šå¸¸æ›´å¸¸ç”¨
å‡½æ•°è¿”å›å€¼å¯èƒ½æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯èƒ½æ˜¯ nullã€‚string | null æ··åˆç±»å‹çš„æ•°ç»„ æ•°ç»„
1let a = [1, 2, 3] // number[] 2let b = [&#39;a&#39;, &#39;b&#39;] // string[] 3let c: string[] = [&#39;a&#39;] // string[] 4let d = [1, &#39;a&#39;] // (number | string)[] 5const e = [2, &#39;b&#39;] // (number | string)[] 6let f = [&#39;red&#39;] // string[] 7 8f.push(&#39;blue&#39;) 9f.push(true) // Error TS2345: Argument of type &#39;true&#39; is not assignable to parameter of type &#39;string&#39;. 10 11let g = [] // any[] 12g.push(1) // number[] 13g.push(&#39;red&#39;) // (number | string)[] 14 15let h: number[] = [] // number[] 16h.push(1) // number[] 17h.push(&#39;red&#39;) // Error TS2345: Argument of type &#39;&#34;red&#34;&#39; is not assignable to parameter of type &#39;number&#39;. TypeScript æ”¯æŒä¸¤ç§æ³¨è§£æ•°ç»„ç±»å‹çš„å¥æ³•
T[] Array ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ•°ç»„åº”è¯¥ä¿æŒåŒè´¨ã€‚
å…ƒç¥–
array çš„å­ç±»å‹ï¼Œé•¿åº¦å›ºå®šï¼Œå„ç´¢å¼•ä½ä¸Šçš„å€¼å…·æœ‰å›ºå®šçš„å·²çŸ¥ç±»å‹ã€‚
å£°æ˜å…ƒç»„æ—¶å¿…é¡»æ˜¾å¼æ³¨è§£ç±»å‹ã€‚
1let a: [number] = 1 2let b: [string, string, number] = [&#39;jack&#39;, &#39;boy&#39;, 1963] 3b = [&#39;tom&#39;, &#39;boy&#39;, &#39;li&#39;, 1926] // Error TS2322: Type &#39;string&#39; is not assignable to type &#39;number&#39;. å…ƒç»„ä¹Ÿæ”¯æŒå¯é€‰å…ƒç´ 
1let trainFares: [number, number?][] = [ 2 [3.75], 3 [8.25, 7.70], 4 [10.60], 5] 6 7// ç­‰ä»·äº 8let moreTrainFares: ([number, number] | [number])[] = [ 9 // ... 10] å…ƒç»„ä¹Ÿæ”¯æŒå‰©ä½™å…ƒç´ ï¼Œå³ä¸ºå…ƒç»„å®šä¹‰æœ€å°é•¿åº¦
1// å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´  2let friends: [string, ...string[]] = [&#39;Sara&#39;, &#39;Tali&#39;, &#39;Chloe&#39;, &#39;Claire&#39;] 3 4// å…ƒç´ ç±»å‹ä¸åŒçš„åˆ—è¡¨ 5let list: [number, boolean, ...string[]] = [1, false, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;] åªè¯»æ•°ç»„å’Œå…ƒç¥–
1let as: readonly number[] = [1, 2, 3] // readonly number[] 2let bs: readonly number[] = as.concat(4) // readonly number[] 3let three = bs[2] // number 4as[4] = 5 // Error TS2542: Index signature in type &#39;readonly number[]&#39; only permits reading. 5as.push(6) // Error TS2339: Property &#39;push&#39; does not exist on type &#39;readonly number[]&#39;. 6 7// Readonly å’Œ ReadonlyArray å¥æ³• 8type A = readonly string[] // readonly string[] 9type B = ReadonlyArray&lt;string&gt; // readonly string[] 10type C = Readonly&lt;string[]&gt; // readonly string[] 11 12type D = readonly [number, string] // readonly [number, string] 13type E = Readonly&lt;[number, string]&gt; // readonly [number, string] nullã€undefinedã€void å’Œ never | ç±»å‹ | å«ä¹‰ | | â€” | â€” | | null | ç¼ºå°‘å€¼ | | undefined | å°šæœªèµ‹å€¼çš„å˜é‡ | | void | æ²¡æœ‰ return è¯­å¥çš„å‡½æ•° | | never | æ°¸ä¸è¿”å›çš„å‡½æ•° |
1// è¿”å› never çš„å‡½æ•° 2function d() { 3 throw TypeError(&#39;I always error&#39;) 4} 5 6function e() { 7 while (true) { 8 doSomething() 9 } 10} never æ˜¯æ‰€æœ‰ç±»å‹çš„å­ç±»å‹ï¼Œå¯ä»¥èµ‹å€¼ç»™å…¶ä»–ä»»ä½•ç±»å‹ã€‚
æšä¸¾
æšä¸¾çš„ä½œç”¨æ˜¯åˆ—ä¸¾ç±»å‹ä¸­åŒ…å«çš„å„ä¸ªå€¼ã€‚æ˜¯ä¸€ç§æ— åºæ•°æ®ç»“æ„ï¼ŒæŠŠé”®æ˜ å°„åˆ°å€¼ä¸Šã€‚
æšä¸¾å¯ä»¥ç†è§£ä¸ºç¼–è¯‘æ—¶é”®å›ºå®šçš„å¯¹è±¡ï¼Œè®¿é—®é”®æ—¶ï¼ŒTypeScript å°†æ£€æŸ¥æŒ‡å®šçš„é”®æ˜¯å¦å­˜åœ¨ã€‚
æšä¸¾åˆ†ä¸ºä¸¤ç§
å­—ç¬¦ä¸²åˆ°å­—ç¬¦ä¸²ä¹‹é—´çš„æ˜ å°„ å­—ç¬¦ä¸²åˆ°æ•°å­—ä¹‹é—´çš„æ˜ å°„ 1enum Language { 2 English, 3 Spaish, 4 Russian 5} æŒ‰çº¦å®šï¼Œæšä¸¾åç§°ä¸ºå¤§å†™å•æ•°å½¢å¼ã€‚æšä¸¾ä¸­çš„é”®ä¹Ÿå¤§å†™ã€‚
TypeScript å¯ä»¥è‡ªåŠ¨ä¸ºæšä¸¾ä¸­çš„å„ä¸ªæˆå‘˜æ¨å¯¼å¯¹åº”çš„æ•°å­—ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨è®¾ç½®ã€‚
1enum Language { 2 English = 0, 3 Spanish = 1, 4 Russian = 2 5} æšä¸¾ä¸­çš„å€¼è®¿é—®æ–¹å¼å’Œå¯¹è±¡ä¸€æ ·
1let myFirstLanguage = Language.Russian 2let mySecondLanguage = Language[&#39;English&#39;] ä¸€ä¸ªæšä¸¾å¯ä»¥åˆ†æˆå‡ æ¬¡å£°æ˜ï¼ŒTypeScript å°†è‡ªåŠ¨æŠŠå„éƒ¨åˆ†åˆå¹¶åœ¨ä¸€èµ·
1enum Language { 2 English = 0, 3 Spanish = 1, 4} 5 6enum Language { 7 Russian = 2 8} meiju
å°ç»“ ç±»å‹å­ç±»å‹booleanBoolean å­—é¢é‡bigintBigInt å­—é¢é‡numberNumber å­—é¢é‡stringString å­—é¢é‡symbolunique symbolobjectObject å­—é¢é‡æ•°ç»„å…ƒç»„enumconst enum å£°æ˜å’Œè°ƒç”¨å‡½æ•° åœ¨ JavaScript ä¸­ï¼Œå‡½æ•°æ˜¯ä¸€ç­‰å¯¹è±¡ã€‚è¿™æ„å‘³ç€ï¼Œå¯ä»¥å‘å¯¹è±¡é‚£æ ·ä½¿ç”¨å‡½æ•°
å¯ä»¥èµ‹å€¼ç»™å˜é‡ å¯ä»¥ä½œä¸ºå‚æ•°ä¼ ç»™å…¶ä»–å‡½æ•° å¯ä»¥ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼ å¯ä»¥èµ‹å€¼ç»™å¯¹è±¡å’ŒåŸå‹ å¯ä»¥èµ‹äºˆå±æ€§ å¯ä»¥è¯»å–å±æ€§ TypeScript é€šå¸¸ä¼šæ˜¾ç¤ºæ³¨è§£å‡½æ•°çš„å‚æ•°
1function add(a: number, b: number) { 2 return a + b 3} è¿”å›ç±»å‹èƒ½æ¨å¯¼å‡ºæ¥ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥æ˜¾ç¤ºæ³¨è§£
1function add(a: number, b: number): number { 2 return a + b 3} TypeScript ä¸­å£°æ˜å‡½æ•°
1// å…·åå‡½æ•° 2function greet(name: string) { 3 return &#39;hello &#39; + name 4} 5 6// å‡½æ•°è¡¨è¾¾å¼ 7let greet2 = function(name: string) { 8 retunr &#39;hello &#39; + name 9} 10 11// ç®­å¤´å‡½æ•°è¡¨è¾¾å¼ 12let greet3 = (name: string) =&gt; { 13 return &#39;hello &#39; + name 14} 15 16// ç®­å¤´å‡½æ•°è¡¨è¾¾å¼ç®€å†™ 17let greet4 = (name: string) =&gt; &#39;hello &#39; + name 18 19// å‡½æ•°æ„é€ æ–¹æ³• 20let greet5 = new Function(&#39;name&#39;, &#39;return &#34;hello &#34; + name&#39;) é™¤äº†å‡½æ•°æ„é€ æ–¹æ³•ï¼Œå…¶ä»–å‡ ç§å¥æ³•åœ¨ TypeScript ä¸­éƒ½å¯ä»¥æ”¾å¿ƒä½¿ç”¨ï¼Œèƒ½å¤Ÿä¿è¯ç±»å‹å®‰å…¨ã€‚é€šå¸¸éœ€è¦æ³¨è§£å‚æ•°çš„ç±»å‹ï¼Œè€Œè¿”å›ç±»å‹ä¸è¦æ±‚å¿…é¡»æ³¨è§£ã€‚ åœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼ŒTypeScript å°†æ£€æŸ¥ä¼ å…¥çš„å®å‚æ˜¯å¦äºå‡½æ•°å½¢å‚ç±»å‹å…¼å®¹ã€‚
å¯é€‰å‚æ•°å’Œé»˜è®¤å‚æ•° å¯é€‰å‚æ•°å¿…é¡»åœ¨æœ«å°¾
1function log(message: string, userId?: string) { 2 let time = new Date().toLocaleTimeString() 3 console.log(time, message, userId || &#39;Not signed in&#39;) 4} 5 6log(&#39;Page loded&#39;) 7log(&#39;User signed in&#39;, &#39;da763be&#39;) 8 9// é»˜è®¤å€¼å‚æ•°ï¼ˆç±»ä¼¼å¯é€‰å‚æ•°åŠŸèƒ½ 10function log(message: string, userId = &#39;Not signed in&#39;) { // userId ä¼šè‡ªåŠ¨æ¨å¯¼ç±»å‹ 11 let time = new Date().toLocaleTimeString() 12 console.log(time, message, userId) 13} 14 15// æ˜¾å¼æ³¨è§£é»˜è®¤å‚æ•°ç±»å‹ 16type Context = { 17 appId?: string 18 userId?: string 19} 20 21function log(message: string, context: Context = {}) { 22 let time = new Date().toLocaleTimeString() 23 console.log(time, message, context.userId) 24} é»˜è®¤å‚æ•°æ›´å¸¸ç”¨ï¼Œé»˜è®¤å‚æ•°å¯ä»¥è‡ªåŠ¨ç±»å‹æ¨å¯¼ã€‚
å¤šæ€ ä¸Šé¢éƒ½æ˜¯è®²çš„å…·ä½“ç±»å‹çš„ç”¨æ³•å’Œç”¨é€”
boolean string Date[] {a: number} | {b: string} (numbers: number[]) =&gt; number ä½¿ç”¨å…·ä½“ç±»å‹çš„å‰ææ˜¯ç±»å‹å·²çŸ¥
å¦‚æœäº‹å…ˆä¸çŸ¥é“éœ€è¦ä»€ä¹ˆç±»å‹ ä¸æƒ³é™åˆ¶å‡½æ•°åªèƒ½æ¥å—æŸä¸ªç±»å‹
1// example 2function filter(array, f) { 3 let result = [] 4 for (let i = 0; i &lt; array.length; i++) { 5 let item = array[i] 6 if (f(item)) { 7 result.push(item) 8 } 9 } 10 return result 11} 12 13filtre([1, 2, 3, 4], (item) =&gt; item &lt; 3) // [1, 2] ä¾‹å­ä¸­ï¼Œæ•°ç»„å…ƒç´ çš„ç±»å‹å¯ä»¥ä¸º numberï¼Œä¸è¿‡ filter å‡½æ•°çš„ä½œç”¨åº”è¯¥æ›´ä¸€èˆ¬ï¼Œå¯ä»¥ç­›é€‰æ•°å­—æ•°ç»„ã€å­—ç¬¦ä¸²æ•°å­—ã€å¯¹è±¡æ•°ç»„ç­‰ã€‚ ä¸‹é¢é€šè¿‡é‡è½½æè¿°ä¸‹å‡½æ•°ç­¾å
1type Filter = { 2 (array: number[], f: (item: number) =&gt; boolean): number[] 3 (array: string[], f: (item: string) =&gt; boolean): string[] 4} 5 6// åŠ ä¸Šå¯¹è±¡ç±»å‹ 7type Filter = { 8 (array: number[], f: (item: number) =&gt; boolean): number[] 9 (array: object[], f: (item: object) =&gt; boolean): object[] 10} object æ— æ³•æè¿°å¯¹è±¡çš„ç»“æ„ï¼Œè®¿é—®æ•°ç»„ä¸­å…ƒç´ å±æ€§å°±ä¼šæŠ¥é”™ã€‚ ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œå°±æœ‰äº†æ³›å½¢å‚æ•°
æ³›å‹å‚æ•°â€”â€”åœ¨ç±»å‹å±‚é¢æ–½åŠ çº¦æŸçš„å ä½ç±»å‹ï¼Œä¹Ÿç§°å¤šæ€ç±»å‹å‚æ•°ï¼Œç®€ç§°æ³›å½¢
1// example 2type Filter = { 3 &lt;T&gt;(array: T[], f: (item: T): boolean): T[] 4} è¿™ä¹ˆåšçš„æ„æ€æ˜¯ Filter ä½¿ç”¨äº†ä¸€ä¸ªæ³›å½¢å‚æ•° Tï¼Œäº‹å…ˆä¸çŸ¥é“å…·ä½“ç±»å‹æ˜¯ä»€ä¹ˆï¼Œè°ƒç”¨çš„æ—¶å€™æ ¹æ®ä¼ å…¥çš„å‚æ•°æ¨å¯¼ T çš„ç±»å‹ã€‚
çŸ¥è¯†ç‚¹
æ³›å½¢ä½¿ç”¨å°–æ‹¬å·å£°æ˜ï¼Œå¯ä»¥æŠŠå°–æ‹¬å·ç†è§£ä¸º type å…³é”®å­—ï¼Œåªä¸è¿‡å£°æ˜çš„æ˜¯æ³›å½¢ã€‚ å°–æ‹¬å·ä½ç½®é™åˆ¶æ³›å½¢ä½œç”¨åŸŸå°–æ‹¬å·ä¸­å¯ä»¥å£°æ˜ä»»æ„å¤šä¸ªä»¥é€—å·åˆ†éš” T å°±æ˜¯ä¸€ä¸ªç±»å‹åç§°ï¼ˆç±»ä¼¼å˜é‡åç§°ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä»»æ„åç§°ï¼Œé€šå¸¸ä¼šä½¿ç”¨ T U V W æ³›å½¢å¯ä»¥ç†è§£ä¸ºä¸€ç§çº¦æŸï¼ŒæŠŠæ³›å½¢ T æ‰€åœ¨ä½ç½®çš„ç±»å‹çº¦æŸä¸º T ç±»å‹ ä»€ä¹ˆæ—¶å€™ç»‘å®šæ³›å‹ å£°æ˜æ³›å½¢çš„ä½ç½®ä¸ä»…é™å®šæ³›å½¢ä½œç”¨åŸŸï¼Œè¿˜å†³å®šä»€ä¹ˆæ—¶å€™ä¸ºæ³›å½¢ç»‘å®šå…·ä½“çš„å€¼
1// 1 åœ¨è°ƒç”¨ç­¾åä¸­å£°æ˜ 2type Filter = { 3 &lt;T&gt;(array: T[], f: (item: T): boolean): T[] 4} 5// è°ƒç”¨å‡½æ•°æ—¶ä¸º T ç»‘å®šå…·ä½“ç±»å‹ 6let filter: Filter = (array, f) =&gt; { 7 // ... 8} 9 10 11// 2 åœ¨ç±»å‹åˆ«å Filter ä¸­ 12type Filter&lt;T&gt; = { 13 (array: T[], f: (item: T): boolean): T[] 14} 15// ä½¿ç”¨ Filter æ—¶æ˜¾å¼ç»‘å®šå…·ä½“ç±»å‹ 16let filter: Filter&lt;number&gt; = (array, f) =&gt; { 17 // ... 18} å¯ä»¥åœ¨ä»€ä¹ˆåœ°æ–¹å£°æ˜æ³›å½¢ 1// 1 2type Filter = { 3 &lt;T&gt;(array: T[], f: (item: T): boolean): T[] 4} 5 6// 2 7type Filter&lt;T&gt; = { 8 (array: T[], f: (item: T): boolean): T[] 9} 10 11// 3 1 çš„ç®€å†™ 12type Filter = &lt;T&gt;(array: T[], f: (item: T): boolean): T[] 13 14// 4 2 çš„ç®€å†™ 15type Filter&lt;T&gt;( = array: T[], f: (item: T): boolean): T[] 16 17// 5 å…·åå‡½æ•°è°ƒç”¨ç­¾åï¼Œæ¯æ¬¡è°ƒç”¨ filter æ—¶ç»‘å®šä¸¾è…¿ç±»å‹ 18function filter&lt;T&gt;(array: T[], f: (item: T) =&gt; boolean): T[] { 19 // ... 20} æ³›å½¢åˆ«å æ³›å½¢çº¦æŸ `,url:"https://hugo-dead-simple.netlify.com/typescript/typescript_program/"},"https://hugo-dead-simple.netlify.com/tags/web%E5%BC%80%E5%8F%91/":{title:"Webå¼€å‘",tags:[],content:"",url:"https://hugo-dead-simple.netlify.com/tags/web%E5%BC%80%E5%8F%91/"},"https://hugo-dead-simple.netlify.com/frontend/switch_light_drak_theme/":{title:"å®Œç¾å®ç° Hugo åšå®¢æš—é»‘æ¨¡å¼åˆ‡æ¢ï¼šä»åŸç†åˆ°å®è·µ",tags:["Hugo","Webå¼€å‘","JavaScript","CSS"],content:`åœ¨å½“ä»Šçš„ç”¨æˆ·ä½“éªŒè®¾è®¡ä¸­ï¼Œæä¾›æš—é»‘æ¨¡å¼ï¼ˆDark Modeï¼‰å‡ ä¹å·²æˆä¸ºæ ‡é…ã€‚å®ƒä¸ä»…èƒ½å‡å°‘çœ¼éƒ¨ç–²åŠ³ï¼Œåœ¨ä½å…‰ç¯å¢ƒä¸‹ä¹Ÿæ›´åŠ èˆ’é€‚ã€‚æœ¬æ–‡å°†è¯¦ç»†è®°å½•å¦‚ä½•ä¸ºä¸€ä¸ª Hugo ç½‘ç«™ï¼ˆå®é™…ä¸Šé€‚ç”¨äºä»»ä½•é™æ€ç½‘ç«™ï¼‰æ·»åŠ ä¸€ä¸ªåŠŸèƒ½å®Œå–„ã€ä½“éªŒæµç•…çš„ä¸»é¢˜åˆ‡æ¢å™¨ã€‚
æˆ‘ä»¬å°†è§£å†³ä¸€ä¸ªå¸¸è§ç—›ç‚¹ï¼šé¡µé¢åˆ·æ–°æ—¶çš„â€œé—ªçƒâ€é—®é¢˜ï¼Œå¹¶æœ€ç»ˆå®ç°ä¸€ä¸ªå ªç§°å®Œç¾çš„è§£å†³æ–¹æ¡ˆã€‚
æœ€ç»ˆæ•ˆæœ ä¸€ä¸ªä½äºå¯¼èˆªæ çš„æŒ‰é’®ï¼Œç”¨äºåœ¨æµ…è‰²ï¼ˆLightï¼‰å’Œæ·±è‰²ï¼ˆDarkï¼‰ä¸»é¢˜é—´åˆ‡æ¢ã€‚ ç”¨æˆ·çš„é€‰æ‹©ä¼šè¢«æµè§ˆå™¨è®°ä½ï¼Œä¸‹æ¬¡è®¿é—®æ—¶è‡ªåŠ¨åº”ç”¨ã€‚ å¦‚æœç”¨æˆ·é¦–æ¬¡è®¿é—®ï¼Œåˆ™ä¼šæ ¹æ®å…¶æ“ä½œç³»ç»Ÿçš„åå¥½è‡ªåŠ¨é€‰æ‹©ä¸»é¢˜ã€‚ æœ€é‡è¦çš„ï¼šé¡µé¢åœ¨åŠ è½½å’Œåˆ·æ–°æ—¶ç»ä¸ä¼šå‡ºç°æ¼äººçš„é¢œè‰²é—ªçƒã€‚ æ ¸å¿ƒå®ç°åŸç† æˆ‘ä»¬çš„ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ä¸»è¦ä¾èµ–ä¸¤å¤§ç°ä»£ Web æŠ€æœ¯çš„ç»“åˆï¼š
CSS è‡ªå®šä¹‰å±æ€§ (CSS Variables) é€šè¿‡ JavaScript æ“ä½œ HTML æ ‡ç­¾çš„ data-* å±æ€§ åŸºæœ¬æ€è·¯æ˜¯ï¼šæˆ‘ä»¬åœ¨ CSS ä¸­å®šä¹‰ä¸¤å¥—é¢œè‰²å˜é‡ï¼Œä¸€å¥—ç”¨äºæµ…è‰²ä¸»é¢˜ï¼Œå¦ä¸€å¥—ç”¨äºæ·±è‰²ä¸»é¢˜ã€‚ç„¶åï¼Œé€šè¿‡ JavaScript åŠ¨æ€åœ°åœ¨ &lt;html&gt; æ ¹å…ƒç´ ä¸Šåˆ‡æ¢ä¸€ä¸ª data-theme å±æ€§ï¼ˆä¾‹å¦‚ï¼Œdata-theme=&quot;light&quot; æˆ– data-theme=&quot;dark&quot;ï¼‰ã€‚CSS ä¼šæ ¹æ®è¿™ä¸ªå±æ€§çš„å€¼ï¼Œè‡ªåŠ¨åº”ç”¨å¯¹åº”çš„é¢œè‰²å˜é‡é›†ï¼Œä»è€Œå®ç°æ•´ä¸ªç½‘ç«™çš„é¢œè‰²åˆ‡æ¢ã€‚
1/* åŸºç¡€/æµ…è‰²ä¸»é¢˜å˜é‡ */ 2:root { 3 --background: #ffffff; 4 --text: #000000; 5 --link: #3366cc; 6 /* ... å…¶ä»–é¢œè‰²å˜é‡ */ 7} 8 9/* æ·±è‰²ä¸»é¢˜å˜é‡ */ 10[data-theme=&#39;dark&#39;] { 11 --background: #1b1b1b; 12 --text: #d8d8d8; 13 --link: #88a9e9; 14 /* ... å…¶ä»–é¢œè‰²å˜é‡ */ 15} 16 17/* åœ¨ç»„ä»¶ä¸­ä½¿ç”¨å˜é‡ */ 18body { 19 background-color: var(--background); 20 color: var(--text); 21} 22 23a { 24 color: var(--link); 25} è¿™ç§æ–¹æ³•çš„ä¼˜åŠ¿åœ¨äºï¼Œæˆ‘ä»¬æ— éœ€åŠ è½½ä¸åŒçš„ CSS æ–‡ä»¶ï¼Œåªéœ€æ”¹å˜ä¸€ä¸ªå±æ€§ï¼Œå°±èƒ½é«˜æ•ˆåœ°é‡ç»˜æ•´ä¸ªé¡µé¢çš„é¢œè‰²ï¼Œéå¸¸çµæ´»ä¸”æ€§èƒ½ä¼˜ç§€ã€‚
æ¼äººçš„â€œé—ªçƒâ€é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ å¾ˆå¤šä¸»é¢˜åˆ‡æ¢æ–¹æ¡ˆéƒ½å­˜åœ¨ä¸€ä¸ªé€šç—…ï¼šå½“ç”¨æˆ·é€‰æ‹©æ·±è‰²æ¨¡å¼å¹¶åˆ·æ–°é¡µé¢æ—¶ï¼Œé¡µé¢ä¼šå…ˆä»¥é»˜è®¤çš„æµ…è‰²æ¨¡å¼çŸ­æš‚æ˜¾ç¤ºï¼Œç„¶åâ€œé—ªçƒâ€ä¸€ä¸‹å†å˜æˆæ·±è‰²ã€‚
é—ªçƒåŸå› ï¼šè¿™æ˜¯å› ä¸ºè´Ÿè´£åˆ‡æ¢ä¸»é¢˜çš„ JavaScript è„šæœ¬é€šå¸¸æ”¾åœ¨ &lt;body&gt; åº•éƒ¨åŠ è½½ã€‚æµè§ˆå™¨ä¼šå…ˆæŒ‰ç…§ CSS çš„é»˜è®¤è®¾ç½®ï¼ˆé€šå¸¸æ˜¯æµ…è‰²ä¸»é¢˜ï¼‰æ¸²æŸ“é¡µé¢ï¼Œç­‰ JS åŠ è½½å¹¶æ‰§è¡Œåï¼Œæ‰æŠŠä¸»é¢˜åˆ‡æ¢è¿‡æ¥ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±é€ æˆäº†é—ªçƒã€‚
è§£å†³æ–¹æ¡ˆï¼šç­”æ¡ˆæ˜¯åœ¨æµè§ˆå™¨æ¸²æŸ“ &lt;body&gt; ä¹‹å‰å°±ç¡®å®šå¥½ä¸»é¢˜ã€‚æˆ‘ä»¬å°†ä¸€å°æ®µå…³é”®çš„ JavaScript ä»£ç ä½œä¸ºå†…è”è„šæœ¬ç›´æ¥æ”¾åœ¨ &lt;head&gt; æ ‡ç­¾ä¸­ã€‚
è¿™æ®µè„šæœ¬çš„ä»»åŠ¡éå¸¸çº¯ç²¹ï¼š
æ£€æŸ¥ localStorage ä¸­æ˜¯å¦æœ‰ç”¨æˆ·ä¹‹å‰ä¿å­˜çš„ä¸»é¢˜åå¥½ã€‚ å¦‚æœæ²¡æœ‰ï¼Œåˆ™æ£€æŸ¥ç”¨æˆ·çš„æ“ä½œç³»ç»Ÿæ˜¯å¦åå¥½æ·±è‰²æ¨¡å¼ã€‚ æ ¹æ®ç»“æœï¼Œç«‹å³åœ¨ &lt;html&gt; æ ‡ç­¾ä¸Šè®¾ç½® data-theme å±æ€§ã€‚ å› ä¸ºè¿™æ®µè„šæœ¬åœ¨ &lt;head&gt; ä¸­ï¼Œå®ƒä¼šæ¯”é¡µé¢çš„ä»»ä½•å¯è§å…ƒç´ ï¼ˆ&lt;body&gt; å†…çš„å†…å®¹ï¼‰éƒ½å…ˆæ‰§è¡Œï¼Œä»è€Œç¡®ä¿äº†æµè§ˆå™¨åœ¨â€œç¬¬ä¸€å¸§â€æ¸²æŸ“æ—¶å°±ä½¿ç”¨äº†æ­£ç¡®çš„ä¸»é¢˜ï¼Œå½»åº•æ¶ˆé™¤äº†é—ªçƒã€‚
åˆ†æ­¥å®ç°æŒ‡å— ç¬¬ 1 æ­¥ï¼šåœ¨ header.html ä¸­æ·»åŠ æ ¸å¿ƒè„šæœ¬å’Œåˆ‡æ¢æŒ‰é’® é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å°†å®ç°æ— é—ªçƒåˆ‡æ¢çš„æ ¸å¿ƒè„šæœ¬å’ŒæŒ‰é’®æ·»åŠ åˆ°ä¸»é¢˜çš„ header.html ä¸­ã€‚
1// filepath: layouts/partials/header.html 2 3&lt;head&gt; 4 {{/* ... å…¶ä»– head å†…å®¹ ... */}} 5 6 {{/* æ ¸å¿ƒï¼šé˜²æ­¢é—ªçƒçš„å†…è”è„šæœ¬ */}} 7 &lt;script&gt; 8 // åœ¨é¡µé¢åŠ è½½æˆ–åˆ‡æ¢ä¸»é¢˜æ—¶ï¼Œæ­¤è„šæœ¬åº”å†…è”åœ¨ &lt;head&gt; ä¸­ä»¥é¿å… FOUC (Flash of Unstyled Content) 9 (function() { 10 const theme = localStorage.getItem(&#39;theme&#39;) || (window.matchMedia(&#39;(prefers-color-scheme: dark)&#39;).matches ? &#39;dark&#39; : &#39;light&#39;); 11 document.documentElement.setAttribute(&#39;data-theme&#39;, theme); 12 })(); 13 &lt;/script&gt; 14 15 {{/* ... å…¶ä»– head å†…å®¹ï¼Œå¦‚ CSS é“¾æ¥ç­‰ ... */}} 16&lt;/head&gt; 17 18&lt;body&gt; 19 &lt;nav&gt; 20 &lt;ul class=&#34;menu&#34;&gt; 21 {{/* ... å…¶ä»–èœå•é¡¹ ... */}} 22 &lt;li&gt;&lt;a href=&#34;/posts&#34;&gt;æ–‡ç« &lt;/a&gt;&lt;/li&gt; 23 {{/* ä¸»é¢˜åˆ‡æ¢æŒ‰é’® */}} 24 &lt;li&gt;&lt;button id=&#34;theme-switcher&#34; class=&#34;menu-link&#34; type=&#34;button&#34;&gt;ğŸŒ—&lt;/button&gt;&lt;/li&gt; 25 &lt;/ul&gt; 26 &lt;/nav&gt; 27 {{/* ... */}} ç¬¬ 2 æ­¥ï¼šåˆ›å»ºå¤„ç†æŒ‰é’®äº¤äº’çš„ JavaScript æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ JS æ–‡ä»¶æ¥å¤„ç†æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ã€‚è¿™ä¸ªè„šæœ¬å¯ä»¥æ”¾åœ¨ &lt;body&gt; åº•éƒ¨åŠ è½½ï¼Œå› ä¸ºå®ƒä¸è´Ÿè´£åˆå§‹ä¸»é¢˜çš„è®¾å®šï¼Œåªè´Ÿè´£å“åº”ç”¨æˆ·æ“ä½œã€‚
1// filepath: static/js/theme-switcher.js 2 3(function() { 4 const themeSwitcher = document.getElementById(&#39;theme-switcher&#39;); 5 if (!themeSwitcher) { 6 return; 7 } 8 9 // é¡µé¢åŠ è½½æ—¶ï¼Œæ ¹æ®å½“å‰ä¸»é¢˜è®¾ç½®æŒ‰é’®å›¾æ ‡ 10 let currentTheme = document.documentElement.getAttribute(&#39;data-theme&#39;); 11 themeSwitcher.textContent = currentTheme === &#39;dark&#39; ? &#39;â˜€ï¸&#39; : &#39;ğŸŒ—&#39;; 12 13 // ç›‘å¬æŒ‰é’®ç‚¹å‡»äº‹ä»¶ 14 themeSwitcher.addEventListener(&#39;click&#39;, () =&gt; { 15 // åˆ‡æ¢ä¸»é¢˜ 16 currentTheme = document.documentElement.getAttribute(&#39;data-theme&#39;) === &#39;dark&#39; ? &#39;light&#39; : &#39;dark&#39;; 17 document.documentElement.setAttribute(&#39;data-theme&#39;, currentTheme); 18 19 // å°†ç”¨æˆ·çš„é€‰æ‹©å­˜å…¥ localStorage 20 localStorage.setItem(&#39;theme&#39;, currentTheme); 21 22 // æ›´æ–°æŒ‰é’®å›¾æ ‡ 23 themeSwitcher.textContent = currentTheme === &#39;dark&#39; ? &#39;â˜€ï¸&#39; : &#39;ğŸŒ—&#39;; 24 }); 25})(); åˆ«å¿˜äº†åœ¨ footer_scripts.html æˆ–ç±»ä¼¼çš„åœ°æ–¹å¼•å…¥è¿™ä¸ªè„šæœ¬ï¼š &lt;script src=&quot;{{ &quot;js/theme-switcher.js&quot; | relURL }}&quot;&gt;&lt;/script&gt;
ç¬¬ 3 æ­¥ï¼šé…ç½® CSS é¢œè‰²å˜é‡ æœ€åï¼Œä¹Ÿæ˜¯æœ€å…³é”®çš„ä¸€æ­¥ï¼Œæ˜¯é…ç½®å¥½æˆ‘ä»¬çš„ CSS æ–‡ä»¶ï¼Œè®©å®ƒèƒ½å¤Ÿå“åº” data-theme å±æ€§çš„å˜åŒ–ã€‚
1/* filepath: assets/css/main.css */ 2 3/* é»˜è®¤/æµ…è‰²ä¸»é¢˜å˜é‡ */ 4:root { 5 --background: #ffffff; 6 --text: black; 7 --link: #3366cc; 8 --card-background: #f9f9f9; 9 /* ... æ›´å¤šé¢œè‰² */ 10} 11 12/* å½“ data-theme=&#39;light&#39; æ—¶åº”ç”¨çš„å˜é‡ï¼ˆå¯é€‰ï¼Œç”¨äºæ˜ç¡®æŒ‡å®šï¼‰ */ 13[data-theme=&#39;light&#39;] { 14 --background: #ffffff; 15 --text: black; 16 --link: #3366cc; 17 --card-background: #f9f9f9; 18 /* ... */ 19} 20 21/* å½“ data-theme=&#39;dark&#39; æ—¶åº”ç”¨çš„å˜é‡ */ 22[data-theme=&#39;dark&#39;] { 23 --background: #1b1b1b; 24 --text: #d8d8d8; 25 --link: #88a9e9; 26 --card-background: #272727; 27 /* ... æ›´å¤šé¢œè‰² */ 28} 29 30/* ... ä¹‹åçš„ CSS è§„åˆ™å…¨éƒ¨ä½¿ç”¨ var() æ¥å¼•ç”¨é¢œè‰² ... */ 31body { 32 background-color: var(--background); 33 color: var(--text); 34} 35 36.subcategory-card { 37 background-color: var(--card-background); 38} æ€»ç»“ é€šè¿‡å°†ä¸»é¢˜å†³ç­–é€»è¾‘å‰ç½®åˆ° &lt;head&gt; å¹¶ç»“åˆ CSS å˜é‡ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªå¥å£®ã€é«˜æ•ˆä¸”ç”¨æˆ·ä½“éªŒæä½³çš„ä¸»é¢˜åˆ‡æ¢ç³»ç»Ÿã€‚è¿™ä¸ªæ–¹æ¡ˆä¸ä»…è§£å†³äº†æ¼äººçš„â€œé—ªçƒâ€é—®é¢˜ï¼Œå…¶æ¨¡å—åŒ–çš„ç»“æ„ä¹Ÿä½¿å¾—æœªæ¥çš„æ ·å¼ç»´æŠ¤å’Œæ‰©å±•å˜å¾—å¼‚å¸¸ç®€å•ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼
data-theme è‡ªå®šä¹‰å±æ€§åŸç† 1:root { 2Â --complimentary: #815205; 3Â --text: black; 4Â --code: black; 5Â --accent-color: #00aaff; 6Â --accent-color-light: rgba(0, 170, 255, 0.1); 7Â --card-background: #cccccc5f; 8Â --card-background-hover: #6e6b6bff; 9Â --card-text-color: #100101ff; 10Â --shadow-color: rgba(0, 0, 0, 0.1); 11Â --text-dim: #444; 12Â --link: #3366cc; 13Â --link-visited: #795cb2; 14Â --code-background: #f3f5f7; 15Â --code-border: #eaecf0; 16Â --code-border: transparent; 17Â --code-hl: #e6e6e6; 18Â --border-general: #cccfd4; 19Â --table-th: #e1e5ea; 20Â --table-tr: #edeff2; 21Â --toc-background: #f9f9f9; 22Â --toc-border: #aaa; 23Â --output-background: #d5dbe3; 24Â --output-foreground: #805105; 25} 26 27[data-theme=&#39;light&#39;] { 28Â --background: #ffffff; 29} 30 31[data-theme=&#39;dark&#39;] { 32Â --background: #1b1b1b; 33Â --text: #d8d8d8; 34Â --code: #cbcbcb; 35Â --accent-color: #00aaff; 36Â --accent-color-light: rgba(0, 170, 255, 0.2); 37Â --card-background: #272727; 38Â --card-background-hover: #444; 39Â --card-text-color: #d8d8d8; 40Â --shadow-color: rgba(0, 0, 0, 0.3); 41Â --text-dim: #a7a7a7; 42Â --link: #88a9e9; 43Â --link-visited: #a390ca; 44Â --code-background: #272727; 45Â --code-border: transparent; 46Â --code-hl: #5a5a5a; 47Â --border-general: #495057; 48Â --table-th: #414141; 49Â --table-tr: #343434; 50Â --toc-background: #343434; 51Â --toc-border: #495057; 52Â --output-background: #020202; 53} å‘æˆ‘è§£é‡Šä¸Šé¢çš„ä»£ç ,å¹¶å‘æˆ‘è§£é‡Š data-themeçš„åŸç†
å½“ç„¶ï¼Œæˆ‘å¾ˆä¹æ„ä¸ºä½ è§£é‡Šè¿™æ®µä»£ç ä»¥åŠ data-theme çš„å·¥ä½œåŸç†ã€‚
ç®€å•æ¥è¯´ï¼Œè¿™æ®µ CSS ä»£ç ä½¿ç”¨ CSS å˜é‡ï¼ˆä¹Ÿå«è‡ªå®šä¹‰å±æ€§ï¼‰å’Œ data- å±æ€§æ¥åˆ›å»ºä¸€å¥—çµæ´»çš„ä¸»é¢˜ç³»ç»Ÿï¼Œå¯ä»¥è½»æ¾åœ°åœ¨æµ…è‰²æ¨¡å¼ (light mode) å’Œæ·±è‰²æ¨¡å¼ (dark mode) ä¹‹é—´åˆ‡æ¢ã€‚
ä»£ç è§£æ è¿™æ®µä»£ç ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š
1. :root â€” å…¨å±€é»˜è®¤å˜é‡ 1:root { 2Â --complimentary: #815205; 3Â --text: black; 4 /* ... å…¶ä»–å˜é‡ ... */ 5} :root é€‰æ‹©å™¨ï¼šè¿™ä¸ªé€‰æ‹©å™¨æŒ‡å‘æ–‡æ¡£çš„æ ¹å…ƒç´ ï¼Œåœ¨ HTML ä¸­å°±æ˜¯ &lt;html&gt; æ ‡ç­¾ã€‚åœ¨è¿™é‡Œå®šä¹‰çš„å˜é‡æ˜¯å…¨å±€çš„ï¼Œå¯ä»¥åœ¨æ•´ä¸ªé¡µé¢çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨ã€‚ CSS å˜é‡ (Custom Properties)ï¼šä»¥ -- å¼€å¤´çš„éƒ½æ˜¯ CSS å˜é‡ã€‚ä½ å¯ä»¥æŠŠå®ƒä»¬çœ‹ä½œæ˜¯å€¼çš„â€œå ä½ç¬¦â€ã€‚ä¾‹å¦‚ï¼Œ--text: black; å®šä¹‰äº†ä¸€ä¸ªåä¸º text çš„å˜é‡ï¼Œå®ƒçš„å€¼æ˜¯é»‘è‰²ã€‚ ä½œç”¨ï¼šè¿™ä¸ªéƒ¨åˆ†å®šä¹‰äº†ç½‘ç«™çš„é»˜è®¤ä¸»é¢˜ï¼Œæˆ–è€…è¯´æ˜¯â€œåŸºç¡€â€é¢œè‰²ã€‚å½“æ²¡æœ‰æŒ‡å®šç‰¹å®šä¸»é¢˜æ—¶ï¼Œç½‘ç«™å°±ä¼šä½¿ç”¨è¿™äº›é¢œè‰²ã€‚ 2. [data-theme='light'] â€” æµ…è‰²ä¸»é¢˜ 1[data-theme=&#39;light&#39;] { 2Â --background: #ffffff; 3} [data-theme='light']ï¼šè¿™æ˜¯ä¸€ä¸ªå±æ€§é€‰æ‹©å™¨ã€‚å®ƒçš„æ„æ€æ˜¯ï¼šâ€œé€‰æ‹©ä»»ä½•å¸¦æœ‰ data-theme å±æ€§å¹¶ä¸”è¯¥å±æ€§çš„å€¼ä¸º light çš„å…ƒç´ â€ã€‚ ä½œç”¨ï¼šå½“ &lt;html&gt; æˆ– &lt;body&gt; æ ‡ç­¾è¢«è®¾ç½®ä¸º &lt;html data-theme=&quot;light&quot;&gt; æ—¶ï¼Œè¿™ä¸ªè§„åˆ™å°±ä¼šç”Ÿæ•ˆã€‚å®ƒå®šä¹‰äº†æµ…è‰²ä¸»é¢˜ä¸‹çš„ç‰¹å®šå˜é‡ã€‚åœ¨è¿™é‡Œï¼Œå®ƒåªå®šä¹‰äº† --background ä¸ºç™½è‰² (#ffffff)ã€‚å…¶ä»–æ²¡æœ‰è¢«é‡æ–°å®šä¹‰çš„å˜é‡ï¼ˆå¦‚ --textï¼‰ä¼šç»§ç»­ä½¿ç”¨ :root ä¸­çš„é»˜è®¤å€¼ã€‚ 3. [data-theme='dark'] â€” æ·±è‰²ä¸»é¢˜ 1[data-theme=&#39;dark&#39;] { 2Â --background: #1b1b1b; 3Â --text: #d8d8d8; 4 /* ... å…¶ä»–å˜é‡ ... */ 5} [data-theme='dark']ï¼šä¸ä¸Šé¢ç±»ä¼¼ï¼Œè¿™ä¸ªå±æ€§é€‰æ‹©å™¨ä¼šåŒ¹é… &lt;html data-theme=&quot;dark&quot;&gt; è¿™æ ·çš„å…ƒç´ ã€‚ ä½œç”¨ï¼šå½“ç½‘ç«™åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼æ—¶ï¼Œè¿™ä¸ªè§„åˆ™ä¼šç”Ÿæ•ˆã€‚å®ƒä¼šè¦†ç›– :root ä¸­å®šä¹‰çš„è®¸å¤šå˜é‡ï¼Œå°†å®ƒä»¬æ›¿æ¢ä¸ºé€‚åˆåœ¨æ·±è‰²èƒŒæ™¯ä¸‹æ˜¾ç¤ºçš„é¢œè‰²å€¼ï¼ˆä¾‹å¦‚ï¼ŒèƒŒæ™¯å˜ä¸ºæ·±ç°è‰²ï¼Œæ–‡å­—å˜ä¸ºæµ…ç°è‰²ï¼‰ã€‚ data-theme çš„å·¥ä½œåŸç† data-theme æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰æ•°æ®å±æ€§ (Custom Data Attribute)ã€‚è¿™æ˜¯ HTML5 çš„ä¸€ä¸ªå¾ˆæ£’çš„åŠŸèƒ½ï¼Œå…è®¸ä½ å°†è‡ªå®šä¹‰çš„æ•°æ®å­˜å‚¨åœ¨ HTML å…ƒç´ ä¸Šï¼Œè€Œä¸ä¼šå½±å“å…¶æ ·å¼å’Œè¡Œä¸ºã€‚
å®ƒçš„å·¥ä½œåŸç†å°±åƒä¸€ä¸ªçŠ¶æ€å¼€å…³ ğŸš¦ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š
å®šä¹‰æ ·å¼ï¼šå°±åƒä½ ä¸Šé¢æä¾›çš„ CSS ä»£ç ä¸€æ ·ï¼Œæˆ‘ä»¬ä¸ºä¸åŒçš„ data-theme å€¼ï¼ˆå¦‚ light å’Œ darkï¼‰å®šä¹‰ä¸åŒçš„ CSS å˜é‡ã€‚
è®¾ç½®åˆå§‹çŠ¶æ€ï¼šåœ¨ HTML çš„æ ¹å…ƒç´ ï¼ˆé€šå¸¸æ˜¯ &lt;html&gt;ï¼‰ä¸Šè®¾ç½®ä¸€ä¸ªåˆå§‹ä¸»é¢˜ã€‚
1&lt;html data-theme=&#34;light&#34;&gt; 2 &lt;/html&gt; å½“é¡µé¢åŠ è½½æ—¶ï¼Œæµè§ˆå™¨çœ‹åˆ° data-theme=&quot;light&quot;ï¼Œäºæ˜¯ [data-theme='light'] çš„ CSS è§„åˆ™è¢«åº”ç”¨ï¼Œé¡µé¢æ˜¾ç¤ºä¸ºæµ…è‰²ä¸»é¢˜ã€‚
ä½¿ç”¨å˜é‡ï¼šåœ¨ä½ çš„å…¶ä»– CSS æ–‡ä»¶ä¸­ï¼Œä½ ä¸ä¼šç›´æ¥ä½¿ç”¨é¢œè‰²ä»£ç ï¼Œè€Œæ˜¯ä½¿ç”¨ var() å‡½æ•°æ¥è°ƒç”¨è¿™äº›å˜é‡ã€‚
1body { 2 background-color: var(--background); /* ä½¿ç”¨ --background å˜é‡ */ 3 color: var(--text); /* ä½¿ç”¨ --text å˜é‡ */ 4} 5 6a { 7 color: var(--link); /* ä½¿ç”¨ --link å˜é‡ */ 8} è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œä½ åªéœ€è¦æ”¹å˜å˜é‡çš„å€¼ï¼Œæ‰€æœ‰ä½¿ç”¨è¯¥å˜é‡çš„å…ƒç´ çš„æ ·å¼éƒ½ä¼šè‡ªåŠ¨æ›´æ–°ã€‚
ç”¨ JavaScript åˆ‡æ¢ä¸»é¢˜ï¼šå½“ç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªâ€œåˆ‡æ¢ä¸»é¢˜â€æŒ‰é’®æ—¶ï¼Œä½ ä¼šç”¨ JavaScript æ¥æ”¹å˜ &lt;html&gt; æ ‡ç­¾ä¸Š data-theme å±æ€§çš„å€¼ã€‚
1// è·å– &lt;html&gt; å…ƒç´  2const htmlElement = document.documentElement; 3 4// å‡è®¾å½“å‰æ˜¯ &#39;light&#39;ï¼Œæˆ‘ä»¬è¦åˆ‡æ¢åˆ° &#39;dark&#39; 5htmlElement.setAttribute(&#39;data-theme&#39;, &#39;dark&#39;); åˆ‡æ¢ç¬é—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ
å½“ JavaScript å°† data-theme çš„å€¼ä» 'light' æ”¹ä¸º 'dark' æ—¶ï¼Œæµè§ˆå™¨ä¼šç«‹å³é‡æ–°è®¡ç®—æ ·å¼ï¼š
ä¹‹å‰åŒ¹é…çš„ CSS è§„åˆ™ [data-theme='light'] ä¸å†ç”Ÿæ•ˆã€‚ æ–°çš„ CSS è§„åˆ™ [data-theme='dark'] å¼€å§‹ç”Ÿæ•ˆã€‚ æ‰€æœ‰ CSS å˜é‡ï¼ˆ--background, --text ç­‰ï¼‰çš„å€¼è¢«ç«‹åˆ»æ›´æ–°ä¸ºæ·±è‰²ä¸»é¢˜çš„å€¼ã€‚ æ‰€æœ‰ä½¿ç”¨äº† var() å‡½æ•°çš„å…ƒç´ ï¼ˆæ¯”å¦‚ bodyï¼‰çš„æ ·å¼éƒ½ä¼šè‡ªåŠ¨é‡æ–°æ¸²æŸ“ï¼Œé¡µé¢ç¬é—´å°±ä»æµ…è‰²æ¨¡å¼å˜æˆäº†æ·±è‰²æ¨¡å¼ï¼Œæ— éœ€åˆ·æ–°é¡µé¢ã€‚ æ€»ç»“ æ€»è€Œè¨€ä¹‹ï¼Œè¿™ç§æ–¹æ³•é€šè¿‡ CSS å˜é‡å°†è®¾è®¡ç³»ç»Ÿçš„é¢œè‰²é›†ä¸­ç®¡ç†ï¼Œç„¶ååˆ©ç”¨ data-theme å±æ€§ä½œä¸ºå¼€å…³ï¼Œæœ€åé€šè¿‡ JavaScript æ¥â€œæ‹¨åŠ¨â€è¿™ä¸ªå¼€å…³ï¼Œä»è€Œå®ç°äº†ä¸€ç§éå¸¸ç°ä»£åŒ–ã€é«˜æ•ˆä¸”æ˜“äºç»´æŠ¤çš„ç½‘ç«™ä¸»é¢˜åˆ‡æ¢æ–¹æ¡ˆã€‚
`,url:"https://hugo-dead-simple.netlify.com/frontend/switch_light_drak_theme/"},"https://hugo-dead-simple.netlify.com/typescript/%E5%AF%B9%E8%B1%A1%E5%AD%97%E9%9D%A2%E9%87%8F/":{title:"å¯¹è±¡å­—é¢é‡",tags:[],content:`åœ¨ TypeScript ä¸­ï¼Œå¯¹è±¡å­—é¢é‡ï¼ˆObject Literalï¼‰æ˜¯é€šè¿‡èŠ±æ‹¬å· {} æ¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å¯ä»¥ç›´æ¥ä¸ºå…¶æ·»åŠ å±æ€§å’Œå€¼ã€‚è¿™ä¸ JavaScript ä¸­çš„å¯¹è±¡å­—é¢é‡ä½¿ç”¨æ–¹å¼ç±»ä¼¼ï¼Œä½† TypeScript ä¸ºå¯¹è±¡å­—é¢é‡æä¾›äº†ç±»å‹ç³»ç»Ÿï¼Œå¯ä»¥é€šè¿‡ç±»å‹æ³¨è§£æ¥é™åˆ¶å¯¹è±¡çš„ç»“æ„ã€‚
1. åŸºæœ¬çš„å¯¹è±¡å­—é¢é‡ å¯¹è±¡å­—é¢é‡ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥æŒ‡å®šå…¶å±æ€§å’Œå€¼ï¼š
1const person = { 2 name: &#34;Alice&#34;, 3 age: 30 4}; è¿™é‡Œ person æ˜¯ä¸€ä¸ªå¯¹è±¡å­—é¢é‡ï¼ŒåŒ…å«äº†ä¸¤ä¸ªå±æ€§ï¼šname å’Œ ageã€‚
2. ä½¿ç”¨ç±»å‹æ³¨è§£æŒ‡å®šå¯¹è±¡å­—é¢é‡çš„ç±»å‹ TypeScript å…è®¸ä½ ä¸ºå¯¹è±¡å­—é¢é‡æŒ‡å®šç±»å‹ï¼Œä»è€Œé™åˆ¶å¯¹è±¡çš„å±æ€§å’Œç±»å‹ã€‚è¿™ä½¿å¾—ä»£ç æ›´åŠ å®‰å…¨ï¼Œèƒ½å¤Ÿé˜²æ­¢é”™è¯¯çš„å±æ€§èµ‹å€¼ã€‚
ç¤ºä¾‹ï¼šä½¿ç”¨ type æˆ– interface å®šä¹‰å¯¹è±¡ç±»å‹ 1interface Person { 2 name: string; 3 age: number; 4} 5 6const person: Person = { 7 name: &#34;Alice&#34;, 8 age: 30 9}; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒPerson æ˜¯ä¸€ä¸ªæ¥å£ï¼ˆinterfaceï¼‰ï¼Œå®ƒå®šä¹‰äº† name å’Œ age å±æ€§çš„ç±»å‹ã€‚ç„¶åæˆ‘ä»¬é€šè¿‡ç±»å‹æ³¨è§£ const person: Person æ¥ç¡®ä¿ person å¯¹è±¡ç¬¦åˆè¿™ä¸ªç±»å‹ã€‚
ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ type æ¥å®šä¹‰ç±»å‹ï¼š
1type Person = { 2 name: string; 3 age: number; 4}; 5 6const person: Person = { 7 name: &#34;Alice&#34;, 8 age: 30 9}; 3. åœ¨å¯¹è±¡å­—é¢é‡ä¸­ä½¿ç”¨å¯é€‰å±æ€§ åœ¨å¯¹è±¡å­—é¢é‡ä¸­ï¼Œä½ å¯ä»¥å®šä¹‰å¯é€‰å±æ€§ï¼Œé€šè¿‡åœ¨å±æ€§ååæ·»åŠ  ? æ¥å®ç°ã€‚
1interface Person { 2 name: string; 3 age: number; 4 address?: string; // å¯é€‰å±æ€§ 5} 6 7const person: Person = { 8 name: &#34;Alice&#34;, 9 age: 30 10 // address æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥ä¸æä¾› 11}; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œaddress å±æ€§æ˜¯å¯é€‰çš„ï¼Œå› æ­¤ä½ å¯ä»¥åœ¨åˆ›å»º person å¯¹è±¡æ—¶ä¸æä¾›è¯¥å±æ€§ã€‚
4. åªè¯»å±æ€§ TypeScript è¿˜å…è®¸ä½ ä¸ºå¯¹è±¡å­—é¢é‡å®šä¹‰åªè¯»å±æ€§ï¼Œè¿™æ„å‘³ç€è¿™äº›å±æ€§çš„å€¼åœ¨åˆå§‹åŒ–åä¸èƒ½è¢«ä¿®æ”¹ã€‚å¯ä»¥ä½¿ç”¨ readonly ä¿®é¥°ç¬¦æ¥å®ç°ã€‚
1interface Person { 2 readonly name: string; 3 readonly age: number; 4} 5 6const person: Person = { 7 name: &#34;Alice&#34;, 8 age: 30 9}; 10 11// person.name = &#34;Bob&#34;; // è¿™æ˜¯ä¸å…è®¸çš„ï¼Œä¼šæŠ¥é”™ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œname å’Œ age æ˜¯åªè¯»çš„ï¼Œå› æ­¤ä½ ä¸èƒ½ä¿®æ”¹å®ƒä»¬çš„å€¼ã€‚
5. å¯¹è±¡å­—é¢é‡ä¸å‡½æ•°ç±»å‹ ä½ è¿˜å¯ä»¥å°†æ–¹æ³•ä½œä¸ºå¯¹è±¡å­—é¢é‡çš„ä¸€éƒ¨åˆ†æ¥ä½¿ç”¨ã€‚å‡½æ•°ç±»å‹å¯ä»¥åœ¨å¯¹è±¡å­—é¢é‡ä¸­ç›´æ¥å®šä¹‰ã€‚
1interface Person { 2 name: string; 3 greet: () =&gt; void; // greet æ˜¯ä¸€ä¸ªå‡½æ•° 4} 5 6const person: Person = { 7 name: &#34;Alice&#34;, 8 greet: () =&gt; { 9 console.log(\`Hello, my name is \${person.name}\`); 10 } 11}; 12 13person.greet(); // è¾“å‡ºï¼šHello, my name is Alice 6. ä½¿ç”¨ç´¢å¼•ç­¾å ç´¢å¼•ç­¾åå…è®¸å¯¹è±¡å­—é¢é‡å…·æœ‰ä»»æ„æ•°é‡çš„å±æ€§ï¼Œå¹¶ä¸”è¿™äº›å±æ€§çš„ç±»å‹æ˜¯é¢„å®šä¹‰çš„ã€‚é€šè¿‡ index signatureï¼Œä½ å¯ä»¥æŒ‡å®šå¯¹è±¡å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„é”®ï¼Œå¹¶é™åˆ¶é”®å€¼çš„ç±»å‹ã€‚
1interface Dictionary { 2 [key: string]: number; // é”®æ˜¯ string ç±»å‹ï¼Œå€¼æ˜¯ number ç±»å‹ 3} 4 5const myDictionary: Dictionary = { 6 apple: 10, 7 banana: 20 8}; 9 10console.log(myDictionary.apple); // è¾“å‡ºï¼š10 åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒDictionary æ¥å£å®šä¹‰äº†ä¸€ä¸ªç´¢å¼•ç­¾åï¼Œå…è®¸ä»»ä½•å­—ç¬¦ä¸²é”®ï¼Œä¸”è¿™äº›é”®å¯¹åº”çš„å€¼éƒ½å¿…é¡»æ˜¯ number ç±»å‹ã€‚
7. ä½¿ç”¨ç±»å‹æ¨æ–­ TypeScript ä¼šè‡ªåŠ¨æ¨æ–­å­—é¢é‡å¯¹è±¡çš„ç±»å‹ã€‚å¦‚æœä½ æ²¡æœ‰æ˜¾å¼åœ°ä¸ºå¯¹è±¡æŒ‡å®šç±»å‹ï¼ŒTypeScript ä¼šæ ¹æ®å¯¹è±¡çš„ç»“æ„è‡ªåŠ¨æ¨æ–­ç±»å‹ã€‚
1const person = { 2 name: &#34;Alice&#34;, 3 age: 30 4}; // TypeScript æ¨æ–­ person çš„ç±»å‹ä¸º { name: string; age: number; } 5 6person.name = &#34;Bob&#34;; // å…è®¸ä¿®æ”¹ 7// person.name = 100; // é”™è¯¯ï¼Œå› ä¸º name åº”è¯¥æ˜¯ string ç±»å‹ 8. ç¦æ­¢é¢å¤–çš„å±æ€§ æœ‰æ—¶ï¼Œä½ å¸Œæœ›å¯¹è±¡å­—é¢é‡åªèƒ½åŒ…å«æŸäº›ç‰¹å®šçš„å±æ€§ï¼Œç¦æ­¢æ·»åŠ ä»»ä½•é¢å¤–çš„å±æ€§ã€‚å¯ä»¥ä½¿ç”¨ exact ç±»å‹æ¥å®ç°è¿™ä¸€ç‚¹ï¼ˆé€šè¿‡ as const æ¥ç¡®ä¿å­—é¢é‡ç±»å‹çš„ç²¾ç¡®æ€§ï¼‰ã€‚
1const person = { 2 name: &#34;Alice&#34;, 3 age: 30 4} as const; // ä½¿ç”¨ &#39;as const&#39; æ¥ç¡®ä¿å±æ€§æ˜¯åªè¯»çš„å¹¶ä¸”ç²¾ç¡®åŒ¹é… 5 6// person.name = &#34;Bob&#34;; // é”™è¯¯ï¼Œå› ä¸º &#39;name&#39; æ˜¯åªè¯»çš„ï¼Œä¸èƒ½ä¿®æ”¹ 7// person.address = &#34;NY&#34;; // é”™è¯¯ï¼Œå› ä¸º \`address\` å±æ€§å¹¶ä¸åœ¨å¯¹è±¡å­—é¢é‡ä¸­ æ€»ç»“ å¯¹è±¡å­—é¢é‡ æ˜¯é€šè¿‡ {} åˆ›å»ºçš„æ™®é€š JavaScript å¯¹è±¡ï¼Œåœ¨ TypeScript ä¸­å¯ä»¥é€šè¿‡ç±»å‹æ³¨è§£æ¥æŒ‡å®šå…¶ç»“æ„ã€‚ ä½ å¯ä»¥ä½¿ç”¨ interface æˆ– type æ¥å®šä¹‰å¯¹è±¡çš„ç»“æ„ï¼Œç¡®ä¿å¯¹è±¡ç¬¦åˆæŸç§é¢„æœŸçš„å½¢çŠ¶ã€‚ TypeScript è¿˜æ”¯æŒå¯é€‰å±æ€§ã€åªè¯»å±æ€§ã€ç´¢å¼•ç­¾åã€æ–¹æ³•ç­‰åŠŸèƒ½ã€‚ TypeScript ä¼šè‡ªåŠ¨æ¨æ–­å¯¹è±¡å­—é¢é‡çš„ç±»å‹ï¼Œå¦‚æœä½ ä¸æä¾›ç±»å‹æ³¨è§£ã€‚ é€šè¿‡è¿™äº›æ–¹å¼ï¼Œä½ å¯ä»¥åœ¨ TypeScript ä¸­åˆ›å»ºçµæ´»ã€ç±»å‹å®‰å…¨çš„å¯¹è±¡å­—é¢é‡ã€‚
`,url:"https://hugo-dead-simple.netlify.com/typescript/%E5%AF%B9%E8%B1%A1%E5%AD%97%E9%9D%A2%E9%87%8F/"},"https://hugo-dead-simple.netlify.com/typescript/%E7%90%86%E8%A7%A3%E7%B1%BB%E5%A3%B0%E6%98%8E%E5%80%BC%E4%B8%8E%E7%B1%BB%E5%9E%8B/":{title:"ç†è§£ç±»å£°æ˜å€¼ä¸ç±»å‹",tags:[],content:`è¿™æ®µä»£ç æ¶‰åŠåˆ°äº† TypeScript ä¸­ç±»çš„æ„é€ å‡½æ•°ã€å®ä¾‹å¯¹è±¡ã€ç±»å‹ç­‰æ¦‚å¿µã€‚è®©æˆ‘ä»¬é€æ­¥è§£ææ¯ä¸ªéƒ¨åˆ†ï¼Œç‰¹åˆ«æ˜¯ console.log(C.a) æŠ¥é”™çš„åŸå› ã€‚
ä»£ç è§£æ 1class C { 2 a = &#34;123&#34;; // ç±»å®ä¾‹å±æ€§ 3} 4 5let c: C = new C(); // åˆ›å»º C ç±»çš„ä¸€ä¸ªå®ä¾‹ 6 7console.log(c); // è¾“å‡º: C { a: &#39;123&#39; } 8console.log(C); // è¾“å‡º: [Function: C]ï¼ŒC æ˜¯æ„é€ å‡½æ•° 9// console.log(C.a); // æŠ¥é”™ï¼šProperty &#39;a&#39; does not exist on type &#39;C&#39;. 10console.log(c.a); // è¾“å‡º: 123 11console.log(c instanceof C); // è¾“å‡º: true 1. console.log(C) è¾“å‡ºçš„æ˜¯æ„é€ å‡½æ•° 1console.log(C); // è¾“å‡º: [Function: C] C æ˜¯ä¸€ä¸ªç±»ï¼Œç±»çš„æœ¬è´¨åœ¨ JavaScript ä¸­æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚C æœ¬èº«æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥åˆ›å»º C ç±»çš„å®ä¾‹ã€‚ å½“ä½ æ‰“å° C æ—¶ï¼Œè¾“å‡ºçš„æ˜¯ç±»çš„æ„é€ å‡½æ•°ã€‚æ¢å¥è¯è¯´ï¼ŒC æ˜¯ä¸€ä¸ª æ„é€ å‡½æ•°ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¯¹è±¡å®ä¾‹æˆ–ç±»çš„ å®ä¾‹ç±»å‹ã€‚ 2. console.log(C.a) æŠ¥é”™çš„åŸå›  1// console.log(C.a); // æŠ¥é”™ï¼šProperty &#39;a&#39; does not exist on type &#39;C&#39;. åœ¨ç±»å®šä¹‰ class C { a = &quot;123&quot;; } ä¸­ï¼Œa æ˜¯ä¸€ä¸ª å®ä¾‹å±æ€§ï¼Œè€Œä¸æ˜¯ ç±»å±æ€§ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œa å±äºç±»çš„å®ä¾‹ï¼ˆä¾‹å¦‚é€šè¿‡ new C() åˆ›å»ºçš„ c å®ä¾‹ï¼‰ï¼Œå¹¶ä¸”åœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ã€‚ å› æ­¤ï¼ŒC ä½œä¸ºæ„é€ å‡½æ•°å¹¶ä¸ç›´æ¥åŒ…å« a å±æ€§ï¼Œa åªèƒ½é€šè¿‡ç±»çš„ å®ä¾‹å¯¹è±¡ è®¿é—®ã€‚ console.log(C.a) ä¼šå¯¼è‡´æŠ¥é”™ï¼Œå› ä¸º a å¹¶ä¸æ˜¯ C è¿™ä¸ªç±»æœ¬èº«çš„å±æ€§ï¼Œè€Œæ˜¯å®ä¾‹çš„å±æ€§ã€‚ 3. console.log(c.a) æ­£å¸¸è¾“å‡º 123 1console.log(c.a); // è¾“å‡º: 123 c æ˜¯ C ç±»çš„ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œc.a æ˜¯è®¿é—® C ç±»å®ä¾‹ä¸Šçš„å±æ€§ aã€‚ ç”±äº a æ˜¯å®ä¾‹å±æ€§ï¼Œæ‰€ä»¥ä½ å¯ä»¥é€šè¿‡ c.a æ­£å¸¸è®¿é—®åˆ°å€¼ &quot;123&quot;ã€‚ 4. console.log(c instanceof C) è¾“å‡º true 1console.log(c instanceof C); // è¾“å‡º: true instanceof è¿ç®—ç¬¦ç”¨äºæ£€æŸ¥å¯¹è±¡æ˜¯å¦æ˜¯æŸä¸ªç±»çš„å®ä¾‹ã€‚ c instanceof C è¿”å› trueï¼Œè¯´æ˜ c ç¡®å®æ˜¯ C ç±»çš„å®ä¾‹ã€‚instanceof ä¼šæ£€æŸ¥ c æ˜¯å¦æ˜¯é€šè¿‡ C æ„é€ å‡½æ•°åˆ›å»ºçš„å¯¹è±¡ï¼Œæˆ–è€…æ˜¯å¦ä½äº C çš„åŸå‹é“¾ä¸Šã€‚ æ€»ç»“ C æ˜¯æ„é€ å‡½æ•°ï¼šç±» C åœ¨ TypeScript å’Œ JavaScript ä¸­æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚é€šè¿‡ new C() åˆ›å»ºçš„å¯¹è±¡æ‰æ˜¯ C ç±»çš„å®ä¾‹ã€‚ å®ä¾‹å±æ€§ vs. ç±»å±æ€§ï¼ša æ˜¯ç±»çš„å®ä¾‹å±æ€§ï¼Œå› æ­¤åªèƒ½é€šè¿‡ç±»çš„å®ä¾‹æ¥è®¿é—®ï¼›è€Œ C æ˜¯ç±»æœ¬èº«çš„æ„é€ å‡½æ•°ï¼Œä¸åŒ…å«å®ä¾‹å±æ€§ aã€‚ instanceof è¿ç®—ç¬¦ï¼šc instanceof C æ£€æŸ¥å¯¹è±¡ c æ˜¯å¦æ˜¯ C ç±»çš„å®ä¾‹ï¼Œè¿”å› true è¡¨ç¤º c æ˜¯é€šè¿‡ C æ„é€ å‡½æ•°åˆ›å»ºçš„ã€‚ æ‰€ä»¥ï¼Œé”™è¯¯çš„æ ¹æºæ˜¯å°† C ç±»æœ¬èº«è¯¯è®¤ä¸ºæ˜¯å®ä¾‹å¯¹è±¡ï¼Œè¯•å›¾ç›´æ¥è®¿é—® aã€‚è€Œå®é™… a æ˜¯ C ç±»å®ä¾‹çš„å±æ€§ï¼Œå¿…é¡»é€šè¿‡å®ä¾‹å¯¹è±¡ï¼ˆå¦‚ c.aï¼‰æ¥è®¿é—®ã€‚
`,url:"https://hugo-dead-simple.netlify.com/typescript/%E7%90%86%E8%A7%A3%E7%B1%BB%E5%A3%B0%E6%98%8E%E5%80%BC%E4%B8%8E%E7%B1%BB%E5%9E%8B/"},"https://hugo-dead-simple.netlify.com/typescript/src/decorator/":{title:"è£…é¥°å™¨",tags:[],content:`è£…é¥°å™¨ï¼ˆDecoratorï¼‰æ˜¯ä¸€ç§è¯­æ³•ç»“æ„ï¼Œç”¨æ¥åœ¨å®šä¹‰æ—¶ä¿®æ”¹ç±»ï¼ˆclassï¼‰çš„è¡Œä¸ºã€‚
æˆ‘çš„ç»“æ„
è£…é¥°å™¨æ˜¯ä¸€ä¸ªå‡½æ•°,æœ¬è´¨æ˜¯å¯¹ç±»è¿›è¡Œä¿®æ”¹(Decorator),ç„¶åå¾—åˆ°ä¸€ä¸ªæ–°çš„ç±»,ä½¿è¿™ä¸ªç±»,æœ‰æ–°çš„åŠŸèƒ½.
index
è¦ä½¿ç”¨è¿™ä¸ªä»£ç ,éœ€è¦é…ç½®tsconfig.json
1&#34;experimentalDecorators&#34;: true, /* Enable experimental support for legacy experimental decorators. */ `,url:"https://hugo-dead-simple.netlify.com/typescript/src/decorator/"},"https://hugo-dead-simple.netlify.com/blog/":{title:"Blogs",tags:[],content:"",url:"https://hugo-dead-simple.netlify.com/blog/"},"https://hugo-dead-simple.netlify.com/blog/newnew/":{title:"Newnew",tags:[],content:`test git action webhook
`,url:"https://hugo-dead-simple.netlify.com/blog/newnew/"},"https://hugo-dead-simple.netlify.com/blog/hugo%E8%87%AA%E5%8A%A8%E5%8F%91%E5%B8%83/":{title:"Hugoè‡ªåŠ¨å‘å¸ƒ",tags:[],content:`è‡ªåŠ¨deploy blog åˆ°github å‚è€ƒ
https://letere-gzj.github.io/hugo-stack/p/hugo/custom-blog/#3-github%E9%83%A8%E7%BD%B2 å¯¹åº”çš„è§†é¢‘æ•™ç¨‹: https://www.bilibili.com/video/BV1bovfeaEtQ å¦ä¸€ä¸ª å¯ä»¥ å‘å¸ƒblogåˆ°vpsæœåŠ¡å™¨ ä¸‹é¢æ˜¯æ–°å¦å¤–ä¸€ä¸ªblog
æœ¬æ–‡ç”± ç®€æ‚¦ SimpRead è½¬ç ï¼Œ åŸæ–‡åœ°å€ blog.wjhwjhn.com
èƒŒæ™¯ æˆ‘ä¸€ç›´è®¡åˆ’è¿ç§»æˆ‘çš„åšå®¢ï¼Œä¸€æ–¹é¢æ˜¯è®¤ä¸ºä¹‹å‰ä¸»é¢˜çš„ä»£ç å±•ç¤ºèƒ½åŠ›ä¸å¼ºï¼Œæ–‡ç« çš„ä¿¡æ¯å¯†åº¦ä½ï¼Œä¸é€‚å®œäºæŠ€æœ¯å†…å®¹çš„å±•ç¤ºï¼›å¦ä¸€æ–¹é¢ï¼Œæˆ‘æ›¾è®¤ä¸ºæä¸ºå®‰å…¨çš„ Typechoï¼Œåœ¨ 2023 å¹´ 6 æœˆçˆ†å‡ºäº† XSS æ¼æ´ï¼Œè¿™åŠ å‰§äº†æˆ‘è¿ç§»çš„ç´§è¿«æ€§ã€‚
æ³¨æ„
æœ¬æ–‡æœ€åæ›´æ–°äº 2024-02-13ï¼Œæ–‡ä¸­å†…å®¹å¯èƒ½å·²è¿‡æ—¶ã€‚
èƒŒæ™¯ æˆ‘ä¸€ç›´è®¡åˆ’è¿ç§»æˆ‘çš„åšå®¢ï¼Œä¸€æ–¹é¢æ˜¯è®¤ä¸ºä¹‹å‰ä¸»é¢˜çš„ä»£ç å±•ç¤ºèƒ½åŠ›ä¸å¼ºï¼Œæ–‡ç« çš„ä¿¡æ¯å¯†åº¦ä½ï¼Œä¸é€‚å®œäºæŠ€æœ¯å†…å®¹çš„å±•ç¤ºï¼›å¦ä¸€æ–¹é¢ï¼Œæˆ‘æ›¾è®¤ä¸ºæä¸ºå®‰å…¨çš„ Typechoï¼Œåœ¨ 2023 å¹´ 6 æœˆçˆ†å‡ºäº† XSS æ¼æ´ï¼Œè¿™åŠ å‰§äº†æˆ‘è¿ç§»çš„ç´§è¿«æ€§ã€‚é‰´äºæ­¤ï¼Œæˆ‘æ—©å°±è½¬å‘ä¸€æ¬¾æ—¢ç¾è§‚åˆå®ç”¨çš„é™æ€åšå®¢å¹³å°â€”â€”æˆ‘é€‰æ‹©äº† Hugoï¼Œå¹¶é€‰ç”¨äº† FixIt ä¸»é¢˜ã€‚æ°é€¢è¿‡å¹´ï¼Œæˆ‘æ‹¥æœ‰äº†è®¸å¤šç¢ç‰‡åŒ–çš„æ—¶é—´ï¼Œè¿™æˆä¸ºäº†æˆ‘è¿ç§»åšå®¢çš„ç»ä½³æ—¶æœºã€‚
é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ åœ¨è¿ç§»åšå®¢çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘é‡åˆ°äº†ä¸€ç³»åˆ—é—®é¢˜ã€‚ä¸ºäº†å¸®åŠ©åŒæ ·é¢å¯¹è¿™äº›æŒ‘æˆ˜çš„è¯»è€…ï¼Œæˆ‘åœ¨ä¸‹é¢è¯¦ç»†è®°å½•äº†æˆ‘æ‰€é¢ä¸´çš„é—®é¢˜ä»¥åŠæˆ‘é‡‡å–çš„è§£å†³æªæ–½ï¼Œå¸Œæœ›è¿™äº›ç»éªŒèƒ½ä¸ºæ‚¨æä¾›å®é™…çš„å¸®åŠ©å’ŒæŒ‡å¼•ã€‚
è­¦å‘Š
åœ¨è¿ç§»ä¹‹å‰ï¼Œè¯·åŠ¡å¿…å¤‡ä»½åŸæœ‰åšå®¢çš„æ–‡ä»¶å’Œæ•°æ®åº“æ•°æ®ï¼Œä»¥é˜²æ„å¤–å‘ç”Ÿã€‚
æ–‡ç« è¿ç§» æ–‡ç« å†…å®¹ï¼šæ–‡ç« å†…å®¹å‚¨å­˜åœ¨ typecho_contents è¡¨çš„ text å­—æ®µä¸­ï¼Œæå–æ¯”è¾ƒå®¹æ˜“ï¼Œåªéœ€è¦å»é™¤ &lt;!--markdown--&gt; æ ‡è®°å³å¯ï¼ŒåŸå…ˆç¼–å†™æ–‡ç« æ—¶å°±ä½¿ç”¨çš„æ˜¯ markdownï¼Œæ‰€ä»¥ç›´æ¥åˆ›å»ºæ–‡ä»¶å³å¯ï¼Œä¸è¿‡åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿé‡åˆ°äº†ä¸å°‘é—®é¢˜ åœ¨æˆ‘åˆšå»ºç«‹è¿™ä¸ªåšå®¢æ—¶ï¼Œå› ä¸ºå¯¹ markdown è¯­æ³•çš„ä¸ç†Ÿæ‚‰ï¼Œå¯¼è‡´ä»¥å‰çš„å¾ˆå¤šæ–‡ç« ä½¿ç”¨äº† markdown çš„æ–¹è¨€ã€‚è¿™äº›æ–‡ç« ï¼Œåœ¨ Typecho ä¸­æ˜¾ç¤ºæ­£å¸¸ï¼Œä½†æ˜¯åœ¨ Hugo ä¸­å°±å‡ºç°äº†æ’ç‰ˆé”™è¯¯ï¼Œå¥½åœ¨æœ‰é—®é¢˜çš„æ–‡ç« ä¸æ˜¯å¾ˆå¤šï¼Œè¿™é‡Œæ‰‹åŠ¨ç¼–è¾‘äº†ä¸€ä¸‹ï¼› åœ¨ Hugo ä¸­ï¼Œæ–‡ç« çš„å…ƒä¿¡æ¯ï¼ˆæ–‡ç« åˆ›å»ºæ—¶é—´ã€æ–‡ç« ç±»åˆ«ã€æ–‡ç« æ ‡é¢˜ç­‰â€¦ï¼‰éƒ½å†…åµŒæ–‡ç« å¼€å¤´çš„ yaml å…ƒä¿¡æ¯ä¸­ï¼Œè¿™äº›ä¿¡æ¯éœ€è¦ä» Typecho çš„æ•°æ®åº“ä¸­æå–å¹¶ç”Ÿæˆï¼Œä¾‹å¦‚ typecho_contents è¡¨çš„ created ã€modified ã€title å­—æ®µï¼› åŸå…ˆçš„ Typecho çš„ typecho_contents è¡¨çš„ status å­—æ®µï¼Œå¦‚æœæ˜¯é public çš„æ–‡ç« ï¼Œåˆ™è®¾ç½® hiddenFromHomePage: trueã€hiddenFromSearch: trueã€hiddenFromRss: trueã€hiddenFromRelated: true ä»¥åŠ password: {password} å¯†ç å­—æ®µï¼Œç”±ä¸»é¢˜è¿›è¡ŒåŠ å¯†å¤„ç†ã€‚ åŸåšå®¢é“¾æ¥è·³è½¬ é—®é¢˜ï¼šåŸåšå®¢çš„é“¾æ¥æ˜¯ä½¿ç”¨ /archives/{cid}/ è¿™ç§å½¢å¼çš„ï¼Œè€Œæ–°åšå®¢çš„é“¾æ¥æ˜¯ä½¿ç”¨ /posts/{name} è¿™ç§å½¢å¼çš„ï¼› è§£å†³æ–¹æ¡ˆï¼šåˆ©ç”¨æ–‡ç« å…ƒä¿¡æ¯ä¸­çš„ aliases å­—æ®µæ¥ç”Ÿæˆä¸€ä¸ªé¢å¤–çš„åˆ«åé“¾æ¥ã€‚ è¯„è®ºå’Œé˜…è¯»é‡è¿ç§» ä½¿ç”¨äº† Twikoo çš„è¯„è®ºç³»ç»Ÿï¼Œå¹¶è§£å†³äº†é“¾æ¥è½¬æ¢é—®é¢˜
Twikoo çš„è¯„è®ºç³»ç»Ÿè¿è¡Œåœ¨ docker è®¾å¤‡ä¸­ï¼Œå¹¶ä¸”æ˜ å°„åˆ° 8099 ç«¯å£ã€‚ä¸ºäº†å®‰å…¨æ€§ï¼Œæˆ‘ä½¿ç”¨ ufw å°†æ­¤ç«¯å£è®¾ç½®ä¸º denyï¼Œä½†å‘ç°æ— æ•ˆï¼Œåœ¨ xianyu çš„å¸®åŠ©ä¸‹ (Orz)ï¼Œä½¿ç”¨äº† ufw-dockerï¼Œå¹¶æˆåŠŸè§£å†³ï¼› å› ä¸º Twikoo åŸç”Ÿåªæ”¯æŒä½¿ç”¨ httpï¼Œè€Œæˆ‘çš„åšå®¢ä½¿ç”¨çš„æ˜¯ httpsï¼Œå¯¼è‡´ twikoo è¢« blockã€‚è¿™é‡Œä½¿ç”¨äº†åå‘ä»£ç†æ¥è§£å†³ï¼Œè®¾ç½®äº† https://blog.wjhwjhn.com/twikoo ä»£ç†åˆ° http://localhost:8099 ï¼› é˜…è¯»é‡æ˜¯æˆ‘åœ¨æ•°æ®åº“ä¸­æ–°å¢çš„ viewsNum å­—æ®µï¼Œæˆ‘è¿›è¡Œäº†å¯¼å‡ºç”Ÿæˆï¼Œå¹¶è½¬åŒ–ä¸º Twikoo çš„æ•°æ®æ ¼å¼ï¼› åœ¨è¯„è®ºå’Œé˜…è¯»é‡ä¸­éœ€è¦æä¾›æ–‡ç« çš„åœ°å€å’Œæ ‡é¢˜ï¼Œè€Œåœ¨æ•°æ®åº“ä¸­çš„éƒ½æ˜¯å…ˆå‰çš„åœ°å€å’Œæ ‡é¢˜ã€‚è¿™é‡Œç¼–å†™äº† Python è„šæœ¬ï¼Œé€»è¾‘å¦‚ä¸‹ åœ¨æ–°ç‰ˆåšå®¢ä¸­ï¼Œå»è®¿é—®åŸæ¥çš„è·¯å¾„ä¸‹è®¿é—® html æ–‡ä»¶ï¼ˆé€šè¿‡ aliases å­—æ®µç”Ÿæˆçš„è·³è½¬æ–‡ä»¶ï¼‰ï¼Œå¹¶ä½¿ç”¨æ­£åˆ™ï¼ˆmeta http-equiv=&quot;refresh&quot; content=&quot;0; url=http://[^/]+(/[^&quot;]+)&quot;ï¼‰å–å‡ºæ›´æ–°åçš„åœ°å€ã€‚ å‰å¾€æ–°ç‰ˆåšå®¢çš„åœ°å€ä¸‹ä½¿ç”¨æ­£åˆ™ï¼ˆ&lt;title&gt;([^&lt;]+)&lt;/title&gt;ï¼‰å–å‡ºæ ‡é¢˜ã€‚ å›¾ç‰‡é“¾æ¥ä¿®å¤ è®© ChatGPT ç¼–å†™æ­£åˆ™ï¼Œæå–å‡ºå›¾ç‰‡é“¾æ¥ï¼Œä»åŸæ¥çš„å›¾ç‰‡é“¾æ¥ä¸­ä¸‹è½½åˆ°æœ¬åœ°ï¼Œå¹¶æ›¿æ¢åŸæœ‰é“¾æ¥
å‘ç°ä»¥å‰æœ‰éƒ¨åˆ†æ—§æ–‡ç« çš„å›¾ç‰‡ä½¿ç”¨çš„æ˜¯ httpï¼Œå¯¼è‡´å›¾ç‰‡æ— æ³•è®¿é—®ï¼Œç¼–å†™äº† SQL è¯­å¥è¿›è¡Œäº†æ›¿æ¢ UPDATE typecho_contents SET text = REPLACE(text, 'http://blog.wjhwjhn', 'https://blog.wjhwjhn');ã€‚ å‘ç°ä»¥å‰æœ‰éƒ¨åˆ†å›¾ç‰‡æ— æ³•è®¿é—®åˆ°ï¼šä¹‹å‰æœ‰è¿‡ä¸€æ®µæ—¶é—´çš„åšå®¢æ–‡ç« ç¼–å†™æ˜¯åœ¨çŸ³å¢¨ä¸Šçš„ï¼Œè€ŒçŸ³å¢¨çš„å¯¼å‡º markdown åŠŸèƒ½ä¹Ÿç»è¿‡ä¸¤æ¬¡çš„è½¬å˜ æˆ‘æœ€æ—©æ¥è§¦çš„æ—¶å€™ï¼ŒçŸ³å¢¨çš„å¯¼å‡ºåŠŸèƒ½æ˜¯å¯ä»¥ç›´æ¥å¯¼å‡ºæ–‡ç« å†…çš„å›¾ç‰‡çš„ï¼Œå¹¶ä¸”ä½¿ç”¨äº†çŸ³å¢¨çš„å›¾ç‰‡å‚¨å­˜æœåŠ¡é“¾æ¥ï¼› ä¼°è®¡åæ¥çŸ³å¢¨å‘ç°ç›—é“¾çš„äººè¿‡å¤šï¼Œäºæ˜¯å¯¹è®¿é—®æ¥æºåšäº†æ£€æµ‹ï¼Œå¯¼è‡´äº†æˆ‘å½“æ—¶æœ‰å¤§é‡çš„åšå®¢å›¾ç‰‡æ— æ³•è®¿é—®ã€‚æˆ‘ç¼–å†™äº†ä¸€ä¸ªæ’ä»¶ï¼Œåœ¨å¯¼å…¥æ—¶å¯¹æ–‡ç« å†…å¤–é“¾å›¾ç‰‡è¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœå­˜åœ¨å¤–é“¾å›¾ç‰‡ï¼Œåˆ™ä¸‹è½½åˆ°æœ¬åœ°å¹¶æ›¿æ¢é“¾æ¥ï¼Œå…·ä½“å†…å®¹æŸ¥çœ‹ åšå®¢å¤–é“¾å›¾ç‰‡å·²æ¢å¤ è¿™ç¯‡æ–‡ç« ï¼› å†åé¢æ–‡ç« å†…å›¾ç‰‡ä½¿ç”¨ base64 è¿›è¡Œç¼–ç åµŒå…¥åœ¨ markdown æ–‡ä»¶ä¸­ï¼Œä½†å¦‚æœå›¾ç‰‡è¿‡å¤§ï¼Œmarkdown æ–‡ä»¶è¿‡å¤§ï¼Œç”šè‡³æ— æ³•åœ¨ Typecho ä¸­å‚¨å­˜ã€‚å› æ­¤æˆ‘ä¹Ÿå°±ä¸ç”¨çŸ³å¢¨å†™æ–‡ç« äº†ï¼Œé€šå¸¸ä¼šåœ¨æœ¬åœ° (ä½¿ç”¨æœ¬åœ°å›¾åºŠ) å†™å¥½æ–‡ç« ï¼Œç„¶åé€šè¿‡æ’ä»¶è‡ªåŠ¨ä¸‹è½½å›¾åºŠå›¾ç‰‡å¹¶ä¿®æ­£åˆ°æœ¬åœ°é“¾æ¥ï¼› æ’ä»¶çš„é²æ£’æ€§ä¸ä½³ï¼Œå­˜åœ¨ä¸‹è½½å¤±è´¥çš„æƒ…å†µï¼Œä¸è¿‡å¥½åœ¨ä¸‹è½½å¤±è´¥çš„æƒ…å†µä¸å¤šï¼Œæˆ‘æ‰‹åŠ¨è¡¥äº†å‡ å¼ å›¾ç‰‡å°±è§£å†³äº†ã€‚ markdown å†…å›¾ç‰‡é“¾æ¥æå–ï¼Œä¸€èˆ¬åˆ†ä¸ºä¸¤ç§å½¢å¼ï¼Œéƒ½æ˜¯ä½¿ç”¨æ­£åˆ™æ¥åŒ¹é… ç›´æ¥åµŒå…¥çš„å›¾ç‰‡![{text}]({url})ï¼ŒåŒ¹é…æ­£åˆ™ï¼š!\\[.*?\\]\\((.*?)\\)ï¼› åœ¨æ–‡ç« åº•éƒ¨ä½¿ç”¨ [{id}]:{url} å®šä¹‰äº†ä¸€ä¸ªè„šæ³¨æˆ–å¼•ç”¨é“¾æ¥ï¼Œåœ¨ä½¿ç”¨æ—¶ä½¿ç”¨ ![{text}][{id}] æ¥å¼•ç”¨ï¼ŒåŒ¹é…æ­£åˆ™ï¼š\\[\\d+\\]:\\s*(.*?)\\s*(?=&quot;#|$)ã€‚ GitHub Action è­¦å‘Š
ä¸ºç¡®ä¿ä¸æ‚¨çš„æœåŠ¡å™¨é…ç½®ã€ä»“åº“è·¯å¾„å’Œç‰¹å®šéœ€æ±‚ç›¸åŒ¹é…ï¼Œè¯·é€‚å½“ä¿®æ”¹ä»¥ä¸‹ä»£ç æ®µã€‚é¿å…ç›´æ¥å¤åˆ¶ç²˜è´´ï¼Œä»¥é¢„é˜²æ½œåœ¨çš„å…¼å®¹æ€§é—®é¢˜æˆ–é…ç½®é”™è¯¯ã€‚
åœ¨è¿‡å»çš„åšå®¢ä¸­ï¼Œå‘å¸ƒæ–‡ç« ä»…éœ€åœ¨åå°ç¼–è¾‘åç›´æ¥å‘é€ï¼Œä¾¿å¯ç«‹å³åœ¨é¡µé¢ä¸Šçœ‹åˆ°æ•ˆæœã€‚ç„¶è€Œï¼Œè‡ªä»è½¬æ¢åˆ°é™æ€åšå®¢å¹³å°åï¼ŒåŸæœ¬ç®€æ´çš„å‘å¸ƒæµç¨‹å˜å¾—å¤æ‚ã€‚ç»è¿‡å‚è€ƒä¼—å¤šæ–‡ç« ä¸èµ„æ–™ï¼Œæˆ‘ç›®å‰é‡‡ç”¨äº† GitHub Action æ¥ç®€åŒ–è¿™ä¸€æµç¨‹ã€‚
æ–°å¢æ–‡ç« æµç¨‹ åœ¨æœ¬åœ°æ“ä½œ Hugo æ–°å¢æ–‡ç« ï¼Œå¹¶ä½¿ç”¨ git è¿›è¡Œç®¡ç†ï¼Œå¹¶ push åˆ° GitHub ä¸Šï¼› GitHub Action æ£€æµ‹åˆ° push å¹¶è‡ªåŠ¨æ‰§è¡Œç¼–è¯‘ï¼Œç¼–è¯‘åçš„é¡µé¢ç»“æœå­˜æ”¾åœ¨ gh-pages åˆ†æ”¯ä¸­ï¼› ç¼–è¯‘å®Œæ¯•åï¼ŒGitHub Action ä½¿ç”¨ Webhook é€šçŸ¥åšå®¢æœåŠ¡å™¨æ¥ GitHub ä¸Šæ‹‰å– gh-pages çš„åšå®¢æ•°æ®ã€‚ å› ä¸ºæˆ‘çš„ GitHub ä»“åº“æ˜¯ç§æœ‰çš„ï¼Œæ‰€ä»¥è¿˜éœ€è¦æŠŠåšå®¢æœåŠ¡å™¨çš„ SSH keys æ·»åŠ åˆ° GitHubï¼Œæ‰èƒ½å¤Ÿæ‹‰å–ç§æœ‰ä»“åº“ã€‚
GitHub Action ä»£ç æµç¨‹ é…ç½®è§£è¯»
å½“ master åˆ†æ”¯è¢« push æ—¶è‡ªåŠ¨æ‰§è¡Œï¼› è¿è¡Œåœ¨ Ubuntu-22.04 çš„ç¯å¢ƒä¸Šï¼› ä½¿ç”¨ Hugo æœ€æ–°æ‰©å±•ç‰ˆå¯¹åšå®¢æºæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼› å°†ç¼–è¯‘åçš„ public æ–‡ä»¶å¤¹éƒ¨ç½²åˆ° gh-pages åˆ†æ”¯ä¸Šï¼› é€šè¿‡ Webhook æ¥é€šçŸ¥åšå®¢æœåŠ¡å™¨æ¥åŒæ­¥æœ€æ–°çš„é™æ€é¡µé¢æ•°æ®ã€‚ 1name: GitHub Pages 2 3on: 4 push: 5 branches: 6 - master # Set a branch to deploy 7 pull_request: 8 9jobs: 10 deploy: 11 runs-on: ubuntu-22.04 12 concurrency: 13 group: \${{ github.workflow }}-\${{ github.ref }} 14 steps: 15 - uses: actions/checkout@v4 16 with: 17 submodules: true # Fetch Hugo themes (true OR recursive) 18 fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod 19 20 - name: Setup Hugo 21 uses: peaceiris/actions-hugo@v2 22 with: 23 hugo-version: &#39;latest&#39; 24 extended: true 25 26 - name: Build 27 run: hugo --minify 28 29 - name: Deploy 30 uses: peaceiris/actions-gh-pages@v3 31 if: github.ref == &#39;refs/heads/master&#39; 32 with: 33 github_token: \${{ secrets.GH_TOKEN }} 34 publish_dir: ./public 35 36 - name: Update Blog Server 37 uses: distributhor/workflow-webhook@v1 38 env: 39 webhook_url: \${{ secrets.WEBHOOK_URL }} 40 webhook_secret: \${{ secrets.WEBHOOK_SECRET }} å®é™…æ•ˆæœå±•ç¤º
Webhook æ‰§è¡Œè„šæœ¬ 1#!/bin/bash 2 3# Start of the script 4echo &#34;$(date &#34;+%Y-%m-%d %H:%M:%S&#34;) Run&#34; 5 6# Define variables 7gitPath=&#34;/www/wwwroot/newblog&#34; 8gitSSH=&#34;git@github.com:wjhwjhn/blog.git&#34; 9 10echo &#34;Web site path: $gitPath&#34; 11 12# Check if the directory exists 13if [ -d &#34;$gitPath&#34; ]; then 14 # Attempt to enter the directory 15 cd &#34;$gitPath&#34; || { echo &#34;Failed to enter directory $gitPath&#34;; exit 1; } 16 17 echo &#34;------&#34; 18 # Check if .git needs to be cloned 19 if [ ! -d &#34;.git&#34; ]; then 20 echo &#34;Cloning git into this directory&#34; 21 if git clone -b gh-pages &#34;$gitSSH&#34; gittemp &amp;&amp; mv gittemp/.git . &amp;&amp; rm -rf gittemp; then 22 echo &#34;Clone successful&#34; 23 else 24 echo &#34;Clone failed&#34; 25 exit 1 26 fi 27 fi 28 29 # Update the git repository 30 if git reset --hard gh-pages &amp;&amp; git pull; then 31 echo &#34;Update successful&#34; 32 else 33 echo &#34;Update failed&#34; 34 exit 1 35 fi 36 37 # Change ownership 38 chown -R www:www &#34;$gitPath&#34; 39 echo &#34;Finish&#34; 40else 41 echo &#34;The project path does not exist&#34; 42 echo &#34;Finish&#34; 43fi Typora å›¾ç‰‡è®¾ç½® Typora æ”¯æŒä¾¿æ·åœ°åœ¨æœ¬åœ°ä¿å­˜æ–‡ä»¶ã€‚ä½†æ˜¯å¦‚æœè®¾ç½®ä¸å½“ï¼Œå®ƒå¯èƒ½æ— æ³•å…¼å®¹ Hugo çš„å›¾ç‰‡å­˜å‚¨æ–¹å¼ï¼Œè¿™é‡Œå¯¹ Typora çš„é…ç½®åšäº†ä»¥ä¸‹è°ƒæ•´
æ ¼å¼ -&gt; å›¾åƒ -&gt; è®¾ç½®å›¾ç‰‡æ ¹ç›®å½•ï¼Œè®¾ç½®ç›®å½•ä¸º Hugo æºæ–‡ä»¶ä¸‹çš„ static æ–‡ä»¶å¤¹
åå¥½è®¾ç½® -&gt; å›¾åƒ -&gt; æ’å…¥å›¾ç‰‡å¤„è®¾ç½®è·¯å¾„ä¸º Hugo æºæ–‡ä»¶ä¸‹çš„ static\\images\\ æ–‡ä»¶å¤¹
è®¾ç½®å®Œæ¯•åï¼Œåœ¨ Typora ä¸­ Ctrl + V ç²˜è´´å›¾ç‰‡å°±ä¼šè‡ªåŠ¨ä»¥ /images/xxx.png çš„é“¾æ¥å‘ˆç°ï¼Œå¹¶æŠŠå›¾ç‰‡ä¿å­˜åœ¨ static\\images\\ æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªå›¾ç‰‡é“¾æ¥å½¢å¼åœ¨ Typora ä¸­å’Œ Hugo åšå®¢ä¸­éƒ½å¯ä»¥æ­£å¸¸æµè§ˆã€‚
æ€»ç»“ æ­¤æ¬¡è¿ç§»å†æ—¶ä¸‰å¤©ï¼Œè¿‡ç¨‹ä¸­è™½ç„¶é‡åˆ°äº†ä¸å°‘æŒ‘æˆ˜ï¼Œä½†ä¹Ÿæ”¶è·é¢‡ä¸°ã€‚é€šè¿‡æå‡ºé—®é¢˜ã€æ„æ€è§£å†³æ–¹æ¡ˆï¼Œä»¥åŠè¿ç”¨ç¼–ç¨‹æŠ€æœ¯è§£å†³å®é™…é—®é¢˜çš„è¿‡ç¨‹ï¼Œä¸ºæˆ‘å¸¦æ¥äº†æå¤§çš„æ»¡è¶³æ„Ÿã€‚
å››å¹´å‰ï¼Œæˆ‘å»ºç«‹äº†è¿™ä¸ªåšå®¢ï¼Œé‚£æ—¶å¯¹ Linux çš„æ“ä½œæ„Ÿåˆ°æåº¦ç•æƒ§ï¼Œæˆ‘çš„ç†è§£ä¹Ÿä»…é™äºä¹¦æœ¬çŸ¥è¯†ã€‚åœ¨è¿‡å»çš„å››å¹´ä¸­ï¼Œæˆ‘å¯¹ Linuxï¼ˆå°¤å…¶æ˜¯ Ubuntuï¼‰çš„äº†è§£å’Œç†Ÿæ‚‰ç¨‹åº¦æœ‰äº†æ˜¾è‘—æé«˜ï¼Œé€æ¸ä½“ä¼šåˆ°äº†ç±» Unix ç³»ç»Ÿçš„ç‹¬ç‰¹é­…åŠ›ã€‚ä¸æ­¤åŒæ—¶ï¼Œæˆ‘çš„äº‘æœåŠ¡å™¨ä¹Ÿä»æœ€åˆä»¥ Windows ç³»ç»Ÿä¸ºä¸»ã€Linux ç³»ç»Ÿä¸ºè¾…ï¼Œè½¬å˜ä¸ºå…¨é¢é‡‡ç”¨ Linux ç³»ç»Ÿã€‚
ç°åœ¨ï¼Œå›é¡¾èµ·æˆ‘å½“åˆé…ç½®çš„æœåŠ¡å™¨ï¼Œæˆ‘æ„è¯†åˆ°äº†è®¸å¤šå®‰å…¨ä¸Šçš„ç–æ¼ï¼ŒåŒæ ·ï¼Œé‡æ–°å®¡è§†æˆ‘æ—©æœŸçš„æ–‡ç« æ—¶ï¼Œæˆ‘ä¹Ÿæ„è¯†åˆ°äº†å½“æ—¶çš„è§†é‡å±€é™å’Œæ€ç»´çš„ç¨šå«©ã€‚æˆ‘ç›¸ä¿¡ï¼Œå››å¹´åçš„è‡ªå·±å†å›çœ‹ä»Šæ—¥æ‰€åšï¼Œå¯èƒ½ä¼šå¯¹æŸäº›å†³å®šæ„Ÿåˆ°å¯ç¬‘æˆ–æœ‰æ‰€é—æ†¾ã€‚ç„¶è€Œï¼Œæˆ‘è®¤ä¸ºè¿™æ­£ä½“ç°äº†äººç”Ÿçš„ä¸€ç¯â€”â€”æŒç»­å­¦ä¹ ï¼Œå›æœ›è¿‡å¾€ï¼Œå¯¹æ›¾ç»çš„è‡ªå·±ä¼šå¿ƒä¸€ç¬‘ã€‚
`,url:"https://hugo-dead-simple.netlify.com/blog/hugo%E8%87%AA%E5%8A%A8%E5%8F%91%E5%B8%83/"},"https://hugo-dead-simple.netlify.com/posts/my-first-post/":{title:"My First Post",tags:[],content:`hdsdf
`,url:"https://hugo-dead-simple.netlify.com/posts/my-first-post/"},"https://hugo-dead-simple.netlify.com/posts/":{title:"Posts",tags:[],content:"",url:"https://hugo-dead-simple.netlify.com/posts/"},"https://hugo-dead-simple.netlify.com/blog/helloworld/":{title:"Helloworld",tags:[],content:`hello world write by Rainboy
`,url:"https://hugo-dead-simple.netlify.com/blog/helloworld/"},"https://hugo-dead-simple.netlify.com/%E7%AE%97%E6%B3%95%E7%AB%9E%E8%B5%9B%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/chapter_1/":{title:"ç¬¬ä¸€ç«  0x00 åŸºæœ¬ç®—æ³•",tags:[],content:`0x01 ä½è¿ç®— a^b æ ‡å‡†å¿«é€Ÿå¹‚å–ä½™ 64ä½æ•´æ•°ä¹˜æ³• 1018Ã—101810^{18} \\times 10^{18}1018Ã—1018 å¤§æ•°ç›¸ä¹˜ï¼Œè¶…è¿‡èŒƒå›´ï¼Œæ˜¯1å°±åŠ ï¼Œbaseå¢å¢ æœ€çŸ­Hamiltonè·¯å¾„: é›†åˆï¼ŒçŠ¶å‹DP èµ·åºŠå›°éš¾ç»¼åˆç—‡ é€šè¿‡æš´åŠ›éªŒè¯ ä¸ç¬¦åˆ äº¤æ¢å¾‹ åˆ©ç”¨ä½è¿ç®—çš„æ€§è´¨: ç¬¬kkkä½ç½®çš„çš„è¿ç®—ä¸ä¼šå½±å“å…¶å®ƒä½ æ—¶é—´32Ã—2Ã—10532 \\times 2 \\times 10 ^532Ã—2Ã—105 0x02 é€’æ¨ä¸é€’å½’ 01åºåˆ—: å­é›†æšä¸¾
æ’åˆ—,å…¨æ’åˆ— Strange Towers of Hanoi Sumdiv ? Fractal Streets ? 0x03 å‰ç¼€å’Œä¸å·®åˆ† å‰ç¼€å’Œä¸å·®åˆ†ä¸€å¯¹äº’é€†æ˜ å°„,å¯¹åº”çš„åºåˆ—ä¸€ä¸€å¯¹åº” ä»»ä½•åœ¨åŸåºåˆ—ä¸Šçš„åŒºé—´æ“ä½œéƒ½å¯ä»¥è½¬æˆå‰ç¼€å’Œåºåˆ—(subseqsub seqsubseq)çš„ä¸€å¯¹å•ç‚¹æ“ä½œ åº”ç”¨ å¤šä¸ªåŒºé—´ï¼Œå¤šä¸ªç‚¹ ,æŸä¸ªåŒºé—´æ˜¯å¦å«æœ‰ç‚¹ 0x05 äºŒåˆ† äºŒåˆ†å¸¸ç”¨åº”ç”¨ ç¬¬ä¸€ä¸ª/æœ€åä¸€ä¸ªå…ƒç´ xå‡ºç°çš„ä½ç½® æŸä¸ªå…ƒç´ çš„æ•°é‡ ä¸åœ¨åŒºé—´ä¸­çš„ç‚¹ï¼š å¤šä¸ªåŒºé—´ï¼Œå¤šä¸ªç‚¹ï¼Œåˆ¤æ–­æŸä¸€ä¸ªç‚¹æ˜¯å¦åœ¨ä»»ä¸€åŒºé—´é‡Œ æ–¹æ³•: äºŒåˆ†è¿‡æ»¤å‡ºli&lt;dotl_i &lt; dotliâ€‹&lt;dotçš„åŒºé—´,max_right(i)=maxâ¡1â‰¤jâ‰¤i{rj}&gt;dotmax\\_right(i) = \\max_{1 \\le j \\le i} \\{r_j\\} &gt; dot max_right(i)=max1â‰¤jâ‰¤iâ€‹{rjâ€‹}&gt;dot è¡¨æ˜ç‚¹ dotdotdotåœ¨æŸä¸€ä¸ªåŒºé—´å†… Best Cow Fences Ã—1000\\times 1000Ã—1000ç„¶åè¾“å‡º,è¯´æ˜ä¿ç•™ä¸‰ä½ç²¾åº¦,é‚£ä¹ˆç­”æ¡ˆä¸æ˜¯ç²¾ç¡®ç®—å‡ºæ¥çš„,æ˜¯é€¼è¿‘çš„,èƒ½é€¼è¿‘çš„ç®—æ³•: å®æ•°äºŒåˆ† P,Qå…¬å…±æ¡ä»¶( &gt;=L ) è‹¥P: aåºåˆ—çš„æœ€å¤§å¹³å‡æ•°æ˜¯ave åˆ™Q: béœ€è¦ maxsum_subseq = 0 P =&gt; Q P1: aåºåˆ—çš„æœ€å¤§å¹³å‡æ•°æ˜¯ave,ä¸” x &lt; ave,Q1: b( [bi | bi = ai-x ]). maxsum_subseq &gt; 0: P1â‡’Q1P1 \\Rightarrow Q1P1â‡’Q1 åˆ©ç”¨DPå•è°ƒæ€§(æ»‘åŠ¨çª—å£,è½¬ç§»åŒºé—´åªåŠ ) : å­˜åœ¨O(n)çš„ç®—æ³•æ±‚å‡ºæœ€å¤§(&gt;=L)çš„æœ€å¤§å­—æ®µå’Œ æ€»ç»“:äºŒåˆ†ç­”æ¡ˆ: æœ€å¤§å­æ®µå’Œ(båºåˆ—)ä¸ æœ€å¤§å­—æ®µå¹³å‡æ•°(aåºåˆ—)ç›´æ¥çš„å…³ç³»: maxsubseqb&gt;0â‡’max_ave(seqa)&lt;xmax_subseq b &gt; 0 \\Rightarrow max\\_ave(seq a) &lt; xmaxsâ€‹ubseqb&gt;0â‡’max_ave(seqa)&lt;x ,[biâˆ£bi=aiâˆ’x][b_i | b_i = a_i - x][biâ€‹âˆ£biâ€‹=aiâ€‹âˆ’x] Innovative Business TODO
0x05 æ’åº é¢˜ç›®Cinema äºŒç»´å…ƒç»„å¤§å°æ¯”è¾ƒ, éœ€è¦ç¦»æ•£åŒ–(O(logn)O(logn)O(logn)),å†æ¥æ‰«ä¸€éO(n)O(n)O(n)
é¢˜ç›®è´§ä»“é€‰å€ è¯æ˜: åˆ›å»ºç‚¹x,ä½¿å¾—xåˆ°æ•°è½´ä¸Šå…¶å®ƒçš„è·ç¦»å’Œæœ€å°
è¯æ˜: é€’å½’,æ•°å­¦å½’çº³
a---b ä¸¤ä¸ªçš„ç‚¹æ—¶ç­”æ¡ˆé›†åˆä¸º[a,b][a,b][a,b],åˆ†ç±»è®¨è®º a--b--c--d,4ä¸ªç‚¹æ—¶,æœ€å¤–å±‚çš„a,bç­”æ¡ˆ(è´¡çŒ®)[a,b][a,b][a,b],å½“ä¿è¯æœ€ç»ˆç­”æ¡ˆansâˆˆ[a,b]ans \\in [a,b]ansâˆˆ[a,b]æ—¶,å°±å˜æˆäº†ä¸¤ä¸ªç‚¹b--cçš„å­é—®é¢˜,ä¸”[b,c]âŠ‚[a,b][b,c] \\subset [a,b][b,c]âŠ‚[a,b](è´ªå¿ƒ: å†³ç­–åŒ…å®¹æ€§) å¥‡æ•°ä¸ªç‚¹,å¯ä»¥æŠŠä¸­é—´çš„é‚£ä¸ªç‚¹å½“æˆ:ä¸¤ä¸ªé‡åˆçš„ç‚¹,äºæ˜¯å¥‡æ•°å˜æˆå¶æ•°. ä¸ƒå¤•ç¥­ å‰æé¢˜ç›®:
å¤šä¸ªå‡åˆ†çº¸ç‰Œ: luogu P1031 T565389 ç¯å½¢ P2125 P2512 è¯æ˜: å¯æ‹†æ€§: æœ€ä¼˜ç­”æ¡ˆä¸å¯èƒ½æˆç¯(å­˜åœ¨ç›¸é‚»ä¸¤ä¸ªäºº,ä¸ä¼ é€’) 1TODO `,url:"https://hugo-dead-simple.netlify.com/%E7%AE%97%E6%B3%95%E7%AB%9E%E8%B5%9B%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/chapter_1/"},"https://hugo-dead-simple.netlify.com/group_theory/1%E7%AD%89%E4%BB%B7%E5%85%B3%E7%B3%BB%E4%B8%8E%E9%9B%86%E5%90%88%E7%9A%84%E5%88%86%E7%B1%BB/":{title:"1ç­‰ä»·å…³ç³»ä¸é›†åˆçš„åˆ†ç±»",tags:[],content:`å¯¹åº”è§†é¢‘çš„p1-p6
å®šä¹‰äºŒå…ƒå…³ç³»RRR ç­‰ä»·å…³ç³» åèº«æ€§ï¼šâˆ€aâ†’aRa\\forall a \\to aRaâˆ€aâ†’aRa å¯¹ç§°æ€§ï¼šaRbâ‡’bRaaRb \\Rightarrow bRaaRbâ‡’bRa ä¼ é€’æ€§ï¼šaRbâˆ§bRcâ‡’aRcaRb \\land bRc \\Rightarrow aRcaRbâˆ§bRcâ‡’aRc ç­‰ä»·ç±» å®šä¹‰ï¼š[a][a][a]è¡¨ç¤ºæ‰€æœ‰ä¸aaaç­‰ä»·çš„å…ƒç´ çš„é›†åˆ ç­‰ä»·ç±»æ˜¯æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„é›†åˆï¼šä»»æ„ä¸¤ä¸ªå…ƒç´ aaaå’Œbbbéƒ½å±äºåŒä¸€ä¸ªç­‰ä»·ç±»å½“ä¸”ä»…å½“aRbaRbaRb å…¬å¼å®šä¹‰: [a]={xâˆˆSâˆ£xRa}[a]= \\{ x \\in S | xRa \\}[a]={xâˆˆSâˆ£xRa} ç±»åœ¨è¿™é‡Œçš„æ„æ€ä¸º:&ldquo;ç‰©ä»¥ç¾¤åˆ†&rdquo;,åˆ†ç±»çš„æ„æ€,ç­‰ä»·ç±»å°±æ˜¯æŠŠæ»¡è¶³ç­‰ä»·å…³ç³»çš„å…ƒç´ å½’ä¸ºä¸€ç±». å•†é›†: SSSçš„å…¨ä½“ç­‰ä»·ç±»æ„æˆçš„é›†åˆ,é›†åˆSSSåœ¨ç­‰ä»·å…³ç³»ä¸‹çš„å•†é›†è®°ä½œS/âˆ½S / \\backsimS/âˆ½ é›†åˆçš„åˆ†ç±» å®šä¹‰ï¼šSSSæ˜¯ä¸€ä¸ªé›†åˆï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªç­‰ä»·å…³ç³»RRRä½¿å¾—SSSçš„æ‰€æœ‰å…ƒç´ éƒ½å¯ä»¥åˆ’åˆ†ä¸ºç­‰ä»·ç±»ï¼Œåˆ™ç§°SSSä¸ºRRRçš„åˆ†ç±» å¦‚æœéç©ºé›†åˆSSSæ˜¯å®ƒçš„æŸäº›ä¸¤ä¸¤ä¸ç›¸äº¤çš„éç©ºå­é›†çš„å¹¶,åˆ™ç§°è¿™äº›å­é›†ä¸ºé›†åˆSSSçš„ä¸€ç§åˆ†ç±»(partition),å…¶ä¸­æ¯ä¸ªå­é›†ç§°ä¸ºé›†åˆSSSçš„ä¸€ä¸ªç±»(class) è‹¥é›†åˆSSSçš„å­é›†æ—{Siâˆ£iâˆˆI}\\{S_i | i \\in I\\}{Siâ€‹âˆ£iâˆˆI}æ„æˆäº†Sçš„ä¸€ç§åˆ†ç±»å½“ä¸”ä»…å½“
S=â‹ƒiâˆˆISiS = \\bigcup_{i \\in I} S_iS=â‹ƒiâˆˆIâ€‹Siâ€‹ Siâˆ©Sj=âˆ…S_i \\cap S_j = \\varnothingSiâ€‹âˆ©Sjâ€‹=âˆ… (i.e., SiS_iSiâ€‹ and SjS_jSjâ€‹ are pairwise disjoint) é›†åˆSSSçš„ä»»ä½•ä¸€ç§ç­‰ä»·å…³ç³»éƒ½ç¡®å®šäº†SSSçš„ä¸€ç§åˆ†ç±»ã€‚
ä¾‹é¢˜ ä¾‹5 aRbâ‡”mâˆ£aâˆ’b,âˆ€a,bâˆˆZ(1) aRb \\Leftrightarrow m \\mid a - b , \\forall a,b \\in \\mathbb{Z} \\tag 1 aRbâ‡”mâˆ£aâˆ’b,âˆ€a,bâˆˆZ(1)è¯æ˜1å¼æ˜¯ç­‰ä»·å…³ç³».ä¹Ÿå°±æ˜¯è¯æ˜mâˆ£aâˆ’bm | a -b mâˆ£aâˆ’bæ˜¯ç­‰ä»·å…³ç³».
å…¬å¼çš„å«ä¹‰è§£é‡Š: mæ˜¯aä¸bå·®çš„å› å­,åˆ™è¯´æ˜a,bå¯¹äºmåŒä½™.è¿™ä¸¤è€…æ˜¯ç­‰ä»·çš„.
ä¸‹é¢è¯æ˜è¿™ä¸¤è€…æ˜¯ç­‰ä»·å…³ç³».
è®¾ A:aâ‰¡b(modâ€‰m)a \\equiv b (\\mod m)aâ‰¡b(modm), B: mâˆ£aâˆ’bm \\mid a-bmâˆ£aâˆ’b.
Aâ†’BA \\to BAâ†’B,æŠŠa,bå†™æˆå¸¦ä½™æ•°é™¤æ³•çš„å½¢å¼.
a=k1Ã—m+rb=k2Ã—m+raâˆ’b=m(k1âˆ’k2)â†’mâˆ£aâˆ’b a = k_1 \\times m + r \\\\ b = k_2 \\times m + r \\\\ a - b = m(k_1 - k_2) \\to m \\mid a - b a=k1â€‹Ã—m+rb=k2â€‹Ã—m+raâˆ’b=m(k1â€‹âˆ’k2â€‹)â†’mâˆ£aâˆ’bå¿…è¦æ€§è¯æ˜å®Œæ¯•,è¯æ˜å……åˆ†æ€§.
mâˆ£aâˆ’bâ†’aâˆ’b=kÃ—mâ†’a=b+kÃ—mâ†’amodâ€‰m=(b+kÃ—m)modâ€‰mâ†’amodâ€‰m=bmodâ€‰m m \\mid a - b \\\\ \\to a -b = k \\times m \\\\ \\to a = b + k \\times m \\\\ \\to a \\mod m = (b+k \\times m) \\mod m \\\\ \\to a \\mod m = b \\mod m mâˆ£aâˆ’bâ†’aâˆ’b=kÃ—mâ†’a=b+kÃ—mâ†’amodm=(b+kÃ—m)modmâ†’amodm=bmodmqed;
è¯æ˜è‡ªåæ€§:
aRaâ‡”mâˆ£aâˆ’a aRa \\Leftrightarrow m \\mid a - a aRaâ‡”mâˆ£aâˆ’aæ˜¾ç„¶æˆç«‹.
è¯æ˜å¯¹ç§°æ€§:
æ ¹æ® mâˆ£xâ†’mâˆ£âˆ’x m \\mid x \\to m \\mid -x mâˆ£xâ†’mâˆ£âˆ’xé‚£ä¹ˆ
mâˆ£aâˆ’bâ†’mâˆ£âˆ’(aâˆ’b)â†’mâˆ£bâˆ’a m \\mid a - b \\to m \\mid -(a - b) \\to m \\mid b - a mâˆ£aâˆ’bâ†’mâˆ£âˆ’(aâˆ’b)â†’mâˆ£bâˆ’aè¯æ˜ä¼ é€’æ€§:
mâˆ£aâˆ’bâˆ§mâˆ£bâˆ’câ†’mâˆ£aâˆ’cm | a - b \\land m| b - c \\to m | a - cmâˆ£aâˆ’bâˆ§mâˆ£bâˆ’câ†’mâˆ£aâˆ’c
a=k1Ã—m+rb=k2Ã—m+rc=k3Ã—m+râ†’aâˆ’c=k1Ã—m+râˆ’k3Ã—mâˆ’râ†’mâˆ£aâˆ’c a = k_1 \\times m + r \\\\ b = k_2 \\times m + r \\\\ c = k_3 \\times m + r \\\\ \\to a - c = k_1 \\times m + r - k_3 \\times m - r\\\\ \\to m \\mid a - c a=k1â€‹Ã—m+rb=k2â€‹Ã—m+rc=k3â€‹Ã—m+râ†’aâˆ’c=k1â€‹Ã—m+râˆ’k3â€‹Ã—mâˆ’râ†’mâˆ£aâˆ’cè¯æ˜å®Œæ¯•
è¯´æ˜åŒä½™æ˜¯ä¸€ç§ç­‰ä»·å…³ç³».
ä¹¦ä¸Šåˆå®šä¹‰äº†ä»€ä¹ˆå«åšåŒä½™å‰©ä½™ç±».
ä¾‹9 è¿™ä¸ªè§ä¹¦.
è¯¾åé¢˜ç›® ä¹ é¢˜1. è¯•åˆ†åˆ«ä¸¾å‡ºæ»¡è¶³ä¸‹åˆ—æ¡ä»¶çš„å…³ç³»ï¼š (1)æœ‰å¯¹ç§°æ€§ï¼Œä¼ é€’æ€§ï¼Œä½†æ— åèº«æ€§ï¼› (2)æœ‰åèº«æ€§ï¼Œä¼ é€’æ€§ï¼Œä½†æ— å¯¹ç§°æ€§ï¼› (3)æœ‰åèº«æ€§ï¼Œå¯¹ç§°æ€§ï¼Œä½†æ— ä¼ é€’æ€§. è§£:è®¾é›†åˆS={a,b,c}S = \\{a,b,c\\}S={a,b,c}
(1) ,R={(a,b),(b,a),(a,a),b,b}R = \\{(a,b),(b,a),(a,a),{b,b}\\}R={(a,b),(b,a),(a,a),b,b},å› ä¸ºæ²¡æœ‰(c,c)(c,c)(c,c)æ‰€ä»¥ä¸æ»¡è¶³åèº«æ€§. (2) ,R={(a,a),(b,b),(c,c),(a,b)}R = \\{(a,a),(b,b),(c,c),(a,b)\\}R={(a,a),(b,b),(c,c),(a,b)},å› ä¸ºæ²¡æœ‰(b,a)(b,a)(b,a)æ‰€ä»¥ä¸æ»¡è¶³å¯¹ç§°æ€§. (3) ,R={(a,a),(b,b),(c,c),(a,b),(b,a),(c,a),(c,b)}R = \\{(a,a),(b,b),(c,c),(a,b),(b,a),(c,a),(c,b)\\}R={(a,a),(b,b),(c,c),(a,b),(b,a),(c,a),(c,b)},å› ä¸ºæ²¡æœ‰(a,c)(a,c)(a,c)æ‰€ä»¥ä¸æ»¡è¶³ä¼ é€’æ€§. ä¹ é¢˜2.æ‰¾å‡ºä¸‹é¢è¯æ˜ä¸­çš„é”™è¯¯ï¼š æœ‰äººæ–­è¨€ï¼Œè‹¥Sçš„å…³ç³»Ræœ‰å¯¹ç§°æ€§å’Œä¼ é€’æ€§ï¼Œåˆ™å¿…æœ‰åèº«æ€§.è¿™æ™¨å›  ä¸ºï¼Œå¯¹ä»»æ„çš„aâˆˆS,ç”±å¯¹ç§°æ€§ï¼Œå¦‚æœaRb,åˆ™bRa.å†ç”±ä¼ é€’æ€§ï¼Œå¾—aRa,æ‰€ ä»¥Ræœ‰åèº«æ€§.
å…³é”®åœ¨äºaâˆˆSa \\in SaâˆˆSï¼Œä½†å¦‚æœaaaå°±æ²¡æœ‰è‡ªå·±çš„å…³ç³»å‘¢?ä¾‹å¦‚ä¹ é¢˜1çš„(1),å°±æ²¡æœ‰cçš„å…³ç³»,æ‰€ä»¥ä¸èƒ½è¯´Ræœ‰åèº«æ€§. å› ä¸ºä¸ä¸€å®šæœ‰cRbcRbcRbè¿™ä¸ªå…³ç³».
`,url:"https://hugo-dead-simple.netlify.com/group_theory/1%E7%AD%89%E4%BB%B7%E5%85%B3%E7%B3%BB%E4%B8%8E%E9%9B%86%E5%90%88%E7%9A%84%E5%88%86%E7%B1%BB/"},"https://hugo-dead-simple.netlify.com/group_theory/":{title:"Group_theories",tags:[],content:"",url:"https://hugo-dead-simple.netlify.com/group_theory/"},"https://hugo-dead-simple.netlify.com/typescript/preverseconstenums/":{title:"preserveConstEnumsç¼–è¯‘å™¨é€‰é¡¹",tags:["typescript"],content:`preserveConstEnums æ˜¯ TypeScript ç¼–è¯‘å™¨é€‰é¡¹ä¹‹ä¸€ï¼Œä½œç”¨æ˜¯æ§åˆ¶ TypeScript ç¼–è¯‘è¿‡ç¨‹ä¸­æ˜¯å¦ä¿ç•™ const enum çš„å¸¸é‡å€¼ã€‚
è¯¦ç»†ä½œç”¨ï¼š å½“ä½ åœ¨ TypeScript ä¸­ä½¿ç”¨ const enum æ—¶ï¼Œå®ƒä»¬ä¼šåœ¨ç¼–è¯‘æ—¶è¢«å†…è”å±•å¼€ä¸ºå¸¸é‡å€¼ï¼Œè€Œä¸ä¼šç”Ÿæˆå•ç‹¬çš„æšä¸¾ä»£ç ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒTypeScript ä¼šå°† const enum ç¼–è¯‘ä¸ºå¸¸é‡å€¼ï¼Œè€Œä¸ä¼šç”Ÿæˆä»»ä½•æšä¸¾ç›¸å…³çš„ JavaScript ä»£ç ã€‚
å¦‚æœä½ å¯ç”¨ preserveConstEnumsï¼ŒTypeScript ç¼–è¯‘å™¨å°†ä¸ä¼šå†…è” const enumï¼Œè€Œæ˜¯ä¿ç•™è¿™äº›æšä¸¾ï¼Œå¹¶ç”Ÿæˆç›¸åº”çš„ JavaScript ä»£ç ã€‚è¿™æ ·ï¼Œç¼–è¯‘åçš„ä»£ç å°†åŒ…å«æšä¸¾çš„å®é™…å®šä¹‰ï¼Œè€Œä¸æ˜¯ç›´æ¥æ›¿æ¢ä¸ºå¸¸é‡å€¼ã€‚
ä½¿ç”¨åœºæ™¯ï¼š preserveConstEnums: true: å¦‚æœä½ å¸Œæœ› const enum åœ¨ç¼–è¯‘åä¾ç„¶ä¿ç•™ä¸ºæšä¸¾å®šä¹‰ï¼ˆè€Œä¸æ˜¯è¢«å†…è”å±•å¼€ä¸ºå¸¸é‡å€¼ï¼‰ï¼Œå¯ä»¥å¼€å¯è¿™ä¸ªé€‰é¡¹ã€‚ preserveConstEnums: falseï¼ˆé»˜è®¤å€¼ï¼‰ï¼šä¼šç›´æ¥å†…è” const enum çš„å€¼ï¼Œç”Ÿæˆçš„ JavaScript ä»£ç ä¸­ä¸ä¼šåŒ…å«æšä¸¾ç±»å‹å®šä¹‰ã€‚ ç¤ºä¾‹ï¼š 1. preserveConstEnums: false (é»˜è®¤) TypeScript ç¼–è¯‘å™¨å°†å†…è” const enumï¼š
1const enum Color { 2 Red = 1, 3 Green = 2, 4 Blue = 3 5} 6 7let c = Color.Green; // ç¼–è¯‘åç›´æ¥æ›¿æ¢æˆ 2 ç¼–è¯‘åçš„ JavaScript ä»£ç ï¼š
1var c = 2; 2. preserveConstEnums: true å¦‚æœå¯ç”¨ preserveConstEnumsï¼Œç¼–è¯‘åçš„ä»£ç ä¼šä¿ç•™æšä¸¾å®šä¹‰ï¼š
1const enum Color { 2 Red = 1, 3 Green = 2, 4 Blue = 3 5} 6 7let c = Color.Green; ç¼–è¯‘åçš„ JavaScript ä»£ç ï¼š
1var Color; 2(function (Color) { 3 Color[Color[&#34;Red&#34;] = 1] = &#34;Red&#34;; 4 Color[Color[&#34;Green&#34;] = 2] = &#34;Green&#34;; 5 Color[Color[&#34;Blue&#34;] = 3] = &#34;Blue&#34;; 6})(Color || (Color = {})); 7var c = Color.Green; æ€»ç»“ï¼š preserveConstEnums: true ä¿ç•™ const enum çš„å®šä¹‰åœ¨è¾“å‡ºçš„ JavaScript ä»£ç ä¸­ï¼Œè€Œä¸æ˜¯å°†å…¶å†…è”æˆå¸¸é‡å€¼ã€‚ preserveConstEnums: falseï¼ˆé»˜è®¤ï¼‰åˆ™ä¼šå°† const enum çš„æˆå‘˜å†…è”ä¸ºå¸¸é‡å€¼ï¼Œç”Ÿæˆçš„ JavaScript ä»£ç ä¼šæ›´ç®€æ´ã€‚ `,url:"https://hugo-dead-simple.netlify.com/typescript/preverseconstenums/"},"https://hugo-dead-simple.netlify.com/typescript/src/readme/":{title:"typescript",tags:["typescript"],content:`å®‰è£… 1yarn global add typescript ts-node æ•°æ®ç±»å‹ string boolean number void ç”¨åœ¨æ²¡æœ‰è¿”å›å€¼çš„å‡½æ•°,å…¶å®ƒå¯ä»¥ç”¨,ä½†ä¸èƒ½èµ‹å€¼ 1function alerme():void { 2 alert(&#39;my name is tom&#39;); 3} null,undefined,æ˜¯æ‰€æœ‰ç±»å‹çš„å­ç±»å‹,å¯ä»¥èµ‹å€¼ç»™å…¶å®ƒç±»å‹,è€Œ void ç±»å‹çš„å˜é‡ä¸èƒ½èµ‹å€¼ç»™ number ç±»å‹çš„å˜é‡ï¼š 1let num:number = null å¯¹è±¡ç±»å‹ 1const xiaoJieJie : { 2 name:string, 3 age:number 4} = { 5 name:&#39;hel&#39;, 6 age:19 7} //1 æ™®é€š 8 9const xiaoJjiejieS :string [] = [&#39;1&#39;,&#39;dajiao&#39;,&#39;liuyaing&#39;]; // 2 .æ•°ç»„ 10 11class Person{} 12const dajiao: Person = new Person() //3 ç±»ç±»å‹ 13 14const jianXiaoJjieJie: () =&gt; string = () =&gt; {return &#34;dajiao&#34;}; //å‡½æ•°å¯¹è±¡ç±»å‹ ç±»å‹æ³¨è§£ ä¸ ç±»å‹æ¨æ–­ type annotation type inference å·¥ä½œä½¿ç”¨çš„åŸåˆ™
å¦‚æœTSèƒ½å¤Ÿè‡ªåŠ¨åˆ†æå˜é‡ç±»å‹,æˆ‘ä»¬å°±ä»€ä¹ˆä¹Ÿä¸éœ€è¦åšäº† å¦‚æœTSæ— æ³•åˆ†æå˜é‡ç±»å‹çš„è¯,æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ç±»å‹æ³¨è§£äº† 05 å‡½æ•°å‚æ•°å’Œè¿”å›ç±»å‹çš„æ³¨è§£ 1&lt;%- include(&#34;demo/demo5.ts&#34;) %&gt; 06æ•°ç»„ç±»å‹çš„å®šä¹‰ ç±»å‹åˆ«å 1&lt;%- include(&#34;demo/demo6.ts&#34;) %&gt; 07 å…ƒç»„çš„ä½¿ç”¨ 1&lt;%- include(&#34;demo/demo7.ts&#34;) %&gt; å…ƒç»„ç°åœ¨ç”¨çš„å°‘äº†,å› ä¸ºå¯ä»¥ç”¨å¯¹è±¡çš„å½¢å¼æ¥ä»£æ›¿
08 09 interface æ¥å£ 1&lt;%- include(&#34;demo/demo8.ts&#34;) %&gt; 1&lt;%- include(&#34;demo/demo9.ts&#34;) %&gt; [propname:string] : any; å†…éƒ¨çº¦æŸäº†ä¸€ä¸ªå‡½æ•°say():string; æ¥å£çº¦æŸä¸€ä¸ªç±»class xiaojiejie implements Gril æ¥å£çš„æ‹“å±•interface Teacher extends Girl{} ç›¸å½“äºç»§æ‰¿ ç¬¦åˆå­æ¥å£çš„å¯¹è±¡ä¹Ÿç¬¦åˆçˆ¶æ¥å£ 10 ç±»çš„æ¦‚å¿µå’Œä½¿ç”¨ å®šä¹‰ ç»§æ‰¿ é‡å†™ super è°ƒç”¨çˆ¶ç±»ä¸­çš„æ–¹æ³• 1&lt;%- include(&#34;demo/demo10.ts&#34;) %&gt; ç±»çš„è®¿é—®ç±»å‹ private å†…éƒ¨ç”¨,å¤–éƒ¨ä¸èƒ½ç”¨ protected å†…éƒ¨ç”¨,å¤–éƒ¨ä¸èƒ½ç”¨,ç»§æ‰¿å¯ä»¥ç”¨ public é»˜è®¤æ˜¯public éƒ½å¯ä»¥ç”¨ ç±»çš„å†…éƒ¨ä¸å¤–éƒ¨
1&lt;%- include(&#34;demo/demo11.ts&#34;) %&gt; 12 ç±»çš„æ„é€ å‡½æ•° 1&lt;%- include(&#34;demo/demo12.ts&#34;) %&gt; 13 ç±»çš„getter setter static åªè¯» 1&lt;%- include(&#34;demo/demo13.ts&#34;) %&gt; 14 æŠ½è±¡ç±» å«æœ‰æŠ½è±¡æ–¹æ³•çš„ç±»å«åšæŠ½è±¡ç±» ç»§æ‰¿æŠ½è±¡ç±»çš„ç±»å¿…é¡»å®ç°æŠ½è±¡æ–¹æ³• 1&lt;%- include(&#34;demo/demo14.ts&#34;) %&gt; 15 16 17 tsconfig.json é…ç½®æ–‡ä»¶ tsc -init ç”Ÿæˆ tsc ä¸åŠ åå­—,ä¼šè°ƒç”¨tsconfig.json &ldquo;include&rdquo;:[&ldquo;demo.ts&rdquo;], å¯ä»¥æ˜¯ç›®å½•åŠæ–‡ä»¶,å¯ä»¥æ­£åˆ™,å¯ä»¥glob &ldquo;exclude&rdquo;:[&ldquo;demo.ts&rdquo;], å¯ä»¥æ’é™¤include é‡Œæ–‡ä»¶ &ldquo;files&rdquo;:[&ldquo;demo.ts&rdquo;], å’Œincludeä¸€æ ·,ä½†åªèƒ½æ˜¯æ–‡ä»¶,ä¸ä¼šè¢«excludeæ’é™¤ compileOptions
strict ä¸¥æ ¼ts noImplicitAny å……è®¸ä½ çš„æ³¨è§£ç±»å‹anyä¸ç”¨ç‰¹æ„æ ‡æ˜ strictNullChecks ä¸å……è®¸æœ‰nullå€¼å‡ºç° ts-node ä¹Ÿä¼šç”¨tsconfig.json rootdir æºä»£ç æ ¹ç›®å½• outDir ç¼–è¯‘è¾“å‡ºçš„æ–‡ä»¶ sourceMap ç”Ÿæˆ.mapæ–‡ä»¶ debugç”¨ noUnsedLocal ä¸èƒ½å‡ºç°æ²¡æœ‰ä½¿ç”¨çš„æœ¬åœ°å˜é‡ 18 ç±»å‹ä¿æŠ¤ä¸è”åˆç±»å‹ ä¸å•ä¸€çš„ç±»å‹ number | boolean åªæœ‰åœ¨è”åˆç±»å‹çš„æ—¶å€™éœ€è¦ ç±»å‹ä¿æŠ¤ ç±»å‹æ–­è¨€ person as Waiter skill in person typeof person ==='string' first instanceof NumberOBJ instanceof åªèƒ½ç”¨åœ¨ç±»ä¸Š 1&lt;%- include(&#34;demo/demo18.cpp&#34;) %&gt; 19 enum ç±»å‹ typescript ç‹¬æœ‰ 1&lt;%- include(&#34;demo/demo19.cpp&#34;) %&gt; enum å¯ä»¥åæŸ¥ log(Status[1]) 20 æ³›å‹ 1&lt;%- include(&#34;demo/demo20.cpp&#34;) %&gt; 21 ç±»ä¸­ä½¿ç”¨æ³›å‹ 1 2 - æ³›å‹åœ¨ç±»ä¸­çš„ä½¿ç”¨ \`class C&lt;T&gt;\` 3 4ä¸ºäº†çº¦æŸä¼ å…¥çš„å‚æ•° 5 6 - æ³›å‹ç»§æ‰¿ 7 - æ³›å‹çº¦æŸ 8 9&lt;%- include(&#34;demo/demo21.cpp&#34;) %&gt; 10 11## 22 23 å‘½åç©ºé—´ 12 13åœ¨æµè§ˆå™¨ä¸­è¿è¡Œä¸çœ‹æ•ˆæœ 14 15 - vscode -&gt; file -&gt; openFloder 16 - vscode-&gt;terminal \`npm init\` 17 - \`tsc -init\` 18 - \`mkdir src &amp;&amp; mkdir build &amp;&amp; touch index.html\` 19 20 - å‘½åç©ºé—´å¯ä»¥åµŒå¥— namespace fater { namespace child { } }
1 2tsconfig.json 3 - outFile -&gt;ç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ 4 - moduble coomjs -&gt;&#39;amd&#39; 5 6## 24 import 7 8éœ€è¦å¼•ç”¨ require.js æ¥ä½¿ç”¨ amd çš„æ¨¡å— require([&ldquo;page&rdquo;],function(){ })
1 2## 25 parcel yarn add &ndash;dev parcel
1 2## 26 ts ä½¿ç”¨jquery yarn add @types/jquery
1 2or declare var $:any;
1 2## èµ„æ–™ 3 4 - [ruanä¸€å³° es6]() 5 - [TypeScript å…¥é—¨æ•™ç¨‹](https://ts.xcatliu.com/) 6 - [TypeScript Handbookï¼ˆä¸­æ–‡ç‰ˆï¼‰](https://zhongsp.gitbooks.io/typescript-handbook/content/) 7 - [æŠ€æœ¯èƒ–-TypeScript ä»å…¥é—¨åˆ°ç²¾é€šå›¾æ–‡è§†é¢‘æ•™ç¨‹-å…è´¹æ•™ç¨‹](http://jspang.com/detailed?id=63) `,url:"https://hugo-dead-simple.netlify.com/typescript/src/readme/"},"https://hugo-dead-simple.netlify.com/tags/typescript/":{title:"Typescript",tags:[],content:"",url:"https://hugo-dead-simple.netlify.com/tags/typescript/"},"https://hugo-dead-simple.netlify.com/typescript/object_object/":{title:"TypeScript ä¸­çš„ object å’Œ Object çš„åŒºåˆ«",tags:["typescript"],content:"åœ¨ TypeScript ä¸­ï¼Œobject å’Œ Object è™½ç„¶çœ‹èµ·æ¥ç›¸ä¼¼ï¼Œä½†å®ƒä»¬æœ‰ç€ä¸åŒçš„å«ä¹‰å’Œç”¨é€”ã€‚\n1. objectï¼ˆå°å†™ï¼‰ object æ˜¯ä¸€ä¸ª ç±»å‹ï¼Œè¡¨ç¤ºä»»ä½•éåŸå§‹ç±»å‹çš„å€¼ã€‚åŸå§‹ç±»å‹åŒ…æ‹¬ï¼šnumberã€stringã€booleanã€symbolã€null å’Œ undefinedã€‚æ¢å¥è¯è¯´ï¼Œobject ç±»å‹æ˜¯æŒ‡ é™¤åŸå§‹ç±»å‹ä¹‹å¤–çš„æ‰€æœ‰ç±»å‹ã€‚\nç‰¹ç‚¹ï¼š object ç±»å‹è¡¨ç¤ºçš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆå³éåŸå§‹å€¼ï¼‰ï¼Œä½†ä¸é™å®šå¯¹è±¡çš„ç»“æ„ï¼ˆå±æ€§å’Œæ–¹æ³•ï¼‰ã€‚ å®ƒå¹¶ä¸ç­‰åŒäº Object æ„é€ å‡½æ•°çš„ç±»å‹ã€‚ ä¸èƒ½ç›´æ¥è®¿é—®å¯¹è±¡çš„å±æ€§æˆ–æ–¹æ³•ï¼Œé™¤éå°†å…¶ç±»å‹è¿›ä¸€æ­¥ç»†åŒ–ã€‚ ç¤ºä¾‹ï¼š 1let obj: object; 2 3obj = { name: &#34;Alice&#34; }; // åˆæ³• 4obj = [1, 2, 3]; // åˆæ³• 5obj = () =&gt; {}; // åˆæ³• 6 7obj = 42; // é”™è¯¯ï¼šç±»å‹ &#39;number&#39; ä¸èƒ½èµ‹å€¼ç»™ç±»å‹ &#39;object&#39; 8obj = &#34;hello&#34;; // é”™è¯¯ï¼šç±»å‹ &#39;string&#39; ä¸èƒ½èµ‹å€¼ç»™ç±»å‹ &#39;object&#39; object ç±»å‹é™åˆ¶äº†åªèƒ½æ˜¯â€œéåŸå§‹ç±»å‹â€çš„å€¼ï¼Œä½†æ˜¯å®ƒå¹¶ä¸å…³å¿ƒå…·ä½“æ˜¯ä»€ä¹ˆç±»å‹ï¼ˆä¾‹å¦‚æ˜¯æ•°ç»„ã€å‡½æ•°è¿˜æ˜¯æ™®é€šå¯¹è±¡ï¼‰ã€‚å› æ­¤ï¼Œä½ ä¸èƒ½ç›´æ¥è®¿é—®å¯¹è±¡çš„å±æ€§ï¼Œé™¤éä½ è¿›ä¸€æ­¥æŒ‡å®šå¯¹è±¡çš„ç»“æ„æˆ–ç±»å‹ã€‚\n2. Objectï¼ˆå¤§å†™ï¼‰ Object æ˜¯ JavaScript ä¸­çš„å†…ç½®æ„é€ å‡½æ•°ï¼Œç”¨æ¥åˆ›å»ºå¯¹è±¡å®ä¾‹ã€‚åœ¨ TypeScript ä¸­ï¼ŒObject è¡¨ç¤ºæ‰€æœ‰é null çš„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯æ‰€æœ‰ç±»å‹çš„è¶…é›†ï¼Œé™¤äº† null å’Œ undefinedã€‚\nç‰¹ç‚¹ï¼š Object ç±»å‹è¡¨ç¤º æ‰€æœ‰å¯¹è±¡ç±»å‹ï¼ŒåŒ…æ‹¬åŸå§‹ç±»å‹ï¼ˆstringã€number ç­‰ï¼‰ä»¥å¤–çš„æ‰€æœ‰ç±»å‹ã€‚ å®ƒæ˜¯ JavaScript ä¸­æ‰€æœ‰å¯¹è±¡çš„çˆ¶ç±»ï¼Œç”šè‡³å¯ä»¥ç”¨äºè¡¨ç¤ºåŸå§‹ç±»å‹ï¼ˆä¸è¿‡é€šå¸¸ä¸è¿™ä¹ˆåšï¼‰ã€‚ ç¤ºä¾‹ï¼š 1let obj: Object; 2 3obj = { name: &#34;Alice&#34; }; // åˆæ³• 4obj = [1, 2, 3]; // åˆæ³• 5obj = &#34;hello&#34;; // åˆæ³•ï¼ˆå°½ç®¡é€šå¸¸ä¸è¿™ä¹ˆåšï¼‰ 6obj = 42; // åˆæ³•ï¼ˆ`number` ä¹Ÿæ˜¯ `Object` ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼‰ 7 8obj = null; // é”™è¯¯ï¼š`null` ä¸èƒ½èµ‹å€¼ç»™ `Object` Object ç±»å‹å®é™…ä¸ŠåŒ…å«äº† æ‰€æœ‰ç±»å‹ï¼Œé™¤ null å’Œ undefined ä¹‹å¤–ã€‚\n3. åŒºåˆ«æ€»ç»“ ç‰¹æ€§ object Object è¡¨ç¤ºçš„å†…å®¹ ä»»ä½•éåŸå§‹ç±»å‹ï¼ˆä¸åŒ…æ‹¬ number, string, boolean, symbol, null, undefinedï¼‰ æ‰€æœ‰ç±»å‹ï¼ˆåŒ…æ‹¬ number, string, boolean, symbol, é™¤ null å’Œ undefinedï¼‰ æ˜¯å¦å…è®¸åŸå§‹ç±»å‹ ä¸å…è®¸åŸå§‹ç±»å‹ï¼ˆåªèƒ½æ˜¯å¯¹è±¡ï¼‰ å…è®¸åŸå§‹ç±»å‹ï¼ˆåŒ…æ‹¬ number, string, boolean, symbol ç­‰ï¼‰ è®¿é—®å±æ€§ ä¸èƒ½ç›´æ¥è®¿é—®å±æ€§ï¼Œéœ€è¦è¿›ä¸€æ­¥ç»†åŒ–ç±»å‹ å…è®¸è®¿é—®å±æ€§ï¼Œå®é™…ä¸Šæ˜¯ Object ç±»å‹çš„è¶…é›† å¸¸è§ç”¨é€” ç”¨äºé™å®šæŸä¸ªå€¼æ˜¯å¯¹è±¡ç±»å‹ï¼ˆè€Œä¸æ˜¯åŸå§‹å€¼ï¼‰ è¡¨ç¤ºæ‰€æœ‰ç±»å‹ï¼ˆä½†ä¸åŒ…æ‹¬ null å’Œ undefinedï¼‰ 4. è¿›ä¸€æ­¥çš„ç¤ºä¾‹ï¼š object ç¤ºä¾‹ï¼š 1let obj: object; 2 3obj = { name: &#34;Alice&#34; }; // åˆæ³• 4obj = [1, 2, 3]; // åˆæ³• 5obj = () =&gt; {}; // åˆæ³• 6 7// ä¸‹é¢çš„ç±»å‹ä¼šæŠ¥é”™ï¼Œå› ä¸º `object` ç±»å‹ä¸å…è®¸åŸå§‹ç±»å‹ 8obj = 42; // é”™è¯¯ 9obj = &#34;hello&#34;; // é”™è¯¯ 10obj = true; // é”™è¯¯ Object ç¤ºä¾‹ï¼š 1let obj: Object; 2 3obj = { name: &#34;Alice&#34; }; // åˆæ³• 4obj = [1, 2, 3]; // åˆæ³• 5obj = &#34;hello&#34;; // åˆæ³• 6obj = 42; // åˆæ³• 7 8// `null` ä¸èƒ½èµ‹å€¼ç»™ `Object` ç±»å‹ 9obj = null; // é”™è¯¯ 5. æ€»ç»“ object æ˜¯ä¸€ä¸ªç±»å‹ï¼Œè¡¨ç¤ºéåŸå§‹ç±»å‹ï¼ˆå³æ’é™¤ number, string, boolean, symbol, null å’Œ undefinedï¼‰ã€‚å®ƒä¸èƒ½ç›´æ¥ç”¨äºè®¿é—®å¯¹è±¡çš„å±æ€§ã€‚ Object æ˜¯ JavaScript ä¸­çš„æ„é€ å‡½æ•°ï¼Œå®ƒæ˜¯æ‰€æœ‰ç±»å‹çš„è¶…é›†ï¼Œé™¤äº† null å’Œ undefinedï¼Œå®ƒå…è®¸è¡¨ç¤ºä»»ä½•ç±»å‹ï¼ŒåŒ…æ‹¬åŸå§‹ç±»å‹ï¼ˆå¦‚ stringã€number ç­‰ï¼‰ã€‚ åœ¨ TypeScript ä¸­ï¼Œå»ºè®®å°½é‡ä½¿ç”¨ object æ¥è¡¨ç¤ºå¯¹è±¡ç±»å‹ï¼Œé¿å…ä½¿ç”¨ Objectï¼Œé™¤éä½ ç¡®å®éœ€è¦ä¸€ä¸ªæ›´å®½æ³›çš„ç±»å‹ï¼ˆè¡¨ç¤ºæ‰€æœ‰é null/undefined çš„å€¼ï¼‰ã€‚\n",url:"https://hugo-dead-simple.netlify.com/typescript/object_object/"},"https://hugo-dead-simple.netlify.com/typescript/":{title:"typescript å­¦ä¹ ç¬”è®°",tags:["typescript"],content:" é¦–é¡µ å¦‚ä½•è°ƒè¯• ç¬”è®°:tsç¼–ç¨‹ å¯¹è±¡å­—é¢é‡çš„ä½¿ç”¨ TypeScript ä¸­çš„ object å’Œ Object çš„åŒºåˆ« preserveConstEnumsç¼–è¯‘å™¨é€‰é¡¹ è£…é¥°å™¨ ",url:"https://hugo-dead-simple.netlify.com/typescript/"},"https://hugo-dead-simple.netlify.com/typescript/readme/":{title:"typescript å­¦ä¹ ç¬”è®°",tags:["typescript"],content:`èµ„æ–™ TypeScript Tutorial é˜®ä¸€å³° es6 é˜®ä¸€å³° TypeScript æ•™ç¨‹ TypeScript Handbook - The TypeScript Handbook TypeScript å…¥é—¨æ•™ç¨‹ TypeScript Handbookï¼ˆä¸­æ–‡ç‰ˆï¼‰ ç°ä»£TypeScripté«˜çº§æ•™ç¨‹- - linwu-hi - åšå®¢å›­ å®‰è£… 1yarn global add typescript ts-node æ•°æ®ç±»å‹ string boolean number void ç”¨åœ¨æ²¡æœ‰è¿”å›å€¼çš„å‡½æ•°,å…¶å®ƒå¯ä»¥ç”¨,ä½†ä¸èƒ½èµ‹å€¼ 1function alerme():void { 2 alert(&#39;my name is tom&#39;); 3} null,undefined,æ˜¯æ‰€æœ‰ç±»å‹çš„å­ç±»å‹,å¯ä»¥èµ‹å€¼ç»™å…¶å®ƒç±»å‹,è€Œ void ç±»å‹çš„å˜é‡ä¸èƒ½èµ‹å€¼ç»™ number ç±»å‹çš„å˜é‡ï¼š 1 let num:number = null å¯¹è±¡ç±»å‹ 1const xiaoJieJie : { 2 name:string, 3 age:number 4} = { 5 name:&#39;hel&#39;, 6 age:19 7} //1 æ™®é€š 8 9const xiaoJjiejieS :string [] = [&#39;1&#39;,&#39;dajiao&#39;,&#39;liuyaing&#39;]; // 2 .æ•°ç»„ 10 11class Person{} 12const dajiao: Person = new Person() //3 ç±»ç±»å‹ 13 14const jianXiaoJjieJie: () =&gt; string = () =&gt; {return &#34;dajiao&#34;}; //å‡½æ•°å¯¹è±¡ç±»å‹ è„šæ‰‹æ¶ æ¢äº†ä¸€ä¸ªè„šæ‰‹æ¶ GitHub - xddqnodejs-typescript-modern-starter Minimal and modern starter template to develop a Node.js project leveraging Typescript
ç±»å‹æ³¨è§£ ä¸ ç±»å‹æ¨æ–­ type annotation type inference å·¥ä½œä½¿ç”¨çš„åŸåˆ™
å¦‚æœTSèƒ½å¤Ÿè‡ªåŠ¨åˆ†æå˜é‡ç±»å‹,æˆ‘ä»¬å°±ä»€ä¹ˆä¹Ÿä¸éœ€è¦åšäº† å¦‚æœTSæ— æ³•åˆ†æå˜é‡ç±»å‹çš„è¯,æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ç±»å‹æ³¨è§£äº† 05 å‡½æ•°å‚æ•°å’Œè¿”å›ç±»å‹çš„æ³¨è§£ demo5
06æ•°ç»„ç±»å‹çš„å®šä¹‰ ç±»å‹åˆ«å demo/demo6.ts
07 å…ƒç»„çš„ä½¿ç”¨ demo/demo7.ts
å…ƒç»„ç°åœ¨ç”¨çš„å°‘äº†,å› ä¸ºå¯ä»¥ç”¨å¯¹è±¡çš„å½¢å¼æ¥ä»£æ›¿
08 09 interface æ¥å£ demo/demo8.ts
demo/demo9.ts
[propname:string] : any; å†…éƒ¨çº¦æŸäº†ä¸€ä¸ªå‡½æ•°say():string; æ¥å£çº¦æŸä¸€ä¸ªç±»class xiaojiejie implements Gril æ¥å£çš„æ‹“å±•interface Teacher extends Girl{} ç›¸å½“äºç»§æ‰¿ ç¬¦åˆå­æ¥å£çš„å¯¹è±¡ä¹Ÿç¬¦åˆçˆ¶æ¥å£ 10 ç±»çš„æ¦‚å¿µå’Œä½¿ç”¨ å®šä¹‰ ç»§æ‰¿ é‡å†™ super è°ƒç”¨çˆ¶ç±»ä¸­çš„æ–¹æ³• demo/demo10.ts
ç±»çš„è®¿é—®ç±»å‹ private å†…éƒ¨ç”¨,å¤–éƒ¨ä¸èƒ½ç”¨ protected å†…éƒ¨ç”¨,å¤–éƒ¨ä¸èƒ½ç”¨,ç»§æ‰¿å¯ä»¥ç”¨ public é»˜è®¤æ˜¯public éƒ½å¯ä»¥ç”¨ ç±»çš„å†…éƒ¨ä¸å¤–éƒ¨
demo/demo11.ts
12 ç±»çš„æ„é€ å‡½æ•° demo/demo12.ts
13 ç±»çš„getter setter static åªè¯» demo/demo13.ts
14 æŠ½è±¡ç±» å«æœ‰æŠ½è±¡æ–¹æ³•çš„ç±»å«åšæŠ½è±¡ç±» ç»§æ‰¿æŠ½è±¡ç±»çš„ç±»å¿…é¡»å®ç°æŠ½è±¡æ–¹æ³• demo/demo14.ts
15 16 17 tsconfig.json é…ç½®æ–‡ä»¶ tsc -init ç”Ÿæˆ tsc ä¸åŠ åå­—,ä¼šè°ƒç”¨tsconfig.json &ldquo;include&rdquo;:[&ldquo;demo.ts&rdquo;], å¯ä»¥æ˜¯ç›®å½•åŠæ–‡ä»¶,å¯ä»¥æ­£åˆ™,å¯ä»¥glob &ldquo;exclude&rdquo;:[&ldquo;demo.ts&rdquo;], å¯ä»¥æ’é™¤include é‡Œæ–‡ä»¶ &ldquo;files&rdquo;:[&ldquo;demo.ts&rdquo;], å’Œincludeä¸€æ ·,ä½†åªèƒ½æ˜¯æ–‡ä»¶,ä¸ä¼šè¢«excludeæ’é™¤ compileOptions
strict ä¸¥æ ¼ts noImplicitAny å……è®¸ä½ çš„æ³¨è§£ç±»å‹anyä¸ç”¨ç‰¹æ„æ ‡æ˜ strictNullChecks ä¸å……è®¸æœ‰nullå€¼å‡ºç° ts-node ä¹Ÿä¼šç”¨tsconfig.json rootdir æºä»£ç æ ¹ç›®å½• outDir ç¼–è¯‘è¾“å‡ºçš„æ–‡ä»¶ sourceMap ç”Ÿæˆ.mapæ–‡ä»¶ debugç”¨ noUnsedLocal ä¸èƒ½å‡ºç°æ²¡æœ‰ä½¿ç”¨çš„æœ¬åœ°å˜é‡ 18 ç±»å‹ä¿æŠ¤ä¸è”åˆç±»å‹ ä¸å•ä¸€çš„ç±»å‹ number | boolean åªæœ‰åœ¨è”åˆç±»å‹çš„æ—¶å€™éœ€è¦ ç±»å‹ä¿æŠ¤ ç±»å‹æ–­è¨€ person as Waiter skill in person typeof person ==='string' first instanceof NumberOBJ instanceof åªèƒ½ç”¨åœ¨ç±»ä¸Š demo/demo18.ts
19 enum ç±»å‹ typescript ç‹¬æœ‰ demo/demo19.ts
enum å¯ä»¥åæŸ¥ log(Status[1]) 20 æ³›å‹ demo/demo20.ts
21 ç±»ä¸­ä½¿ç”¨æ³›å‹ æ³›å‹åœ¨ç±»ä¸­çš„ä½¿ç”¨ class C&lt;T&gt; ä¸ºäº†çº¦æŸä¼ å…¥çš„å‚æ•°
æ³›å‹ç»§æ‰¿ æ³›å‹çº¦æŸ demo/demo21.ts
22 23 å‘½åç©ºé—´ åœ¨æµè§ˆå™¨ä¸­è¿è¡Œä¸çœ‹æ•ˆæœ
vscode -&gt; file -&gt; openFloder
vscode-&gt;terminal npm init
tsc -init
mkdir src &amp;&amp; mkdir build &amp;&amp; touch index.html
å‘½åç©ºé—´å¯ä»¥åµŒå¥—
1namespace fater { 2 namespace child { 3 } 4} tsconfig.json
outFile -&gt;ç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ moduble coomjs -&gt;&lsquo;amd&rsquo; 24 import éœ€è¦å¼•ç”¨ require.js æ¥ä½¿ç”¨ amd çš„æ¨¡å—
1require([&#34;page&#34;],function(){ 2}) 25 parcel 1yarn add --dev parcel 26 ts ä½¿ç”¨jquery 1yarn add @types/jquery or
1declare var $:any; `,url:"https://hugo-dead-simple.netlify.com/typescript/readme/"},"https://hugo-dead-simple.netlify.com/linux_tcp_program/":{title:"linuxç½‘ç»œç¼–ç¨‹å­¦ä¹ ç¬”è®°",tags:[],content:`è¯´æ˜ æˆ‘çš„å­¦ä¹ è¿‡ç¨‹
1åŸºç¡€çš„socketç¼–ç¨‹ -&gt; -&gt; çº¿ç¨‹ç¼–ç¨‹ -&gt; muduoåº“å­¦ä¹  Linuxç½‘ç»œç¼–ç¨‹è§†é¢‘æ•™ç¨‹ å­¦ä¹ è‡ª
https://github.com/834810071/NetworkProgramming https://www.bilibili.com/video/av33813135/ æˆ‘ä¸»è¦çš„å­¦ä¹ ç›®æ ‡:
å›ºå®šä½ socket ç¼–ç¨‹çš„åŸºç¡€çŸ¥è¯†
å¦‚ä½•ä½¿ç”¨ è¿›ç¨‹ ç¼–ç¨‹
å¦‚ä½•ä½¿ç”¨ thread ç¼–ç¨‹
p1 è®²è§£äº†,ç½‘ç»œæ¨¡å‹,ç†è§£äº†å››å±‚çš„æ¨¡å‹
linuxç½‘ç»œç¼–ç¨‹
tcpipåŸºç¡€ p1-p5 socketç¼–ç¨‹ p6 TCP/IP ç½‘ç»œç¼–ç¨‹ tcpipç½‘ç»œç¼–ç¨‹ chapter_1 chapter_2 chapter_3 chapter_4 chapter_5 chapter_7 chapter_8 chapter_9 chapter_10 muduo ç½‘ç»œåº“ muduoåº“çš„å®ç°: https://github.com/EricPengShuai/muduo
muduo ç½‘ç»œåº“ chapter_1 chapter_2 `,url:"https://hugo-dead-simple.netlify.com/linux_tcp_program/"},"https://hugo-dead-simple.netlify.com/linux_tcp_program/1/":{title:"",tags:[],content:`p4 tcp åŸºäºå­—èŠ‚æµ æ— è¾¹ç•Œçš„å­—èŠ‚æµ,éœ€è¦å¯¹æ•°æ®è¿›è¡Œåˆ†å‰² ç²˜åŒ…é—®é¢˜,è§£å†³æ–¹æ³•: å‘é€æ–¹: å‘é€æ•°æ®å‰,å…ˆå°†æ•°æ®åŒ…çš„é•¿åº¦ä¿¡æ¯å‘é€ç»™å¯¹æ–¹ æ¥æ”¶æ–¹: æ¥æ”¶åˆ°æ•°æ®åŒ…é•¿åº¦ä¿¡æ¯å,æ ¹æ®é•¿åº¦ä¿¡æ¯,å°†æ•°æ®åŒ…æ‹†åˆ†ä¸ºå¤šä¸ªæ•°æ®åŒ…è¿›è¡Œå¤„ç† é¢å‘è¿æ¥çš„ tcp åè®®,éœ€è¦å»ºç«‹è¿æ¥,æ–­å¼€è¿æ¥,ä¿è¯æ•°æ®ä¼ è¾“çš„å¯é æ€§ ç¼“å†²ä¼ è¾“
tcpæŠ¥æ–‡æ ¼å¼
ç´§æ€¥æŒ‡é’ˆ: ç´§æ€¥æ•°æ®æŒ‡é’ˆ,åªæœ‰ç´§æ€¥æ•°æ®æ‰ä¼šä½¿ç”¨ç´§æ€¥æŒ‡é’ˆ,ç´§æ€¥æ•°æ®æ˜¯æŒ‡éœ€è¦ç«‹å³ä¼ è¾“çš„æ•°æ® é€‰é¡¹å­—æ®µ: é€‰é¡¹å­—æ®µ,å¯ä»¥æºå¸¦ä¸€äº›æ§åˆ¶ä¿¡æ¯,å¦‚çª—å£å¤§å°,æœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦,æ—¶é—´æˆ³ç­‰ tcpä¸‰æ¬¡æ¡æ‰‹
ç¬¬ä¸€æ¬¡æ¡æ‰‹: å®¢æˆ·ç«¯å‘é€ SYN æŠ¥æ–‡,æœåŠ¡å™¨æ”¶åˆ°å,å‘é€ SYN+ACK æŠ¥æ–‡,å®¢æˆ·ç«¯æ”¶åˆ°å,å‘é€ ACK æŠ¥æ–‡ ç¬¬äºŒæ¬¡æ¡æ‰‹: å®¢æˆ·ç«¯å‘é€ ACK æŠ¥æ–‡,æœåŠ¡å™¨æ”¶åˆ°å,å‘é€ ACK æŠ¥æ–‡ ç¬¬ä¸‰æ¬¡æ¡æ‰‹: å®¢æˆ·ç«¯å‘é€ ACK æŠ¥æ–‡,æœåŠ¡å™¨æ”¶åˆ°å,è¿æ¥å»ºç«‹å®Œæˆ tcpå››æ¬¡æŒ¥æ‰‹
ç¬¬ä¸€æ¬¡æŒ¥æ‰‹: å®¢æˆ·ç«¯å‘é€ FIN æŠ¥æ–‡,æœåŠ¡å™¨æ”¶åˆ°å,å‘é€ ACK æŠ¥æ–‡,å®¢æˆ·ç«¯æ”¶åˆ°å,è¿›å…¥ TIME-WAIT çŠ¶æ€ ç¬¬äºŒæ¬¡æŒ¥æ‰‹: æœåŠ¡å™¨å‘é€ FIN æŠ¥æ–‡,å®¢æˆ·ç«¯æ”¶åˆ°å,å‘é€ ACK æŠ¥æ–‡,æœåŠ¡å™¨æ”¶åˆ°å,è¿›å…¥ CLOSED çŠ¶æ€ ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹: æœåŠ¡å™¨å‘é€ ACK æŠ¥æ–‡,å®¢æˆ·ç«¯æ”¶åˆ°å,è¿›å…¥ CLOSED çŠ¶æ€ ç¬¬å››æ¬¡æŒ¥æ‰‹: å®¢æˆ·ç«¯å‘é€ ACK æŠ¥æ–‡,æœåŠ¡å™¨æ”¶åˆ°å,è¿›å…¥ CLOSED çŠ¶æ€ tcpæ‹¥å¡æ§åˆ¶
æ…¢å¯åŠ¨: å¼€å§‹æ—¶,å‘é€æ–¹çš„å‘é€é€Ÿç‡è¾ƒä½,é€æ¸å¢å¤§,ä»¥ä¾¿é€¼è¿‘ç½‘ç»œçš„å®é™…é€Ÿç‡ æ‹¥å¡é¿å…: ç½‘ç»œæ‹¥å¡æ—¶,å‘é€æ–¹çš„å‘é€é€Ÿç‡é™ä½,ä»¥é˜²æ­¢ç½‘ç»œè¿‡è½½ å¿«é€Ÿé‡ä¼ : æ¥æ”¶æ–¹æ”¶åˆ°é‡å¤çš„ ACK æŠ¥æ–‡,è®¤ä¸ºæ˜¯ä¸¢åŒ…,ç«‹å³é‡ä¼ ä¸¢å¤±çš„æŠ¥æ–‡æ®µ è¶…æ—¶é‡ä¼ : å‘é€æ–¹åœ¨ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ° ACK æŠ¥æ–‡,è®¤ä¸ºæŠ¥æ–‡ä¸¢å¤±,é‡æ–°å‘é€ å¿«é€Ÿæ¢å¤: å½“ç½‘ç»œæ‹¥å¡ç¨‹åº¦å‡ç¼“æ—¶,å‘é€æ–¹çš„å‘é€é€Ÿç‡å¢åŠ ,ä»¥ä¾¿å‡è½»ç½‘ç»œæ‹¥å¡ æ»‘åŠ¨çª—å£åè®®
å‘é€æ–¹ç»´æŠ¤ä¸€ä¸ªçª—å£,æŒ‡ç¤ºè‡ªå·±å¯ä»¥å‘é€çš„æŠ¥æ–‡æ®µæ•°é‡ æ¥æ”¶æ–¹ç»´æŠ¤ä¸€ä¸ªçª—å£,æŒ‡ç¤ºè‡ªå·±å¯ä»¥æ¥æ”¶çš„æŠ¥æ–‡æ®µæ•°é‡ å‘é€æ–¹æ ¹æ®æ¥æ”¶æ–¹çš„åé¦ˆ,è°ƒæ•´çª—å£çš„å¤§å°,ä»¥ä¾¿åœ¨ç½‘ç»œæ‹¥å¡æ—¶,å‡å°‘å‘é€æŠ¥æ–‡æ®µçš„æ•°é‡ æ¥æ”¶æ–¹æ ¹æ®å‘é€æ–¹çš„åé¦ˆ,è°ƒæ•´çª—å£çš„å¤§å°,ä»¥ä¾¿åœ¨ç½‘ç»œæ‹¥å¡æ—¶,å‡å°‘æ¥æ”¶æŠ¥æ–‡æ®µçš„æ•°é‡ `,url:"https://hugo-dead-simple.netlify.com/linux_tcp_program/1/"},"https://hugo-dead-simple.netlify.com/linux_tcp_program/2/":{title:"",tags:[],content:`å­¦ä¹ ç›®æ ‡ 1mindmap 2 root((å­¦ä¹ ç›®æ ‡)) 3 1.ä»€ä¹ˆæ˜¯socket 4 2.IPv4å¥—æ¥å£åœ°å€ç»“æ„ 5 3.ç½‘ç»ˆå­—èŠ‚åº 6 4.å­—èŠ‚åºè½¬æ¢å‡½æ•° 7 5.åœ°å€è½¬æ¢å‡½æ•° 8 6.å¥—æ¥å­—ç±»å‹ 1. ä»€ä¹ˆæ˜¯socket socketå¯ä»¥çœ‹æˆæ˜¯ç”¨æˆ·è¿›ç¨‹ä¸å†…æ ¸ç½‘ç»œåè®®æ ˆçš„ ç¼–ç¨‹æ¥å£ socketä¸ä»…å¯ä»¥ç”¨äºæœ¬æœºçš„è¿›ç¨‹é—´é€šä¿¡ï¼Œè¿˜å¯ä»¥ ç”¨äºç½‘ç»œä¸Šä¸åŒä¸»æœºçš„è¿›ç¨‹é—´é€šä¿¡ æˆ‘çš„ç†è§£: socketå°±æ˜¯å¯¹å‰é¢å­¦ä¹ çš„tcp/ipçš„ä»£ç å°è£…,ä½†æ˜¯ä½äºç³»ç»Ÿçš„å†…æ ¸,ä¹Ÿå°±æ˜¯è¯´æä¾›ç»™ç”¨æˆ·çš„ä¸€ç»„API,ç”¨äºç½‘ç»œé€šä¿¡.
[!WARNING] socket è¿™é‡Œç†è§£æˆ&quot;æ’åº§&quot;
1mindmap 2 root((socketéœ€è¦çš„å±æ€§)) 3 åœ°å€: sockaddr_in 4 sin_addr 5 sin_port 6 sin_family ipv4 socket åœ°å€ç»“æ„ä½“ ipv4 socketåœ°å€ç»“æ„ä½“,åœ¨å¤´æ–‡ä»¶netinet/in.hä¸­å®šä¹‰ã€‚ sockaddr_inç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼š
ä½¿ç”¨man 7 ipå‘½ä»¤æŸ¥çœ‹sockaddr_inç»“æ„ä½“çš„å®šä¹‰ï¼š
1struct sockaddr_in { 2 sa_family_t sin_family; // åœ°å€æ—ï¼Œipv4 å°±æ˜¯AF_INET 3 in_port_t sin_port; // ç«¯å£å· 4 struct in_addr sin_addr; // IPåœ°å€ 5 char sin_zero[8]; // æœªä½¿ç”¨,æ³¨æ„è¿™ä¸ªåœ¨man 7 ipä¸­æ²¡æœ‰è¯´æ˜ 6 //æš—ç¤ºç¨‹åºå‘˜ä¸éœ€è¦çŸ¥é“è¿™ä¸ª?? 7 //å½“æˆä¸Šé¢çš„æ™®é€šçš„æ¥ç”¨? 8}; sin_familyå­—æ®µè¡¨ç¤ºåœ°å€æ—,socketåœ¨è®¾è®¡çš„æ—¶å€™è¿˜å¯ä»¥ç”¨äºå…¶å®ƒçš„åè®®,ä¸ä»…æ˜¯tcp/ip,æ¯”å¦‚è¿˜æœ‰unixåŸŸï¼Œå¯¹äºIPv4åœ°å€ï¼Œè¯¥å€¼ä¸ºAF_INETã€‚ sin_portå­—æ®µè¡¨ç¤ºç«¯å£å·ï¼Œä½¿ç”¨ç½‘ç»œå­—èŠ‚åºï¼ˆbig-endianï¼‰å­˜å‚¨ã€‚ sin_addrå­—æ®µè¡¨ç¤ºIPåœ°å€ï¼Œä½¿ç”¨struct in_addrç»“æ„ä½“è¡¨ç¤ºã€‚ struct in_addrç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼š
1struct in_addr { 2 uint32_t s_addr; // IPåœ°å€ï¼Œä½¿ç”¨ç½‘ç»œå­—èŠ‚åºå­˜å‚¨ 3}; s_addrå­—æ®µè¡¨ç¤ºIPåœ°å€ï¼Œä½¿ç”¨ç½‘ç»œå­—èŠ‚åºå­˜å‚¨ã€‚ ç–‘é—®1 [!NOTE] åˆ°è¿™é‡Œå°±æœ‰ä¸€ä¸ªç–‘é—®,socketaddr_inç»“æ„ä½“å…·ä½“çš„å®šä¹‰æ˜¯ä»€ä¹ˆå‘¢?åé¢æœ‰æ²¡æœ‰char sin_zero[8];å­—æ®µå‘¢?é€šè¿‡ä¸‹é¢çš„ä»£ç æ¥éªŒè¯
1{{#include ./code/size_ofsockaddr_in.c}} è¾“å‡ºçš„ç»“æœæ˜¯ï¼š16,
1size bytes of sockaddr_in 16 2size bytes of sin_family 2 3size bytes of sin_port 2 4size bytes of sin_addr 4 ç»“æœç¡®å®æ˜¯å°‘8
é€šç”¨å¥—æ¥å­—åœ°å€ç»“æ„ä½“sockaddr å®šä¹‰å¦‚ä¸‹ï¼š
å®ƒé€‚ç”¨äºä»»ä½•åœ°å€åè®®,
1struct sockaddr { 2 sa_family_t sa_family; // åœ°å€æ— 3 char sa_data[14]; // åœ°å€æ•°æ®ï¼Œé•¿åº¦å–å†³äºåœ°å€æ— 4}; sa_familyå­—æ®µè¡¨ç¤ºåœ°å€æ—ã€‚ sa_dataå­—æ®µè¡¨ç¤ºåœ°å€æ•°æ®ï¼Œé•¿åº¦å–å†³äºåœ°å€æ—ã€‚ 1#include &lt;stdio.h&gt; 2#include &lt;netinet/in.h&gt; 3 4int main(int argc, char const *argv[]) 5{ 6 struct sockaddr_in addr1; 7 struct sockaddr addr2; 8 9 printf(&#34;sizof(sockaddr_in) = %ld\\n&#34;, sizeof(addr1)); 10 printf(&#34;sizof(sockaddr) = %ld\\n&#34;, sizeof(addr2)); 11 12 // æœ€åè¾“å‡ºçš„ç»“æœæ˜¯ï¼š 13 // sizof(sockaddr_in) = 16 14 // sizof(sockaddr) = 16 15 // è¯´æ˜sockaddr_inå’Œsockaddrçš„å¤§å°æ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯16å­—èŠ‚ã€‚ 16 17 return 0; 18} åœ¨é€šå¸¸çš„ç½‘ç»œç¼–ç¨‹ä¸­,æˆ‘ä»¬å…ˆå¡«å†™sockaddr_inç»“æ„ä½“,ç„¶åå†æŠŠå®ƒè½¬æ¢æˆé€šç”¨çš„sockaddrç»“æ„ä½“.
ç½‘ç»œå­—èŠ‚åº ç½‘ç»œå­—èŠ‚åº å­—èŠ‚åºåˆ†ä¸ºï¼š
å¤§ç«¯å­—èŠ‚åºï¼ˆBig-endianï¼‰ å°ç«¯å­—èŠ‚åºï¼ˆLittle-endianï¼‰ ç½‘ç»œå­—èŠ‚åºï¼ˆNetwork Byte Orderï¼‰æ˜¯æŒ‡æ•°æ®çš„é«˜ä½å­—èŠ‚ä¿å­˜åœ¨å†…å­˜çš„ä½åœ°å€ä¸­ï¼Œè€Œæ•°æ®çš„ä½ä½å­—èŠ‚ä¿å­˜åœ¨å†…å­˜çš„é«˜åœ°å€ä¸­ã€‚å°±æ˜¯å¤§ç«¯å­—èŠ‚åº.
åœ¨TCP/IPåè®®ä¸­ï¼Œæ‰€æœ‰é•¿åº¦å­—æ®µå’Œæ•°å­—éƒ½é‡‡ç”¨ç½‘ç»œå­—èŠ‚åºã€‚ä¾‹å¦‚ï¼Œåœ¨TCPæŠ¥æ–‡å¤´éƒ¨çš„æºç«¯å£å­—æ®µä¸­ï¼Œç«¯å£å·çš„é«˜ä½å­—èŠ‚ä¿å­˜åœ¨å†…å­˜çš„ä½åœ°å€ä¸­ï¼Œè€Œç«¯å£å·çš„ä½ä½å­—èŠ‚ä¿å­˜åœ¨å†…å­˜çš„é«˜åœ°å€ä¸­ã€‚
`,url:"https://hugo-dead-simple.netlify.com/linux_tcp_program/2/"},"https://hugo-dead-simple.netlify.com/linux_tcp_program/muduo/chapter1/":{title:"",tags:[],content:`çº¿ç¨‹å®‰å…¨çš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç®¡ç† åœ¨å¤šçº¿ç§çš„æƒ…å†µä¸‹,ç¼–å†™ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»å°¤ä¸ºå›°éš¾.è¿™é‡Œæƒ³è¦ä½¿ç”¨share_ptræ¥å®Œå…¨è¿™äº›é—®é¢˜.
1.1.2 MutexLockä¸MutexLockGuard
è¿™æ˜¯ä¸€ä¸ªç®€å•çš„èµ„æºç±»ï¼Œç”¨RAII(RAIIå…¨ç§°æ˜¯â€œResource Acquisition is Initializationâ€ï¼Œç›´è¯‘è¿‡æ¥æ˜¯â€œèµ„æºè·å–å³åˆå§‹åŒ–â€,ä¹Ÿå°±æ˜¯è¯´åœ¨æ„é€ å‡½æ•°ä¸­ç”³è¯·åˆ†é…èµ„æºï¼Œåœ¨ææ„å‡½æ•°ä¸­é‡Šæ”¾èµ„æº)æ‰‹æ³•å°è£…äº’æ–¥å™¨çš„åˆ›å»ºä¸é”€æ¯ã€‚åœ¨Linuxä¸‹æ˜¯pthread_mutex_tï¼Œé»˜è®¤æ˜¯ä¸å¯é‡å…¥çš„ï¼ˆ&amp;2.1.1ï¼‰ã€‚MutexLockä¸€èˆ¬æ˜¯åˆ«çš„classçš„æ•°æ®æˆå‘˜ã€‚
MutexLockGuardå°è£…ä¸´ç•ŒåŒºçš„è¿›å…¥å’Œé€€å‡ºï¼Œå³åŠ é”å’Œè§£é”ã€‚MutexLockGuardä¸€èˆ¬æ˜¯ä¸ªæ ˆä¸Šçš„å¯¹è±¡ï¼Œå®ƒçš„ä½œç”¨åŸŸåˆšå¥½ç­‰äºä¸´ç•ŒåŒºåŸŸã€‚
è¿™ä¸¤ä¸ªclasséƒ½ä¸å…è®¸æ‹·è´æ„é€ å’Œèµ‹å€¼ï¼Œä½¿ç”¨åŸåˆ™è§&amp;2.1ã€‚
1.1.3 ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„Counterç¤ºä¾‹
è¿™é‡Œä½¿ç”¨äº†ç¥å¥‡çš„mutableå…³é”®å­—.
ä¸‹é¢æ˜¯ç›¸å…³çš„å†…å®¹.
å…³é”®å­—mutable å…³é”®å­—const ä¹¦ä¸Šçš„counterç±»,åœ¨å¯¹è±¡é”€æ¯çš„æ—¶å€™ä¼šæœ‰race caondition
1.2 å¯¹è±¡çš„åˆ›å»ºå¾ˆç®€å•
å¯¹è±¡çš„æ„é€ è¦åšåˆ°çº¿ç¨‹å®‰å…¨,å”¯ä¸€çš„è¦æ±‚å°±æ˜¯åœ¨æ„é€ æœŸé—´ä¸è¦æ³„æ¼thisæŒ‡é’ˆ.
1.3 é”€æ¯å¤ªéš¾
æˆå‘˜å‡½æ•°ç”¨æ¥ä¿æŠ¤ä¸´ç•ŒåŒºçš„äº’æ–¥å™¨æœ¬èº«å¿…é¡»æ˜¯æœ‰æ•ˆçš„ã€‚è€Œææ„å‡½ æ•°ç ´åäº†è¿™ä¸€å‡è®¾ï¼Œå®ƒä¼šæŠŠmutexæˆå‘˜å˜é‡é”€æ¯æ‰ã€‚æ‚²å‰§å•Š
1.3.2 ä½œä¸ºæ•°æ®æˆå‘˜çš„ mutex ä¸èƒ½ä¿æŠ¤ææ„
åŸå§‹æŒ‡é’ˆæœ‰å„ç§é—®é¢˜
1.4 çº¿ç¨‹å®‰å…¨çš„ Observer æœ‰å¤šéš¾
ä¸€ä¸ªObservableç±»,å®ƒæŒæœ‰å¦ä¸€ä¸ªObserverçš„æŒ‡é’ˆ,åœ¨ä½¿ç”¨è¿™ä¸ªæŒ‡é’ˆObserver * -&gt; updateæ—¶,å¦‚ä½•ä¿è¯Observeræ˜¯å­˜åœ¨çš„å‘¢?
åœ¨Observerææ„æ—¶è°ƒç”¨unregister(),è¿™ä¹Ÿä¸è¡Œ,ä¸¤ä¸ªçº¿ç¨‹A,BåŒæ—¶åœ¨è®¿é—®. Aåœ¨ææ„,Bçš„update,ä¼šäº§ç”ŸæœªçŸ¥æƒ…å†µ.
1.4.1 çº¿ç¨‹å®‰å…¨çš„ Observer æœ‰å¤šéš¾
1.4.2 çº¿ç¨‹å®‰å…¨çš„ Observer æœ‰å¤šéš¾
1.6 ç¥å™¨shared_ptr/weak_ptr
1.8 åº”ç”¨åˆ° Observer ä¸Š
æ—¢ç„¶é€šè¿‡ weak_ptr èƒ½æ¢æŸ¥å¯¹è±¡çš„ç”Ÿæ­»ï¼Œé‚£ä¹ˆ Observer æ¨¡å¼çš„ç«æ€æ¡ä»¶å°±å¾ˆå®¹æ˜“è§£å†³ï¼Œåªè¦è®© Observable ä¿å­˜ weak_ptr å³å¯
å¦‚ä½•æ”¹æˆshared_ptr,åˆ™å¯¹åº”çš„å¯¹è±¡ä¼šä¸€ç›´å­˜åœ¨.
1.9 å†è®º shared_ptr çš„çº¿ç¨‹å®‰å…¨
ä½†æ˜¯ shared_ptr æœ¬èº«ä¸æ˜¯100% çº¿ç¨‹å®‰å…¨çš„ã€‚å®ƒçš„å¼•ç”¨è®¡æ•°æœ¬èº«æ˜¯å®‰å…¨ä¸”æ— é”çš„ï¼Œä½†å¯¹è±¡çš„è¯»å†™åˆ™ä¸æ˜¯
`,url:"https://hugo-dead-simple.netlify.com/linux_tcp_program/muduo/chapter1/"},"https://hugo-dead-simple.netlify.com/linux_tcp_program/muduo/chapter2/":{title:"",tags:[],content:`1ï¼ é¦–è¦åŸåˆ™æ˜¯å°½é‡æœ€ä½é™åº¦åœ°å…±äº«å¯¹è±¡ï¼Œ å‡å°‘éœ€è¦åŒæ­¥çš„åœºåˆã€‚ ä¸€ä¸ªå¯¹è±¡èƒ½ä¸æš´éœ²ç»™åˆ«çš„çº¿ç¨‹å°±ä¸è¦æš´éœ²ï¼› å¦‚æœè¦æš´éœ²ï¼Œ ä¼˜å…ˆè€ƒè™‘ immutableå¯¹è±¡ï¼› å®åœ¨ä¸è¡Œæ‰æš´éœ²å¯ä¿®æ”¹çš„å¯¹è±¡ï¼Œ å¹¶ç”¨åŒæ­¥æªæ–½æ¥å……åˆ† ä¿æŠ¤å®ƒã€‚ 2ï¼ å…¶æ¬¡æ˜¯ä½¿ç”¨é«˜çº§çš„å¹¶å‘ç¼–ç¨‹æ„ä»¶ï¼Œ å¦‚TaskQueueã€ ProducerConsumer Queueã€ CountDownLatchç­‰ç­‰ã€‚ 3ï¼ æœ€åä¸å¾—å·²å¿…é¡»ä½¿ç”¨åº•å±‚åŒæ­¥åŸè¯­ï¼ˆprimitivesï¼‰ æ—¶ï¼Œ åªç”¨éé€’ å½’çš„äº’æ–¥å™¨å’Œæ¡ä»¶å˜é‡ï¼Œ æ…ç”¨è¯»å†™é”ï¼Œ ä¸è¦ç”¨ä¿¡å·é‡ã€‚ 4ï¼ é™¤äº†ä½¿ç”¨atomicæ•´æ•°ä¹‹å¤–ï¼Œ ä¸è‡ªå·±ç¼–å†™lock-freeä»£ç 3ï¼Œ ä¹Ÿä¸è¦ ç”¨â€œå†…æ ¸çº§â€åŒæ­¥åŸè¯­45ã€‚ ä¸å‡­ç©ºçŒœæµ‹â€œå“ªç§åšæ³•æ€§èƒ½ä¼šæ›´å¥½â€ï¼Œ æ¯”å¦‚spin lock vs. mutexã€‚
`,url:"https://hugo-dead-simple.netlify.com/linux_tcp_program/muduo/chapter2/"},"https://hugo-dead-simple.netlify.com/linux_tcp_program/muduo/frame/":{title:"",tags:[],content:`channel -&gt; eventloop &lt;- poller
eventloop åˆ°åº•åšäº†ä»€ä¹ˆå‘¢?
`,url:"https://hugo-dead-simple.netlify.com/linux_tcp_program/muduo/frame/"},"https://hugo-dead-simple.netlify.com/linux_tcp_program/muduo/readme/":{title:"",tags:[],content:`æˆ‘å‰é¢å·²ç»çœ‹å®Œäº† TCPIPç½‘ç»œç¼–ç¨‹è¿™æœ¬ä¹¦.
muduo å­¦ä¹ ç¬”è®° 834810071/muduo_study åŸºäº ã€é«˜çº§ã€‘æ‰‹å†™C++ Muduoç½‘ç»œåº“é¡¹ç›®-æŒæ¡é«˜æ€§èƒ½ç½‘ç»œåº“å®ç°åŸç† ä»£ç  GitHub - ShangyizhouA-Tiny-Network-Library ä½¿ç”¨ C++ 11 é‡æ„é™ˆç¡•çš„ muduo åº“ï¼Œå»é™¤ boost ä¾èµ–ã€‚å†…éƒ¨å®ç°æœ‰ HTTP æœåŠ¡å™¨ï¼Œå¯æ”¯æŒ GET è¯·æ±‚ã€‚ å¯ä»¥å‚è€ƒè¿™ä¸ªé¡¹ç›®,çœ‹å®ƒæ˜¯å¦‚æœå®ç°ç”¨æˆ·çš„æ³¨å†Œä¸ç™»å½•çš„ chenshuo/documents æœ‰ppt https://github.com/iceCream1997/muduo_server_learn S1mpleBugmuduo_cpp11 C++11ç‰ˆæœ¬muduoç½‘ç»œåº“ é™¤å»äº†å¯¹booståº“çš„ä¾èµ– è¿˜æœ‰è§†é¢‘æ•™ç¨‹ ç»“åˆæˆ‘è‡ªå·±å†™çš„ä¸€äº›c++çš„ç¬”è®° https://cpphub.roj.ac.cn å½“ç„¶è¿˜æœ‰æˆ‘ä»¬çš„cppreference æ‰‹å†Œ Hansimovlinux-server ã€ŠLinux é«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ã€‹å’Œã€ŠLinuxå¤šçº¿ç¨‹æœåŠ¡ç«¯ç¼–ç¨‹ï¼šä½¿ç”¨muduo C++ç½‘ç»œåº“ã€‹çš„ç¬”è®°å’Œæºç ï¼Œä»¥åŠä¸¤ä¸ªè½»é‡çº§æœåŠ¡å™¨çš„é¡¹ç›®ä»£ç  ä¹Ÿæ¯”è¾ƒæœ‰ç”¨ raichen/LinuxServerCodes: Linuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹æºç  https://github.com/raichen/LinuxServerCodes chenshuo/muduo: Event-driven network library for multi-threaded Linux server in C++11 https://github.com/chenshuo/muduo qinguoyi/TinyWebServer: Linuxä¸‹C++è½»é‡çº§WebæœåŠ¡å™¨ https://github.com/qinguoyi/TinyWebServer linyacool/WebServer: A C++ High Performance Web Server https://github.com/linyacool/WebServer ä½¿ç”¨å·¥å…·Webbenchï¼Œè¿›è¡Œæµ‹è¯• å…¶å®ƒå¯ä»¥å‚è€ƒçš„åº“ Frees0u1smuduoChatServer åŸºäºMuduoç²¾ç®€å®ç°çš„Smuduo,åœ¨ä¿ç•™åŸæœ‰åŠŸèƒ½å’Œç‰¹æ€§(äº‹ä»¶é©±åŠ¨çš„Reactoræ¨¡å¼ï¼Œéé˜»å¡IO)çš„åŸºç¡€ä¸Šï¼Œç§»é™¤booståº“ä¾èµ–ï¼Œå¤§é‡ä½¿ç”¨C++11æ–°ç‰¹æ€§. `,url:"https://hugo-dead-simple.netlify.com/linux_tcp_program/muduo/readme/"},"https://hugo-dead-simple.netlify.com/linux_tcp_program/my_test/%E7%90%86%E8%A7%A3/":{title:"",tags:[],content:`åœ¨ä½ çš„ C++ ä»£ç ä¸­ï¼Œå½“æ‰§è¡Œ cv.wait(lk); æ—¶ï¼Œlk é”ï¼ˆå³ std::unique_lock å¯¹è±¡ï¼‰ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ã€‚ è¯¦ç»†è§£é‡Š
1.cv.wait(lk); çš„ä½œç”¨:
2.cv.wait(lk); è¿™ä¸ªè°ƒç”¨ä¼šä½¿å½“å‰çº¿ç¨‹åœ¨æ¡ä»¶å˜é‡ cv ä¸Šç­‰å¾…ï¼ŒåŒæ—¶ä¼šè§£é”ä¸ lk å…³è”çš„äº’æ–¥é” mã€‚è¿™æ„å‘³ç€å…¶ä»–çº¿ç¨‹å¯ä»¥è·å–è¯¥äº’æ–¥é”ï¼Œå¹¶å¯¹å…±äº«æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚
3.é”çš„é‡Šæ”¾ä¸å†è·å–:
4.å½“æ¡ä»¶å˜é‡ cv é€šçŸ¥ï¼ˆnotify_one æˆ– notify_allï¼‰æ—¶ï¼Œçº¿ç¨‹ä¼šè¢«å”¤é†’ï¼Œé‡æ–°è·å¾— m äº’æ–¥é”ï¼Œä¹‹åæ‰ä¼šç»§ç»­æ‰§è¡Œã€‚wait çš„è¿”å›æ—¶æœºé€šå¸¸æ˜¯åœ¨è¢«é€šçŸ¥åï¼Œè¿™æ—¶ä¼šé‡æ–°è·å¾—é”ã€‚
5.å®ç°åŸç†:
6.åœ¨ cv.wait(lk); çš„å®ç°ä¸­ï¼Œè°ƒç”¨ä¼šæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š 7.é‡Šæ”¾ lkï¼ˆå³é‡Šæ”¾äº’æ–¥é”ï¼‰ã€‚ 8.å°†çº¿ç¨‹ç½®äºç­‰å¾…çŠ¶æ€ï¼ˆæŒ‚èµ·ï¼‰ã€‚ 9.ç­‰å¾…é€šçŸ¥åï¼Œå†é‡æ–°è·å–äº’æ–¥é”ã€‚
æ€»ç»“ å› æ­¤ï¼Œåœ¨ cv.wait(lk); è°ƒç”¨æ—¶ï¼Œlk å¯¹åº”çš„äº’æ–¥é”ä¼šè¢«é‡Šæ”¾ï¼Œå…è®¸å…¶ä»–çº¿ç¨‹åœ¨æ­¤æœŸé—´æ‰§è¡Œä¸´ç•ŒåŒºä»£ç ã€‚å½“æ¡ä»¶å˜é‡å‘å‡ºé€šçŸ¥åï¼Œç­‰å¾…çš„çº¿ç¨‹ä¼šé‡æ–°è·å¾—é”å¹¶ç»§ç»­æ‰§è¡Œã€‚è¿™æ˜¯æ¡ä»¶å˜é‡å®ç°çº¿ç¨‹åŒæ­¥çš„æ ¸å¿ƒæœºåˆ¶ã€‚
`,url:"https://hugo-dead-simple.netlify.com/linux_tcp_program/my_test/%E7%90%86%E8%A7%A3/"},"https://hugo-dead-simple.netlify.com/linux_tcp_program/tcpip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/chapter_1/":{title:"",tags:[],content:`ç¬¬ä¸€ç«  ç†è§£ç½‘ç»œç¼–ç¨‹å’Œsocket ![INFO] ç½‘ç»œç¼–ç¨‹å°±æ˜¯ç¼–å†™ç¨‹åºä½¿ç”¨ä¸¤å°è¿ç½‘çš„è®¡ç®—æœºç›¸äº’äº¤æ¢æ•°æ®.
è¿™å°±æ˜¯æ•´ä¸ªç½‘ç»œç¼–ç¨‹çš„å…¨éƒ¨å†…å®¹.æˆ‘è§‰å¾—ä¸éœ€è¦å»è¯¦ç»†çš„ç†è§£TCP/IPçš„ç»†èŠ‚.
ä¸‹é¢æˆ‘æŒ‰æˆ‘çš„ç†è§£è¿™ä¸€ç« çš„å†…å®¹.
å¦‚æœæˆ‘ä»¬æƒ³åˆ°åœ¨ç”µè„‘ä¸Šåˆ›å»ºä¸€ä¸ªserverç«¯çš„è½¯ä»¶,ç”¨æ¥æ¥æ”¶å…¶å®ƒç”µè„‘ä¸Šå¦ä¸€ä¸ªç¨‹åºé€šè¿‡ç½‘ç»œå‘æ¥çš„ä¿¡æ¯,åº”è¯¥å¦‚ä½•åšå‘¢? åº”è¯¥æŒ‰ä¸‹é¢çš„æµç¨‹æ¥åš
1--- 2title: server socket åˆ›å»ºæµç¨‹ 3--- 4flowchart TD 5 step_1[1.åˆ›å»ºsocket,API:socket] 6 step_2[2.ç»‘å®šç«¯å£ä¸ip: bind] 7 step_3[3.å¼€å¯ç›‘å¬ listen] 8 step_4[4.æ¥å—äº§ç”Ÿçš„socket: accept ] 9 step_1 --&gt; step_2 --&gt; step_3 --&gt; step_4; ç¬¬ä¸€æ­¥åˆ›å»º socket(æ’åº§) å¦‚æœæˆ‘ä»¬å®¶é‡Œéœ€è¦ç½‘ç»œé€šä¿¡,é¦–å…ˆè¦æœ‰ä¸€ä¸ªç½‘ç»œé¢æ¿(ç½‘ç»œæ’åº§)ç”¨æ¥è¿æ¥ç½‘ç»œ,ç„¶åæ‰èƒ½é€šä¿¡. åŒæ ·æˆ‘ä»¬ä¹Ÿéœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªsocket,è¿™ä¸ªsocketçš„ä½œç”¨å°±æ˜¯ç”¨äºåé¢çš„ç½‘ç»œè¿æ¥.
1int socket(int domain,int type,int protocal) å…·ä½“å‚æ•°çš„å«ä¹‰ä¸ç†è§£è§ä¸€ä¸‹ç« èŠ‚
ç¬¬äºŒæ­¥ bindå‡½æ•° é€šè¿‡ç¬¬ä¸€æ­¥æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªsocket(æ’åº§),é‚£ä¹ˆåº”è¯¥æŠŠå®ƒæ”¾åœ¨å“ªé‡Œå‘¢? å…¶å®å°±æ˜¯æ ¹æ®å“ªäº›ä¿¡æ¯å¯ä»¥æ‰¾åˆ°è¿™ä¸ªsocket.
ä¿¡æ¯é¦–å…ˆè¦èƒ½å‘é€ç»™ç”µè„‘,ä¹Ÿå°±æ˜¯éœ€è¦çŸ¥é“ç”µè„‘çš„IP,ä¸€ä¸ªç”µè„‘å¯ä»¥æœ‰å¤šä¸ªIP. æ¯”å¦‚è¿™ä¸ªç”µè„‘å°±æœ‰ä¸¤ä¸ªç½‘å£,(å•ç½‘å£ä¹Ÿå¯ä»¥æœ‰å¤šIP)
å¯ä»¥æƒ³åƒåˆ°ä¸€ä¸ªç”µè„‘ä¸Šèƒ½è¿›è¡Œç½‘ç»œé€šä¿¡çš„è½¯ä»¶æœ‰å¤šä¸ª,é‚£ä¹ˆå°±æœ‰å¾ˆå¤šä¸ªsocket. ç”µè„‘ä¸ºäº†å’Œå¤–éƒ¨é€šä¿¡,åˆ›å»ºäº†ç«¯å£è¿™ä¸ªæ¦‚å¿µ.
ä½ å¯ä»¥æŠŠç«¯å£æƒ³åƒæˆç”µè„‘ä¸€ä¸ªä¸€ä¸ªå­”æ´,æ¯ä¸€ä¸ªæ•°æ®é€šè¿‡è¿™ä¸ªå­”æ´å‘æµå…¥è¿›ç”µè„‘,å¦‚ä½•ä½ çš„socket&quot;å®‰è£…&quot;åœ¨è¿™ä¸ªç«¯å£ä¸Š,é‚£ä¹ˆå°±å¯ä»¥æ¥æ”¶åˆ°è¿™ä¸ªæ•°æ®äº†.
ç„¶åè¿™ä¸ªsocketå’Œè¿˜éœ€è¦å’ŒæŸä¸€ç«¯å£ç»‘å®šåœ¨ä¸€èµ·.
1#include &lt;sys/socket.h&gt; 2int bind(int sockfd,struct sockaddr_in * myaddr,socklen_t addrlen) ç¬¬ä¸‰æ­¥: æ¿€æ´»ç›‘å¬,listen ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªsocket,å¹¶æŠŠå®ƒæ”¾åˆ°äº†åˆé€‚çš„ä½ç½®(bind),æ¥ä¸‹å°±èƒ½é€šä¿¡äº†å—? ä¸èƒ½,è¿˜éœ€è¦å¯ç”¨,æ¿€æ´»å®ƒ,å°±åƒå®¶é‡Œå¼„äº†ç½‘ç»œé¢æ¿,ç½‘çº¿,è¿˜éœ€è¦ç½‘ç»œå…¬å¸ç»™æˆ‘ä»¬å¼€é€šç½‘ç»œæƒé™.
1int listen(int sockfd,int backlog) listençš„å…¶å®æ˜¯åœ¨socketåˆ›å»ºä¸€ä¸ªç›‘å¬é˜Ÿåˆ—,é˜Ÿåˆ—å¤§å°ä¸ºbacklog,æ¯ä¸€ä¸ªclientè¯·æ±‚è¿æ¥å,å°±ä¼šåŠ å…¥åˆ°é˜Ÿåˆ—é‡Œ,ç­‰å¾…å¤„ç†
ç¬¬å››æ­¥: accept,å¤„ç†è¿æ¥è¯·æ±‚ 1int accept(int sockfd,struct sockaddr * addr ,socklen_t * addrlen); ä¸Šä¸€æ­¥,å¯ä»¥æ¥æ”¶è¿æ¥,ç„¶ååŠ å…¥åˆ°é˜Ÿåˆ—é‡Œ,ä½†æ˜¯è¿˜éœ€è¦å¯¹è¿™äº›é˜Ÿåˆ—é‡Œçš„å†…å®¹è¿›è¡Œå¤„ç†.
acceptçš„ä½œç”¨,ä»é˜Ÿåˆ—å–å‡ºä¸€ä¸ªè¿æ¥æ•°æ®,ç„¶ååˆ›å»ºä¸€ä¸ªsocket.ä½ å¯èƒ½ä¼šé—®,ä¸ºä»€ä¹ˆåˆåˆ›å»ºäº†ä¸€ä¸ªsocket,åŸæ¥ä¸æ˜¯æœ‰ä¸€ä¸ªå—?
é¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®çš„çŸ¥é“ä¸€ä¸ªæ¦‚å¿µ,ä¸¤ä¸ªsocketä¸€åœ¨ä¸€èµ·æ‰èƒ½è¿›è¡Œé€šä¿¡,æˆ–è€…è¯´é€šä¿¡çš„ä¸¤ä¸ªç”µè„‘ä¹‹é—´å„æœ‰ä¸€ä¸ªsocket,ä¸å…è®¸ä¸€socketå¯¹åº”å¤šä¸ªsocket.
ç¬¬ä¸€ä¸ªsocket,æˆ‘ä»¬çš„æˆä¸ºsocket,æˆ‘ä»¬ç§°ä¸ºserver socket,å®ƒåœ¨åŒä¸€æ—¶åˆ»ä¸ä¸€ä¸ªclient socketè¿›è¡Œè¿æ¥,ç„¶åæ¥æ”¶åˆ°å¿…è¦çš„ä¿¡æ¯ä¹‹å.æ ¹æ®è¿™äº›ä¿¡æ¯äº§ç”Ÿä¸€ä¸ªsocket A.è¿™ä¸ªæ–°çš„socket Aå·²ååªä¸è¿™ä¸ªclient socketè¿›è¡Œé€šä¿¡.
è¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬ç§°ä¸ºaccept
serverç«¯ä»£ç  1{{#include code/1-hello_world_server.c}} ç¼–è¯‘
1gcc -g -o server 1-hello_world_server.c æµ‹è¯•
1netcat -v 127.0.0.1 8989 ç»“æœ
1â netcat -v 127.0.0.1 8989 2localhost [127.0.0.1] 8989 (sunwebadmins) open 3Hello World!% clientç«¯ä»£ç  clientå®ç°æ¯”è¾ƒç®€å•
åˆ›å»ºsocket è°ƒç”¨connect,ä¸server socketè¿›è¡Œè¿æ¥ å‘é€æ•°æ® æ¥æ”¶è¿”å›çš„æ•°æ® ç»“æŸclient socket 1{{#include code/1-hello_world_client.c}} è¿è¡Œç»“æœ
1â ./1-hello_world_client.out 2Message from server: Hello World! inet_addr å‡½æ•° inet_addr æ˜¯ä¸€ä¸ªç”¨äºå°† IPv4 åœ°å€ä»ç‚¹åˆ†åè¿›åˆ¶å­—ç¬¦ä¸²è¡¨ç¤ºè½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºçš„ 32 ä½äºŒè¿›åˆ¶å€¼çš„å‡½æ•°ã€‚å®ƒåœ¨ Linux å’Œå…¶ä»–ç±» Unix ç³»ç»Ÿçš„ç½‘ç»œç¼–ç¨‹ä¸­å¹¿æ³›ä½¿ç”¨ã€‚
man 3 inet_addr
å‡½æ•°åŸå‹ï¼š
1#include &lt;arpa/inet.h&gt; 2in_addr_t inet_addr(const char *cp); å‚æ•°ï¼š
cpï¼šä»¥ç‚¹åˆ†åè¿›åˆ¶æ ¼å¼è¡¨ç¤ºçš„ IPv4 åœ°å€å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ &ldquo;192.168.0.1&rdquo;ã€‚ è¿”å›å€¼ï¼š
æˆåŠŸæ—¶ï¼Œè¿”å›è½¬æ¢åçš„ 32 ä½ç½‘ç»œå­—èŠ‚åºçš„ IPv4 åœ°å€ã€‚ å¤±è´¥æ—¶ï¼Œè¿”å› INADDR_NONEï¼ˆé€šå¸¸ä¸º -1ï¼‰ã€‚ inet_addr å‡½æ•°å°†ç‚¹åˆ†åè¿›åˆ¶æ ¼å¼çš„ IPv4 åœ°å€å­—ç¬¦ä¸²è½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºçš„ 32 ä½äºŒè¿›åˆ¶å€¼ã€‚å®ƒæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š
å°†ç‚¹åˆ†åè¿›åˆ¶çš„ IPv4 åœ°å€å­—ç¬¦ä¸²æŒ‰ç…§ç‚¹å·åˆ†éš”ç¬¦åˆ†å‰²ä¸ºå››ä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†è¡¨ç¤ºä¸€ä¸ªå­—èŠ‚ã€‚ å°†æ¯ä¸ªéƒ¨åˆ†è½¬æ¢ä¸ºå¯¹åº”çš„æ•´æ•°å€¼ï¼ˆ0-255ï¼‰ã€‚ å°†å››ä¸ªå­—èŠ‚ç»„åˆæˆä¸€ä¸ª 32 ä½çš„äºŒè¿›åˆ¶å€¼ï¼Œå¹¶æŒ‰ç…§ç½‘ç»œå­—èŠ‚åºæ’åˆ—ã€‚ ä¾‹å¦‚ï¼Œå¯¹äº IP åœ°å€ &ldquo;192.168.0.1&rdquo;ï¼Œinet_addr å‡½æ•°å°†è¿”å›ä¸€ä¸ª 32 ä½çš„æ•´æ•°å€¼ 0x0100A8C0ï¼ˆç½‘ç»œå­—èŠ‚åºï¼‰ã€‚
ä½¿ç”¨ç¤ºä¾‹ï¼š
1#include &lt;stdio.h&gt; 2#include &lt;arpa/inet.h&gt; 3 4int main() { 5 const char *ip_str = &#34;192.168.0.1&#34;; 6 in_addr_t ip_addr = inet_addr(ip_str); 7 8 if (ip_addr == INADDR_NONE) { 9 printf(&#34;æ— æ•ˆçš„ IP åœ°å€\\n&#34;); 10 } else { 11 printf(&#34;IP åœ°å€çš„ç½‘ç»œå­—èŠ‚åºè¡¨ç¤º: 0x%08X\\n&#34;, ip_addr); 12 } 13 14 return 0; 15} è¾“å‡ºï¼š
1IP åœ°å€çš„ç½‘ç»œå­—èŠ‚åºè¡¨ç¤º: 0x0100A8C0 éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œinet_addr å‡½æ•°åªæ”¯æŒ IPv4 åœ°å€çš„è½¬æ¢ï¼Œå¯¹äº IPv6 åœ°å€ï¼Œéœ€è¦ä½¿ç”¨ inet_pton å‡½æ•°è¿›è¡Œè½¬æ¢ã€‚
å¦å¤–ï¼Œç”±äº inet_addr å‡½æ•°ä¸èƒ½å¤„ç†æ ¼å¼é”™è¯¯çš„ IP åœ°å€å­—ç¬¦ä¸²ï¼Œå› æ­¤åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œé€šå¸¸æ¨èä½¿ç”¨æ›´åŠ å¥å£®å’Œé€šç”¨çš„ inet_pton å‡½æ•°æ¥è¿›è¡Œ IP åœ°å€çš„è½¬æ¢ã€‚
linuxçš„æ–‡ä»¶æ“ä½œ æ¯ä¸€ä¸ªç¨‹åºéƒ½æœ‰å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦,ä» 0 åˆ° 1023ï¼Œè¿™äº›0,1,2æ–‡ä»¶æè¿°ç¬¦è¢«ç§°ä¸ºæ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºã€æ ‡å‡†é”™è¯¯ã€‚
è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æ˜¯ç”±linuxç³»ç»Ÿç»´æŠ¤çš„.
1int open(const char *pathname, int flags); 2int close(int fd); 3ssize_t read(int fd, void *buf, size_t count); 4ssize_t write(int fd, const void *buf, size_t count); `,url:"https://hugo-dead-simple.netlify.com/linux_tcp_program/tcpip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/chapter_1/"},"https://hugo-dead-simple.netlify.com/linux_tcp_program/tcpip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/chapter_10/":{title:"",tags:[],content:`ä¸ºäº†åŠ å¤§æœåŠ¡å™¨åŒæ—¶å¤„ç†ç”¨æˆ·çš„è¿æ¥,æœ‰æ•ˆçš„åˆ©ç”¨CPU
å¤šè¿›ç¨‹æœåŠ¡å™¨: åˆ›å»ºå¤šä¸ªè¿›ç¨‹æä¾›æœåŠ¡ å¤šè·¯å¤ç”¨: æ†ç»‘å¹¶ç»Ÿä¸€ç®¡ç†IOå¯¹è±¡æä¾›æœåŠ¡ å¤šçº¿ç¨‹: ç”Ÿæˆä¸å®¢æˆ·çŸ­ç­‰é‡åŒ–çš„çº¿ç¨‹æä¾›æœåŠ¡ 10.1 è¿›ç¨‹æ¦‚å¿µåŠå¼•ç”¨ ç†è§£è¿›ç¨‹ è¿›ç¨‹çš„å®šä¹‰å¦‚ä¸‹ï¼šå ç”¨å†…å­˜ç©ºé—´çš„æ­£åœ¨è¿è¡Œçš„ç¨‹åº
è¿›ç¨‹ID åœ¨è¯´è¿›ç¨‹åˆ›å»ºæ–¹æ³•ä¹‹å‰ï¼Œå…ˆè¦ç®€è¦è¯´æ˜è¿›ç¨‹ IDã€‚æ— è®ºè¿›ç¨‹æ˜¯å¦‚ä½•åˆ›å»ºçš„ï¼Œæ‰€æœ‰çš„è¿›ç¨‹éƒ½ä¼šè¢«æ“ä½œç³»ç»Ÿåˆ†é…ä¸€ä¸ª IDã€‚æ­¤ ID è¢«ç§°ä¸ºã€Œè¿›ç¨‹IDã€ï¼Œå…¶å€¼ä¸ºå¤§äº 2 çš„æ•´æ•°ã€‚1 è¦åˆ†é…ç»™æ“ä½œç³»ç»Ÿå¯åŠ¨åçš„ï¼ˆç”¨äºååŠ©æ“ä½œç³»ç»Ÿï¼‰é¦–ä¸ªè¿›ç¨‹ï¼Œå› æ­¤ç”¨æˆ·æ— æ³•å¾—åˆ° ID å€¼ä¸º 1 ã€‚æ¥ä¸‹æ¥è§‚å¯Ÿåœ¨ Linux ä¸­è¿è¡Œçš„è¿›ç¨‹ã€‚
forkåˆ›å»ºè¿›ç¨‹ åˆ›å»ºè¿›ç¨‹çš„æ–¹å¼å¾ˆå¤šï¼Œæ­¤å¤„åªä»‹ç»ç”¨äºåˆ›å»ºå¤šè¿›ç¨‹æœåŠ¡ç«¯çš„ fork å‡½æ•°ã€‚
1#include &lt;unistd.h&gt; 2pid_t fork(void); 3// æˆåŠŸæ—¶è¿”å›è¿›ç¨‹ID,å¤±è´¥æ—¶è¿”å› -1 fork å‡½æ•°å°†åˆ›å»ºè°ƒç”¨çš„è¿›ç¨‹å‰¯æœ¬ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¹¶éæ ¹æ®å®Œå…¨ä¸åŒçš„ç¨‹åºåˆ›å»ºè¿›ç¨‹ï¼Œè€Œæ˜¯å¤åˆ¶æ­£åœ¨è¿è¡Œçš„ã€è°ƒç”¨ fork å‡½æ•°çš„è¿›ç¨‹ã€‚å¦å¤–ï¼Œä¸¤ä¸ªè¿›ç¨‹éƒ½æ‰§è¡Œ fork å‡½æ•°è°ƒç”¨åçš„è¯­å¥ï¼ˆå‡†ç¡®çš„è¯´æ˜¯åœ¨ fork å‡½æ•°è¿”å›åï¼‰ã€‚ä½†å› ä¸ºæ˜¯é€šè¿‡åŒä¸€ä¸ªè¿›ç¨‹ã€å¤åˆ¶ç›¸åŒçš„å†…å­˜ç©ºé—´ï¼Œä¹‹åçš„ç¨‹åºæµè¦æ ¹æ® fork å‡½æ•°çš„è¿”å›å€¼åŠ ä»¥åŒºåˆ†ã€‚å³åˆ©ç”¨ fork å‡½æ•°çš„å¦‚ä¸‹ç‰¹ç‚¹åŒºåˆ†ç¨‹åºæ‰§è¡Œæµç¨‹ã€‚
çˆ¶è¿›ç¨‹ï¼šfork å‡½æ•°è¿”å›å­è¿›ç¨‹ ID å­è¿›ç¨‹ï¼šfork å‡½æ•°è¿”å› 0 æ­¤å¤„ï¼Œã€Œçˆ¶è¿›ç¨‹ã€ï¼ˆParent Processï¼‰æŒ‡åŸè¿›ç¨‹ï¼Œå³è°ƒç”¨ fork å‡½æ•°çš„ä¸»ä½“ï¼Œè€Œã€Œå­è¿›ç¨‹ã€ï¼ˆChild Processï¼‰æ˜¯é€šè¿‡çˆ¶è¿›ç¨‹è°ƒç”¨ fork å‡½æ•°å¤åˆ¶å‡ºçš„è¿›ç¨‹ã€‚æ¥ä¸‹æ¥æ˜¯è°ƒç”¨ fork å‡½æ•°åçš„ç¨‹åºè¿è¡Œæµç¨‹ã€‚å¦‚å›¾æ‰€ç¤ºï¼š
ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œçˆ¶è¿›ç¨‹è°ƒç”¨ fork å‡½æ•°çš„åŒæ—¶å¤åˆ¶å‡ºå­è¿›ç¨‹ï¼Œå¹¶åˆ†åˆ«å¾—åˆ° fork å‡½æ•°çš„è¿”å›å€¼ã€‚ä½†å¤åˆ¶å‰ï¼Œçˆ¶è¿›ç¨‹å°†å…¨å±€å˜é‡ gval å¢åŠ åˆ° 11,å°†å±€éƒ¨å˜é‡ lval çš„å€¼å¢åŠ åˆ° 25ï¼Œå› æ­¤åœ¨è¿™ç§çŠ¶æ€ä¸‹å®Œæˆè¿›ç¨‹å¤åˆ¶ã€‚å¤åˆ¶å®Œæˆåæ ¹æ® fork å‡½æ•°çš„è¿”å›ç±»å‹åŒºåˆ†çˆ¶å­è¿›ç¨‹ã€‚çˆ¶è¿›ç¨‹çš„ lval çš„å€¼å¢åŠ  1 ï¼Œä½†è¿™ä¸ä¼šå½±å“å­è¿›ç¨‹çš„ lval å€¼ã€‚åŒæ ·å­è¿›ç¨‹å°† gval çš„å€¼å¢åŠ  1 ä¹Ÿä¸ä¼šå½±å“åˆ°çˆ¶è¿›ç¨‹çš„ gval ã€‚å› ä¸º fork å‡½æ•°è°ƒç”¨ååˆ†æˆäº†å®Œå…¨ä¸åŒçš„è¿›ç¨‹ï¼Œåªæ˜¯äºŒè€…å…±äº«åŒä¸€æ®µä»£ç è€Œå·²ã€‚æ¥ä¸‹æ¥ç»™å‡ºä¸€ä¸ªä¾‹å­ï¼š
1#include &lt;stdio.h&gt; 2#include &lt;unistd.h&gt; 3int gval = 10; 4int main(int argc, char *argv[]) 5{ 6 pid_t pid; 7 int lval = 20; 8 gval++, lval += 5; 9 pid = fork(); 10 if (pid == 0) 11 gval += 2, lval += 2; 12 else 13 gval -= 2, lval -= 2; 14 if (pid == 0) 15 printf(&#34;Child Proc: [%d,%d] \\n&#34;, gval, lval); 16 else 17 printf(&#34;Parent Proc: [%d,%d] \\n&#34;, gval, lval); 18 return 0; 19} 10.2 è¿›ç¨‹ä¸åƒµå°¸è¿›ç¨‹ æ–‡ä»¶æ“ä½œä¸­ï¼Œå…³é—­æ–‡ä»¶å’Œæ‰“å¼€æ–‡ä»¶åŒç­‰é‡è¦ã€‚åŒæ ·ï¼Œè¿›ç¨‹é”€æ¯å’Œè¿›ç¨‹åˆ›å»ºä¹ŸåŒç­‰é‡è¦ã€‚å¦‚æœæœªè®¤çœŸå¯¹å¾…è¿›ç¨‹é”€æ¯ï¼Œä»–ä»¬å°†å˜æˆåƒµå°¸è¿›ç¨‹ã€‚
è¿›ç¨‹çš„å·¥ä½œå®Œæˆåï¼ˆæ‰§è¡Œå®Œ main å‡½æ•°ä¸­çš„ç¨‹åºåï¼‰åº”è¢«é”€æ¯ï¼Œä½†æœ‰æ—¶è¿™äº›è¿›ç¨‹å°†å˜æˆåƒµå°¸è¿›ç¨‹ï¼Œå ç”¨ç³»ç»Ÿä¸­çš„é‡è¦èµ„æºã€‚è¿™ç§çŠ¶æ€ä¸‹çš„è¿›ç¨‹ç§°ä½œã€Œåƒµå°¸è¿›ç¨‹ã€ï¼Œè¿™ä¹Ÿæ˜¯ç»™ç³»ç»Ÿå¸¦æ¥è´Ÿæ‹…çš„åŸå› ä¹‹ä¸€ã€‚
åƒµå°¸è¿›ç¨‹æ˜¯å½“å­è¿›ç¨‹æ¯”çˆ¶è¿›ç¨‹å…ˆç»“æŸï¼Œè€Œçˆ¶è¿›ç¨‹åˆæ²¡æœ‰å›æ”¶å­è¿›ç¨‹ï¼Œé‡Šæ”¾å­è¿›ç¨‹å ç”¨çš„èµ„æºï¼Œæ­¤æ—¶å­è¿›ç¨‹å°†æˆä¸ºä¸€ä¸ªåƒµå°¸è¿›ç¨‹ã€‚å¦‚æœçˆ¶è¿›ç¨‹å…ˆé€€å‡º ï¼Œå­è¿›ç¨‹è¢«initæ¥ç®¡ï¼Œå­è¿›ç¨‹é€€å‡ºåinitä¼šå›æ”¶å…¶å ç”¨çš„ç›¸å…³èµ„æº
UNIXå‘½ä»¤psåˆ—å‡ºçš„è¿›ç¨‹çš„çŠ¶æ€ï¼ˆ&ldquo;STAT&rdquo;ï¼‰æ æ ‡ç¤ºä¸º &ldquo;Z&quot;åˆ™ä¸ºåƒµå°¸è¿›ç¨‹ã€‚[1]
æ”¶å‰²åƒµå°¸è¿›ç¨‹çš„æ–¹æ³•æ˜¯é€šè¿‡killå‘½ä»¤æ‰‹å·¥å‘å…¶çˆ¶è¿›ç¨‹å‘é€SIGCHLDä¿¡å·ã€‚å¦‚æœå…¶çˆ¶è¿›ç¨‹ä»ç„¶æ‹’ç»æ”¶å‰²åƒµå°¸è¿›ç¨‹ï¼Œåˆ™ç»ˆæ­¢çˆ¶è¿›ç¨‹ï¼Œä½¿å¾—initè¿›ç¨‹æ”¶å…»åƒµå°¸è¿›ç¨‹ã€‚initè¿›ç¨‹å‘¨æœŸæ‰§è¡Œwaitç³»ç»Ÿè°ƒç”¨æ”¶å‰²å…¶æ”¶å…»çš„æ‰€æœ‰åƒµå°¸è¿›ç¨‹ã€‚
äº§ç”Ÿåƒµå°¸è¿›ç¨‹çš„åŸå›  äº§ç”Ÿåƒµå°¸è¿›ç¨‹çš„åŸå› æ˜¯: å½“å­è¿›ç¨‹ç»“æŸæ—¶,æ“ä½œç³»ç»Ÿä¸ä¼šä¸»åŠ¨å°†å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ä¼ é€’ç»™çˆ¶è¿›ç¨‹ ã€‚åªæœ‰çˆ¶è¿›ç¨‹ä¸»åŠ¨è¯·æ±‚è·å–å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€, æ“ä½œç³»ç»Ÿæ‰ä¼šå°†å…¶ä¼ é€’ã€‚å¦‚æœçˆ¶è¿›ç¨‹æ²¡æœ‰ä¸»åŠ¨è¦æ±‚è·å–å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€,æ“ä½œç³»ç»Ÿå°†ä¸€ç›´ä¿å­˜å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€,å¯¼è‡´å­è¿›ç¨‹é•¿æ—¶é—´å¤„äºåƒµå°¸è¿›ç¨‹çŠ¶æ€ã€‚å› æ­¤,ä¸ºäº†åŠæ—¶å›æ”¶å­è¿›ç¨‹,çˆ¶è¿›ç¨‹åº”è¯¥ä¸»åŠ¨è·å–å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ã€‚
zombie.c
1{{#include chapter_10/zombie.c }} é”€æ¯åƒµå°¸ waitå‡½æ•° çˆ¶è¿›ç¨‹åº”è¯¥ä¸»åŠ¨è¯·æ±‚è·å–å­è¿›ç¨‹çš„è¿”å›å€¼ä»¥é”€æ¯å­è¿›ç¨‹ã€‚ä½¿ç”¨ wait å‡½æ•°æ¥è·å–å­è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€ï¼Œé€šè¿‡å® WIFEXITED å’Œ WEXITSTATUS æ¥åˆ†ç¦»å’Œå¤„ç†å­è¿›ç¨‹çš„è¿”å›å€¼ã€‚
{{#include chapter_10/wait.c }}
é”€æ¯åƒµå°¸ waitpidå‡½æ•° wait å‡½æ•°ä¼šå¼•èµ·ç¨‹åºé˜»å¡ï¼Œè¿˜å¯ä»¥è€ƒè™‘è°ƒç”¨ waitpid å‡½æ•°ã€‚è¿™æ˜¯é˜²æ­¢åƒµå°¸è¿›ç¨‹çš„ç¬¬äºŒç§æ–¹æ³•ï¼Œä¹Ÿæ˜¯é˜²æ­¢é˜»å¡çš„æ–¹æ³•ã€‚
1#include &lt;sys/wait.h&gt; 2pid_t waitpid(pid_t pid, int *statloc, int options); 3/* 4æˆåŠŸæ—¶è¿”å›ç»ˆæ­¢çš„å­è¿›ç¨‹ID æˆ– 0 ï¼Œå¤±è´¥æ—¶è¿”å› -1 5pid: ç­‰å¾…ç»ˆæ­¢çš„ç›®æ ‡å­è¿›ç¨‹çš„ID,è‹¥ä¼  -1ï¼Œåˆ™ä¸ wait å‡½æ•°ç›¸åŒï¼Œå¯ä»¥ç­‰å¾…ä»»æ„å­è¿›ç¨‹ç»ˆæ­¢ 6statloc: ä¸ wait å‡½æ•°çš„ statloc å‚æ•°å…·æœ‰ç›¸åŒå«ä¹‰ 7options: ä¼ é€’å¤´æ–‡ä»¶ sys/wait.h å£°æ˜çš„å¸¸é‡ WNOHANG ,å³ä½¿æ²¡æœ‰ç»ˆæ­¢çš„å­è¿›ç¨‹ä¹Ÿä¸ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯è¿”å› 0 é€€å‡ºå‡½æ•°ã€‚ 8*/ waitpid.c
1#include &lt;stdio.h&gt; 2#include &lt;unistd.h&gt; 3#include &lt;sys/wait.h&gt; 4int main(int argc, char *argv[]) 5{ 6 int status; 7 pid_t pid = fork(); 8 if (pid == 0) 9 { 10 sleep(15); //ç”¨ sleep æ¨è¿Ÿå­è¿›ç¨‹çš„æ‰§è¡Œ 11 return 24; 12 } 13 else 14 { 15 //è°ƒç”¨waitpid ä¼ é€’å‚æ•° WNOHANG ï¼Œè¿™æ ·ä¹‹å‰æœ‰æ²¡æœ‰ç»ˆæ­¢çš„å­è¿›ç¨‹åˆ™è¿”å›0 16 while (!waitpid(-1, &amp;status, WNOHANG)) 17 { 18 sleep(3); 19 puts(&#34;sleep 3 sec.&#34;); 20 } 21 if (WIFEXITED(status)) 22 printf(&#34;Child send %d \\n&#34;, WEXITSTATUS(status)); 23 } 24 return 0; 10.3 ä¿¡å·å¤„ç† å­è¿›ç¨‹ç©¶ç«Ÿä½•æ—¶ç»ˆæ­¢ï¼Ÿè°ƒç”¨ waitpid å‡½æ•°åè¦æ— ä¼‘æ­¢çš„ç­‰å¾…å—ï¼Ÿ
ä¿¡å·æ˜¯ä¸€ç§è½¯ä¸­æ–­ï¼Œå®ƒæ˜¯ç”±æ“ä½œç³»ç»Ÿå‘è¿›ç¨‹å‘é€çš„é€šçŸ¥æ¶ˆæ¯ã€‚ä¿¡å·çš„ä½œç”¨æ˜¯é€šçŸ¥è¿›ç¨‹å‘ç”Ÿäº†æŸç§äº‹ä»¶ï¼Œå¦‚è¿›ç¨‹ç»ˆæ­¢ã€è¿›ç¨‹æ”¶åˆ°æŸç§è¾“å…¥ã€è¿›ç¨‹æ‰§è¡Œæ—¶é—´åˆ°è¾¾æŸä¸€ç‚¹ç­‰ã€‚ä¿¡å·çš„å¤„ç†æ–¹å¼æ˜¯é€šè¿‡ä¿¡å·å¤„ç†å‡½æ•°æ¥å®ç°çš„ã€‚
å­è¿›ç¨‹ç»ˆæ­¢çš„è¯†åˆ«ä¸»ä½“æ˜¯æ“ä½œç³»ç»Ÿï¼Œå› æ­¤ï¼Œè‹¥æ“ä½œç³»ç»Ÿèƒ½æŠŠå­è¿›ç¨‹ç»“æŸçš„ä¿¡æ¯å‘Šè¯‰æ­£å¿™äºå·¥ä½œçš„çˆ¶è¿›ç¨‹ï¼Œå°†æœ‰åŠ©äºæ„å»ºæ›´é«˜æ•ˆçš„ç¨‹åº
ä¿¡å·ä¸signalå‡½æ•° æˆ‘ä»¬å¯ä»¥æ³¨å†Œä¿¡å·å¤„ç†å‡½æ•°ï¼Œå½“ä¿¡å·å‘ç”Ÿæ—¶ï¼Œæ“ä½œç³»ç»Ÿå°†è°ƒç”¨ç›¸åº”çš„ä¿¡å·å¤„ç†å‡½æ•°ã€‚ä¿¡å·å¤„ç†å‡½æ•°çš„åŸå‹å¦‚ä¸‹ï¼š
1#include &lt;signal.h&gt; 2void (*signal(int signo, void (*func)(int)))(int); 3/* 4ä¸ºäº†åœ¨äº§ç”Ÿä¿¡å·æ—¶è°ƒç”¨ï¼Œè¿”å›ä¹‹å‰æ³¨å†Œçš„å‡½æ•°æŒ‡é’ˆ 5å‡½æ•°å: signal 6å‚æ•°ï¼šint signo,void(*func)(int) 7è¿”å›ç±»å‹ï¼šå‚æ•°ç±»å‹ä¸ºintå‹ï¼Œè¿”å› void å‹å‡½æ•°æŒ‡é’ˆ 8*/ è¿™ä¸ªå‡½æ•°æ¯”è¾ƒéš¾,æˆ‘è¿™æ ·ç†è§£
æœ‰å‡½æ•°ä¸º
1void func_a(int) è¿™ä¸ªå‡½æ•°çš„æ˜¯ä¸€ä¸ªè¿”å›å€¼ä¸ºvoid,å‚æ•°ä¸ºintçš„å‡½æ•°.
1void (*func_b)(int) 2 3//ç›¸å½“äº 4 5//å®šä¹‰ä¸€ä¸ªç±»å‹,å‡½æ•°æŒ‡é’ˆ 6typedef void (*)(int) func_a_pointer; 7// å®šä¹‰ä¸€ä¸ªæŒ‡å‘å‡½æ•°çš„å˜é‡ 8func_a_pointer func_a_p = func_a; æ€ä¹ˆç†è§£å‡½æ•°æŒ‡é’ˆ å†éš¾ä¸€ç‚¹,å®šä¹‰å‡½æ•°çš„è¿”å›å€¼ ä¸ºå‡½æ•°æŒ‡é’ˆ
1void (*func_c(int))(int) 2 3typedef void (*)(int) func_a_pointer; 4// å®šä¹‰ä¸€ä¸ªæŒ‡å‘å‡½æ•°çš„å˜é‡ 5func_a_pointer function_c(int); å†éš¾ä¸€ç‚¹,å‡½æ•°çš„è¿”å›å€¼ä¸ºå‡½æ•°æŒ‡é’ˆ,ä¸”å‡½æ•°çš„å‚æ•°è¿˜æœ‰ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ
1void (*signal(int signo, void (*func)(int)))(int); è°ƒç”¨ä¸Šè¿°å‡½æ•°æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç‰¹æ®Šæƒ…å†µä¿¡æ¯ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç‰¹æ®Šæƒ…å†µä¸‹å°†è¦è°ƒç”¨çš„å‡½æ•°çš„åœ°å€å€¼ï¼ˆæŒ‡é’ˆï¼‰ã€‚å‘ç”Ÿç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨çš„æƒ…å†µæ—¶ï¼Œè°ƒç”¨ç¬¬äºŒä¸ªå‚æ•°æ‰€æŒ‡çš„å‡½æ•°ã€‚ä¸‹é¢ç»™å‡ºå¯ä»¥åœ¨ signal å‡½æ•°ä¸­æ³¨å†Œçš„éƒ¨åˆ†ç‰¹æ®Šæƒ…å†µå’Œå¯¹åº”çš„å‡½æ•°ã€‚
SIGALRMï¼šå·²åˆ°é€šè¿‡è°ƒç”¨ alarm å‡½æ•°æ—¶å€™äº§ç”Ÿ SIGINTï¼šè¾“å…¥ ctrl+c SIGCHLDï¼šå­è¿›ç¨‹ç»ˆæ­¢ 1#include &lt;stdio.h&gt; 2#include &lt;unistd.h&gt; 3#include &lt;signal.h&gt; 4void timeout(int sig) //ä¿¡å·å¤„ç†å™¨ 5{ 6 if (sig == SIGALRM) 7 puts(&#34;Time out!&#34;); 8 alarm(2); //ä¸ºäº†æ¯éš” 2 ç§’é‡å¤äº§ç”Ÿ SIGALRM ä¿¡å·ï¼Œåœ¨ä¿¡å·å¤„ç†å™¨ä¸­è°ƒç”¨ alarm å‡½æ•° 9} 10void keycontrol(int sig) //ä¿¡å·å¤„ç†å™¨ 11{ 12 if (sig == SIGINT) 13 puts(&#34;CTRL+C pressed&#34;); 14} 15int main(int argc, char *argv[]) 16{ 17 int i; 18 signal(SIGALRM, timeout); //æ³¨å†Œä¿¡å·åŠç›¸åº”å¤„ç†å™¨ 19 signal(SIGINT, keycontrol); 20 alarm(2); //é¢„çº¦ 2 ç§’å€™å‘ç”Ÿ SIGALRM ä¿¡å· 21 22 for (i = 0; i &lt; 3; i++) 23 { 24 puts(&#34;wait...&#34;); 25 sleep(100); 26 } 27 return 0; 28} å‘ç”Ÿä¿¡å·æ—¶å°†å”¤é†’ç”±äºè°ƒç”¨ sleep å‡½æ•°è€Œè¿›å…¥é˜»å¡çŠ¶æ€çš„è¿›ç¨‹ã€‚
åˆ©ç”¨ sigaction å‡½æ•°è¿›è¡Œä¿¡å·å¤„ç† è¿˜æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå«åš sigaction å‡½æ•°ï¼Œä»–ç±»ä¼¼äº signal å‡½æ•°ï¼Œè€Œä¸”å¯ä»¥å®Œå…¨ä»£æ›¿åè€…ï¼Œä¹Ÿæ›´ç¨³å®šã€‚ä¹‹æ‰€ä»¥ç¨³å®šï¼Œæ˜¯å› ä¸ºï¼š
signal å‡½æ•°åœ¨ Unix ç³»åˆ—çš„ä¸åŒæ“ä½œç³»ç»Ÿå¯èƒ½å­˜åœ¨åŒºåˆ«ï¼Œä½† sigaction å‡½æ•°å®Œå…¨ç›¸åŒ
å®é™…ä¸Šç°åœ¨å¾ˆå°‘ç”¨ signal å‡½æ•°ç¼–å†™ç¨‹åºï¼Œä»–åªæ˜¯ä¸ºäº†ä¿æŒå¯¹æ—§ç¨‹åºçš„å…¼å®¹ï¼Œä¸‹é¢ä»‹ç» sigaction å‡½æ•°ï¼Œåªè®²è§£å¯ä»¥æ›¿æ¢ signal å‡½æ•°çš„åŠŸèƒ½ã€‚
1#include &lt;signal.h&gt; 2 3int sigaction(int signo, const struct sigaction *act, struct sigaction *oldact); 4/* 5æˆåŠŸæ—¶è¿”å› 0 ï¼Œå¤±è´¥æ—¶è¿”å› -1 6act: å¯¹äºç¬¬ä¸€ä¸ªå‚æ•°çš„ä¿¡å·å¤„ç†å‡½æ•°ï¼ˆä¿¡å·å¤„ç†å™¨ï¼‰ä¿¡æ¯ã€‚ 7oldact: é€šè¿‡æ­¤å‚æ•°è·å–ä¹‹å‰æ³¨å†Œçš„ä¿¡å·å¤„ç†å‡½æ•°æŒ‡é’ˆï¼Œè‹¥ä¸éœ€è¦åˆ™ä¼ é€’ 0 8*/ å£°æ˜å¹¶åˆå§‹åŒ– sigaction ç»“æ„ä½“å˜é‡ä»¥è°ƒç”¨ä¸Šè¿°å‡½æ•°ï¼Œè¯¥ç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼š
1struct sigaction 2{ 3 void (*sa_handler)(int); 4 sigset_t sa_mask; 5 int sa_flags; 6}; 1#include &lt;stdio.h&gt; 2#include &lt;unistd.h&gt; 3#include &lt;signal.h&gt; 4 5void timeout(int sig) 6{ 7 if (sig == SIGALRM) 8 puts(&#34;Time out!&#34;); 9 alarm(2); 10} 11 12int main(int argc, char *argv[]) 13{ 14 int i; 15 struct sigaction act; 16 act.sa_handler = timeout; //ä¿å­˜å‡½æ•°æŒ‡é’ˆ 17 sigemptyset(&amp;act.sa_mask); //å°† sa_mask æˆå‘˜çš„æ‰€æœ‰ä½åˆå§‹åŒ–æˆ0 18 act.sa_flags = 0; //sa_flags åŒæ ·åˆå§‹åŒ–æˆ 0 19 sigaction(SIGALRM, &amp;act, 0); //æ³¨å†Œ SIGALRM ä¿¡å·çš„å¤„ç†å™¨ã€‚ 20 21 alarm(2); //2 ç§’åå‘ç”Ÿ SIGALRM ä¿¡å· 22 23 for (int i = 0; i &lt; 3; i++) 24 { 25 puts(&#34;wait...&#34;); 26 sleep(100); 27 } 28 return 0; 29} 10.3.4 åˆ©ç”¨ä¿¡å·å¤„ç†æŠ€æœ¯æ¶ˆç­åƒµå°¸è¿›ç¨‹ ä¸‹é¢åˆ©ç”¨å­è¿›ç¨‹ç»ˆæ­¢æ—¶äº§ç”Ÿ SIGCHLD ä¿¡å·è¿™ä¸€ç‚¹ï¼Œæ¥ç”¨ä¿¡å·å¤„ç†æ¥æ¶ˆç­åƒµå°¸è¿›ç¨‹ã€‚çœ‹ä»¥ä¸‹ä»£ç ï¼š
1#include &lt;stdio.h&gt; 2#include &lt;stdlib.h&gt; 3#include &lt;unistd.h&gt; 4#include &lt;signal.h&gt; 5#include &lt;sys/wait.h&gt; 6 7void read_childproc(int sig) 8{ 9 int status; 10 pid_t id = waitpid(-1, &amp;status, WNOHANG); 11 if (WIFEXITED(status)) 12 { 13 printf(&#34;Removed proc id: %d \\n&#34;, id); //å­è¿›ç¨‹çš„ pid 14 printf(&#34;Child send: %d \\n&#34;, WEXITSTATUS(status)); //å­è¿›ç¨‹çš„è¿”å›å€¼ 15 } 16} 17 18int main(int argc, char *argv[]) 19{ 20 pid_t pid; 21 struct sigaction act; 22 act.sa_handler = read_childproc; 23 sigemptyset(&amp;act.sa_mask); 24 act.sa_flags = 0; 25 sigaction(SIGCHLD, &amp;act, 0); 26 27 pid = fork(); 28 if (pid == 0) //å­è¿›ç¨‹æ‰§è¡Œé˜¶æ®µ 29 { 30 puts(&#34;Hi I&#39;m child process&#34;); 31 sleep(10); 32 return 12; 33 } 34 else //çˆ¶è¿›ç¨‹æ‰§è¡Œé˜¶æ®µ 35 { 36 printf(&#34;Child proc id: %d\\n&#34;, pid); 37 pid = fork(); 38 if (pid == 0) 39 { 40 puts(&#34;Hi! I&#39;m child process&#34;); 41 sleep(10); 42 exit(24); 43 } 44 else 45 { 46 int i; 47 printf(&#34;Child proc id: %d \\n&#34;, pid); 48 for (i = 0; i &lt; 5; i++) 49 { 50 puts(&#34;wait&#34;); 51 sleep(5); 52 } 53 } 54 } 55 return 0; 56} 10.4 åŸºäºå¤šä»»åŠ¡çš„å¹¶å‘æœåŠ¡å™¨ ä¹‹å‰çš„å›å£°æœåŠ¡å™¨æ¯æ¬¡åªèƒ½åŒäº‹å‘ 1 ä¸ªå®¢æˆ·ç«¯æä¾›æœåŠ¡ã€‚å› æ­¤ï¼Œéœ€è¦æ‰©å±•å›å£°æœåŠ¡å™¨ï¼Œä½¿å…¶å¯ä»¥åŒæ—¶å‘å¤šä¸ªå®¢æˆ·ç«¯æä¾›æœåŠ¡ã€‚ä¸‹å›¾æ˜¯åŸºäºå¤šè¿›ç¨‹çš„å›å£°æœåŠ¡å™¨çš„æ¨¡å‹ã€‚
ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ¯å½“æœ‰å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼ˆè¿æ¥è¯·æ±‚ï¼‰ï¼Œå›å£°æœåŠ¡å™¨éƒ½åˆ›å»ºå­è¿›ç¨‹ä»¥æä¾›æœåŠ¡ã€‚å¦‚æœè¯·æ±‚çš„å®¢æˆ·ç«¯æœ‰ 5 ä¸ªï¼Œåˆ™å°†åˆ›å»º 5 ä¸ªå­è¿›ç¨‹æ¥æä¾›æœåŠ¡ï¼Œä¸ºäº†å®Œæˆè¿™äº›ä»»åŠ¡ï¼Œéœ€è¦ç»è¿‡å¦‚ä¸‹è¿‡ç¨‹ï¼š
ç¬¬ä¸€é˜¶æ®µï¼šå›å£°æœåŠ¡å™¨ç«¯ï¼ˆçˆ¶è¿›ç¨‹ï¼‰é€šè¿‡è°ƒç”¨ accept å‡½æ•°å—ç†è¿æ¥è¯·æ±‚ ç¬¬äºŒé˜¶æ®µï¼šæ­¤æ—¶è·å–çš„å¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦åˆ›å»ºå¹¶ä¼ é€’ç»™å­è¿›ç¨‹ ç¬¬ä¸‰é˜¶æ®µï¼šå­è¿›ç¨‹åˆ©ç”¨ä¼ é€’æ¥çš„æ–‡ä»¶æè¿°ç¬¦æä¾›æœåŠ¡ Q ? å¦‚ä½•ä¼ é€’ç»™å­è¿›ç¨‹æ–‡ä»¶æè¿°ç¬¦
A å­è¿›ç¨‹ä¼šå¤åˆ¶çˆ¶è¿›ç¨‹çš„æ‰€æœ‰çš„èµ„æº,æ‰€ä»¥ä¸éœ€è¦ä¼ é€’
Q: å­è¿›ç¨‹ä¼šå¤åˆ¶çˆ¶è¿›ç¨‹çš„server_sdï¼ˆå¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦ï¼‰å—? é‚£ä»–ä¼šæ”¶åˆ°cientçš„æ•°æ®å—?
1#include &lt;stdio.h&gt; 2#include &lt;stdlib.h&gt; 3#include &lt;string.h&gt; 4#include &lt;unistd.h&gt; 5#include &lt;signal.h&gt; 6#include &lt;sys/wait.h&gt; 7#include &lt;arpa/inet.h&gt; 8#include &lt;sys/socket.h&gt; 9 10#define BUF_SIZE 30 11void error_handling(char *message); 12void read_childproc(int sig); 13 14int main(int argc, char *argv[]) 15{ 16 int serv_sock, clnt_sock; 17 struct sockaddr_in serv_adr, clnt_adr; 18 19 pid_t pid; 20 struct sigaction act; 21 socklen_t adr_sz; 22 int str_len, state; 23 char buf[BUF_SIZE]; 24 if (argc != 2) 25 { 26 printf(&#34;Usgae : %s &lt;port&gt;\\n&#34;, argv[0]); 27 exit(1); 28 } 29 act.sa_handler = read_childproc; //é˜²æ­¢åƒµå°¸è¿›ç¨‹ 30 sigemptyset(&amp;act.sa_mask); 31 act.sa_flags = 0; 32 state = sigaction(SIGCHLD, &amp;act, 0); //æ³¨å†Œä¿¡å·å¤„ç†å™¨,æŠŠæˆåŠŸçš„è¿”å›å€¼ç»™ state 33 serv_sock = socket(PF_INET, SOCK_STREAM, 0); //åˆ›å»ºæœåŠ¡ç«¯å¥—æ¥å­— 34 memset(&amp;serv_adr, 0, sizeof(serv_adr)); 35 serv_adr.sin_family = AF_INET; 36 serv_adr.sin_addr.s_addr = htonl(INADDR_ANY); 37 serv_adr.sin_port = htons(atoi(argv[1])); 38 39 if (bind(serv_sock, (struct sockaddr *)&amp;serv_adr, sizeof(serv_adr)) == -1) //åˆ†é…IPåœ°å€å’Œç«¯å£å· 40 error_handling(&#34;bind() error&#34;); 41 if (listen(serv_sock, 5) == -1) //è¿›å…¥ç­‰å¾…è¿æ¥è¯·æ±‚çŠ¶æ€ 42 error_handling(&#34;listen() error&#34;); 43 44 while (1) 45 { 46 adr_sz = sizeof(clnt_adr); 47 clnt_sock = accept(serv_sock, (struct sockaddr *)&amp;clnt_adr, &amp;adr_sz); 48 if (clnt_sock == -1) 49 continue; 50 else 51 puts(&#34;new client connected...&#34;); 52 pid = fork(); //æ­¤æ—¶ï¼Œçˆ¶å­è¿›ç¨‹åˆ†åˆ«å¸¦æœ‰ä¸€ä¸ªå¥—æ¥å­— 53 if (pid == -1) 54 { 55 close(clnt_sock); 56 continue; 57 } 58 if (pid == 0) //å­è¿›ç¨‹è¿è¡ŒåŒºåŸŸ,æ­¤éƒ¨åˆ†å‘å®¢æˆ·ç«¯æä¾›å›å£°æœåŠ¡ 59 { 60 close(serv_sock); //å…³é—­æœåŠ¡å™¨å¥—æ¥å­—ï¼Œå› ä¸ºä»çˆ¶è¿›ç¨‹ä¼ é€’åˆ°äº†å­è¿›ç¨‹ 61 while ((str_len = read(clnt_sock, buf, BUFSIZ)) != 0) 62 write(clnt_sock, buf, str_len); 63 64 close(clnt_sock); 65 puts(&#34;client disconnected...&#34;); 66 return 0; 67 } 68 else 69 close(clnt_sock); //é€šè¿‡ accept å‡½æ•°åˆ›å»ºçš„å¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦å·²ç»å¤åˆ¶ç»™å­è¿›ç¨‹ï¼Œå› ä¸ºæœåŠ¡å™¨ç«¯è¦é”€æ¯è‡ªå·±æ‹¥æœ‰çš„ 70 } 71 close(serv_sock); 72 73 return 0; 74} 75 76void error_handling(char *message) 77{ 78 fputs(message, stderr); 79 fputc(&#39;\\n&#39;, stderr); 80 exit(1); 81} 82void read_childproc(int sig) 83{ 84 pid_t pid; 85 int status; 86 pid = waitpid(-1, &amp;status, WNOHANG); 87 printf(&#34;removed proc id: %d \\n&#34;, pid); 88} 10.4.2 å®ç°å¹¶å‘æœåŠ¡å™¨ 10.4.3 é€šè¿‡ fork å‡½æ•°å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ ç¤ºä¾‹ä¸­ç»™å‡ºäº†é€šè¿‡ fork å‡½æ•°å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦çš„è¿‡ç¨‹ã€‚çˆ¶è¿›ç¨‹å°† 2 ä¸ªå¥—æ¥å­—ï¼ˆä¸€ä¸ªæ˜¯æœåŠ¡ç«¯å¥—æ¥å­—å¦ä¸€ä¸ªæ˜¯å®¢æˆ·ç«¯å¥—æ¥å­—ï¼‰æ–‡ä»¶æè¿°ç¬¦å¤åˆ¶ç»™äº†å­è¿›ç¨‹ã€‚
è°ƒç”¨ fork å‡½æ•°æ—¶èµ‹å€¼çˆ¶è¿›ç¨‹çš„æ‰€æœ‰èµ„æºï¼Œä½†æ˜¯å¥—æ¥å­—ä¸æ˜¯å½’è¿›ç¨‹æ‰€æœ‰çš„ï¼Œè€Œæ˜¯å½’æ“ä½œç³»ç»Ÿæ‰€æœ‰ï¼Œåªæ˜¯è¿›ç¨‹æ‹¥æœ‰ä»£è¡¨ç›¸åº”å¥—æ¥å­—çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
å¦‚å›¾æ‰€ç¤ºï¼Œ1 ä¸ªå¥—æ¥å­—å­˜åœ¨ 2 ä¸ªæ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œåªæœ‰ 2 ä¸ªæ–‡ä»¶æè¿°ç¬¦éƒ½ç»ˆæ­¢ï¼ˆé”€æ¯ï¼‰åï¼Œæ‰èƒ½é”€æ¯å¥—æ¥å­—ã€‚å¦‚æœç»´æŒå›¾ä¸­çš„çŠ¶æ€ï¼Œå³ä½¿å­è¿›ç¨‹é”€æ¯äº†ä¸å®¢æˆ·ç«¯è¿æ¥çš„å¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦ï¼Œä¹Ÿæ— æ³•é”€æ¯å¥—æ¥å­—ï¼ˆæœåŠ¡å™¨å¥—æ¥å­—åŒæ ·å¦‚æ­¤ï¼‰ã€‚å› æ­¤è°ƒç”¨ fork å‡½æ•°åï¼Œè¦å°†æ— å…³ç´§è¦çš„å¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦å…³æ‰ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š
10.5 åˆ†å‰² TCP çš„ I/O ç¨‹åº `,url:"https://hugo-dead-simple.netlify.com/linux_tcp_program/tcpip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/chapter_10/"},"https://hugo-dead-simple.netlify.com/linux_tcp_program/tcpip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/chapter_2/":{title:"",tags:[],content:`socketç±»å‹ä¸åè®®è®¾ç½® ä¸‹æˆ‘åªä¸æˆ‘ç†è§£çš„å†…å®¹,å¦‚æœå…¨éƒ¨éƒ½å†™,é‚£ä¹ˆå°±å˜åœ¨äº†æŠ„ä¹¦äº†.
1int socket(int domain, int type, int protocol); å…¶ä¸­çš„domainå‚æ•°æŒ‡å®šåè®®æ—,å¸¸è§çš„æœ‰AF_INET, AF_INET6, AF_UNIXç­‰,åˆ†åˆ«å¯¹åº”IPv4, IPv6, Unix Domain Socket.
typeå‚æ•°æŒ‡å®šsocketç±»å‹,å¸¸è§çš„æœ‰SOCK_STREAM, SOCK_DGRAM, SOCK_RAW, SOCK_SEQPACKETç­‰,åˆ†åˆ«å¯¹åº”TCPæµå¼socket, UDPæ•°æ®æŠ¥å¼socket, åŸå§‹å¥—æ¥å­—, é¡ºåºåŒ…å¥—æ¥å­—ç­‰.
protocolå‚æ•°æŒ‡å®šåè®®,å¸¸è§çš„æœ‰IPPROTO_TCP, IPPROTO_UDP, IPPROTO_RAW, IPPROTO_SCTPç­‰,åˆ†åˆ«å¯¹åº”TCP, UDP, åŸå§‹åè®®, SCTPç­‰.
ä¸€èˆ¬æƒ…å†µä¸‹,æˆ‘ä»¬åªéœ€è¦è®¾ç½®domainå’Œtypeå‚æ•°,å› ä¸ºprotocolå‚æ•°ä¸€èˆ¬ç”±ç³»ç»Ÿè‡ªåŠ¨è®¾ç½®.
ä¾‹å¦‚,åˆ›å»ºä¸€ä¸ªTCPæµå¼socket,å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç :
è¿™ä¸ªç”¨åˆ°çš„æœ€å¤š,å…¶å®ä¹Ÿåªç”¨åˆ°è¿™ä¸ª(æˆ‘ä»¬è‡ªå·±å†™çš„ç®€å•ä»£ç ).
1int sockfd = socket(AF_INET, SOCK_STREAM, 0); åˆ›å»ºä¸€ä¸ªUDPæ•°æ®æŠ¥å¼socket,å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç :
1int sockfd = socket(AF_INET, SOCK_DGRAM, 0); åˆ›å»ºä¸€ä¸ªåŸå§‹å¥—æ¥å­—,å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç :
1int sockfd = socket(AF_INET, SOCK_RAW, IPPROTO_RAW); ä¼ è¾“çš„æ•°æ®ä¸å­˜åœ¨æ•°æ®è¾¹ç•Œ ä¹¦ä¸Šå‘Šè¯‰æˆ‘ä»¬,socketæ•°æ®çš„ä¼ è¾“æ˜¯æ— è¾¹ç•Œçš„,ä¹Ÿå°±æ˜¯è¯´,æˆ‘ä»¬å‘é€çš„æ•°æ®å¯èƒ½è¢«æ‹†åˆ†æˆå¤šä¸ªåŒ…,ä¹Ÿå¯èƒ½è¢«ç²˜åŒ…,æ¥æ”¶æ–¹ä¹Ÿå¯èƒ½ä¸€æ¬¡æ¥æ”¶å¤šä¸ªåŒ…,è¿™å–å†³äºç½‘ç»œçš„ä¼ è¾“é€Ÿç‡å’Œæ¥æ”¶æ–¹å¤„ç†èƒ½åŠ›.
è¿™é‡Œç»™å‡ºä¸€ä¸ªæˆ‘æ ¹æ®ä¹¦ä¸Šå†™çš„client.cä»£ç ,ç”¨æ¥æ¥æ”¶TCPæµå¼socketæ•°æ®:
å®ƒä¸€æ¬¡åªèƒ½è¯»å–ä¸€ä¸ªå­—èŠ‚.
1int tot = 0; 2int read_len; 3char buf[1024] 4while(1) { 5 //ä¸€æ¬¡è¯»å–ä¸€ä¸ªå­—èŠ‚ 6 read_len = read(sockfd, buf, 1); 7 if( read_len == -1) break; 8 //è¾“å‡ºè¯»å–çš„å­—ç¬¦ 9 printf(&#34;%c&#34;,buf[0]); 10 tot += read_len; 11} `,url:"https://hugo-dead-simple.netlify.com/linux_tcp_program/tcpip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/chapter_2/"},"https://hugo-dead-simple.netlify.com/linux_tcp_program/tcpip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/chapter_3/":{title:"",tags:[],content:`åœ°å€æ—ä¸æ•°æ®åºåˆ— ä¹¦ä¸Šè®²è§£äº†ä¸€äº›ipv4åœ°å€çš„æ¦‚å¿µï¼Œä»¥åŠipv6åœ°å€çš„æ¦‚å¿µã€‚
åˆè¯´äº†ä¸€äº›ç«¯å£å·çš„æ¦‚å¿µï¼Œä»¥åŠç«¯å£å·çš„ä½œç”¨ã€‚
ä½†æ˜¯è¿˜æ˜¯å¾ˆå¤æ‚çš„,ç›´æ¥ç†è§£æˆ‘ç¬¬ä¸€ç« èŠ‚è¯´çš„å†…å®¹,æ¯ä¸ªæ¦‚å¿µåªæœ‰ä¸€å¥è¯.ä½†æ˜¯è¿™æ˜¯å»ºç«‹åœ¨æˆ‘å¯¹ç½‘ç»œç¼–ç¨‹çš„äº†è§£åŸºç¡€ä¸Šçš„.
ä¸‹è®²è§£äº†
1mindmap 2 root((sockadd_in)) 3 sin_family(sin_family) 4 AF_INET(AF_INET) 5 AF_INET6(AF_INET6) 6 AF_Local(AF_Local) 7 sin_port(sin_port) 8 htons(&#34;htons(int)&#34;) 9 sin_addr(sin_addr) 10 s_addr(s_addr) 11 inet_addr(&#34;inet_addr(char*)&#34;) éœ€è¦æŠŠsockaddr_inè½¬åŒ–æˆstruct sockaddr *æ‰èƒ½ä½¿ç”¨bind()ç­‰å‡½æ•°.
ç½‘ç»œå­—èŠ‚åºä¸åœ°å€çš„è½¬æ¢ htons(int)ï¼šå°†intç±»å‹æ•´æ•°è½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºã€‚ htonl(int)ï¼šå°†intç±»å‹æ•´æ•°è½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºã€‚ ntohs(int)ï¼šå°†intç±»å‹æ•´æ•°è½¬æ¢ä¸ºä¸»æœºå­—èŠ‚åºã€‚ ntohl(int)ï¼šå°†intç±»å‹æ•´æ•°è½¬æ¢ä¸ºä¸»æœºå­—èŠ‚åºã€‚ inet_addr(char*)ï¼šå°†char*ç±»å‹å­—ç¬¦ä¸²è½¬æ¢ä¸ºin_addrç±»å‹ã€‚ inet_aton(char*, struct in_addr*)ï¼šå°†char*ç±»å‹å­—ç¬¦ä¸²è½¬æ¢ä¸ºin_addrç±»å‹ã€‚ inet_ntoa(struct in_addr)ï¼šå°†in_addrç±»å‹è½¬æ¢ä¸ºchar*ç±»å‹å­—ç¬¦ä¸²,å¤±è´¥è¿”å›-1 æ¯æ¬¡åˆ›å»ºæœåŠ¡å™¨ç«¯socketéƒ½è¦è¾“å…¥IPåœ°å€ä¼šæœ‰äº›ç¹ç,æ­¤æ—¶å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„åˆå§‹åŒ–åœ°å€ä¿¡æ¯
1struct sockaddr_in server_addr; 2char * serv_port = &#34;8989&#34;; 3server_addr.sin_family = AF_INET; 4server_addr.sin_port = htons(atoi(serv_port)); 5server_addr.sin_addr.s_addr = inet_addr(INADDR_ANY); `,url:"https://hugo-dead-simple.netlify.com/linux_tcp_program/tcpip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/chapter_3/"},"https://hugo-dead-simple.netlify.com/linux_tcp_program/tcpip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/chapter_4/":{title:"",tags:[],content:`åŸºäºtcpçš„æœåŠ¡å™¨ç«¯/å®¢æˆ·ç«¯ è¯¦ç»†çš„å†…å®¹çœ‹è¿™é‡Œ,æˆ‘å°±ä¸å¤åˆ¶äº†:
https://github.com/riba2534/TCP-IP-NetworkNote/blob/master/ch04/README.md
TCP/IP åè®®æ ˆå…±åˆ†ä¸º 4 å±‚ï¼Œå¯ä»¥ç†è§£ä¸ºæ•°æ®æ”¶å‘åˆ†æˆäº† 4 ä¸ªå±‚æ¬¡åŒ–è¿‡ç¨‹ï¼Œé€šè¿‡å±‚æ¬¡åŒ–çš„æ–¹å¼æ¥è§£å†³é—®é¢˜
é“¾è·¯å±‚: ç‰©ç†å±‚,è´Ÿè´£ç½‘ç»œè®¾å¤‡ä¹‹é—´çš„é€šä¿¡ï¼Œå¦‚ç½‘å¡ã€ç½‘çº¿ç­‰ IPå±‚: æ•°æ®åŒ…è¿›è¡Œä¸­çº¿é€‰æ‹© TCP/UDPå±‚: è´Ÿè´£æ•°æ®åŒ…çš„ä¼ è¾“ï¼Œä¿è¯æ•°æ®åŒ…çš„å¯é æ€§å’Œé¡ºåºæ€§ å®ç°åŸºäº TCP çš„æœåŠ¡å™¨/å®¢æˆ·ç«¯ ä»£ç : hello_server
1{{#include ch04/hello_server.c}} ä»£ç : hello_client
1{{#include ch04/hello_client.c}} echoæœåŠ¡å™¨/å®¢æˆ·ç«¯ ç¨‹åºè¿è¡Œçš„åŸºæœ¬æ–¹å¼ï¼š
æœåŠ¡å™¨ç«¯åœ¨åŒä¸€æ—¶åˆ»åªä¸ä¸€ä¸ªå®¢æˆ·ç«¯ç›¸è¿ï¼Œå¹¶æä¾›å›å£°æœåŠ¡ã€‚ æœåŠ¡å™¨ç«¯ä¾æ¬¡å‘ 5 ä¸ªå®¢æˆ·ç«¯æä¾›æœåŠ¡å¹¶é€€å‡ºã€‚forå¾ªç¯5æ¬¡ å®¢æˆ·ç«¯æ¥å—ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²å¹¶å‘é€åˆ°æœåŠ¡å™¨ç«¯ã€‚ æœåŠ¡å™¨ç«¯å°†æ¥å—çš„å­—ç¬¦ä¸²æ•°æ®ä¼ å›å®¢æˆ·ç«¯ï¼Œå³ã€Œå›å£°ã€ æœåŠ¡å™¨ç«¯ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„å­—ç¬¦ä¸²å›å£°ä¸€ç›´æ‰§è¡Œåˆ°å®¢æˆ·ç«¯è¾“å…¥ Q ä¸ºæ­¢ã€‚ 1{{#include ch04/echo_server.c}} 1{{#include ch04/echo_client.c}} FAQ é—®: æˆ‘åœ¨åœ¨linuxä¸‹ä½¿ç”¨socketè¿›è¡Œtcpç½‘ç»œç¼–ç¨‹,å¦‚æœclientç«¯è°ƒç”¨äº†close(sock)å‡½æ•°,é‚£ä¹ˆserverç«¯å£çš„readå‡½æ•°ä¼šè¯»å–åˆ°ä»€ä¹ˆ?
ç­”:
åœ¨Linuxä¸‹ä½¿ç”¨socketè¿›è¡ŒTCPç½‘ç»œç¼–ç¨‹æ—¶,å¦‚æœå®¢æˆ·ç«¯è°ƒç”¨äº†close(sock)å‡½æ•°,æœåŠ¡å™¨ç«¯çš„readå‡½æ•°çš„è¡Œä¸ºå–å†³äºå®¢æˆ·ç«¯å…³é—­è¿æ¥çš„æ–¹å¼å’Œæ—¶æœºã€‚
é€šå¸¸æƒ…å†µä¸‹,å½“å®¢æˆ·ç«¯è°ƒç”¨close(sock)å‡½æ•°æ—¶,ä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªFINåŒ…,è¡¨ç¤ºå®¢æˆ·ç«¯æƒ³è¦å…³é—­è¿æ¥ã€‚æœåŠ¡å™¨æ”¶åˆ°FINåŒ…å,ä¼šåšå‡ºä»¥ä¸‹å“åº”:
å¦‚æœæœåŠ¡å™¨å·²ç»è¯»å–äº†æ‰€æœ‰å®¢æˆ·ç«¯å‘é€çš„æ•°æ®,é‚£ä¹ˆreadå‡½æ•°ä¼šè¿”å›0,è¡¨ç¤ºå·²ç»åˆ°è¾¾æ–‡ä»¶æœ«å°¾(EOF)ã€‚è¿™æ„å‘³ç€å®¢æˆ·ç«¯å·²ç»å…³é—­äº†è¿æ¥,å¹¶ä¸”æ²¡æœ‰æ›´å¤šçš„æ•°æ®å¯è¯»ã€‚
å¦‚æœæœåŠ¡å™¨è¿˜æ²¡æœ‰è¯»å–å®Œå®¢æˆ·ç«¯å‘é€çš„æ‰€æœ‰æ•°æ®,é‚£ä¹ˆreadå‡½æ•°ä¼šç»§ç»­è¯»å–å‰©ä½™çš„æ•°æ®,ç›´åˆ°è¯»å–å®Œæ‰€æœ‰æ•°æ®æˆ–è€…é‡åˆ°é”™è¯¯ä¸ºæ­¢ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹,readå‡½æ•°ä¼šè¿”å›å®é™…è¯»å–åˆ°çš„å­—èŠ‚æ•°ã€‚å½“æ‰€æœ‰æ•°æ®è¯»å–å®Œæ¯•å,å†æ¬¡è°ƒç”¨readå‡½æ•°ä¼šè¿”å›0,è¡¨ç¤ºå·²ç»åˆ°è¾¾æ–‡ä»¶æœ«å°¾(EOF)ã€‚
å¦‚æœå®¢æˆ·ç«¯åœ¨å‘é€æ•°æ®çš„è¿‡ç¨‹ä¸­çªç„¶å…³é—­äº†è¿æ¥,é‚£ä¹ˆæœåŠ¡å™¨çš„readå‡½æ•°å¯èƒ½ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯,é€šå¸¸æ˜¯ECONNRESETé”™è¯¯,è¡¨ç¤ºè¿æ¥è¢«é‡ç½®ã€‚
éœ€è¦æ³¨æ„çš„æ˜¯,å¦‚æœå®¢æˆ·ç«¯åœ¨å…³é—­è¿æ¥ä¹‹å‰æ²¡æœ‰å‘é€æ‰€æœ‰çš„æ•°æ®,é‚£ä¹ˆæœåŠ¡å™¨å¯èƒ½ä¼šä¸¢å¤±ä¸€éƒ¨åˆ†æ•°æ®ã€‚ä¸ºäº†ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§,é€šå¸¸å»ºè®®åœ¨å…³é—­è¿æ¥ä¹‹å‰,å…ˆè°ƒç”¨shutdown(sock, SHUT_WR)å‡½æ•°,å‘Šè¯‰æ“ä½œç³»ç»Ÿä¸å†å‘é€æ•°æ®,ç„¶åå†è°ƒç”¨close(sock)å‡½æ•°å…³é—­è¿æ¥ã€‚
æ€»ä¹‹,æœåŠ¡å™¨ç«¯çš„readå‡½æ•°åœ¨å®¢æˆ·ç«¯å…³é—­è¿æ¥æ—¶çš„è¡Œä¸ºå–å†³äºå…·ä½“çš„æƒ…å†µ:
å¦‚æœå®¢æˆ·ç«¯å‘é€äº†æ‰€æœ‰æ•°æ®å¹¶å…³é—­è¿æ¥,readå‡½æ•°ä¼šè¿”å›0,è¡¨ç¤ºEOFã€‚ å¦‚æœå®¢æˆ·ç«¯å…³é—­è¿æ¥æ—¶è¿˜æœ‰æœªè¯»å–çš„æ•°æ®,readå‡½æ•°ä¼šç»§ç»­è¯»å–å‰©ä½™æ•°æ®,ç›´åˆ°è¯»å–å®Œæ¯•,ç„¶åè¿”å›0,è¡¨ç¤ºEOFã€‚ å¦‚æœå®¢æˆ·ç«¯å¼‚å¸¸å…³é—­è¿æ¥,readå‡½æ•°å¯èƒ½ä¼šè¿”å›é”™è¯¯,å¦‚ECONNRESETã€‚ ä½œä¸ºæœåŠ¡å™¨ç«¯,éœ€è¦æ­£ç¡®å¤„ç†è¿™äº›ä¸åŒçš„æƒ…å†µ,ä»¥ç¡®ä¿ç¨‹åºçš„æ­£ç¡®æ€§å’Œé²æ£’æ€§ã€‚
é—®: å¦‚ä½•æ£€æµ‹åˆ° readå‡½æ•°è¿”å›ä¸€ä¸ªé”™è¯¯, ä¾‹å¦‚æ˜¯ECONNRESET?
åœ¨Linuxç³»ç»Ÿä¸­,å½“readå‡½æ•°è¿”å›é”™è¯¯æ—¶,ä¼šè®¾ç½®å…¨å±€å˜é‡errnoæ¥æŒ‡ç¤ºå…·ä½“çš„é”™è¯¯ç±»å‹ã€‚ä½ å¯ä»¥é€šè¿‡æ£€æŸ¥errnoçš„å€¼æ¥åˆ¤æ–­æ˜¯å¦å‘ç”Ÿäº†ECONNRESETé”™è¯¯ã€‚
ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ,æ¼”ç¤ºäº†å¦‚ä½•æ£€æµ‹readå‡½æ•°è¿”å›çš„é”™è¯¯:
1#include &lt;stdio.h&gt; 2#include &lt;stdlib.h&gt; 3#include &lt;unistd.h&gt; 4#include &lt;errno.h&gt; 5#include &lt;string.h&gt; 6 7ssize_t read_data(int sockfd, void *buf, size_t len) { 8 ssize_t num_read = read(sockfd, buf, len); 9 if (num_read == -1) { 10 if (errno == ECONNRESET) { 11 printf(&#34;Connection reset by peer\\n&#34;); 12 } else { 13 perror(&#34;read&#34;); 14 } 15 return -1; 16 } 17 return num_read; 18} åœ¨ä¸Šé¢çš„ä»£ç ä¸­,read_dataå‡½æ•°å°è£…äº†readå‡½æ•°çš„è°ƒç”¨ã€‚å®ƒæ£€æŸ¥readå‡½æ•°çš„è¿”å›å€¼:
å¦‚æœè¿”å›å€¼ä¸º-1,è¡¨ç¤ºå‘ç”Ÿäº†é”™è¯¯ã€‚æ­¤æ—¶,é€šè¿‡æ£€æŸ¥errnoçš„å€¼æ¥åˆ¤æ–­å…·ä½“çš„é”™è¯¯ç±»å‹: å¦‚æœerrnoçš„å€¼ç­‰äºECONNRESET,è¡¨ç¤ºè¿æ¥è¢«å¯¹ç«¯é‡ç½®,å¯ä»¥è¾“å‡ºç›¸åº”çš„é”™è¯¯ä¿¡æ¯ã€‚ å¦åˆ™,å¯ä»¥ä½¿ç”¨perrorå‡½æ•°è¾“å‡ºé”™è¯¯ä¿¡æ¯,perrorå‡½æ•°ä¼šæ ¹æ®errnoçš„å€¼è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„é”™è¯¯æè¿°ã€‚ å¦‚æœè¿”å›å€¼ä¸ä¸º-1,è¡¨ç¤ºè¯»å–æˆåŠŸ,å‡½æ•°è¿”å›å®é™…è¯»å–åˆ°çš„å­—èŠ‚æ•°ã€‚ åœ¨å®é™…ä½¿ç”¨æ—¶,ä½ å¯ä»¥æ ¹æ®éœ€è¦å¯¹read_dataå‡½æ•°è¿›è¡Œè°ƒç”¨,å¹¶æ ¹æ®è¿”å›å€¼è¿›è¡Œç›¸åº”çš„å¤„ç†:
1char buffer[1024]; 2ssize_t num_read = read_data(sockfd, buffer, sizeof(buffer)); 3if (num_read == -1) { 4 // å¤„ç†é”™è¯¯æƒ…å†µ 5} else if (num_read == 0) { 6 // å¤„ç†è¿æ¥å…³é—­çš„æƒ…å†µ 7} else { 8 // å¤„ç†æˆåŠŸè¯»å–æ•°æ®çš„æƒ…å†µ 9} é€šè¿‡æ£€æŸ¥read_dataå‡½æ•°çš„è¿”å›å€¼,ä½ å¯ä»¥åˆ¤æ–­æ˜¯å¦å‘ç”Ÿäº†é”™è¯¯,å¹¶æ ¹æ®å…·ä½“çš„é”™è¯¯ç±»å‹é‡‡å–ç›¸åº”çš„å¤„ç†æªæ–½ã€‚
æ€»ä¹‹,é€šè¿‡æ£€æŸ¥readå‡½æ•°çš„è¿”å›å€¼å’Œerrnoçš„å€¼,ä½ å¯ä»¥æ£€æµ‹å¹¶å¤„ç†readå‡½æ•°è¿”å›çš„é”™è¯¯,åŒ…æ‹¬ECONNRESETé”™è¯¯ã€‚è¿™æ ·å¯ä»¥å¢å¼ºç¨‹åºçš„å¥å£®æ€§å’Œå¯é æ€§ã€‚
`,url:"https://hugo-dead-simple.netlify.com/linux_tcp_program/tcpip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/chapter_4/"},"https://hugo-dead-simple.netlify.com/linux_tcp_program/tcpip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/chapter_5/":{title:"",tags:[],content:`åŸºäºtcpçš„æœåŠ¡å™¨ç«¯/å®¢æˆ·ç«¯(2) æœ¬ç« èŠ‚è¯¦ç»†çš„è®²è§£äº†TCP ä¸­å¿…è¦çš„ç†è®ºçŸ¥è¯†
å›å£°å®¢æˆ·ç«¯é—®é¢˜çš„è§£å†³åŠæ³• è¿™ä¸ªé—®é¢˜å…¶å®å¾ˆå®¹æ˜“è§£å†³ï¼Œå› ä¸ºå¯ä»¥æå‰æ¥å—æ•°æ®çš„å¤§å°ã€‚è‹¥ä¹‹å‰ä¼ è¾“äº†20å­—èŠ‚é•¿çš„å­—ç¬¦ä¸²ï¼Œåˆ™å†æ¥æ”¶æ—¶å¾ªç¯è°ƒç”¨ read å‡½æ•°è¯»å– 20 ä¸ªå­—èŠ‚å³å¯ã€‚æ—¢ç„¶æœ‰äº†è§£å†³åŠæ³•ï¼Œæ ¸å¿ƒé‚£ä¹ˆä»£ç å¦‚ä¸‹ï¼š
1 2//å¾—åˆ°å‘é€çš„æ•°æ®å¤§å° 3str_len = write(sockfd,message,sizeof(message)); 4int recv_len = 0; 5while( recv_len &lt; str_len ) { 6 int recv_cnt += read(sockfd,recv_buf,str_len-recv_len); 7 //å¯¹æ–¹å…³é—­äº†è¿æ¥ 8 if( recv_cnt == 0 ) { 9 break; 10 } 11 if( recv_cnt &lt; 0 ) { 12 error_handing(&#34;read error&#34;)! 13 } 14 recv_len += recv_cnt; 15} 16message[recv_len] = &#39;\\0&#39;; 17printf(&#34;Received message: %s\\n&#34;,message); TCP åŸç† TCP socketä¸­çš„I/Oç¼“å†²
IOç¼“å†²åœ¨æ¯ä¸ªTCP socketä¸­å•ç‹¬å­˜åœ¨.
IOç¼“å†²åœ¨åœ¨åˆ›å»ºTCP socketè‡ªåŠ¨ç”Ÿæˆ.
å³ä½¿å…³é—­socket ä¹Ÿä¼šç»§ç»­ä¼ é€’è¾“å‡ºç¼“å†²ä¸­é—ç•™çš„æ•°æ®.
å…³é—­socketä¼šä¸¢å¤±è¾“å…¥ç¼“å†²ä¸­çš„æ•°æ®.
ä¸ä¼šå‘ç”Ÿè¶…è¿‡è¾“å…¥ç¼“å†²å¤§å°çš„æ•°æ®ä¼ è¾“!
writeå‡½æ•°ä¼šåœ¨æ•°æ®ç§»åˆ°è¾“å‡ºç¼“å†²æ—¶è¿”å›.
1. TCPè¿æ¥ 3æ¬¡æ¡æ‰‹(three-way handshaking)
1[SYN] SEQ:1000 ACK:NULL 2[SYN+ACK] SEQ: 2000, ACK: 1001 3[ACK] SEQ: 1001, ACK: 2001 2. TCPä¼ è¾“ 3. TCPæ–­å¼€ `,url:"https://hugo-dead-simple.netlify.com/linux_tcp_program/tcpip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/chapter_5/"},"https://hugo-dead-simple.netlify.com/linux_tcp_program/tcpip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/chapter_7/":{title:"",tags:[],content:`1 å•æ–¹é¢æ–­å¼€è¿æ¥å¸¦æ¥çš„é—®é¢˜ ä¸»æœº A å‘é€å®Œæœ€åçš„æ•°æ®åï¼Œè°ƒç”¨ close å‡½æ•°æ–­å¼€äº†æœ€åçš„è¿æ¥ï¼Œä¹‹åä¸»æœº A æ— æ³•å†æ¥å—ä¸»æœº B ä¼ è¾“çš„æ•°æ®ã€‚å®é™…ä¸Šï¼Œæ˜¯å®Œå…¨æ— æ³•è°ƒç”¨ä¸æ¥å—æ•°æ®ç›¸å…³çš„å‡½æ•°ã€‚æœ€ç»ˆï¼Œç”±ä¸»æœº B ä¼ è¾“çš„ã€ä¸»æœº A å¿…é¡»è¦æ¥å—çš„æ•°æ®ä¹Ÿé”€æ¯äº†ã€‚
2. shutdownå‡½æ•°çš„ä½œç”¨ 1#include &lt;sys/socket.h&gt; 2int shutdown(int sock, int howto); 3/* 4æˆåŠŸæ—¶è¿”å› 0 ï¼Œå¤±è´¥æ—¶è¿”å› -1 5sock: éœ€è¦æ–­å¼€å¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦ 6howto: ä¼ é€’æ–­å¼€æ–¹å¼ä¿¡æ¯ 7*/ è°ƒç”¨ä¸Šè¿°å‡½æ•°æ—¶ï¼Œç¬¬äºŒä¸ªå‚æ•°å†³å®šæ–­å¼€è¿æ¥çš„æ–¹å¼ï¼Œå…¶å€¼å¦‚ä¸‹æ‰€ç¤ºï¼š
SHUT_RD : æ–­å¼€è¾“å…¥æµ SHUT_WR : æ–­å¼€è¾“å‡ºæµ SHUT_RDWR : åŒæ—¶æ–­å¼€ I/O æµ è‹¥å‘ shutdown çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ é€’SHUT_RDï¼Œåˆ™æ–­å¼€è¾“å…¥æµï¼Œå¥—æ¥å­—æ— æ³•æ¥æ”¶æ•°æ®ã€‚å³ä½¿è¾“å…¥ç¼“å†²æ”¶åˆ°æ•°æ®ä¹Ÿä¼šæŠ¹å»ï¼Œè€Œä¸”æ— æ³•è°ƒç”¨ç›¸å…³å‡½æ•°ã€‚å¦‚æœå‘ shutdown çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ é€’SHUT_WRï¼Œåˆ™ä¸­æ–­è¾“å‡ºæµï¼Œä¹Ÿå°±æ— æ³•ä¼ è¾“æ•°æ®ã€‚è‹¥å¦‚æœè¾“å‡ºç¼“å†²ä¸­è¿˜æœ‰æœªä¼ è¾“çš„æ•°æ®ï¼Œåˆ™å°†ä¼ é€’ç»™ç›®æ ‡ä¸»æœºã€‚æœ€åï¼Œè‹¥ä¼ é€’å…³é”®å­—SHUT_RDWRï¼Œåˆ™åŒæ—¶ä¸­æ–­ I/O æµã€‚è¿™ç›¸å½“äºåˆ† 2 æ¬¡è°ƒç”¨ shutdown ï¼Œå…¶ä¸­ä¸€æ¬¡ä»¥SHUT_RDä¸ºå‚æ•°ï¼Œå¦ä¸€æ¬¡ä»¥SHUT_WRä¸ºå‚æ•°
3. ä¸ºä»€ä¹ˆè¦åŠå…³é—­è¿æ¥ ç•™ä¸‹è¶³å¤Ÿçš„æ—¶é—´,ç­‰æ‰€æœ‰çš„æ•°æ®äº¤æ¢å®Œä¸å°±è¡Œäº†,å¥½åƒä¹Ÿæ²¡æœ‰å¿…è¦ä½¿ç”¨åŠå…³é—­.
è€ƒè™‘ä»¥ä¸‹æƒ…å†µï¼š
ä¸€æ—¦å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å°†çº¦å®šçš„æ–‡ä»¶ä¼ è¾“ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°åå‘é€å­—ç¬¦ä¸²ã€ŒThank youã€ç»™æœåŠ¡å™¨ç«¯ã€‚
æ­¤å¤„ã€ŒThank youã€çš„ä¼ é€’æ˜¯å¤šä½™çš„ï¼Œè¿™åªæ˜¯ç”¨æ¥æ¨¡æ‹Ÿå®¢æˆ·ç«¯æ–­å¼€è¿æ¥å‰è¿˜æœ‰æ•°æ®è¦ä¼ è¾“çš„æƒ…å†µã€‚æ­¤æ—¶ç¨‹åºçš„è¿˜å«Œéš¾åº¦å¹¶ä¸å°ï¼Œå› ä¸ºä¼ è¾“æ–‡ä»¶çš„æœåŠ¡å™¨ç«¯åªéœ€è¿ç»­ä¼ è¾“æ–‡ä»¶æ•°æ®å³å¯ï¼Œè€Œå®¢æˆ·ç«¯æ— æ³•çŸ¥é“éœ€è¦æ¥æ”¶æ•°æ®åˆ°ä½•æ—¶ã€‚å®¢æˆ·ç«¯ä¹Ÿæ²¡åŠæ³•æ— ä¼‘æ­¢çš„è°ƒç”¨è¾“å…¥å‡½æ•°ï¼Œå› ä¸ºè¿™æœ‰å¯èƒ½å¯¼è‡´ç¨‹åºé˜»å¡ã€‚
æ˜¯å¦å¯ä»¥è®©æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çº¦å®šä¸€ä¸ªä»£è¡¨æ–‡ä»¶å°¾çš„å­—ç¬¦ï¼Ÿ
è¿™ç§æ–¹å¼ä¹Ÿæœ‰é—®é¢˜ï¼Œå› ä¸ºè¿™æ„å‘³è¿™æ–‡ä»¶ä¸­ä¸èƒ½æœ‰ä¸çº¦å®šå­—ç¬¦ç›¸åŒçš„å†…å®¹ã€‚ä¸ºäº†è§£å†³è¯¥é—®é¢˜ï¼ŒæœåŠ¡ç«¯åº”æœ€åå‘å®¢æˆ·ç«¯ä¼ é€’ EOF è¡¨ç¤ºæ–‡ä»¶ä¼ è¾“ç»“æŸã€‚å®¢æˆ·ç«¯é€šè¿‡å‡½æ•°è¿”å›å€¼æ¥å— EOF ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸æ–‡ä»¶å†…å®¹å†²çªã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒæœåŠ¡ç«¯å¦‚ä½•ä¼ é€’ EOF ï¼Ÿ
æ–­å¼€è¾“å‡ºæµæ—¶å‘ä¸»æœºä¼ è¾“ EOFã€‚
å½“ç„¶ï¼Œè°ƒç”¨ close å‡½æ•°çš„åŒæ—¶å…³é—­ I/O æµï¼Œè¿™æ ·ä¹Ÿä¼šå‘å¯¹æ–¹å‘é€ EOF ã€‚ä½†æ­¤æ—¶æ— æ³•å†æ¥å—å¯¹æ–¹ä¼ è¾“çš„æ•°æ®ã€‚æ¢è¨€ä¹‹ï¼Œè‹¥è°ƒç”¨ close å‡½æ•°å…³é—­æµï¼Œå°±æ— æ³•æ¥å—å®¢æˆ·ç«¯æœ€åå‘é€çš„å­—ç¬¦ä¸²ã€ŒThank youã€ã€‚è¿™æ—¶éœ€è¦è°ƒç”¨ shutdown å‡½æ•°ï¼Œåªå…³é—­æœåŠ¡å™¨çš„è¾“å‡ºæµã€‚è¿™æ ·æ—¢å¯ä»¥å‘é€ EOF ï¼ŒåŒæ—¶åˆä¿ç•™äº†è¾“å…¥æµã€‚ä¸‹é¢å®ç°æ”¶å‘æ–‡ä»¶çš„æœåŠ¡å™¨ç«¯/å®¢æˆ·ç«¯ã€‚
4. åŸºäºåŠå…³é—­çš„æ–‡ä»¶ä¼ è¾“ç¨‹åº serverä»£ç 
1{{#include chapter_7/file_server.c}} clientä»£ç 
1{{#include chapter_7/file_client.c}} `,url:"https://hugo-dead-simple.netlify.com/linux_tcp_program/tcpip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/chapter_7/"},"https://hugo-dead-simple.netlify.com/linux_tcp_program/tcpip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/chapter_8/":{title:"",tags:[],content:`ç¬¬ 8 ç«  åŸŸååŠç½‘ç»œåœ°å€ æœ¬ç« ä»£ç ï¼Œåœ¨TCP-IP-NetworkNoteä¸­å¯ä»¥æ‰¾åˆ°ã€‚
8.1 åŸŸåç³»ç»Ÿ DNS æ˜¯å¯¹IPåœ°å€å’ŒåŸŸåè¿›è¡Œç›¸äº’è½¬æ¢çš„ç³»ç»Ÿï¼Œå…¶æ ¸å¿ƒæ˜¯ DNS æœåŠ¡å™¨
8.1.1 ä»€ä¹ˆæ˜¯åŸŸå åŸŸåå°±æ˜¯æˆ‘ä»¬å¸¸å¸¸åœ¨åœ°å€æ é‡Œé¢è¾“å…¥çš„åœ°å€ï¼Œå°†æ¯”è¾ƒéš¾è®°å¿†çš„IPåœ°å€å˜æˆäººç±»å®¹æ˜“ç†è§£çš„ä¿¡æ¯ã€‚
8.1.2 DNS æœåŠ¡å™¨ ç›¸å½“äºä¸€ä¸ªå­—å…¸ï¼Œå¯ä»¥æŸ¥è¯¢å‡ºæŸä¸€ä¸ªåŸŸåå¯¹åº”çš„IPåœ°å€
å¦‚å›¾æ‰€ç¤ºï¼Œæ˜¾ç¤ºäº† DNS æœåŠ¡å™¨çš„æŸ¥è¯¢è·¯å¾„ã€‚
8.2 IPåœ°å€å’ŒåŸŸåä¹‹é—´çš„è½¬æ¢ 8.2.1 ç¨‹åºä¸­æœ‰å¿…è¦ä½¿ç”¨åŸŸåå—ï¼Ÿ ä¸€å¥è¯ï¼Œéœ€è¦ï¼Œå› ä¸ºIPåœ°å€å¯èƒ½ç»å¸¸æ”¹å˜ï¼Œè€Œä¸”ä¹Ÿä¸å®¹æ˜“è®°å¿†ï¼Œé€šè¿‡åŸŸåå¯ä»¥éšæ—¶æ›´æ”¹è§£æï¼Œè¾¾åˆ°æ›´æ¢IPçš„ç›®çš„
8.2.2 åˆ©ç”¨åŸŸåè·å–IPåœ°å€ ä½¿ç”¨ä»¥ä¸‹å‡½æ•°å¯ä»¥é€šè¿‡ä¼ é€’å­—ç¬¦ä¸²æ ¼å¼çš„åŸŸåè·å–IPåœ°å€
1#include &lt;netdb.h&gt; 2struct hostent *gethostbyname(const char *hostname); 3/* 4æˆåŠŸæ—¶è¿”å› hostent ç»“æ„ä½“åœ°å€ï¼Œå¤±è´¥æ—¶è¿”å› NULL æŒ‡é’ˆ 5*/ è¿™ä¸ªå‡½æ•°ä½¿ç”¨æ–¹ä¾¿ï¼Œåªè¦ä¼ é€’å­—ç¬¦ä¸²ï¼Œå°±å¯ä»¥è¿”å›åŸŸåå¯¹åº”çš„IPåœ°å€ã€‚åªæ˜¯è¿”å›æ—¶ï¼Œåœ°å€ä¿¡æ¯è£…å…¥ hostent ç»“æ„ä½“ã€‚æ­¤ç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹ï¼š
1struct hostent 2{ 3 char *h_name; /* Official name of host. */ 4 char **h_aliases; /* Alias list. */ 5 int h_addrtype; /* Host address type. */ 6 int h_length; /* Length of address. */ 7 char **h_addr_list; /* List of addresses from name server. */ 8}; ä»ä¸Šè¿°ç»“æ„ä½“å¯ä»¥çœ‹å‡ºï¼Œä¸æ­¢è¿”å›IPä¿¡æ¯ï¼ŒåŒäº‹è¿˜å¸¦ç€å…¶ä»–ä¿¡æ¯ä¸€èµ·è¿”å›ã€‚åŸŸåè½¬æ¢æˆIPæ—¶åªéœ€è¦å…³æ³¨ h_addr_list ã€‚ä¸‹é¢ç®€è¦è¯´æ˜ä¸Šè¿°ç»“æ„ä½“çš„æˆå‘˜ï¼š
h_nameï¼šè¯¥å˜é‡ä¸­å­˜æœ‰å®˜æ–¹åŸŸåï¼ˆOfficial domain nameï¼‰ã€‚å®˜æ–¹åŸŸåä»£è¡¨æŸä¸€ä¸»é¡µï¼Œä½†å®é™…ä¸Šï¼Œä¸€äº›è‘—åå…¬å¸çš„åŸŸåå¹¶æ²¡æœ‰ç”¨å®˜æ–¹åŸŸåæ³¨å†Œã€‚ h_aliasesï¼šå¯ä»¥é€šè¿‡å¤šä¸ªåŸŸåè®¿é—®åŒä¸€ä¸»é¡µã€‚åŒä¸€IPå¯ä»¥ç»‘å®šå¤šä¸ªåŸŸåï¼Œå› æ­¤ï¼Œé™¤å®˜æ–¹åŸŸåå¤–è¿˜å¯ä»¥æŒ‡å®šå…¶ä»–åŸŸåã€‚è¿™äº›ä¿¡æ¯å¯ä»¥é€šè¿‡ h_aliases è·å¾—ã€‚ h_addrtypeï¼šgethostbyname å‡½æ•°ä¸ä»…æ”¯æŒ IPV4 è¿˜æ”¯æŒ IPV6 ã€‚å› æ­¤å¯ä»¥é€šè¿‡æ­¤å˜é‡è·å–ä¿å­˜åœ¨ h_addr_list çš„IPåœ°å€æ—ä¿¡æ¯ã€‚è‹¥æ˜¯ IPV4 ï¼Œåˆ™æ­¤å˜é‡ä¸­å­˜æœ‰ AF_INETã€‚ h_lengthï¼šä¿å­˜IPåœ°å€é•¿åº¦ã€‚è‹¥æ˜¯ IPV4 åœ°å€ï¼Œå› ä¸ºæ˜¯ 4 ä¸ªå­—èŠ‚ï¼Œåˆ™ä¿å­˜4ï¼›IPV6 æ—¶ï¼Œå› ä¸ºæ˜¯ 16 ä¸ªå­—èŠ‚ï¼Œæ•…ä¿å­˜ 16 h_addr_listï¼šè¿™ä¸ªæ˜¯æœ€é‡è¦çš„çš„æˆå‘˜ã€‚é€šè¿‡æ­¤å˜é‡ä»¥æ•´æ•°å½¢å¼ä¿å­˜åŸŸåç›¸å¯¹åº”çš„IPåœ°å€ã€‚å¦å¤–ï¼Œç”¨æˆ·æ¯”è¾ƒå¤šçš„ç½‘ç«™æœ‰å¯èƒ½åˆ†é…å¤šä¸ªIPåœ°å€ç»™åŒä¸€ä¸ªåŸŸåï¼Œåˆ©ç”¨å¤šä¸ªæœåŠ¡å™¨åšè´Ÿè½½å‡è¡¡ï¼Œã€‚æ­¤æ—¶å¯ä»¥é€šè¿‡æ­¤å˜é‡è·å–IPåœ°å€ä¿¡æ¯ã€‚ è°ƒç”¨ gethostbyname å‡½æ•°åï¼Œè¿”å›çš„ç»“æ„ä½“å˜é‡å¦‚å›¾æ‰€ç¤ºï¼š
ä¸‹é¢çš„ä»£ç é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥æ¼”ç¤º gethostbyname çš„åº”ç”¨ï¼Œå¹¶è¯´æ˜ hostent ç»“æ„ä½“å˜é‡ç‰¹æ€§ã€‚
gethostbyname.c ç¼–è¯‘è¿è¡Œï¼š
1gcc gethostbyname.c -o hostname 2./hostname www.baidu.com ç»“æœï¼š
å¦‚å›¾æ‰€ç¤ºï¼Œæ˜¾ç¤ºå‡ºäº†å¯¹ç™¾åº¦çš„åŸŸåè§£æ
å¯ä»¥çœ‹å‡ºï¼Œç™¾åº¦æœ‰ä¸€ä¸ªåŸŸåè§£ææ˜¯ CNAME è§£æçš„ï¼ŒæŒ‡å‘äº†shifen.comï¼Œå…³äºç™¾åº¦å…·ä½“çš„è§£æè¿‡ç¨‹ã€‚
è¿™ä¸€éƒ¨åˆ†ç‰µæ‰¯åˆ°äº†å¾ˆå¤šå…³äºDNSè§£æçš„è¿‡ç¨‹ï¼Œè¿˜æœ‰ Linux ä¸‹å…³äºåŸŸåè§£æçš„ä¸€äº›å‘½ä»¤ï¼Œæˆ‘æ‰¾äº†ä¸€éƒ¨åˆ†èµ„æ–™ï¼Œå¯ä»¥ç‚¹ä¸‹é¢çš„é“¾æ¥æŸ¥çœ‹æ¯”è¾ƒè¯¦ç»†çš„ï¼š
å…³äºç™¾åº¦DNSçš„è§£æè¿‡ç¨‹ DNSè§£æçš„è¿‡ç¨‹æ˜¯ä»€ä¹ˆï¼Œæ±‚è¯¦ç»†çš„ï¼Ÿ Linux DNS æŸ¥è¯¢å‰–æ Linux DNSæŸ¥è¯¢å‘½ä»¤ Linuxä¸­DNSæœåŠ¡å™¨åœ°å€æŸ¥è¯¢å‘½ä»¤nslookupä½¿ç”¨æ•™ç¨‹ DNS åŸç†å…¥é—¨ ä»”ç»†é˜…è¯»è¿™ä¸€æ®µä»£ç ï¼š
1inet_ntoa(*(struct in_addr *)host-&gt;h_addr_list[i]) è‹¥åªçœ‹ hostent çš„å®šä¹‰ï¼Œç»“æ„ä½“æˆå‘˜ h_addr_list æŒ‡å‘å­—ç¬¦ä¸²æŒ‡é’ˆæ•°ç»„ï¼ˆç”±å¤šä¸ªå­—ç¬¦ä¸²åœ°å€æ„æˆçš„æ•°ç»„ï¼‰ã€‚ä½†æ˜¯å­—ç¬¦ä¸²æŒ‡é’ˆæ•°ç»„ä¿å­˜çš„å…ƒç´ å®é™…æŒ‡å‘çš„æ˜¯ in_addr ç»“æ„ä½“å˜é‡ä¸­åœ°å€å€¼è€Œéå­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯è¯´(struct in_addr *)host-&gt;h_addr_list[i]å…¶å®æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œç„¶åç”¨*ç¬¦å·å–å…·ä½“çš„å€¼ã€‚å¦‚å›¾æ‰€ç¤ºï¼š
8.2.3 åˆ©ç”¨IPåœ°å€è·å–åŸŸå è¯·çœ‹ä¸‹é¢çš„å‡½æ•°å®šä¹‰ï¼š
1#include &lt;netdb.h&gt; 2struct hostent *gethostbyaddr(const char *addr, socklen_t len, int family); 3/* 4æˆåŠŸæ—¶è¿”å› hostent ç»“æ„ä½“å˜é‡åœ°å€å€¼ï¼Œå¤±è´¥æ—¶è¿”å› NULL æŒ‡é’ˆ 5addr: å«æœ‰IPåœ°å€ä¿¡æ¯çš„ in_addr ç»“æ„ä½“æŒ‡é’ˆã€‚ä¸ºäº†åŒæ—¶ä¼ é€’ IPV4 åœ°å€ä¹‹å¤–çš„å…¨éƒ¨ä¿¡æ¯ï¼Œè¯¥å˜é‡çš„ç±»å‹å£°æ˜ä¸º char æŒ‡é’ˆ 6len: å‘ç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’çš„åœ°å€ä¿¡æ¯çš„å­—èŠ‚æ•°ï¼ŒIPV4æ—¶ä¸º 4 ï¼ŒIPV6 æ—¶ä¸º16. 7family: ä¼ é€’åœ°å€æ—ä¿¡æ¯ï¼Œipv4 æ˜¯ AF_INET ï¼ŒIPV6æ˜¯ AF_INET6 8*/ ä¸‹é¢çš„ä»£ç æ¼”ç¤ºä½¿ç”¨æ–¹æ³•ï¼š
gethostbyaddr.c ç¼–è¯‘è¿è¡Œï¼š
1gcc gethostbyaddr.c -o hostaddr 2./hostaddr 8.8.8.8 ç»“æœï¼š
ä»å›¾ä¸Šå¯ä»¥çœ‹å‡ºï¼Œ8.8.8.8è¿™ä¸ªIPåœ°å€æ˜¯è°·æ­Œçš„ã€‚
8.3 åŸºäº Windows çš„å®ç° æš‚ç•¥
8.4 ä¹ é¢˜ ä»¥ä¸‹ç­”æ¡ˆä»…ä»£è¡¨æœ¬äººä¸ªäººè§‚ç‚¹ï¼Œå¯èƒ½ä¸æ˜¯æ­£ç¡®ç­”æ¡ˆã€‚
ä¸‹åˆ—å…³äºDNSçš„è¯´æ³•é”™è¯¯çš„æ˜¯ï¼Ÿ
ç­”ï¼šå­—ä½“åŠ ç²—çš„è¡¨ç¤ºæ­£ç¡®ç­”æ¡ˆã€‚
å› ä¸ºDNSä»å­˜åœ¨ï¼Œæ•…å¯ä»¥ä½¿ç”¨åŸŸåä»£æ›¿IP DNSæœåŠ¡å™¨å®é™…ä¸Šæ˜¯è·¯ç”±å™¨ï¼Œå› ä¸ºè·¯ç”±å™¨æ ¹æ®åŸŸåå†³å®šæ•°æ®çš„è·¯å¾„ æ‰€æœ‰åŸŸåä¿¡æ¯å¹¶éé›†ä¸­ä¸ 1 å° DNS æœåŠ¡å™¨ï¼Œä½†å¯ä»¥è·å–æŸä¸€ DNS æœåŠ¡å™¨ä¸­æœªæ³¨å†Œçš„æ‰€æœ‰åœ°å€ DNS æœåŠ¡å™¨æ ¹æ®æ“ä½œç³»ç»Ÿè¿›è¡ŒåŒºåˆ†ï¼ŒWindows ä¸‹çš„ DNS æœåŠ¡å™¨å’Œ Linux ä¸‹çš„ DNS æœåŠ¡å™¨æ˜¯ä¸åŒçš„ã€‚ é˜…è¯»å¦‚ä¸‹å¯¹è¯ï¼Œå¹¶è¯´æ˜ä¸œç§€çš„æ–¹æ¡ˆæ˜¯å¦å¯è¡Œã€‚ï¼ˆå› ä¸ºå¯¹è¯çš„å­—å¤ªå¤šï¼Œç”¨å›¾ä»£æ›¿ï¼‰
ç­”ï¼šç­”æ¡ˆå°±æ˜¯å¯è¡Œï¼ŒDNS æœåŠ¡å™¨æ˜¯åˆ†å¸ƒå¼çš„ï¼Œä¸€å°åäº†å¯ä»¥æ‰¾å…¶ä»–çš„ã€‚
åœ¨æµè§ˆå™¨åœ°å€è¾“å…¥ www.orentec.co.kr ï¼Œå¹¶æ•´ç†å‡ºä¸»é¡µæ˜¾ç¤ºè¿‡ç¨‹ã€‚å‡è®¾æµè§ˆå™¨è®¿é—®é»˜è®¤ DNS æœåŠ¡å™¨ä¸­å¹¶æ²¡æœ‰å…³äº www.orentec.co.kr çš„åœ°å€ä¿¡æ¯.
ç­”ï¼šå¯ä»¥å‚è€ƒä¸€ä¸‹çŸ¥ä¹å›ç­”ï¼Œåœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ä¸€ä¸ªURLåå›è½¦ï¼ŒèƒŒåä¼šè¿›è¡Œå“ªäº›æŠ€æœ¯æ­¥éª¤ï¼Ÿ,æˆ‘ç”¨æˆ‘è‡ªå·±çš„ç†è§£ï¼Œç®€å•è¯´ä¸€ä¸‹ï¼Œé¦–å…ˆä¼šå»å‘ä¸Šä¸€çº§çš„ DNS æœåŠ¡å™¨å»æŸ¥è¯¢ï¼Œé€šè¿‡è¿™ç§æ–¹å¼é€çº§å‘ä¸Šä¼ é€’ä¿¡æ¯ï¼Œä¸€ç›´åˆ°è¾¾æ ¹æœåŠ¡å™¨æ—¶ï¼Œå®ƒçŸ¥é“åº”è¯¥å‘å“ªä¸ª DNS æœåŠ¡å™¨å‘èµ·è¯¢é—®ã€‚å‘ä¸‹ä¼ é€’è§£æè¯·æ±‚ï¼Œå¾—åˆ°IPåœ°å€å€™åŸè·¯è¿”å›ï¼Œæœ€åä¼šå°†è§£æçš„IPåœ°å€ä¼ é€’åˆ°å‘èµ·è¯·æ±‚çš„ä¸»æœºã€‚
ä»£ç  gethostbyaddr.c
1{{#include chapter_8/gethostbyaddr.c}} gethostbyname.c
1{{#include chapter_8/gethostbyname.c}} `,url:"https://hugo-dead-simple.netlify.com/linux_tcp_program/tcpip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/chapter_8/"},"https://hugo-dead-simple.netlify.com/linux_tcp_program/tcpip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/chapter_9/":{title:"",tags:[],content:`ç¬¬ 9 ç«  å¥—æ¥å­—çš„å¤šç§å¯é€‰é¡¹ æœ¬ç« ä»£ç ï¼Œåœ¨TCP-IP-NetworkNoteä¸­å¯ä»¥æ‰¾åˆ°ã€‚
9.1 å¥—æ¥å­—å¯é€‰é¡¹å’Œ I/O ç¼“å†²å¤§å° æˆ‘ä»¬è¿›è¡Œå¥—æ¥å­—ç¼–ç¨‹æ—¶å¾€å¾€åªå…³æ³¨æ•°æ®é€šä¿¡ï¼Œè€Œå¿½ç•¥äº†å¥—æ¥å­—å…·æœ‰çš„ä¸åŒç‰¹æ€§ã€‚ä½†æ˜¯ï¼Œç†è§£è¿™äº›ç‰¹æ€§å¹¶æ ¹æ®å®é™…éœ€è¦è¿›è¡Œæ›´æ”¹ä¹Ÿå¾ˆé‡è¦
9.1.1 å¥—æ¥å­—å¤šç§å¯é€‰é¡¹ æˆ‘ä»¬ä¹‹å‰å†™å¾—ç¨‹åºéƒ½æ˜¯åˆ›å»ºå¥½å¥—æ¥å­—ä¹‹åç›´æ¥ä½¿ç”¨çš„ï¼Œæ­¤æ—¶é€šè¿‡é»˜è®¤çš„å¥—æ¥å­—ç‰¹æ€§è¿›è¡Œæ•°æ®é€šä¿¡ï¼Œè¿™é‡Œåˆ—å‡ºäº†ä¸€äº›å¥—æ¥å­—å¯é€‰é¡¹ã€‚
åè®®å±‚ é€‰é¡¹å è¯»å– è®¾ç½® SOL_SOCKET SO_SNDBUF O O SOL_SOCKET SO_RCVBUF O O SOL_SOCKET SO_REUSEADDR O O SOL_SOCKET SO_KEEPALIVE O O SOL_SOCKET SO_BROADCAST O O SOL_SOCKET SO_DONTROUTE O O SOL_SOCKET SO_OOBINLINE O O SOL_SOCKET SO_ERROR O X SOL_SOCKET SO_TYPE O X IPPROTO_IP IP_TOS O O IPPROTO_IP IP_TTL O O IPPROTO_IP IP_MULTICAST_TTL O O IPPROTO_IP IP_MULTICAST_LOOP O O IPPROTO_IP IP_MULTICAST_IF O O IPPROTO_TCP TCP_KEEPALIVE O O IPPROTO_TCP TCP_NODELAY O O IPPROTO_TCP TCP_MAXSEG O O ä»è¡¨ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¥—æ¥å­—å¯é€‰é¡¹æ˜¯åˆ†å±‚çš„ã€‚
IPPROTO_IP å¯é€‰é¡¹æ˜¯IPåè®®ç›¸å…³äº‹é¡¹
IPPROTO_TCP å±‚å¯é€‰é¡¹æ˜¯ TCP åè®®çš„ç›¸å…³äº‹é¡¹
SOL_SOCKET å±‚æ˜¯å¥—æ¥å­—çš„é€šç”¨å¯é€‰é¡¹ã€‚
9.1.2 getsockopt &amp; setsockopt å¯é€‰é¡¹çš„è¯»å–å’Œè®¾ç½®é€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°æ¥å®Œæˆ
1#include &lt;sys/socket.h&gt; 2 3int getsockopt(int sock, int level, int optname, void *optval, socklen_t *optlen); 4/* 5æˆåŠŸæ—¶è¿”å› 0 ï¼Œå¤±è´¥æ—¶è¿”å› -1 6sock: ç”¨äºæŸ¥çœ‹é€‰é¡¹å¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦ 7level: è¦æŸ¥çœ‹çš„å¯é€‰é¡¹åè®®å±‚ 8optname: è¦æŸ¥çœ‹çš„å¯é€‰é¡¹å 9optval: ä¿å­˜æŸ¥çœ‹ç»“æœçš„ç¼“å†²åœ°å€å€¼ 10optlen: å‘ç¬¬å››ä¸ªå‚æ•°ä¼ é€’çš„ç¼“å†²å¤§å°ã€‚è°ƒç”¨å‡½æ•°å€™ï¼Œè¯¥å˜é‡ä¸­ä¿å­˜é€šè¿‡ç¬¬å››ä¸ªå‚æ•°è¿”å›çš„å¯é€‰é¡¹ä¿¡æ¯çš„å­—èŠ‚æ•°ã€‚ 11*/ ä¸Šè¿°å‡½æ•°å¯ä»¥ç”¨æ¥è¯»å–å¥—æ¥å­—å¯é€‰é¡¹ï¼Œä¸‹é¢çš„å‡½æ•°å¯ä»¥æ›´æ”¹å¯é€‰é¡¹ï¼šd
1#include &lt;sys/socket.h&gt; 2 3int setsockopt(int sock, int level, int optname, const void *optval, socklen_t optlen); 4/* 5æˆåŠŸæ—¶è¿”å› 0 ï¼Œå¤±è´¥æ—¶è¿”å› -1 6sock: ç”¨äºæ›´æ”¹é€‰é¡¹å¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦ 7level: è¦æ›´æ”¹çš„å¯é€‰é¡¹åè®®å±‚ 8optname: è¦æ›´æ”¹çš„å¯é€‰é¡¹å 9optval: ä¿å­˜æ›´æ”¹ç»“æœçš„ç¼“å†²åœ°å€å€¼ 10optlen: å‘ç¬¬å››ä¸ªå‚æ•°ä¼ é€’çš„ç¼“å†²å¤§å°ã€‚è°ƒç”¨å‡½æ•°åï¼Œè¯¥å˜é‡ä¸­ä¿å­˜é€šè¿‡ç¬¬å››ä¸ªå‚æ•°è¿”å›çš„å¯é€‰é¡¹ä¿¡æ¯çš„å­—èŠ‚æ•°ã€‚ 11*/ ä¸‹é¢çš„ä»£ç å¯ä»¥çœ‹å‡º getsockopt çš„ä½¿ç”¨æ–¹æ³•ã€‚ä¸‹é¢ç¤ºä¾‹ç”¨åè®®å±‚ä¸º SOL_SOCKET ã€åä¸º SO_TYPE çš„å¯é€‰é¡¹æŸ¥çœ‹å¥—æ¥å­—ç±»å‹ï¼ˆTCP å’Œ UDP ï¼‰ã€‚
sock_type.c ç¼–è¯‘è¿è¡Œï¼š
1gcc sock_type.c -o sock_type 2./sock_type ç»“æœï¼š
1SOCK_STREAM: 1 2SOCK_DGRAM: 2 3Socket type one: 1 4Socket type two: 2 é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª TCP å¥—æ¥å­—å’Œä¸€ä¸ª UDP å¥—æ¥å­—ã€‚ç„¶åé€šè¿‡è°ƒç”¨ getsockopt å‡½æ•°æ¥è·å¾—å½“å‰å¥—æ¥å­—çš„çŠ¶æ€ã€‚
ç”¨äºéªŒè¯å¥—æ¥ç±»å‹çš„ SO_TYPE æ˜¯åªè¯»å¯é€‰é¡¹ï¼Œå› ä¸ºå¥—æ¥å­—ç±»å‹åªèƒ½åœ¨åˆ›å»ºæ—¶å†³å®šï¼Œä»¥åä¸èƒ½å†æ›´æ”¹ã€‚
9.1.3 SO_SNDBUF &amp; SO_RCVBUF åˆ›å»ºå¥—æ¥å­—çš„åŒæ—¶ä¼šç”Ÿæˆ I/O ç¼“å†²ã€‚å…³äº I/O ç¼“å†²ï¼Œå¯ä»¥å»çœ‹ç¬¬äº”ç« ã€‚
SO_RCVBUF æ˜¯è¾“å…¥ç¼“å†²å¤§å°ç›¸å…³å¯é€‰é¡¹ï¼ŒSO_SNDBUF æ˜¯è¾“å‡ºç¼“å†²å¤§å°ç›¸å…³å¯é€‰é¡¹ã€‚ç”¨è¿™ 2 ä¸ªå¯é€‰é¡¹æ—¢å¯ä»¥è¯»å–å½“å‰ I/O å¤§å°ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œæ›´æ”¹ã€‚é€šè¿‡ä¸‹åˆ—ç¤ºä¾‹è¯»å–åˆ›å»ºå¥—æ¥å­—æ—¶é»˜è®¤çš„ I/O ç¼“å†²å¤§å°ã€‚
get_buf.c ç¼–è¯‘è¿è¡Œï¼š
1gcc get_buf.c -o getbuf 2./getbuf è¿è¡Œç»“æœï¼š
1Input buffer size: 87380 2Output buffer size: 16384 å¯ä»¥çœ‹å‡ºæœ¬æœºçš„è¾“å…¥ç¼“å†²å’Œè¾“å‡ºç¼“å†²å¤§å°ã€‚
ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†ï¼Œé€šè¿‡ç¨‹åºè®¾ç½® I/O ç¼“å†²åŒºçš„å¤§å°
set_buf.c ç¼–è¯‘è¿è¡Œï¼š
1gcc get_buf.c -o setbuf 2./setbuf ç»“æœ:
1Input buffer size: 6144 2Output buffer size: 6144 è¾“å‡ºç»“æœå’Œæˆ‘ä»¬é¢„æƒ³çš„ä¸æ˜¯å¾ˆç›¸åŒï¼Œç¼“å†²å¤§å°çš„è®¾ç½®éœ€è°¨æ…å¤„ç†ï¼Œå› æ­¤ä¸ä¼šå®Œå…¨æŒ‰ç…§æˆ‘ä»¬çš„è¦æ±‚è¿›è¡Œã€‚
9.2 SO_REUSEADDR 9.2.1 å‘ç”Ÿåœ°å€åˆ†é…é”™è¯¯ï¼ˆBinding Errorï¼‰ åœ¨å­¦ä¹  SO_REUSEADDR å¯é€‰é¡¹ä¹‹å‰ï¼Œåº”è¯¥å¥½å¥½ç†è§£ Time-wait çŠ¶æ€ã€‚çœ‹ä»¥ä¸‹ä»£ç çš„ç¤ºä¾‹ï¼š
reuseadr_eserver.c è¿™æ˜¯ä¸€ä¸ªå›å£°æœåŠ¡å™¨çš„æœåŠ¡ç«¯ä»£ç ï¼Œå¯ä»¥é…åˆç¬¬å››ç« çš„ echo_client.c ä½¿ç”¨ï¼Œåœ¨è¿™ä¸ªä»£ç ä¸­ï¼Œå®¢æˆ·ç«¯é€šçŸ¥æœåŠ¡å™¨ç»ˆæ­¢ç¨‹åºã€‚åœ¨å®¢æˆ·ç«¯æ§åˆ¶å°è¾“å…¥ Q å¯ä»¥ç»“æŸç¨‹åºï¼Œå‘æœåŠ¡å™¨å‘é€ FIN æ¶ˆæ¯å¹¶ç»è¿‡å››æ¬¡æ¡æ‰‹è¿‡ç¨‹ã€‚å½“ç„¶ï¼Œè¾“å…¥ CTRL+C ä¹Ÿä¼šå‘æœåŠ¡å™¨ä¼ é€’ FIN ä¿¡æ¯ã€‚å¼ºåˆ¶ç»ˆæ­¢ç¨‹åºæ—¶ï¼Œç”±æ“ä½œç³»ç»Ÿå…³é—­æ–‡ä»¶å¥—æ¥å­—ï¼Œæ­¤è¿‡ç¨‹ç›¸å½“äºè°ƒç”¨ close å‡½æ•°ï¼Œä¹Ÿä¼šå‘æœåŠ¡å™¨å‘é€ FIN æ¶ˆæ¯ã€‚
è¿™æ ·çœ‹ä¸åˆ°æ˜¯ä»€ä¹ˆç‰¹æ®Šç°è±¡ï¼Œè€ƒè™‘ä»¥ä¸‹æƒ…å†µï¼š
æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯éƒ½å·²ç»å»ºç«‹è¿æ¥çš„çŠ¶æ€ä¸‹ï¼Œå‘æœåŠ¡å™¨æ§åˆ¶å°è¾“å…¥ CTRL+C ï¼Œå¼ºåˆ¶å…³é—­æœåŠ¡ç«¯
å¦‚æœç”¨è¿™ç§æ–¹å¼ç»ˆæ­¢ç¨‹åºï¼Œå¦‚æœç”¨åŒä¸€ç«¯å£å·å†æ¬¡è¿è¡ŒæœåŠ¡ç«¯ï¼Œå°±ä¼šè¾“å‡ºã€Œbind() errorã€æ¶ˆæ¯ï¼Œå¹¶ä¸”æ— æ³•å†æ¬¡è¿è¡Œã€‚ä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå†è¿‡å¤§çº¦ 3 åˆ†é’Ÿå°±å¯ä»¥é‡æ–°è¿è¡ŒæœåŠ¡ç«¯ã€‚
9.2.2 Time-wait çŠ¶æ€ è§‚å¯Ÿä»¥ä¸‹è¿‡ç¨‹ï¼š
å‡è®¾å›¾ä¸­ä¸»æœº A æ˜¯æœåŠ¡å™¨ï¼Œå› ä¸ºæ˜¯ä¸»æœº A å‘ B å‘é€ FIN æ¶ˆæ¯ï¼Œæ•…å¯æƒ³è±¡æˆæœåŠ¡å™¨ç«¯åœ¨æ§åˆ¶å°ä¸­è¾“å…¥ CTRL+C ã€‚ä½†æ˜¯é—®é¢˜æ˜¯ï¼Œå¥—æ¥å­—ç»è¿‡å››æ¬¡æ¡æ‰‹åå¹¶æ²¡æœ‰ç«‹å³æ¶ˆé™¤ï¼Œè€Œæ˜¯è¦ç»è¿‡ä¸€æ®µæ—¶é—´çš„ Time-wait çŠ¶æ€ã€‚å½“ç„¶ï¼Œåªæœ‰å…ˆæ–­å¼€è¿æ¥çš„ï¼ˆå…ˆå‘é€ FIN æ¶ˆæ¯çš„ï¼‰ä¸»æœºæ‰ç»è¿‡ Time-wait çŠ¶æ€ã€‚å› æ­¤ï¼Œè‹¥æœåŠ¡å™¨ç«¯å…ˆæ–­å¼€è¿æ¥ï¼Œåˆ™æ— æ³•ç«‹å³é‡æ–°è¿è¡Œã€‚å¥—æ¥å­—å¤„åœ¨ Time-wait è¿‡ç¨‹æ—¶ï¼Œç›¸åº”ç«¯å£æ˜¯æ­£åœ¨ä½¿ç”¨çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œå°±åƒä¹‹å‰éªŒè¯è¿‡çš„ï¼Œbind å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿé”™è¯¯ã€‚
å®é™…ä¸Šï¼Œä¸è®ºæ˜¯æœåŠ¡ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯ï¼Œéƒ½è¦ç»è¿‡ä¸€æ®µæ—¶é—´çš„ Time-wait è¿‡ç¨‹ã€‚å…ˆæ–­å¼€è¿æ¥çš„å¥—æ¥å­—å¿…ç„¶ä¼šç»è¿‡ Time-wait è¿‡ç¨‹ï¼Œä½†æ˜¯ç”±äºå®¢æˆ·ç«¯å¥—æ¥å­—çš„ç«¯å£æ˜¯ä»»æ„æŒ‡å®šçš„ï¼Œæ‰€ä»¥æ— éœ€è¿‡å¤šå…³æ³¨ Time-wait çŠ¶æ€ã€‚
é‚£åˆ°åº•ä¸ºä»€ä¹ˆä¼šæœ‰ Time-wait çŠ¶æ€å‘¢ï¼Œåœ¨å›¾ä¸­å‡è®¾ï¼Œä¸»æœº A å‘ä¸»æœº B ä¼ è¾“ ACK æ¶ˆæ¯ï¼ˆSEQ 5001 , ACK 7502 ï¼‰åç«‹åˆ»æ¶ˆé™¤å¥—æ¥å­—ã€‚ä½†æ˜¯æœ€åè¿™æ¡ ACK æ¶ˆæ¯åœ¨ä¼ é€’è¿‡ç¨‹ä¸­ä¸¢å¤±ï¼Œæ²¡æœ‰ä¼ é€’ä¸»æœº B ï¼Œè¿™æ—¶ä¸»æœº B å°±ä¼šè¯•å›¾é‡ä¼ ã€‚ä½†æ˜¯æ­¤æ—¶ä¸»æœº A å·²ç»æ˜¯å®Œå…¨ç»ˆæ­¢çŠ¶æ€ï¼Œå› æ­¤ä¸»æœº B æ°¸è¿œæ— æ³•æ”¶åˆ°ä»ä¸»æœº A æœ€åä¼ æ¥çš„ ACK æ¶ˆæ¯ã€‚åŸºäºè¿™äº›é—®é¢˜çš„è€ƒè™‘ï¼Œæ‰€ä»¥è¦è®¾è®¡ Time-wait çŠ¶æ€ã€‚
9.2.3 åœ°å€å†åˆ†é… Time-wait çŠ¶æ€çœ‹ä¼¼é‡è¦ï¼Œä½†æ˜¯ä¸ä¸€å®šè®¨äººå–œæ¬¢ã€‚å¦‚æœç³»ç»Ÿå‘ç”Ÿæ•…éšœç´§æ€¥åœæ­¢ï¼Œè¿™æ—¶éœ€è¦å°½å¿«é‡å¯æœåŠ¡èµ·ä»¥æä¾›æœåŠ¡ï¼Œä½†å› å¤„äº Time-wait çŠ¶æ€è€Œå¿…é¡»ç­‰å¾…å‡ åˆ†é’Ÿã€‚å› æ­¤ï¼ŒTime-wait å¹¶éåªæœ‰ä¼˜ç‚¹ï¼Œè¿™äº›æƒ…å†µä¸‹å®¹æ˜“å¼•å‘å¤§é—®é¢˜ã€‚ä¸‹å›¾ä¸­å±•ç¤ºäº†å››æ¬¡æ¡æ‰‹æ—¶ä¸å¾—ä¸å»¶é•¿ Time-wait è¿‡ç¨‹çš„æƒ…å†µã€‚
ä»å›¾ä¸Šå¯ä»¥çœ‹å‡ºï¼Œåœ¨ä¸»æœº A å››æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ€åçš„æ•°æ®ä¸¢å¤±ï¼Œåˆ™ä¸»æœº B ä¼šè®¤ä¸ºä¸»æœº A æœªèƒ½æ”¶åˆ°è‡ªå·±å‘é€çš„ FIN ä¿¡æ¯ï¼Œå› æ­¤é‡ä¼ ã€‚è¿™æ—¶ï¼Œæ”¶åˆ°çš„ FIN æ¶ˆæ¯çš„ä¸»æœº A å°†é‡å¯ Time-wait è®¡æ—¶å™¨ã€‚å› æ­¤ï¼Œå¦‚æœç½‘ç»œçŠ¶å†µä¸ç†æƒ³ï¼Œ Time-wait å°†æŒç»­ã€‚
è§£å†³æ–¹æ¡ˆå°±æ˜¯åœ¨å¥—æ¥å­—çš„å¯é€‰é¡¹ä¸­æ›´æ”¹ SO_REUSEADDR çš„çŠ¶æ€ã€‚é€‚å½“è°ƒæ•´è¯¥å‚æ•°ï¼Œå¯å°† Time-wait çŠ¶æ€ä¸‹çš„å¥—æ¥å­—ç«¯å£å·é‡æ–°åˆ†é…ç»™æ–°çš„å¥—æ¥å­—ã€‚SO_REUSEADDR çš„é»˜è®¤å€¼ä¸º 0.è¿™å°±æ„å‘³ç€æ— æ³•åˆ†é… Time-wait çŠ¶æ€ä¸‹çš„å¥—æ¥å­—ç«¯å£å·ã€‚å› æ­¤éœ€è¦å°†è¿™ä¸ªå€¼æ”¹æˆ 1 ã€‚å…·ä½“ä½œæ³•å·²åœ¨ç¤ºä¾‹ reuseadr_eserver.c ç»™å‡ºï¼Œåªéœ€è¦æŠŠæ³¨é‡Šæ‰çš„ä¸œè¥¿è§£é™¤æ³¨é‡Šå³å¯ã€‚
1optlen = sizeof(option); 2option = TRUE; 3setsockopt(serv_sock, SOL_SOCKET, SO_REUSEADDR, (void *)&amp;option, optlen); æ­¤æ—¶ï¼Œå·²ç»è§£å†³äº†ä¸Šè¿°é—®é¢˜ã€‚
9.3 TCP_NODELAY 9.3.1 Nagle ç®—æ³• ä¸ºäº†é˜²æ­¢å› æ•°æ®åŒ…è¿‡å¤šè€Œå‘ç”Ÿç½‘ç»œè¿‡è½½ï¼ŒNagle ç®—æ³•è¯ç”Ÿäº†ã€‚å®ƒåº”ç”¨äº TCP å±‚ã€‚å®ƒæ˜¯å¦ä½¿ç”¨ä¼šå¯¼è‡´å¦‚å›¾æ‰€ç¤ºçš„å·®å¼‚ï¼š
å›¾ä¸­å±•ç¤ºäº†é€šè¿‡ Nagle ç®—æ³•å‘é€å­—ç¬¦ä¸² Nagle å’Œæœªä½¿ç”¨ Nagle ç®—æ³•çš„å·®åˆ«ã€‚å¯ä»¥å¾—åˆ°ä¸€ä¸ªç»“è®ºã€‚
åªæœ‰æ¥æ”¶åˆ°å‰ä¸€æ•°æ®çš„ ACK æ¶ˆæ¯ï¼Œ Nagle ç®—æ³•æ‰å‘é€ä¸‹ä¸€æ•°æ®ã€‚
TCP å¥—æ¥å­—é»˜è®¤ä½¿ç”¨ Nagle ç®—æ³•äº¤æ¢æ•°æ®ï¼Œå› æ­¤æœ€å¤§é™åº¦çš„è¿›è¡Œç¼“å†²ï¼Œç›´åˆ°æ”¶åˆ° ACK ã€‚å·¦å›¾ä¹Ÿå°±æ˜¯è¯´ä¸€å…±ä¼ é€’ 4 ä¸ªæ•°æ®åŒ…ä»¥ä¼ è¾“ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ä»å³å›¾å¯ä»¥çœ‹å‡ºï¼Œå‘é€æ•°æ®åŒ…ä¸€å…±ä½¿ç”¨äº† 10 ä¸ªæ•°æ®åŒ…ã€‚ç”±æ­¤å¯çŸ¥ï¼Œä¸ä½¿ç”¨ Nagle ç®—æ³•å°†å¯¹ç½‘ç»œæµé‡äº§ç”Ÿè´Ÿé¢å½±å“ã€‚å³ä½¿åªä¼ è¾“ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œå…¶å¤´ä¿¡æ¯éƒ½å¯èƒ½æ˜¯å‡ åä¸ªå­—èŠ‚ã€‚å› æ­¤ï¼Œä¸ºäº†æé«˜ç½‘ç»œä¼ è¾“æ•ˆç‡ï¼Œå¿…é¡»ä½¿ç”¨ Nagle ç®—æ³•ã€‚
Nagle ç®—æ³•å¹¶ä¸æ˜¯ä»€ä¹ˆæƒ…å†µä¸‹éƒ½é€‚ç”¨ï¼Œç½‘ç»œæµé‡æœªå—å¤ªå¤§å½±å“æ—¶ï¼Œä¸ä½¿ç”¨ Nagle ç®—æ³•è¦æ¯”ä½¿ç”¨å®ƒæ—¶ä¼ è¾“é€Ÿåº¦å¿«ã€‚æœ€å…¸å‹çš„å°±æ˜¯ã€Œä¼ è¾“å¤§æ–‡æ•°æ®ã€ã€‚å°†æ–‡ä»¶æ•°æ®ä¼ å…¥è¾“å‡ºç¼“å†²ä¸ä¼šèŠ±å¤ªå¤šæ—¶é—´ï¼Œå› æ­¤ï¼Œä¸ä½¿ç”¨ Nagle ç®—æ³•ï¼Œä¹Ÿä¼šåœ¨è£…æ»¡è¾“å‡ºç¼“å†²æ—¶ä¼ è¾“æ•°æ®åŒ…ã€‚è¿™ä¸ä»…ä¸ä¼šå¢åŠ æ•°æ®åŒ…çš„æ•°é‡ï¼Œåè€Œåœ¨æ— éœ€ç­‰å¾… ACK çš„å‰æä¸‹è¿ç»­ä¼ è¾“ï¼Œå› æ­¤å¯ä»¥å¤§å¤§æé«˜ä¼ è¾“é€Ÿåº¦ã€‚
æ‰€ä»¥ï¼Œæœªå‡†ç¡®åˆ¤æ–­æ•°æ®æ€§è´¨æ—¶ä¸åº”ç¦ç”¨ Nagle ç®—æ³•ã€‚
9.3.2 ç¦ç”¨ Nagle ç®—æ³• ç¦ç”¨ Nagle ç®—æ³•åº”è¯¥ä½¿ç”¨ï¼š
1int opt_val = 1; 2setsockopt(sock, IPPROTO_TCP, TCP_NODELAY, (void *)&amp;opt_val, sizeof(opt_val)); é€šè¿‡ TCP_NODELAY çš„å€¼æ¥æŸ¥çœ‹Nagle ç®—æ³•çš„è®¾ç½®çŠ¶æ€ã€‚
1opt_len = sizeof(opt_val); 2getsockopt(sock, IPPROTO_TCP, TCP_NODELAY, (void *)&amp;opt_val, &amp;opt_len); å¦‚æœæ­£åœ¨ä½¿ç”¨Nagle ç®—æ³•ï¼Œé‚£ä¹ˆ opt_val å€¼ä¸º 0ï¼Œå¦‚æœç¦ç”¨åˆ™ä¸º 1.
å…³äºè¿™ä¸ªç®—æ³•ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸ªå›ç­”ï¼šTCPè¿æ¥ä¸­å¯ç”¨å’Œç¦ç”¨TCP_NODELAYæœ‰ä»€ä¹ˆå½±å“ï¼Ÿ
9.4 åŸºäº Windows çš„å®ç° æš‚ç•¥
9.5 ä¹ é¢˜ ä»¥ä¸‹ç­”æ¡ˆä»…ä»£è¡¨æœ¬äººä¸ªäººè§‚ç‚¹ï¼Œå¯èƒ½ä¸æ˜¯æ­£ç¡®ç­”æ¡ˆã€‚
ä¸‹åˆ—å…³äº Time-wait çŠ¶æ€çš„è¯´æ³•é”™è¯¯çš„æ˜¯ï¼Ÿ
ç­”ï¼šä»¥ä¸‹å­—ä½“åŠ ç²—çš„ä»£è¡¨æ­£ç¡®ã€‚
Time-wait çŠ¶æ€åªåœ¨æœåŠ¡å™¨çš„å¥—æ¥å­—ä¸­å‘ç”Ÿ æ–­å¼€è¿æ¥çš„å››æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå…ˆä¼ è¾“ FIN æ¶ˆæ¯çš„å¥—æ¥å­—å°†è¿›å…¥ Time-wait çŠ¶æ€ã€‚ Time-wait çŠ¶æ€ä¸æ–­å¼€è¿æ¥çš„è¿‡ç¨‹æ— å…³ï¼Œè€Œä¸è¯·æ±‚è¿æ¥è¿‡ç¨‹ä¸­ SYN æ¶ˆæ¯çš„ä¼ è¾“é¡ºåºæœ‰å…³ Time-wait çŠ¶æ€é€šå¸¸å¹¶éå¿…è¦ï¼Œåº”å°½å¯èƒ½é€šè¿‡æ›´æ”¹å¥—æ¥å­—å¯é€‰é¡¹æ¥é˜²æ­¢å…¶å‘ç”Ÿ TCP_NODELAY å¯é€‰é¡¹ä¸ Nagle ç®—æ³•æœ‰å…³ï¼Œå¯é€šè¿‡å®ƒç¦ç”¨ Nagle ç®—æ³•ã€‚è¯·é—®ä½•æ—¶åº”è€ƒè™‘ç¦ç”¨ Nagle ç®—æ³•ï¼Ÿç»“åˆæ”¶å‘æ•°æ®çš„ç‰¹æ€§ç»™å‡ºè¯´æ˜ã€‚
ç­”ï¼šå½“ç½‘ç»œæµé‡æœªå—å¤ªå¤§å½±å“æ—¶ï¼Œä¸ä½¿ç”¨ Nagle ç®—æ³•è¦æ¯”ä½¿ç”¨å®ƒæ—¶ä¼ è¾“é€Ÿåº¦å¿«ï¼Œæ¯”å¦‚è¯´åœ¨ä¼ è¾“å¤§æ–‡ä»¶æ—¶ã€‚
ä»£ç  get_buf.c
1{{#include chapter_9/get_buf.c}} set_buf
1{{#include chapter_9/set_buf.c}} reuseadr_eserver
1{{#include chapter_9/reuseadr_eserver.c}} sock_type
1{{#include chapter_9/sock_type.c}} `,url:"https://hugo-dead-simple.netlify.com/linux_tcp_program/tcpip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/chapter_9/"},"https://hugo-dead-simple.netlify.com/linux_tcp_program/tcpip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/readme/":{title:"",tags:[],content:`è¯´æ˜ ä½œè€…: éŸ©å›½ - å°¹åœ£é›¨
å­¦ä¹ èµ„æº riba2534TCP-IP-NetworkNote ğŸ“˜ã€ŠTCPIPç½‘ç»œç¼–ç¨‹ã€‹(éŸ©-å°¹åœ£é›¨)å­¦ä¹ ç¬”è®° `,url:"https://hugo-dead-simple.netlify.com/linux_tcp_program/tcpip%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/readme/"},"https://hugo-dead-simple.netlify.com/mongodb/readme/":{title:"",tags:[],content:"",url:"https://hugo-dead-simple.netlify.com/mongodb/readme/"},"https://hugo-dead-simple.netlify.com/categories/":{title:"Categories",tags:[],content:"",url:"https://hugo-dead-simple.netlify.com/categories/"},"https://hugo-dead-simple.netlify.com/mongodb/":{title:"MongoDB å­¦ä¹ ç¬”è®°",tags:[],content:`è¿™é‡Œæ˜¯æˆ‘å­¦ä¹  MongoDB è¿‡ç¨‹ä¸­è®°å½•çš„æ‰€æœ‰ç¬”è®°å’Œç»ƒä¹ ã€‚
MongoDB - Lookup æ“ä½œè¯¦è§£ MongoDB ç»ƒä¹  1 MongoDB ç»ƒä¹  2 MongoDB ç»ƒä¹  3 MongoDB ç»ƒä¹  4 MongoDB - åœ¨æ•°ç»„ä¸ŠæŸ¥è¯¢ `,url:"https://hugo-dead-simple.netlify.com/mongodb/"},"https://hugo-dead-simple.netlify.com/search/":{title:"Search Results",tags:[],content:"",url:"https://hugo-dead-simple.netlify.com/search/"},"https://hugo-dead-simple.netlify.com/%E7%AE%97%E6%B3%95%E7%AB%9E%E8%B5%9B%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/":{title:"ç®—æ³•ç«èµ›è¿›é˜¶æŒ‡å— å­¦ä¹ ç¬”è®°",tags:[],content:" 0x00 åŸºæœ¬ç®—æ³• ",url:"https://hugo-dead-simple.netlify.com/%E7%AE%97%E6%B3%95%E7%AB%9E%E8%B5%9B%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/"},"https://hugo-dead-simple.netlify.com/":{title:"é¦–é¡µ",tags:[],content:" è¿™é‡Œæ˜¯rainboyå†™çš„æ–‡ç« , æ‰˜ç®¡åœ¨ GitHub ä»“åº“ ",url:"https://hugo-dead-simple.netlify.com/"}}</script><script defer src=/js/lunr.js></script><script defer src=/js/search.js></script><br><footer><div class=footer-info><p>Copyright &copy; 2025 Rainboy. All rights reserved.
<span>| Last build: 2025-09-07 12:16:37</span></p></div><script defer>document.addEventListener("keydown",function(e){if(document.activeElement.isContentEditable)return!1;if(document.activeElement.tagName=="INPUT")return!1;if(e.altKey||e.ctrlKey||e.shiftKey)return!1;var t=e.key;if(t==="h")e.preventDefault(),e.stopPropagation(),window.location.href="/";else if(t==="t")e.preventDefault(),e.stopPropagation(),window.location.href=`https://${location.hostname}/tags`;else if(t==="i"){e.preventDefault(),e.stopPropagation();const t=document.querySelectorAll("input");for(let e=0;e<t.length;e++)if(t[e].offsetParent!==null){t[e].selectionStart=t[e].selectionEnd=t[e].value.length,t[e].focus();break}}return!1})</script><script defer>function throttle(e,t){var n=Date.now();return function(){var s=Date.now();n+t-s<0&&(e(),n=s)}}function scrollHandler(){const e=Array.from(document.querySelectorAll("body h2, body h3"));function t(){for(var n,s,o,i=window.pageYOffset||document.documentElement.scrollTop,t=0;t<e.length;t++)s=e[t].getAttribute("id"),n=document.querySelector('nav ul li a[href="#'+s+'"]'),n&&n.classList.remove("active-toc");for(t=e.length-1;t>=0;t--)if(o=e[t].offsetTop,i>o-75&&(s=e[t].getAttribute("id"),n=document.querySelector('nav ul li a[href="#'+s+'"]'),n)){n.classList.add("active-toc");break}}window.addEventListener("scroll",throttle(t,200))}setTimeout(scrollHandler,100)</script><script defer>function addCopyButtonToCodeBlocks(){const e=document.querySelectorAll('code[class^="language-"]:not(.output):not([class*="language-console"])');e.forEach(e=>{const t=document.createElement("button");t.classList.add("copy-code-button"),t.innerHTML="copy",t.addEventListener("click",()=>{const s=e.querySelectorAll(".cl");let n="";s.forEach(e=>{n+=e.innerText}),navigator.clipboard.writeText(n),t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},1500)}),e.parentNode.before(t)})}setTimeout(function(){addCopyButtonToCodeBlocks()},100)</script><script defer src=/js/theme-switcher.js></script></footer></body></html>